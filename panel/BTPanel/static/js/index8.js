import{b as a,u as e,l as t,H as s,G as o,S as l,Y as n,M as i,k as r,V as c,h as p,o as u}from"./utils-lib.js?v=1734676359";import{_ as m}from"./index100.js?v=1734676359";import{_ as d}from"./index90.js?v=1734676359";import{_ as f}from"./index101.js?v=1734676359";import{_}from"./index97.js?v=1734676359";import{_ as h}from"./index99.js?v=1734676359";import{c as b,r as w,h as k,k as g,l as y,e as x,x as v,C as j,p as C,A as D,aZ as R,D as T,i as E,az as V,o as q,B as z,J as H,q as A,y as I,M as O,aY as P}from"./base-lib.js?v=1734676359";import{Y as U,Z as F}from"./config.js?v=1734676359";import{a as L,o as S,u as Y,c as M}from"./column.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";const Z=b({__name:"index",emits:["upload-success"],setup(e,{expose:t,emit:s}){const o=a(),l=s,n=w(),i=w(),r=window.location.protocol+"//"+window.location.host+"/panel/whole_machine_backup/input",c=k({f_size:0,f_path:"/www/backup/whole_machine_backup/",f_name:"",f_start:0}),p=w([]),u=[".tar.gz"].join(","),m=(a,e,t)=>{o.request(a),a.status&&l("upload-success")},d=(a,e,t)=>{o.error("导入失败")},f={"x-http-token":window.vite_public_request_token},_=a=>{a.value=a,c.f_size=a.size,c.f_name=a.name,c.f_start=0},h=(a,e)=>{p.value=e},b=(a,e,t)=>{c.f_start=a.percent,p.value=t.map((t=>(t.uid===e.uid&&(t.percentage=a.percent),t)))};return t({onConfirm:()=>{n.value.submit()},open:()=>{i.value.$el.click()},fileData:c}),(a,e)=>{const t=D,s=R;return g(),y("div",null,[x(s,{class:"upload-demo",ref_key:"uploadRef",ref:n,name:"blob",data:C(c),action:r,headers:f,accept:C(u),"on-error":d,multiple:!1,"show-file-list":!1,"auto-upload":!0,"on-success":m,"on-progress":b,"file-list":C(p),"on-change":h,"before-upload":_},{default:v((()=>[j(x(t,{ref_key:"openRef",ref:i,size:"small",type:"primary"},null,512),[[T,!1]])])),_:1},8,["data","accept","file-list"])])}}}),B={class:"flex items-center"},G={class:"p-2rem flex flex-col"},J=b({__name:"index",setup(a){const{mainHeight:b,payment:R}=e(),T=E((()=>R.value.authType)),J=w(null),N=k({title:"备份还原-功能介绍",ps:"通过对运行环境、网站、数据库、FTP、终端、计划任务、安全页面进行备份，出现异常时可快速恢复数据，保障数据安全。",source:320,desc:["备份和还原数据"],tabImgs:[{title:"备份还原",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/config/backupRestore.png"}]}),W=w(!1),$=w(""),K=w(!1),Q=w(null),X=w([]),aa=w(!1),ea=w(0),ta=k({page:1,limit:10}),sa=()=>J.value.open(),oa=async()=>{await o({loading:aa,request:U(ta),data:{data:[Array,X],page:l(ea)}})},la=async(a=!1)=>{await o({loading:K,request:n({path:"/www/backup/whole_machine_backup/whole_machine_backup.log"}),success:a=>{$.value=a.status?a.data.data||"暂无日志":a.msg}}),a&&i.success("刷新成功")},na=()=>{W.value=!0,la()},ia=a=>{t({title:"详情【".concat(a.name,"】"),area:[90,"80%"],compData:{...a,refresh:oa},component:()=>s((()=>import("./back-restore-log.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},ra=[L(),{label:"备份名称",prop:"name",maxWidth:180,showOverflowTooltip:!0},{label:"备份类型",prop:"backup_type",width:80},{label:"状态",prop:"status",width:220,render:a=>{let e="666",t="--";switch(a.status){case-1:t="备份中";break;case 0:t="等待备份";break;case 3:t="还原中",e="fc6d26";break;case 1:case 4:e="20a53a",t=1===a.status?"备份":"还原";break;case 2:case 5:e="ef0808",t=2===a.status?"备份":"还原"}const s=[-1,0,3];let o=[];return[1,2,4,5].includes(a.status)?(a.access_num&&o.push(V("span",{class:"text-primary"},"".concat(t,"成功（").concat(a.access_num,"）"))),a.error_num&&o.push(V("span",{class:"text-danger"},"".concat(t,"异常（").concat(a.error_num,"）")))):o.push(t),x("span",{style:"color:#".concat(e),class:" ".concat(s.includes(a.status)?"":" cursor-pointer"),onClick:()=>{s.includes(a.status)||ia({...a,tabName:[1,2].includes(a.status)?"backup":"reduction"})}},[o])}},{label:"备份文件",width:420,prop:"backup_path",showOverflowTooltip:!0,render:a=>x("span",{class:"truncate block ".concat(a.backup_path?"cursor-pointer text-primary":""),onClick:()=>{a.backup_path&&S({path:a.backup_path})}},[a.backup_path||"--"])},{label:"执行时间",prop:"exec_time",width:150},{label:"创建时间",prop:"addtime",width:150},Y([{title:"下载",isHide:a=>[-1,0].includes(a.status),onClick:a=>window.open("/download?filename=".concat(a.backup_path))},{isHide:a=>[-1,0].includes(a.status),onClick:a=>{t({title:"还原备份【".concat(a.name,"】"),area:[100,50],component:()=>s((()=>import("./recover-back-task.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,confirmText:"还原",compData:{rowData:a,refresh:oa}})},title:"还原"},{onClick:ia,title:"详情"},{onClick:a=>(async a=>{await u({icon:"warning-filled",title:"删除备份任务【".concat(a.name,"】"),content:"确定要删除该备份任务吗？"}),await o({loading:"正在删除备份任务，请稍候...",request:F({id:a.id}),message:!0,success:oa})})(a),title:"删除"}])],ca=[{label:"删除任务",value:"delete",event:async(a,e,t,s)=>{const o=async({id:a})=>await F({id:a});await a({title:"批量删除任务",content:"即将批量删除，删除任务后无法将无法恢复，是否继续操作！",column:[{label:"任务名称",prop:"name"},M()],onConfirm:async()=>(await e(o),oa(),!1)})}}];return q((()=>{oa()})),(a,e)=>{const o=D,l=P,n=h,i=r,u=c,w=_,k=f,R=p,E=d,V=m,q=z("bt-loading");return g(),y("div",null,["ltd"===C(T)?(g(),H(E,{key:0},{"header-left":v((()=>[A("div",B,[x(o,{onClick:e[0]||(e[0]=a=>{var e,o;t({title:"添加备份",area:90,component:()=>s((()=>import("./add-back-task.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,confirmText:"添加",compData:{isEdit:e,...o,refresh:async()=>{await oa()}}})}),type:"primary"},{default:v((()=>e[6]||(e[6]=[I(" 添加备份 ")]))),_:1}),x(o,{type:"default",onClick:sa},{default:v((()=>e[7]||(e[7]=[I("导入")]))),_:1}),x(l,{direction:"vertical",class:"!h-[2rem] !mx-1rem"}),x(o,{type:"default",onClick:na},{default:v((()=>e[8]||(e[8]=[I("服务日志")]))),_:1})]),x(Z,{ref_key:"fileIpRef",ref:J,onUploadSuccess:e[1]||(e[1]=a=>oa())},null,512)])),"header-right":v((()=>[x(n,{refresh:oa})])),content:v((()=>[j(x(i,{ref_key:"tableRef",ref:Q,data:C(X),column:ra,"max-height":C(b)-226,description:"备份列表为空"},null,8,["data","max-height"]),[[q,C(aa)],[q,"正在加载备份列表，请稍后...","title"]])])),"footer-left":v((()=>[x(u,{"table-ref":C(Q),options:ca},null,8,["table-ref"])])),"footer-right":v((()=>[x(w,{total:C(ea),page:C(ta).page,"onUpdate:page":e[2]||(e[2]=a=>C(ta).page=a),row:C(ta).limit,"onUpdate:row":e[3]||(e[3]=a=>C(ta).limit=a),onChange:oa},null,8,["total","page","row"])])),popup:v((()=>[x(R,{title:"服务日志",modelValue:C(W),"onUpdate:modelValue":e[5]||(e[5]=a=>O(W)?W.value=a:null),area:70},{default:v((()=>[j((g(),y("div",G,[A("div",null,[x(o,{onClick:e[4]||(e[4]=a=>la(!0)),class:"!mb-1rem"},{default:v((()=>e[9]||(e[9]=[I(" 刷新日志 ")]))),_:1})]),x(k,{content:C($),isHtml:!0,"full-screen":{title:"全屏查看【面板运行】日志",onRefresh:la},class:"h-41rem"},null,8,["content","full-screen"])])),[[q,C(K)]])])),_:1},8,["modelValue"])])),_:1})):(g(),H(V,{key:1,data:C(N),class:"px-[20%] my-[8rem]"},null,8,["data"]))])}}});export{J as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
