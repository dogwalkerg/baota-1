import{_ as e}from"./index90.js?v=1734676359";import{R as a,t as l,G as s,o as t,k as o,h as n,b as i}from"./utils-lib.js?v=1734676359";import{c as u,r,h as c,R as d,e as p,o as m,B as f,k as _,l as b,x as k,y as v,C as w,p as h,M as g,q as y,N as z,D as C,v as j,J as V,z as x,A as q,aZ as D,a7 as R,Q as F,a4 as U}from"./base-lib.js?v=1734676359";import{g as N,ae as S,af as A,ag as B,ah as G}from"./useStore3.js?v=1734676359";import{h as H,u as I}from"./column.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const J={class:"p-2rem"},L={class:"p-[2rem]"},M={class:"flex items-center"},Q=u({__name:"backup-view",props:{compData:{default:()=>{}}},setup(u){const Q=u,{refs:{isRefreshInstallList:Z}}=N(),$={"x-http-token":window.vite_public_request_token},E=r(!1),K=r(null),O=r(null),P=window.location.protocol+"//"+window.location.host+"/mod/docker/com/upload_backup",T=c({id:Q.compData.id,restore_backup:!1,backup:!1,f_size:0,f_path:"/www/dk_project/backup/apps",f_name:"",f_start:0}),{id:W}=Q.compData,X=r(!1),Y=i(),ee=d([]),ae=d(!1),le=async()=>{s({request:S({id:W}),loading:ae,success:e=>{ee.value=e.data.data}})},se=async()=>{s({request:A({id:W}),loading:"正在备份中，请稍后...",message:!0,success:le})},te=async()=>{var e;if(T.f_name)return X.value=Y.load("正在上传中，请稍后..."),await(null==(e=K.value)?void 0:e.submit()),!1;Y.error("请选择文件")},oe=e=>{var a;Y.request(e),E.value=!1,T.f_name="",le(),null==(a=X.value)||a.close(),e.status&&(E.value=!1)},ne=e=>{T.f_size=e.size,T.f_name=e.name},ie=()=>{var e;Y.error("导入失败"),T.f_name="",null==(e=X.value)||e.close(),le()},ue=()=>{O.value.$el.click()},re=()=>{var e;null==(e=K.value)||e.clearFiles(),E.value=!1,T.f_name="",T.restore_backup=!1},ce=[{label:"备份名称",prop:"file_name",width:160},{label:"类型",render:e=>p("span",null,["local"===e.backup_type?"本地":e.backup_type])},{label:"备份时间",width:140,render:e=>p("span",null,[a(Number(e.backup_time))])},H({prop:"backup_path",label:"备份目录"}),{label:"大小",render:e=>p("span",null,[l(e.size)])},I([{title:"恢复",onClick:async e=>{await t({content:"恢复备份将会覆盖已有数据，是否继续？",title:"恢复备份-"+e.file_name,icon:"warning-filled",type:"check",check:{content:"备份覆盖前的数据",onConfirm:async a=>{await s({request:G({id:W,file_name:e.file_name,backup:a}),loading:"正在恢复中，请稍后...",message:!0}),le(),Z.value=!0}}})}},{title:"下载",onClick:async e=>{window.open("/download?filename="+e.backup_path+"/"+e.file_name)}},{title:"删除",onClick:async e=>{await t({content:"即将删除备份文件，是否继续？",title:"删除备份-"+e.file_name,icon:"warning-filled"}),s({request:B({id:W,file_name:e.file_name}),loading:"正在删除中，请稍后...",message:!0,success:le})}}])];return m(le),(a,l)=>{const s=q,t=o,i=D,u=R,r=F,c=U,d=n,m=e,N=f("bt-loading");return _(),b("div",J,[p(m,null,{"header-left":k((()=>[p(s,{type:"primary",onClick:se},{default:k((()=>l[5]||(l[5]=[v("点击备份")]))),_:1}),p(s,{onClick:l[0]||(l[0]=e=>E.value=!0)},{default:k((()=>l[6]||(l[6]=[v("上传备份")]))),_:1})])),content:k((()=>[w(p(t,{column:ce,data:h(ee),"max-height":500},null,8,["data"]),[[N,h(ae)]])])),popup:k((()=>[p(d,{title:"上传文件",modelValue:h(E),"onUpdate:modelValue":l[4]||(l[4]=e=>g(E)?E.value=e:null),area:50,onConfirm:te,onCancel:re,showFooter:""},{default:k((()=>[y("div",L,[p(c,{ref:"cmdFormRef",size:"default",model:h(T),class:"relative w-full","label-position":"right",onSubmit:l[3]||(l[3]=z((()=>{}),["prevent"]))},{default:k((()=>[p(u,{prop:"dep_zip",label:"上传文件"},{default:k((()=>[y("div",M,[p(i,{class:"upload-demo h-[0] w-[0]",ref_key:"upload",ref:K,name:"blob",data:h(T),action:P,headers:$,accept:".zip,.gz,.tar","show-file-list":!1,"on-error":ie,multiple:!1,"auto-upload":!1,"on-success":oe,"on-change":ne},{default:k((()=>[w(p(s,{ref_key:"open",ref:O,size:"default",type:"default"},{default:k((()=>l[7]||(l[7]=[v(" 选择文件 ")]))),_:1},512),[[C,!1]])])),_:1},8,["data"]),p(s,{title:"导入项目",size:"default",class:"!mr-[.5rem]",onClick:ue},{default:k((()=>l[8]||(l[8]=[v(" 选择文件 ")]))),_:1}),y("span",null,j(h(T).f_name||"未选择"),1)])])),_:1}),p(u,{label:" "},{default:k((()=>[p(r,{modelValue:h(T).restore_backup,"onUpdate:modelValue":l[1]||(l[1]=e=>h(T).restore_backup=e)},{default:k((()=>l[9]||(l[9]=[v(" 是否立即导入备份文件 ")]))),_:1},8,["modelValue"])])),_:1}),h(T).restore_backup?(_(),V(u,{key:0,label:" "},{default:k((()=>[p(r,{modelValue:h(T).backup,"onUpdate:modelValue":l[2]||(l[2]=e=>h(T).backup=e)},{default:k((()=>l[10]||(l[10]=[v(" 是否备份覆盖前的数据 ")]))),_:1},8,["modelValue"])])),_:1})):x("",!0),l[11]||(l[11]=y("ul",{class:"mt-[.8rem] leading-8 text-[1.2rem] list-disc ml-[2rem]"},[y("li",null,"立即导入备份文件将覆盖现有文件数据，请做好相关数据备份")],-1))])),_:1},8,["model"])])])),_:1},8,["modelValue"])])),_:1})])}}});export{Q as default};
