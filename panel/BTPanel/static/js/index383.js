import{_ as a}from"./index90.js?v=1734676359";import{u as e,G as l,M as t,o as s,ah as n,j as i,k as o,V as r,O as u,h as d}from"./utils-lib.js?v=1734676359";import{B as c}from"./index185.js?v=1734676359";import{c as m,r as p,e as f,o as v,B as w,k as b,l as g,q as h,p as x,M as y,x as j,I as V,aX as _,y as k,C,ah as q,A as U,az as A,J as S,ag as E}from"./base-lib.js?v=1734676359";import{u as T}from"./column.js?v=1734676359";import{c as B}from"./useController3.js?v=1734676359";import{S as D,u as I}from"./useStore7.js?v=1734676359";import{getDirBinding as M,addDirBinding as N,delDirBinding as O,getDirRewrite as R,getFileBody as z,deleteDirBindMultiple as F}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./ace.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const G={class:"flex items-center"},H={class:"flex items-center mr-[16px]"},J={class:"flex items-center mr-[16px]"},X={class:"p-[20px]"},K={class:"flex items-center justify-between"},L=m({__name:"index",props:{compData:{default:()=>({})}},setup(m,{expose:L}){const{saveFileEvent:P}=D(),{plugin:Q}=e(),{siteInfo:W}=I(),Y=p(),Z=p(""),$=p([]),aa=p("");p([]);const ea=p(!1),la=p(""),ta=p(""),sa=p([]),na=p(""),ia=p(!1),oa=[{content:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{content:"您可以对伪静态规则进行修改，修改完后保存即可。"}],ra=p([]),ua=p(!1),da=async()=>{await l({loading:ua,request:M({id:W.value.id}),data:{dirs:[Array,$],binding:[Array,ra]}}),aa.value=$.value[0]||""},ca=async()=>{if(!aa.value||!Z.value)return void t.error("域名和子目录都不可为空！");(await l({loading:"正在添加子目录中,清稍后...",request:N({id:W.value.id,domain:Z.value,dirName:aa.value}),message:!0})).status&&(Z.value="",da())},ma=async()=>{await P({data:la.value,encoding:"utf-8",path:na.value})},pa=async a=>{let e=t.load("正在获取伪静态内容，请稍候..."),l={id:a.id};a.add&&(l.add=1);try{const t=await R(l);e.close(),t.data.status?(la.value=t.data.data,sa.value=t.data.rlist,ta.value=t.data.rlist[0],na.value=t.data.filename,ea.value=!0):(await s({title:"创建伪静态",icon:"warning-filled",content:"你真的要为这个子目录创建独立的伪静态规则吗？"}),pa({...a,add:1}))}catch(i){n(i)}finally{e.close()}},fa=async a=>{l({loading:ia,request:z({path:"/www/server/panel/rewrite/".concat(Q.value.webserver,"/").concat(a,".conf")}),data:{data:[String,la]}})},va=p([{type:"selection"},{prop:"domain",label:"域名",render:a=>f("span",{class:"cursor-pointer bt-link",onClick:()=>{window.open("http://".concat(a.domain,":").concat(a.port))}},[a.domain])},{prop:"port",label:"端口"},{width:220,label:"子目录",render:a=>f("span",null,[a.path])},T([{onClick:pa,title:"伪静态",width:60},{onClick:async a=>{await s({title:"删除【".concat(a.domain,"】"),content:"删除选中的子目录绑定后，将无法访问该子目录绑定的域名，是否继续操作？",icon:"warning-filled"});(await l({loading:"正在删除，请稍后...",request:O({id:a.id}),message:!0})).status&&da()},title:"删除"}])]),wa=[{label:"删除",value:"delete",event:async(a,e,l,t,n)=>{await s({title:"批量删除",width:"35rem",icon:"warning-filled",content:"批量删除，该操作可能会存在风险，是否继续？"});let i=[l.value.map((a=>a.id))];const{data:o}=await F({bind_ids:i,id:W.value.id});let r=[];await o.success.forEach((a=>{r.push({name:a,msg:"删除成功",status:!0})})),await Object.keys(o.error).forEach((a=>{r.push({name:a,msg:o.data.error[a],status:!1})})),await B({resultData:r,resultTitle:"删除",resultColumn:[{label:"域名",prop:"name"},{label:"结果",render:a=>A("span",{class:a.status?"text-primary":"text-danger"},a.status?a.msg||"操作成功":a.msg||"操作失败")}]}),da(),n()}}];return v(da),L({init:da}),(e,l)=>{const t=i,s=E,n=q,m=U,p=o,v=r,A=c,T=u,B=d,D=a,I=w("bt-loading");return b(),g("div",null,[h("div",G,[h("div",H,[l[5]||(l[5]=h("span",{class:"mr-[16px] w-[4rem]"},"域名",-1)),f(t,{modelValue:x(Z),"onUpdate:modelValue":l[0]||(l[0]=a=>y(Z)?Z.value=a:null),placeholder:"请输入域名"},null,8,["modelValue"])]),h("div",J,[l[6]||(l[6]=h("span",{class:"mr-[16px]"},"子目录",-1)),f(n,{class:"!w-[15rem]",filterable:"",modelValue:x(aa),"onUpdate:modelValue":l[1]||(l[1]=a=>y(aa)?aa.value=a:null)},{default:j((()=>[(b(!0),g(V,null,_(x($),((a,e)=>(b(),S(s,{key:e,value:a,label:a},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])]),f(m,{type:"primary",onClick:ca},{default:j((()=>l[7]||(l[7]=[k("添加")]))),_:1})]),f(D,null,{"header-left":j((()=>l[8]||(l[8]=[]))),"header-right":j((()=>l[9]||(l[9]=[]))),content:j((()=>[C(f(p,{ref_key:"subTableRef",ref:Y,"max-height":"500",column:x(va),data:x(ra)},null,8,["column","data"]),[[I,x(ua)]])])),"footer-left":j((()=>[f(v,{"table-ref":x(Y),options:x(wa)},null,8,["table-ref","options"])])),"footer-right":j((()=>l[10]||(l[10]=[]))),popup:j((()=>[f(B,{title:"伪静态规则",modelValue:x(ea),"onUpdate:modelValue":l[4]||(l[4]=a=>y(ea)?ea.value=a:null),area:50},{default:j((()=>[h("div",X,[h("div",K,[f(n,{class:"!w-[15rem]",modelValue:x(ta),"onUpdate:modelValue":l[2]||(l[2]=a=>y(ta)?ta.value=a:null),onChange:fa},{default:j((()=>[(b(!0),g(V,null,_(x(sa),((a,e)=>(b(),S(s,{key:e,value:a,label:a},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),l[11]||(l[11]=h("span",{class:"flex items-center"},[k(" 规则转换工具： "),h("a",{class:"bt-link flex items-center",href:"https://www.bt.cn/Tools",target:"_blank"},[k("Apache转Nginx "),h("i",{class:"svgtofont-el-link"})])],-1))]),C(f(A,{id:"statictRef",class:"!h-[40rem] !w-full my-[12px]",modelValue:x(la),"onUpdate:modelValue":l[3]||(l[3]=a=>y(la)?la.value=a:null),onSave:ma},null,8,["modelValue"]),[[I,x(ia)]]),h("div",null,[f(m,{type:"primary",onClick:ma},{default:j((()=>l[12]||(l[12]=[k("保存")]))),_:1})]),f(T,{options:oa,class:"ml-[20px] mt-[20px]"})])])),_:1},8,["modelValue"])])),_:1})])}}});export{L as default};
