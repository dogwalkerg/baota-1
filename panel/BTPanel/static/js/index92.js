import{u as e,s as a,aV as r,p as l,aW as s,q as t,aO as o,j as n,c as d,E as u,aX as i,b as c,e as p}from"./utils-lib.js?v=1734676359";import{_ as m}from"./index91.js?v=1734676359";import{B as f}from"./index87.js?v=1734676359";import{c as v,r as w,h as b,o as g,B as h,k as _,J as y,x,e as k,q as V,v as j,F as D,C as q,p as E,L as I,l as z,y as C,z as U,D as K}from"./base-lib.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const O={class:"flex !justify-center !w-full items-center"},B={class:"text-[2rem] text-dark inline-block mr-2 font-bold my-[10px]"},J={key:0,class:"absolute el-form-item__error"},$={class:"flex justify-end items-center mt-8 text-[1.2rem]"},F=p(v({__name:"index",props:{compData:{default:()=>({title:"",btn:""})}},setup(p,{expose:v}){const{getGlobalInfo:F}=e(),G=c(),H=p,L=w(!1),N=w("获取验证码"),R=b({username:"",password:"",code:""}),S=b({username:!1,password:!1,code:!1}),W=w(""),X=w(),A=w(),M=w(!1),P=w({username:[{validator:(e,a,r)=>{var l,s;if((null==(l=H.compData)?void 0:l.title)&&(M.value=!1),/^1[3456789]\d{9}$/.test(a))r();else if(""===a)r(new Error("请输入宝塔官网账号"));else{if(null==(s=H.compData)?void 0:s.title)return M.value=!0,void r(new Error(" "));r(new Error("请输入正确的手机号"))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,r)=>{a.length>=8?r():r(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,r)=>{L.value||r(),6===a.length?r():r(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),Q=()=>{A.value.validate((async e=>{if(!e)return!1;{const e={...R};if(L.value){if(!R.code)return G.error("请输入验证码");e.token=W.value,delete e.password}else delete e.code;const t=G.load("绑定堡塔账号，请稍候 ...");try{e.username=await a(e.username),e.password=await a(e.password);const s=await r({...e});if(G.request(s),s.status)return window.location.reload();if(l(s.data))return!1;if(!s.status&&"[]"===JSON.stringify(s.data))return G.request(s);-1===s.data.code&&(W.value=s.data.token,L.value=!0)}catch(s){}finally{t.close()}}}))},T=async()=>{if(!R.username||!R.password)return void G.error("请先输入手机号和密码");S.username=!0,S.password=!0,(e=>{X.value&&clearInterval(X.value);const a=()=>{if(--e<=0)return clearInterval(X.value),N.value="获取验证码",void(S.code=!1);N.value="重新获取验证码(".concat(e,"s)")};a(),X.value=setInterval(a,1e3),S.code=!0})(60);const e=await s({username:R.username,token:W.value});G.request(e)};return v({onOpen:()=>{t(A.value.$el,"username")},onCancel:()=>{A.value.clearValidate()}}),g((()=>{var e;null==(e=A.value)||e.clearValidate(),F()})),(e,a)=>{var r;const l=f,s=o,t=n,c=d,p=u,v=m,w=i,b=h("focus");return _(),y(w,{ref_key:"bindUserRef",ref:A,size:"default",rules:E(P),model:E(R),class:D(["bind-user-info",{"bind-form":!!(null==(r=e.compData)?void 0:r.title)}])},{default:x((()=>{var r;return[k(s,{class:"!mb-5 flex !justify-center"},{default:x((()=>{var r;return[V("div",O,[V("h3",B,j((null==(r=e.compData)?void 0:r.title)||"切换宝塔官网账号"),1),k(l,{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:x((()=>a[7]||(a[7]=[V("a",{class:"bt-ico-ask align-middle inline-block",href:"javascript:;"}," ? ",-1)]))),_:1})])]})),_:1}),(_(),y(s,{key:1,prop:"username",class:D({"!mb-[3rem]":!!(null==(r=e.compData)?void 0:r.title)})},{default:x((()=>{var r;return[q(k(t,{modelValue:E(R).username,"onUpdate:modelValue":a[0]||(a[0]=e=>E(R).username=e),clearable:"",required:"",name:"username",placeholder:"宝塔官网账号",class:"h-[4rem] leading-[4rem] w-full",disabled:E(S).username,onKeyup:a[1]||(a[1]=I((e=>Q()),["enter","native"]))},null,8,["modelValue","disabled"]),[[b]]),(null==(r=e.compData)?void 0:r.title)&&E(M)?(_(),z("span",J,[a[9]||(a[9]=V("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),k(c,{class:"!text-[12px]",href:"https://www.bt.cn/register"},{default:x((()=>a[8]||(a[8]=[C(" 免费注册 ")]))),_:1})])):U("",!0)]})),_:1},8,["class"])),(_(),y(s,{key:2,prop:"password"},{default:x((()=>[k(t,{modelValue:E(R).password,"onUpdate:modelValue":a[2]||(a[2]=e=>E(R).password=e),clearable:"",required:"",type:"password",name:"password",placeholder:"密码",class:"h-[4rem] leading-[4rem] w-full","show-password":!0,disabled:E(S).password,onKeyup:a[3]||(a[3]=I((e=>Q()),["enter","native"]))},null,8,["modelValue","disabled"])])),_:1})),q(k(s,{prop:"code"},{default:x((()=>[k(t,{modelValue:E(R).code,"onUpdate:modelValue":a[4]||(a[4]=e=>E(R).code=e),clearable:"",placeholder:"验证码",type:"text",onKeyup:a[5]||(a[5]=I((e=>Q()),["enter","native"]))},{append:x((()=>[k(p,{class:"relative top-0 rounded-none rounded-r-[3px] w-full !h-[auto]",size:"large",type:"primary",disabled:E(S).code,plain:"",onClick:T},{default:x((()=>[C(j(E(N)),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1},512),[[K,E(L)]]),k(p,{type:"primary",class:"w-[100%] mt-[1.2rem]",size:"large",onClick:a[6]||(a[6]=e=>Q())},{default:x((()=>{var a,r;return[C(j((null==(a=e.compData)?void 0:a.btn)||((null==(r=e.compData)?void 0:r.title)?"绑定账号":"切换账号")),1)]})),_:1}),V("div",$,[k(c,{href:"https://www.bt.cn/register"},{default:x((()=>a[10]||(a[10]=[C("注册账号")]))),_:1}),k(v),k(c,{href:"https://www.bt.cn/login.html?page=reset"},{default:x((()=>a[11]||(a[11]=[C("忘记密码")]))),_:1}),k(v),k(c,{href:"https://www.bt.cn/bbs"},{default:x((()=>a[12]||(a[12]=[C("问题反馈")]))),_:1})])]})),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-100ae8f2"]]);export{F as default};
