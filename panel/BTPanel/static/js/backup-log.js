import{_ as e}from"./index101.js?v=1734676359";import{c as a,r as s,w as l,o as t,aB as i,k as n,l as c,q as r,v as o,p as m,e as u,x as d,y as p,A as v}from"./base-lib.js?v=1734676359";import{b as f,o as g,G as x}from"./utils-lib.js?v=1734676359";import{getBackupLogs as w,stopBackup as _}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const b={class:"p-2rem flex-wrap"},y={class:"relative w-full text-[1.6rem] flex items-center leading-4rem mb-1rem justify-between"},j={class:"ml-1rem"},C={class:"grid grid-cols-3 leading-3rem py-1rem text-[1.4rem]"},h={class:"flex items-center mr-1rem"},D={class:"truncate flex-1"},k={class:"flex items-center mr-1rem"},T={class:"truncate flex-1"},q={class:"flex items-center"},H={class:"truncate flex-1"},M=a({__name:"backup-log",props:{compData:{default:()=>({type:"scan",endMsg:"扫描结束",logPath:"",successMsg:"修复成功",isClear:!1,completeEvent:null,id:""})}},emits:["close","onCancel"],setup(a,{expose:M,emit:A}){const B=a,E=A,G=s(""),P=s(""),z=s(""),F=s("");l((()=>B.compData),(e=>{K.value=!0,O()}));const I=f(),J=s("获取中...\t"),K=s(!0),L=s(null);let N=!1;const O=async()=>{if(!N)try{const{data:e}=await w({id:B.compData.id});if(J.value!==e.msg&&(J.value=e.msg),(null==e?void 0:e.total)&&(G.value=e.total,P.value=e.speed,z.value=e.site_name,F.value=e.title),e.stop)return K.value=!1,void(e.status?(I.success(e.title),E("close"),R()):(I.error(e.title),K.value=!1));!e.stop&&K.value&&(L.value=setTimeout((function(){O()}),1e3))}catch(e){K.value&&O()}},Q=async()=>{await g({width:"40rem",title:"取消备份",content:'<p>取消选中站点备份文件后，<span class="text-danger">该站点备份文件将永久消失</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0}),await x({loading:"正在取消备份，请稍后...",request:_({id:B.compData.id}),message:!0}),E("close")},R=()=>{L.value&&clearTimeout(L.value)},S=()=>{B.compData.isClear&&clearTimeout(L.value)};return E("onCancel",S),t((()=>{O()})),i((()=>{R(),N=!0})),M({onCancel:S}),(a,s)=>{const l=v,t=e;return n(),c("div",b,[r("div",y,[r("div",null,[s[0]||(s[0]=r("i",{class:"svgtofont-el-loading text-3rem"},null,-1)),r("span",j,o(m(F)||"正在备份，请稍后..."),1)]),u(l,{type:"warning",plain:"",onClick:Q},{default:d((()=>s[1]||(s[1]=[p("取消备份")]))),_:1})]),s[5]||(s[5]=r("hr",{class:"!border-[#dedede]"},null,-1)),r("div",C,[r("div",h,[s[2]||(s[2]=r("span",null,"备份网站：",-1)),r("div",D,o(m(z)||"--"),1)]),r("div",k,[s[3]||(s[3]=r("div",null,"已备份：",-1)),r("div",T,o(m(G)||"--"),1)]),r("div",q,[s[4]||(s[4]=r("div",null,"备份速度：",-1)),r("div",H,o(m(P)||"--"),1)])]),u(t,{class:"h-[30rem]",content:m(J)},null,8,["content"])])}}});export{M as default};
