import{u as a,G as e,l as s,H as l,ac as t,M as n,ad as o,c as i,ae as r,F as m,a8 as d,k as u,V as c,af as p,ag as f,S as v}from"./utils-lib.js?v=1734676359";import{_ as y}from"./index90.js?v=1734676359";import{_}from"./index97.js?v=1734676359";import{_ as g}from"./index99.js?v=1734676359";import{B as b}from"./index107.js?v=1734676359";import{c as h,b4 as x,i as k,h as C,r as w,w as q,W as j,o as M,B as A,k as L,l as S,p as V,J as R,x as E,e as I,z as T,q as U,M as D,I as N,v as B,y as H,N as P,F,C as Q,aj as z,aT as O,A as W,ap as Y,ao as G,an as J,aN as K}from"./base-lib.js?v=1734676359";import{_ as X}from"./index116.js?v=1734676359";import{e as Z,f as $,g as aa,u as ea}from"./column.js?v=1734676359";import{addDbTypes as sa,modifyDbTypes as la,delDbTypes as ta,getMysqlRootPwd as na,getMysqlCloudServer as oa,setAutoConfig as ia,getDbTypes as ra,getMysqlList as ma,getAutoConfig as da}from"./database.js?v=1734676359";import{g as ua,a as ca,b as pa,c as fa,d as va,s as ya,e as _a,f as ga,h as ba,i as ha,j as xa,k as ka,l as Ca,m as wa,n as qa}from"./useMethod3.js?v=1734676359";import{e as ja,g as Ma,p as Aa}from"./validator.js?v=1734676359";import{B as La}from"./index117.js?v=1734676359";import{_ as Sa}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1734676359";import{_ as Va}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";const Ra={class:"inline-flex items-center mr-2rem"},Ea={key:0,class:"text-[12px]"},Ia={class:"flex items-center"},Ta=h({__name:"index",setup(h){const{refs:{isRefreshTable:Ta,isLoading:Ua,softData:Da,isHaveServer:Na},resetRefresh:Ba,refreshTableList:Ha}=ua(),Pa=x(),{payment:Fa,mainWidth:Qa}=a(),za=k((()=>Fa.value.authType)),Oa=C({status:!1,code:""}),Wa=w(!1),Ya=w(""),Ga=C({total:0,page:1,row:10}),Ja=w([]),Ka=w([]),Xa=w(null),Za=w("all"),$a=w(""),ae=w([]),ee=w([]),se=w([]),le=k((()=>Qa.value>1530?280:Qa.value>1440?200:Qa.value>1200?150:120)),te=[{label:"设置权限",value:"permission",event:async(a,e,s,l)=>va(s.value,"multlples")},{label:"设置分类",value:"class",event:async(a,e,s,l,t)=>{ya(s,t,ne)}},..._a()],ne=w([]),oe=w([]),ie=a=>{$a.value=a,Ga.page=1,Ha()},re=async()=>(await e({request:ra({db_type:"mysql"}),data:{msg:Array},success:({msg:a})=>{ne.value=[...a.map((a=>({label:a.ps,value:String(a.id)})))],ee.value=[{label:"全部分类",value:"all"},...a.map((a=>({label:a.ps,value:String(a.id)})))],oe.value=ee.value.map((a=>a.value)).filter((a=>Number(a)<=0||"all"===a))}}),Promise.resolve(ee.value||[])),me=async()=>{const a=await e({loading:"正在获取密码，请稍后...",request:na({table:"config",id:1,key:"mysql_root"}),data:String});ga(a)},de=a=>{s({title:"高级设置",area:[96,62],compData:a,component:()=>l((()=>import("./index114.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},ue=a=>{"ltd"===za.value?0===a.sid?s({title:"数据库配额",area:50,component:()=>l((()=>import("./index115.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:a,showFooter:!0}):n.error("仅本地数据库支持设置容量配额"):Aa({sourceId:52})},ce=async()=>(await e({request:oa(),data:[Array,ae]}),ae.value.length||(Na.value=!1),ae.value),pe=async(a={p:Ga.page,limit:Ga.row,table:"databases",search:$a.value,sid:"all"===Za.value?"":Za.value})=>{""===a.sid&&delete a.sid,Number(a.sid)<0&&(a.type_id=a.sid,delete a.sid),await e({loading:Ua,request:ma(a),data:{data:[Array,Ja],page:v(Ga),search_history:[Array,se],error:String},success:a=>{wa.value=a.data,a.error&&(Oa.status=!0,Oa.code=a.error)}})},fe=async a=>{Wa.value=a;try{await e({loading:"正在设置自动备份数据库...",request:ia({name:"mysql",status:a?1:0}),message:!0,success:e=>{e.status||(Wa.value=!a)}})}catch(s){}finally{undefined.close()}},ve=()=>Pa.push({name:"crontab"}),ye=()=>{localStorage.setItem("MYSQL-RECYCLE","true"),window.location.href="/files"},_e=[{name:"企业增量备份",ename:"increment",callback:()=>de("increment")},{name:"远程数据库",ename:"server",callback:()=>pa()},{name:"关联服务",ename:"service",callback:()=>de("service")},{name:"容量限制",ename:"capacity",callback:()=>{if(!Ja.value.length)return n.error("暂无数据库，请先添加数据库");if(!Ja.value.some((a=>0===a.sid)))return n.error("当前页暂无本地数据库进行容量配额！");const a=Ja.value.filter((a=>0===a.sid))[0];ue(a)}},{name:"敏感词检测",ename:"sensitive",callback:()=>de("sensitive")},{name:"Mysql用户管理",ename:"user",callback:()=>de("user")}],ge=()=>[...ba(ka),Z({event:ue}),$({event:(a,e)=>qa(a,e)}),ha(ae.value,"mysql"),aa({table:"databases"}),ea([{isHide:a=>!!a.sid,onClick:a=>(async a=>{const{data:s}=await e({loading:"正在跳转phpMyAdmin，请稍后...",request:p({sName:"phpmyadmin"})});return(null==s?void 0:s.ext.auth)?n.error("当前phpMyAdmin已开启密码访问，请使用【通过公共访问】进行访问"):"false"===(null==s?void 0:s.setup)?n.error("当前phpMyAdmin未安装，请先安装phpMyAdmin"):void(await f(a.username,a.password))})(a),title:"管理"},{onClick:va,title:"权限"},{onClick:a=>xa(a),title:"工具"},{onClick:a=>ka(a),title:"改密"},{onClick:a=>Ca(a),title:"删除"}])];return q((()=>Ta.value),(async a=>{a&&await pe(),Ba()})),j("serverList",ae),M((async()=>{Ma({promises:[re],delay:1e3}),(async()=>{try{const{data:a}=await da({name:"mysql"});Wa.value=!!a.status,Ya.value=a.cycle}catch(a){}})(),pe(),await ce(),Ka.value=ge(),t(Ka.value,"database_mysql_column")})),(a,e)=>{var s;const l=X,t=o,n=z,p=O,f=W,v=Y,h=G,x=J,k=K,C=i,w=b,q=r,j=m,M=g,Z=d,$=u,aa=c,ea=_,na=y,oa=A("bt-loading");return L(),S("div",null,[(null==(s=V(Da))?void 0:s.setup)||V(Na)?T("",!0):(L(),R(l,{key:0,options:V(Da)},{content:E((()=>[I(Sa,{type:"Mysql"})])),_:1},8,["options"])),V(Oa).status?(L(),R(t,{key:1,options:V(Oa)},null,8,["options"])):T("",!0),I(p,{type:"info",closable:!1,class:"!mb-[12px]","show-icon":""},{title:E((()=>[U("div",Ra,[e[8]||(e[8]=U("div",{class:"mr-4 min-w-max text-[#555] text-[12px]"},"自动备份数据库",-1)),I(n,{size:"small",class:"mr-8px",modelValue:V(Wa),"onUpdate:modelValue":e[0]||(e[0]=a=>D(Wa)?Wa.value=a:null),width:36,onChange:fe},null,8,["modelValue"]),V(Wa)?(L(),S(N,{key:1},[U("span",null,B(V(Ya)),1),U("span",{class:"bt-link",onClick:ve},"[前往计划任务]")],64)):(L(),S("div",Ea," 添加数据库后，可开启自动备份，保证数据安全。 "))])])),_:1}),I(na,null,{"header-left":E((()=>[U("div",Ia,[I(f,{type:"primary",onClick:e[1]||(e[1]=a=>V(ca)(ce))},{default:E((()=>e[9]||(e[9]=[H(" 添加数据库 ")]))),_:1}),I(f,{onClick:me},{default:E((()=>e[10]||(e[10]=[H("root密码")]))),_:1}),I(f,{onClick:V(pa)},{default:E((()=>e[11]||(e[11]=[H("远程数据库")]))),_:1},8,["onClick"]),I(f,{onClick:V(fa)},{default:E((()=>e[12]||(e[12]=[H("phpMyAdmin")]))),_:1},8,["onClick"]),I(x,{class:"ml-10px","split-button":"",type:"default",onClick:e[2]||(e[2]=P((a=>de("route")),["stop"])),onCommand:de},{dropdown:E((()=>[I(h,null,{default:E((()=>[I(v,{command:"route"},{default:E((()=>e[13]||(e[13]=[H("数据库备份")]))),_:1}),I(v,{command:"increment"},{default:E((()=>e[14]||(e[14]=[H(" 企业增量备份 ")]))),_:1}),I(v,{command:"user"},{default:E((()=>e[15]||(e[15]=[H(" MySQL用户管理 ")]))),_:1}),I(v,{command:"sensitive"},{default:E((()=>e[16]||(e[16]=[H(" 敏感词检测 ")]))),_:1}),I(v,{command:"service"},{default:E((()=>e[17]||(e[17]=[H("关联服务")]))),_:1}),I(v,{command:"process"},{default:E((()=>e[18]||(e[18]=[H(" MySQL守护进程 ")]))),_:1}),I(v,{command:"reinforce"},{default:E((()=>e[19]||(e[19]=[H(" 等保加固 ")]))),_:1}),I(v,{command:"audit"},{default:E((()=>e[20]||(e[20]=[U("i",{class:"svgtofont-icon-ltd text-[1.6rem] !mr-0 text-[#9B7E48]"},null,-1),H("日志审计 ")]))),_:1})])),_:1})])),default:E((()=>[e[21]||(e[21]=H(" 高级设置 "))])),_:1}),I(Va,{"comp-data":V(ae),class:"mx-[1rem]"},null,8,["comp-data"]),I(k,{content:"点击跳转数据库回收站",placement:"top"},{default:E((()=>[I(f,{type:"default",onClick:ye},{default:E((()=>e[22]||(e[22]=[U("i",{class:"svgtofont-el-delete mr-2px"},null,-1),U("span",{class:"<2xl:hidden"},"回收站",-1)]))),_:1})])),_:1}),V(Da).setup&&V(Qa)>1200?(L(),R(La,{key:0,class:"ml-[1rem]","plugin-name":"mysql","is-request":!1,pluginInfo:V(Da)},null,8,["pluginInfo"])):T("",!0),I(C,{onClick:e[3]||(e[3]=a=>V(ja)({name:"数据库",type:12,id:17})),icon:"desired",class:"ml-[12px] <2xl:hidden",iconClass:"text-1.6rem"},{default:E((()=>e[23]||(e[23]=[H(" 需求反馈 ")]))),_:1})])])),"header-right":E((()=>[I(w,{class:"mr-[10px] !w-[14rem]",modelValue:V(Za),"onUpdate:modelValue":e[4]||(e[4]=a=>D(Za)?Za.value=a:null),onChange:V(Ha),name:"Mysql",options:V(ee),config:{getClassList:re,addClass:({ps:a})=>sa({ps:a,db_type:"mysql"}),editClass:({ps:a,id:e})=>la({ps:a,id:e,db_type:"mysql"}),deleteClass:({id:a})=>ta({id:a,db_type:"mysql"})},ignore:V(oe)},null,8,["modelValue","onChange","options","config","ignore"]),I(j,{class:F("!w-[".concat(V(le),"px]")),disabledPopover:!1,modelValue:V($a),"onUpdate:modelValue":e[5]||(e[5]=a=>D($a)?$a.value=a:null),clearable:"",placeholder:"请输入数据库名称/备注",onSearch:ie},{default:E((()=>[I(q,{list:{historyList:V(se),recommendList:_e},name:"databases",keys:"mysql",onUpdate:V(Ha),onSearch:ie},null,8,["list","onUpdate"])])),_:1},8,["class","modelValue"]),I(M,{class:"ml-[10px]",onRefresh:V(Ha)},null,8,["onRefresh"]),I(Z,{name:"database_mysql",class:"ml-[10px]","table-ref":V(Xa),column:V(Ka)},null,8,["table-ref","column"])])),content:E((()=>[Q(I($,{ref_key:"mysqlDbTableRef",ref:Xa,column:V(Ka),data:V(Ja)},null,8,["column","data"]),[[oa,V(Ua)]])])),"footer-left":E((()=>[I(aa,{options:te,"table-ref":V(Xa)},null,8,["table-ref"])])),"footer-right":E((()=>[I(ea,{total:V(Ga).total,page:V(Ga).page,"onUpdate:page":e[6]||(e[6]=a=>V(Ga).page=a),row:V(Ga).row,"onUpdate:row":e[7]||(e[7]=a=>V(Ga).row=a),onChange:V(Ha)},null,8,["total","page","row","onChange"])])),_:1})])}}});export{Ta as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
