import{c as e,r as a,o as l,B as s,k as r,l as o,e as t,x as d,C as u,p,J as m,z as n,N as i,q as b,v as _,I as c,aX as v,P as g,a7 as w,a4 as f}from"./base-lib.js?v=1734676359";import{di as h,dx as y,j as V,G as q}from"./utils-lib.js?v=1734676359";import{addServer as j,addModulesServer as x,modifyServer as k,modifyModulesServer as D}from"./database.js?v=1734676359";import{g as U,w as E}from"./useMethod3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const J={class:"p-[24px]"},N={class:"ml-20px mt-12px leading-8 text-[1.2rem] list-disc"},S={key:0},C={key:1},I=e({__name:"add-cloud-server",props:{compData:{default:()=>({row:{},refreshEvent:()=>{}})}},setup(e,{expose:I}){const{refs:{tabActive:O}}=U(),z=e,A=a(),B=a(!0),F={mysql:{port:3306,db_user:"root"},mongodb:{port:27017,db_user:"root"},sqlserver:{port:1433,db_user:"sa"},pgsql:{port:5432,db_user:"postgres"},redis:{port:6379,db_user:""}},G=a({db_host:"",db_port:F[O.value].port,db_user:F[O.value].db_user,db_password:"",ps:"",type:O.value}),H=[{content:"支持阿里云、腾讯云等云厂商的云数据库"},{content:"注意1：请确保本服务器有访问数据库的权限"},{content:"注意2：请确保填写的管理员帐号具备足够的权限"}],M={db_host:[{required:!0,message:"请输入服务器地址",trigger:["blur","change"]},{validator:(e,a,l)=>{(h(a)||y(a))&&""!==a||l(new Error("请输入正确的服务器地址")),l()},trigger:["blur","change"]}],db_password:[{required:!0,message:"请输入服务器密码",trigger:["blur","change"]}],db_user:[{required:!0,message:"请输入管理员名称",trigger:["blur","change"]}],db_port:[{required:!0,message:"请输入服务器端口",trigger:["blur","change"]}]},P=e=>{if(B.value&&z.compData.row)return B.value=!1;B.value=!1,G.value.ps=e};return l((()=>{var e;(null==(e=z.compData.row)?void 0:e.db_host)&&(G.value={...z.compData.row,type:O.value})})),I({onConfirm:async e=>{var a;(null==(a=z.compData.row)?void 0:a.db_host)?await(async()=>{await A.value.validate();let e={...G.value,db_ps:G.value.ps};"mysql"!==O.value&&(e.type=O.value),await q({loading:"正在修改远程服务器信息，请稍候...",request:"mysql"===O.value?k(e):D({data:JSON.stringify(e)},O.value),message:!0})})():await(async()=>{await A.value.validate();let e={...G.value,db_ps:G.value.ps};await q({loading:"正在添加远程服务器信息，请稍候...",request:"mysql"===O.value?j(e):x({data:JSON.stringify(e)},O.value),message:!0})})(),z.compData.refreshEvent(),e()}}),(e,a)=>{var l,h;const y=g,q=w,j=V,x=f,k=s("focus");return r(),o("div",J,[t(x,{model:p(G),rules:M,ref_key:"cloudForm",ref:A,onSubmit:a[5]||(a[5]=i((()=>{}),["prevent"]))},{default:d((()=>[t(q,{label:"服务器地址",prop:"db_host"},{default:d((()=>[u(t(y,{class:"!w-[24rem]",placeholder:"请输入服务器地址",modelValue:p(G).db_host,"onUpdate:modelValue":a[0]||(a[0]=e=>p(G).db_host=e),onInput:P},null,8,["modelValue"]),[[k]])])),_:1}),t(q,{label:"数据库端口",prop:"db_port"},{default:d((()=>[t(j,{type:"number",class:"!w-[24rem]",modelValue:p(G).db_port,"onUpdate:modelValue":a[1]||(a[1]=e=>p(G).db_port=e)},null,8,["modelValue"])])),_:1}),"redis"!=p(O)?(r(),m(q,{key:0,label:"管理员名称",prop:"db_user"},{default:d((()=>[t(j,{modelValue:p(G).db_user,"onUpdate:modelValue":a[2]||(a[2]=e=>p(G).db_user=e),placeholder:"请输入管理员名称",class:"!w-[24rem]"},null,8,["modelValue"])])),_:1})):n("",!0),t(q,{label:"管理员密码",prop:"db_password"},{default:d((()=>[t(j,{modelValue:p(G).db_password,"onUpdate:modelValue":a[3]||(a[3]=e=>p(G).db_password=e),placeholder:"请输入管理员密码",class:"!w-[24rem]"},null,8,["modelValue"])])),_:1}),t(q,{label:"备注"},{default:d((()=>[t(j,{modelValue:p(G).ps,"onUpdate:modelValue":a[4]||(a[4]=e=>p(G).ps=e),placeholder:"服务器备注",class:"!w-[24rem]"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),b("ul",N,[(null==(l=p(E))?void 0:l.length)&&p(E)[0]?(r(),o("li",S,_(p(E)[0]),1)):n("",!0),(r(),o(c,null,v(H,((e,a)=>b("li",{key:a},_(e.content),1))),64)),(null==(h=p(E))?void 0:h.length)&&p(E)[1]?(r(),o("li",C,_(p(E)[1]),1)):n("",!0)])])}}});export{I as default};
