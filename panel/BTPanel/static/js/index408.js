var a,e;import{R as l,t as s,k as t,e as u}from"./utils-lib.js?v=1734676359";import{g as o,r as n,c as i,s as v,w as r,o as p,B as c,C as d,p as m,k as b,l as f,q as _,e as y,x,I as g,aX as h,M as j,y as k,ah as S,bM as T,J as I,v as w,ag as D,bL as E}from"./base-lib.js?v=1734676359";import{u as C,S as O}from"./useStore7.js?v=1734676359";import{getLoadInfo as P}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const z=o("SITE-LOAD-STATE-STORE",(()=>{const{siteInfo:a,siteType:e}=C();return{getLoadDataEvent:async a=>{try{const l=await P(a,e.value);return{status:l.status,data:l.data}}catch(l){return{status:!1,msg:"获取负载状态失败"}}}}})),{getLoadDataEvent:F}=z(),{siteInfo:L,siteType:V}=C(),A=n(""),J=n("java"===V.value?null!==(null==(a=L.value)?void 0:a.pid):null==(e=L.value)?void 0:e.run),M=n(!1),R=n(),U=n(),q=n(),B=n(),H=n(),N=[{label:"名称",value:"name"},{label:"状态",value:"status"},{label:"用户",value:"user"},{label:"启动时间",value:"create_time",isTime:!0},{label:"PID",value:"pid"},{label:"PPID",value:"ppid"},{label:"线程",value:"threads"},{label:"Socket",value:"connects"},{label:"CPU",value:"cpu_percent"},{label:"内存",value:"memory_used",isSize:!0},{label:"io读",value:"io_read_bytes",isSize:!0},{label:"io写",value:"io_write_bytes",isSize:!0},{label:"命令",value:"exe"}],X=n([{label:"文件",prop:"path"},{label:"mode",prop:"mode"},{label:"position",prop:"position"},{label:"flags",prop:"flags"},{label:"fd",prop:"fd"}]),G=n([{label:"客户端地址",prop:"client_addr",render:a=>a.client_addr||"--"},{label:"客户端端口",prop:"client_rport"},{label:"协议",prop:"family"},{label:"FD",prop:"fd"},{label:"本地地址",prop:"local_addr"},{label:"本地端口",prop:"local_port"},{label:"状态",prop:"status"}]),K=a=>H.value?a.isTime?l(H.value[a.value]):a.isSize?s(H.value[a.value]):H.value[a.value]:"",Q=async a=>{M.value=!0,U.value=R.value[a].open_files,q.value=R.value[a].connections,H.value=R.value[a],M.value=!1},W=a=>{try{const e=(null==a?void 0:a.load_info)||(null==a?void 0:a.data);Object.keys(e).length&&(B.value=Object.keys(e).map((a=>a)),A.value=B.value[0],U.value=e[A.value].open_files,q.value=e[A.value].connections,H.value=e[A.value],R.value=e),"java"!==V.value&&(J.value=a.run)}catch(e){}},Y=async()=>{(async()=>{try{M.value=!0;let a={project_name:L.value.name};const e=V.value;"go"===e&&(a.has_load_info=1),"nodejs"===V.value&&(a.project_type=L.value.project_config.project_type||"nodejs");const l={java:a,default:{data:JSON.stringify(a)}},{data:s}=await F(l[e]||l.default);await W(s),M.value=!1}catch(a){return{status:!1,msg:"获取负载状态失败"}}})()},Z={class:"relative h-full"},$={key:0,class:"h-[68rem] overflow-auto"},aa={class:"flex items-center"},ea={class:"font-normal"},la={key:1,class:"bg-[#7F7F7F] flex items-center justify-center h-full",style:{"min-height":"600px"}},sa={class:"bg-white px-[48px] py-[16px] text-[#333] flex"},ta=u(i({__name:"index",setup(a,{expose:e}){const{siteInfo:l,siteType:s}=v(O()),{jumpTabEvent:u}=O();return r((()=>l.value),(a=>{var e,t;J.value="java"===s.value?null!==(null==(e=l.value)?void 0:e.pid):null==(t=l.value)?void 0:t.run}),{immediate:!0}),p(Y),e({init:Y}),(a,e)=>{const l=D,s=S,o=E,n=T,i=t,v=c("bt-loading");return d((b(),f("div",Z,[m(J)?(b(),f("div",$,[_("div",aa,[e[2]||(e[2]=_("span",{class:"mr-[8px]"},"PID",-1)),y(s,{modelValue:m(A),"onUpdate:modelValue":e[0]||(e[0]=a=>j(A)?A.value=a:null),onChange:m(Q),class:"!w-[14rem]"},{default:x((()=>[(b(!0),f(g,null,h(m(B),(a=>(b(),I(l,{key:a,label:a,value:a},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])]),y(n,{class:"mt-[20px]",column:3,border:""},{default:x((()=>[(b(!0),f(g,null,h(m(N),((a,e)=>(b(),I(o,{key:e},{label:x((()=>[_("span",ea,w(a.label),1)])),default:x((()=>[k(" "+w(m(K)(a)),1)])),_:2},1024)))),128))])),_:1}),e[3]||(e[3]=_("span",{class:"text-[#666] my-[8px] block"},"网络",-1)),y(i,{"max-height":160,column:m(G),data:m(q)},null,8,["column","data"]),e[4]||(e[4]=_("span",{class:"text-[#666] my-[8px] block"},"打开的文件列表",-1)),y(i,{"max-height":160,column:m(X),data:m(U)},null,8,["column","data"])])):(b(),f("div",la,[_("div",sa,[e[5]||(e[5]=k(" 请开启 ")),_("span",{class:"mx-[.4rem] bt-link",onClick:e[1]||(e[1]=a=>m(u)("state"))},"项目状态"),e[6]||(e[6]=k(" 后查看负载状态 "))])]))])),[[v,m(M)]])}}}),[["__scopeId","data-v-a08a1842"]]);export{ta as default};
