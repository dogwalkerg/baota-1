import{u as e,am as a,bL as t,an as l,U as s,F as r,G as o,l as n,H as i,o as u,a4 as c,aa as m,e as d}from"./utils-lib.js?v=1734676359";import{c as p,e as y,k as g,J as v,x as f,y as h,p as _,A as w,s as b,B as x,l as V,q as C,z as L,C as S,G as k,aj as A,aN as j,Q as D,b0 as O,r as E,o as T,M as W}from"./base-lib.js?v=1734676359";import{L as R,q as P}from"./useStore6.js?v=1734676359";import{u as F,A as H}from"./index276.js?v=1734676359";import{_ as M}from"./index90.js?v=1734676359";import{L as N,u as U,d as I,a as J}from"./useController2.js?v=1734676359";import{_ as z}from"./index99.js?v=1734676359";import{_ as B}from"./index101.js?v=1734676359";import{p as q}from"./validator.js?v=1734676359";const Y=p({__name:"index",setup(s,{expose:r}){const{mainHeight:o}=e(),n=N(),{getOperateLog:i,outLogs:u}=n,{isRefreshList:c}=U(),{BtTable:m,BtPage:d,BtSearch:p,BtRefresh:b,refresh:x}=a({request:e=>{const{search:a,...t}=e;return i({keywords:a,...t,stype:"网站管理"})},columns:[{label:"用户",prop:"username",width:180},{label:"操作类型",prop:"type",width:100},{label:"详情",render:function(e){const a=(new DOMParser).parseFromString(e.log,"text/html");return y("span",{innerHTML:t(a.body.innerHTML)},null)}},{label:"操作时间",width:150,prop:"addtime",align:"right"}],extension:[l(c)]});return r({init:x}),(e,a)=>{const t=w,l=M;return g(),v(l,null,{"header-left":f((()=>[y(t,{onClick:_(u)},{default:f((()=>a[0]||(a[0]=[h("导出日志")]))),_:1},8,["onClick"])])),"header-right":f((()=>[y(_(p),{class:"mr-1rem !w-[24rem]",placeholder:"请输入搜索关键字"}),y(_(b))])),content:f((()=>[y(_(m),{"max-height":_(o)-360},null,8,["max-height"])])),"footer-right":f((()=>[y(_(d))])),_:1})}}}),K={class:"flex flex-col"},G={class:"flex items-center justify-end mb-[12px]"},Q={class:"flex justify-between w-full flex-wrap"},X={class:"flex items-center"},Z={class:"pl-[1rem] mr-[8px]"},$={class:"flex items-center mt-4px"},ee={class:"ml-1rem"},ae=p({__name:"index",setup(a,{expose:t}){const{mainHeight:l}=e(),o=N(),{logParams:n,logMsg:i,preLoading:u}=b(o),c=[{label:"运行日志",value:"access"},{label:"异常日志",value:"error"}];return t({init:()=>Pe("WebLogs")}),(e,a)=>{const t=w,o=A,m=j,d=D,p=s,b=O,E=r,T=z,W=x("bt-loading");return g(),V("div",K,[C("div",G,[C("div",Q,[C("div",X,[y(t,{type:"default",onClick:_(Se)},{default:f((()=>a[6]||(a[6]=[h(" 清理日志 ")]))),_:1},8,["onClick"]),y(t,{type:"default",class:"!mr-[8px]",onClick:_(ke)},{default:f((()=>a[7]||(a[7]=[h(" 导出日志 ")]))),_:1},8,["onClick"]),y(o,{modelValue:_(n).keywordSwitch,"onUpdate:modelValue":a[0]||(a[0]=e=>_(n).keywordSwitch=e),width:36,onChange:_(De)},null,8,["modelValue","onChange"]),C("span",Z,[y(m,{content:"点击开启日志关键词告警",placement:"top"},{default:f((()=>a[8]||(a[8]=[C("span",null,[C("span",{class:"lt-xl:hidden"},"关键词"),h("告警 ")],-1)]))),_:1}),C("span",{class:"cursor-pointer text-primary",onClick:a[1]||(a[1]=(...e)=>_(je)&&_(je)(...e))}," [配置] ")]),"access"===_(n).typeValue?(g(),v(d,{key:0,modelValue:_(n).ipArea,"onUpdate:modelValue":a[2]||(a[2]=e=>_(n).ipArea=e),class:"pr-[2rem]",onChange:_(Oe)},{default:f((()=>a[9]||(a[9]=[C("div",{class:"flex items-center"},[C("span",{class:"text-[1.2rem]"},"显示IP归属地"),C("i",{class:"svgtofont-icon-ltd text-[#9F834F] !text-[2rem]"})],-1)]))),_:1},8,["modelValue","onChange"])):L("",!0)]),C("div",$,[y(p,{type:"button",size:"default",class:"mr-1rem",modelValue:_(n).typeValue,"onUpdate:modelValue":a[3]||(a[3]=e=>_(n).typeValue=e),onChange:_(Ae),options:c},null,8,["modelValue","onChange"]),y(b,{modelValue:_(n).timeValue,"onUpdate:modelValue":a[4]||(a[4]=e=>_(n).timeValue=e),format:"YYYY/MM/DD","value-format":"x",onChange:_(Ae),type:"daterange","range-separator":"-","disabled-date":_(Le),"start-placeholder":"开始",class:"!lt-xl:w-[12rem] !at-lg:w-[12rem] !at-xl:w-[12rem] !w-[20rem]","end-placeholder":"结束"},null,8,["modelValue","onChange","disabled-date"]),C("div",ee,[y(E,{class:"!lt-xl:w-[16rem] !w-[24rem]",modelValue:_(n).searchValue,"onUpdate:modelValue":a[5]||(a[5]=e=>_(n).searchValue=e),placeholder:"请输入搜索关键字",onClear:_(Ae),onSearch:_(Ae)},null,8,["modelValue","onClear","onSearch"])]),y(T,{class:"ml-1rem",onRefresh:_(Ae)},null,8,["onRefresh"])])])]),S(y(B,{content:_(i),isHtml:!0,autoScroll:!0,fullScreen:{title:"全屏查看-日志",onRefresh:()=>_(Pe)("WebLogs")},style:k("height:"+(_(l)-292)+"px")},null,8,["content","fullScreen","style"]),[[W,_(u)]])])}}}),{selectedWebSite:te,webTabActive:le,outDataForm:se,configData:re}=b(R()),{clearWebLogEvent:oe,outWebLogEvent:ne,setKeyWordConfigEvent:ie,onConfirmKeyConfig:ue,getKeywordAlarmData:ce,delLogSourceEvent:me,sendSourceConfirm:de,getLogSystemSite:pe,getSiteLogsData:ye,logSystemConfirm:ge}=N(),{logParams:ve,isRefreshLogSystem:fe,isRefreshList:he,logSystemList:_e}=U(),{payment:we}=e(),{isRefreshList:be,routeData:xe}=F(),Ve=[{label:"网站日志",name:"WebLogs",lazy:!0,render:()=>y(ae,null,null)},{label:"操作日志",name:"OperateLog",lazy:!0,render:()=>y(Y,null,null)},{label:"web日志分析",name:"WebLogAnalysis",lazy:!0,render:()=>y(H,null,null)}],Ce=E([]),Le=e=>e.getTime()>Date.now(),Se=()=>{n({title:"清理【"+te.value+"】网站日志",area:44,component:()=>i((()=>import("./index274.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{tips:"清理相关日志可能会导致故障排查困难，请谨慎操作",type:"website",clearEvent:async(e,a)=>{const t=I(e),l=await oe(t,a);return Ae(),l.status}},showFooter:!0})},ke=()=>{se.value.type=R().getType("website"),re.value={type:"website"},n({title:"导出日志",area:44,component:()=>i((()=>import("./index273.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,compData:{type:"website"}})},Ae=()=>{const e=(()=>{let e={ip_area:ve.value.ipArea?1:0,siteName:te.value,search:ve.value.searchValue};return ve.value.timeValue&&(ve.value.timeValue[0]=new Date(ve.value.timeValue[0]).setHours(0,0,0,0),ve.value.timeValue[1]=new Date(ve.value.timeValue[1]).setHours(23,59,59,0),e.time_search=JSON.stringify([ve.value.timeValue[0]/1e3,ve.value.timeValue[1]/1e3])),ve.value.searchValue||delete e.search,e})();ye(e),"error"!==ve.value.typeValue&&ce()},je=()=>{n({title:"关键字告警配置",area:62,component:()=>i((()=>import("./keyword-config.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},De=async e=>{const{keywordConfig:a}=ve.value;if((!a.keys.length||!a.channel||!a.cycle)&&e)return ve.value.keywordSwitch=!e,void je();const t={sitename:te.value};e&&(t.cycle=ve.value.keywordConfig.cycle,t.keys=JSON.stringify(ve.value.keywordConfig.keys),t.channel=ve.value.keywordConfig.channel);const{status:l}=await ie(t);l&&(ve.value.keywordSwitch=e)},Oe=e=>{if("ltd"!==we.value.authType)return ve.value.ipArea=!e,q({sourceId:107});Ae()},Ee=async(e,a,t)=>{try{await a();const t={cycle:e.value.cycle,channel:e.value.give.join(","),keys:JSON.stringify(e.value.keyword.split(","))},l=await ue(t);return ce(),l.status}catch(l){}},Te=async e=>{await u({title:"删除【"+e.site_name+"】日志源",icon:"warning-filled",content:"是否删除【"+e.site_name+"】?"});const a={server_id:e.server.id,source_type:e.source_type,source_list:JSON.stringify([e.site_name])};await me(a)},We=async e=>{var a;try{let t=_e.value.length>0,l={server_data:JSON.stringify({ip:e.ip,port:e.port})};t?l.server_id=null==(a=_e.value[0])?void 0:a.id:l.server_type="bt_log_server";const s=await ge(l);return s.status&&pe(),s.status}catch(t){}},Re=async e=>{try{const a={server_id:e.server_id,source_type:"site",source_list:JSON.stringify(e.site)},t=await de(a);return fe.value=!0,t.status}catch(a){}},Pe=e=>{"WebLogs"===e?Ae():"WebLogAnalysis"===e?(be.value=!0,xe.value.name=te.value):he.value=!0},Fe={class:"flex items-center mb-[20px]"},He={key:0},Me=d(p({__name:"index",setup(e){const{selectedWebSite:a,webTabActive:t}=b(R()),l=()=>{n({title:"日志服务系统",area:60,component:()=>i((()=>import("./index275.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})};return T((async()=>{await(async()=>{const{msg:e}=await o({loading:"正在获取网站列表，请稍后...",request:P(),data:{msg:Array}});return Array.isArray(e)?(te.value=Array.isArray(e)&&e[0]||"",Ce.value=e.map((e=>({label:e,value:e}))),e):(Ce.value=[],[])})(),"WebLogs"===t.value&&Ae()})),(e,s)=>{const r=c,o=w,n=m;return g(),V("div",null,[C("div",Fe,[s[6]||(s[6]=h(" 网站： ")),y(r,{modelValue:_(a),"onUpdate:modelValue":s[0]||(s[0]=e=>W(a)?a.value=e:null),options:_(Ce),onChange:s[1]||(s[1]=e=>_(Pe)(_(t))),placeholder:"请选择网站",class:"!w-[22rem]",filterable:""},null,8,["modelValue","options"]),"WebLogs"===_(t)?(g(),V("div",He,[y(o,{class:"!ml-12px",onClick:l},{default:f((()=>s[4]||(s[4]=[h(" 日志服务系统 ")]))),_:1})])):L("",!0),C("div",{class:"flex items-center ml-[16px]",onClick:s[2]||(s[2]=e=>_(J)())},s[5]||(s[5]=[C("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),C("span",{class:"bt-link"},"需求反馈",-1)]))]),y(n,{type:"card",modelValue:_(t),"onUpdate:modelValue":s[3]||(s[3]=e=>W(t)?t.value=e:null),options:_(Ve)},null,8,["modelValue","options"])])}}}),[["__scopeId","data-v-64f44dc7"]]),Ne=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));export{Ce as a,Re as b,Ee as c,Te as d,Ne as i,We as s};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
