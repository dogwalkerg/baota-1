import{c as a,r as e,R as s,i as l,o as t,k as r,l as d,e as o,x as u,p as i,I as n,aX as m,J as p,y as c,N as v,P as _,a7 as b,ag as f,ah as g,a4 as h}from"./base-lib.js?v=1734676359";import{v as j,G as y,M as w,ah as x,c as V,e as k}from"./utils-lib.js?v=1734676359";import{addModulesDatabase as C}from"./database.js?v=1734676359";import{g as D,b as I,p as M}from"./useMethod3.js?v=1734676359";import{_ as q}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const A={class:"p-[24px]"},R=k(a({__name:"index",props:{compData:{default:()=>({options:[]})}},setup(a,{expose:k}){const R=a,{refs:{tabActive:U},refreshTableList:F}=D(),G=e(),H=s(!1),J=e({name:"",db_user:"",password:j(16),dataAccess:"127.0.0.1",address:"",codeing:"utf8mb4",dtype:"MongoDb",ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),L=e([]),N={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]}]},P=l((()=>{var a;return(null==(a=L.value.find((a=>a.id===J.value.sid)))?void 0:a.db_host)||""})),S=a=>{J.value.db_user=a,J.value.ps=a},T=async()=>{try{H.value=!0;const{db_status:a,msg:e,err_msg:s}=await M(J.value.sid);return a?(H.value=!1,!0):(w.error(s||e),!1)}catch(a){x(a)}};return t((async()=>{var a,e;L.value=await(null==(a=R.compData)?void 0:a.refresh())||[],J.value.sid=null==(e=L.value[0])?void 0:e.id})),k({onConfirm:async a=>{await G.value.validate();if(!(await T()))return!1;await y({loading:"正在添加数据库, 请稍后...",request:C(J.value,U.value),message:!0,success:e=>{e.status&&(a(),F())}})}}),(a,e)=>{const s=_,l=b,t=f,j=g,y=V,w=h;return r(),d("div",A,[o(w,{disabled:i(H),model:i(J),ref_key:"addFormRef",ref:G,rules:N,onSubmit:e[2]||(e[2]=v((()=>{}),["prevent"]))},{default:u((()=>[o(l,{label:"数据库名",prop:"name"},{default:u((()=>[o(s,{class:"w-[38rem]",ref:"data_name",placeholder:"新的数据库名称",modelValue:i(J).name,"onUpdate:modelValue":e[0]||(e[0]=a=>i(J).name=a),onInput:S},null,8,["modelValue"])])),_:1}),o(l,{label:"添加至",prop:"sid",class:"!mb-0"},{default:u((()=>[o(j,{class:"!w-[24rem]",modelValue:i(J).sid,"onUpdate:modelValue":e[1]||(e[1]=a=>i(J).sid=a)},{default:u((()=>[(r(!0),d(n,null,m(i(L),((a,e)=>(r(),p(t,{key:e,label:a.ps+(a.db_host?"（"+a.db_host+"）":""),value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),o(y,{class:"ml-[8px]",onClick:i(I)},{default:u((()=>e[3]||(e[3]=[c("管理远程数据库")]))),_:1},8,["onClick"])])),_:1}),o(l,{label:" ",class:"!mb-0"},{default:u((()=>[o(q,{server:{sid:i(J).sid,ip:i(P)}},null,8,["server"])])),_:1})])),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-1abf5f6a"]]);export{R as default};
