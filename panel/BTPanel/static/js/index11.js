import{_ as a}from"./index100.js?v=1734676359";import{g as e,r as s,h as t,e as l,c as n,s as o,w as u,o as d,a1 as i,k as r,l as m,p as c,q as p,M as v,I as _,N as y,G as h,v as b,aX as g,J as x,aj as k,z as w,y as f,x as S,aw as D,au as M}from"./base-lib.js?v=1734676359";import{R as T,G as C,o as P,u as j,a4 as V,k as O,e as q}from"./utils-lib.js?v=1734676359";import{e as I,f as L,s as H,g as R}from"./control.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const U=e("CONTROL-STORE",(()=>{const a=s("monitor"),e=t({title:"日报-功能介绍",ps:"能够对服务器运行情况进行监测，分析服务器异常的信息进行行为记录，协助管理员进行服务器分析。",source:22,desc:["服务器运行情况监测","异常信息记录","服务器分析"],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/control/daily.png"}]}),n=s(!1),o=s([]),u=s(""),d=s(),i=s(""),r=s(),m=s(),c=s([]),p=s([]),v=s([]),_=async a=>{var e;const{data:s}=await C({request:I({date:a})});d.value=s.evaluate,"正常"===s.evaluate?i.value="#20a53a":"良好"===s.evaluate?i.value="#2034a5":i.value="#ffa700";const t=s.date.toString();if(r.value=t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2)+" 00:00:00 - 23:59:59",m.value=s.summary,o.value=[{name:"资源",value:"过载次数(五分钟内平均使用率超过80%)"},{name:"CPU",is_status:!0,data:s.data.cpu},{name:"内存",is_status:!0,data:s.data.ram},{name:"磁盘",is_status:!0,data:s.data.disk},{name:"常用服务",value:"异常次数(服务出现停止运行的次数)"},{name:"Nginx",is_status:!0,data:s.data.server.nginx},{name:"Mysql",is_status:!0,data:s.data.server.mysql},{name:"Apache",is_status:!0,data:s.data.server.apache},{name:"PHP",is_status:!0,data:s.data.server.php},{name:"Ftpd",is_status:!0,data:s.data.server.ftpd},{name:"Redis",is_status:!0,data:s.data.server.redis},{name:"Tomcat",is_status:!0,data:s.data.server.tomcat},{name:"Memcached",is_status:!0,data:s.data.server.memcached},{name:"备份类型",value:"备份失败",excess:"未开启备份",is_excess:!0},{name:"数据库",is_status:!0,data:s.data.backup.database.backup,data_excess:s.data.backup.database.no_backup,have_data_excess:!0},{name:"网站",is_status:!0,data:s.data.backup.site.backup,data_excess:s.data.backup.site.no_backup,have_data_excess:!0},{name:"异常类型",value:"次数"},{name:"面板异常登录",is_status:!0,data:s.data.exception.panel},{name:"SSH异常登录",is_status:!0,data:s.data.exception.ssh}],null==(e=s.data.disk)?void 0:e.app_data){const a=y(s.data.disk.app_data);o.value.push({name:"空间存储状态",is_status:!0,data:a})}},y=a=>{let e=[];const s={sites:"站点",databases:"数据库",plugins:"面板插件",logs:"日志",backup:"备份"};return Object.keys(s).forEach((t=>{e.push({name:"".concat(s[t]),value:a[t]})})),e},h=async()=>{await C({request:L(),data:Array,success:a=>{c.value=null==a?void 0:a.map((a=>({label:a.time_key.toString().substr(0,4)+"-"+a.time_key.toString().substr(4,2)+"-"+a.time_key.toString().substr(6,2),value:a.time_key,isStatus:"正常"==a.evaluate?"success":"error"}))).reverse(),u.value=c.value.length?c.value[0].value:"",u.value&&_(u.value)}})},b=async()=>{await C({request:R(),data:[Boolean,n]})};return{tabActive:a,$reset:()=>{p.value=[],v.value=[],c.value=[],o.value=[]},selectData:c,dataList:v,tableList:o,selectValue:u,topStatus:d,topStatusColor:i,watchTime:r,summary:m,tableColumn:p,productData:e,dailyValue:n,getDailyStatus:b,changeDailyStatus:async a=>{await P({title:"日报",content:"您确定要".concat(a?"开启":"关闭","日报功能吗？")}),await C({request:H({status:a?"start":"stop"}),message:!0,success:async()=>{await b(),n.value&&h()}})},getPanelDailyInfoLists:h,getPanelDailyDatas:_,filterType:a=>"数据库"==a.name||"网站"==a.name||"空间存储状态"==a.name?a.data.length>0:a.data.detail.length>0,goDetail:(a,e)=>{"数据库"==e||"网站"==e?a[0].target?p.value=[{label:"名称",showOverflowTooltip:!0,prop:"name"},{label:"时间",render:(a,e)=>T(a.time,"yyyy-MM-dd hh:mm:ss")}]:p.value=[{label:"名称",showOverflowTooltip:!0,prop:"name"}]:"面板异常登录"==e||"SSH异常登录"==e?p.value=[{label:"时间",showOverflowTooltip:!0,render:a=>T(a.time,"yyyy-MM-dd hh:mm:ss")},{label:"用户",prop:"username"},{label:"详情",prop:"desc"}]:"空间存储状态"==e?p.value=[{label:"名称",width:130,prop:"name"},{label:"占用空间",prop:"value"}]:"磁盘"==e?p.value=[{label:"路径",showOverflowTooltip:!0,prop:"name"},{label:"占用",render:a=>a.percent+"%"}]:"CPU"==e||"内存"==e?p.value=[{label:"过载时间",width:100,render:a=>l("span",null,[T(a.time,"yyyy-MM-dd hh:mm:ss")])},{label:"PID",prop:"pid",width:60},{label:"进程",prop:"name",showOverflowTooltip:!0},{label:"占用",width:60,render:a=>a.percent+"%"}]:["Nginx","Mysql","Apache","PHP","Ftpd","Redis","Tomcat","Memcached"].includes(e)&&(p.value=[{label:"停止时间",render:a=>T(a.time,"yyyy-MM-dd hh:mm:ss")}]),v.value="数据库"==e||"网站"==e||"空间存储状态"==e?a:a.detail,p.value.unshift({width:"CPU"==e||"内存"==e?40:30,type:"index",render:(a,e)=>v.value.findIndex(((e,s)=>e==a))+1})}}})),A={class:"content_box"},N={key:0,class:"relative"},z={class:"monitor mb-1rem"},E={class:"box-select"},F={class:"box-body"},G={class:"body_top"},$={class:"watch_time"},B={class:"msg_box"},J={class:"w-[95rem] mt-[2rem]"},X={class:"item_name"},K=["onMouseover"],Q={key:2,class:"item_excess"},W={key:3,class:"item_excess"},Y=["onMouseover"],Z=q(n({__name:"index",setup(e){const{payment:t}=j(),n=U(),{selectData:T,dataList:C,tableList:P,selectValue:q,topStatus:I,topStatusColor:L,watchTime:H,summary:R,tableColumn:Z,productData:aa,dailyValue:ea}=o(n),sa=s(!0);return u((()=>t.value),(a=>{sa.value="ltd"===a.authType})),d((async()=>{await n.getDailyStatus(),ea.value&&n.getPanelDailyInfoLists()})),i(n.$reset),(e,s)=>{const t=k,o=V,u=O,d=D,i=M,j=a;return r(),m("div",A,[c(sa)?(r(),m("div",N,[p("div",z,[s[3]||(s[3]=p("span",{class:"mr-8px align-middle"},"开启日报",-1)),l(t,{modelValue:c(ea),"onUpdate:modelValue":s[0]||(s[0]=a=>v(ea)?ea.value=a:null),onChange:c(n).changeDailyStatus},null,8,["modelValue","onChange"])]),c(T).length?(r(),m(_,{key:0},[p("div",E,[s[4]||(s[4]=p("span",null,"选择日期：",-1)),l(o,{modelValue:c(q),"onUpdate:modelValue":s[1]||(s[1]=a=>v(q)?q.value=a:null),onClick:s[2]||(s[2]=y((()=>{}),["stop"])),options:c(T),class:"!w-[12.02rem]",onChange:c(n).getPanelDailyDatas},null,8,["modelValue","options","onChange"])]),p("div",F,[p("div",G,[p("span",{class:"top_status",style:h({color:c(L)})},b(c(I)),5),p("span",$,"监测时间："+b(c(H)),1),s[5]||(s[5]=p("span",{class:"text-left mb-[1.6rem]"},"健康信息提醒：",-1)),p("div",B,[(r(!0),m(_,null,g(c(R),((a,e)=>(r(),m("span",{key:e},"●"+b(a),1)))),128))])]),p("div",J,[(r(!0),m(_,null,g(c(P),((a,e)=>(r(),m("div",{class:"bottom_item",key:e},[p("div",X,[a.is_status?(r(),m("span",{key:0,class:"mr-[.5rem]",style:h({background:"空间存储状态"==a.name?"#20a53a":"数据库"==a.name||"网站"==a.name?0==a.data.length&&0==a.data_excess.length?"#20a53a":"red":0==a.data.ex?"#20a53a":"red"})},null,4)):w("",!0),f(b(a.name),1)]),a.is_status?(r(),m("div",{key:0,class:"item_value",style:h({width:a.have_data_excess?"24rem":"auto"})},["空间存储状态"!==a.name?(r(),m(_,{key:0},[f(b("数据库"==a.name||"网站"==a.name?0==a.data.length?"未监测到异常":a.data.length+"次":0==a.data.ex?"未监测到异常":a.data.ex+"次"),1)],64)):w("",!0),c(n).filterType(a)?(r(),x(d,{key:1,width:"360",placement:"bottom",trigger:"hover","popper-class":"max_over"},{reference:S((()=>[p("span",{class:"bt-link",onMouseover:e=>c(n).goDetail(a.data,a.name)},"  查看详情",40,K)])),default:S((()=>[l(u,{ref_for:!0,ref:"menuTable1","max-height":300,data:c(C),column:c(Z)},null,8,["data","column"])])),_:2},1024)):w("",!0)],4)):(r(),m("div",{key:1,class:"item_value",style:h({width:a.is_excess?"24rem":"auto"})},b(a.value),5)),a.is_excess?(r(),m("div",Q,b(a.excess),1)):w("",!0),a.is_status&&a.data_excess?(r(),m("div",W,[f(b(a.have_data_excess&&a.data_excess.length?a.data_excess.length+"次":"未监测到异常")+" ",1),a.have_data_excess&&a.data_excess.length?(r(),x(d,{key:0,width:"350",placement:"bottom",trigger:"hover","popper-class":"max_over"},{reference:S((()=>[p("span",{class:"bt-link",onMouseover:e=>c(n).goDetail(a.data_excess,a.name)},"  查看详情",40,Y)])),default:S((()=>[l(u,{ref_for:!0,ref:"menuTable2","max-height":300,data:c(C),column:c(Z)},null,8,["data","column"])])),_:2},1024)):w("",!0)])):w("",!0)])))),128)),s[6]||(s[6]=p("span",{class:"bottom_tips"},"在系统监控开启的情况下，日报会记录服务器每天运行的异常信息，协助管理员分析服务器前一天是否运行正常。",-1))])])],64)):(r(),x(i,{key:1,"image-size":200,description:"面板日报暂无数据"}))])):(r(),x(j,{key:1,data:c(aa),class:"px-[20%] my-[8rem]"},null,8,["data"]))])}}}),[["__scopeId","data-v-49889877"]]);export{Z as default};
