import{c as e,bE as t,e as s,m as a,aS as n,a5 as i,s as l,g as r,r as o,y as c,I as d,w as u,k as p,l as m,x,q as f,v as _,p as v,z as h}from"./base-lib.js?v=1734676359";import{_ as b}from"./index277.js?v=1734676359";import{t as w,ck as g,cl as k,b as j,c5 as y,J as q,u as C,bX as H}from"./utils-lib.js?v=1734676359";import{u as S}from"./column.js?v=1734676359";import{w as D}from"./validator.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const I=e({name:"BtCard",props:{...t},setup:(e,{attrs:t,slots:l})=>()=>{return s(n,a(t,e),"function"==typeof(r=l)||"[object Object]"===Object.prototype.toString.call(r)&&!i(r)?l:{default:()=>[l]});var r}}),{request:O}=j(),T=r("VHOST-STORAGE-STORE",(()=>{const e=o({device:"",mountpoint:"",fstype:"",total:0,used:0,free:0,used_percent:0,inodes_total:0,inodes_used:0,inodes_free:0,inodes_used_percent:0,is_group_quota:!1,is_user_quota:!1,is_default:!1,account_allocate:0,account_percent:0}),t=o(0),a=o(!1),n=o([{label:"挂载点",prop:"mountpoint",minWidth:120},{label:"装置",prop:"device",minWidth:120},{label:"磁盘配额",prop:"is_group_quota",minWidth:140,render:e=>e.is_user_quota?s("span",null,[c("是")]):s("div",null,[s("span",{class:"text-warning"},[c("否")]),c(" |")," ",s("span",{class:"text-primary cursor-pointer",onClick:()=>r(e)},[c("设置磁盘配额")])])},{label:"总大小",prop:"total",minWidth:60,render:e=>w(e.total)},{label:"已使用",prop:"used",minWidth:180,render:e=>{const t=Math.round(e.used_percent);return s(d,null,[s("div",{class:"mr-[10px]"},[t,c("% / "),w(e.used)]),s(b,{class:"w-[100px]",percentage:Number(t.toFixed(2)),"text-inside":!0,"stroke-width":14,status:i(t)},null)])}},S([{width:100,disabled:!0,isHide:e=>e.is_default&&!a.value,render:()=>s("span",null,[c("默认磁盘")])},{title:"重启服务",width:100,onClick:()=>D(),isHide:e=>e.is_default&&!a.value},{title:"设置默认磁盘",width:100,onClick:e=>u(e),isHide:e=>e.is_default&&!a.value}])]),i=e=>{const t=Math.round(e);return t>80?"exception":t>60?"warning":"success"},l=()=>{t.value=(new Date).getTime()},r=async e=>{const t=await g(e.mountpoint);await O(t),l()},u=async e=>{const t=await k({mountpoint:e.mountpoint});await O(t),l(),a.value=!0};return{defaultDiskInfo:e,columns:n,diskColor:i,refreshInfo:t,refreshList:l,getDiskList:async()=>{const{data:t}=await y();if(q(t)){const s=t.find((e=>e.is_default));if(s){const t={...s};t.account_percent=Math.round(t.account_allocate/t.total*100),e.value=t}return{data:t,total:t.length}}return{data:[],total:0}}}})),W={class:"p-[10px]"},E={class:"flex items-center mb-[16px]"},F={class:"flex-1"},L={class:"flex items-center mb-[16px]"},M={class:"flex-1"},N={class:"flex items-center mb-[16px]"},B={class:"flex w-[50rem]"},R={class:"mr-[2rem] max-w-[20rem] w-[16rem]"},z={class:"flex-1"},A={class:"flex items-center mb-[16px]"},G={class:"flex w-[50rem]"},J={class:"mr-[2rem] max-w-[20rem] w-[16rem]"},P={class:"flex-1"},V={key:0,class:"text-center text-danger"},X=e({__name:"index",setup(e){const{mainHeight:t}=C(),{columns:a,getDiskList:n,defaultDiskInfo:i,diskColor:r,refreshInfo:o}=(()=>{const e=T(),t=l(e);return{...e,...t}})(),{BtTable:c,refresh:d}=H({request:n,columns:a.value});return u((()=>o.value),d),(e,a)=>{const n=b,l=I;return p(),m("div",null,[s(l,{class:"!border-none mb-[20px]"},{header:x((()=>a[0]||(a[0]=[f("div",{class:"card-header"},[f("span",null,"预设存储盘")],-1)]))),default:x((()=>[a[5]||(a[5]=f("div",{class:"p-[16px] text-[14px]"},"创建用户时，用户信息将存储在此空间中",-1)),f("div",W,[f("div",E,[a[1]||(a[1]=f("div",{class:"w-[150px] font-black text-[14px] text-right h-[24px]"},"默认磁盘配额：",-1)),f("div",F,_(v(i).mountpoint),1)]),f("div",L,[a[2]||(a[2]=f("div",{class:"w-[150px] font-black text-[14px] text-right h-[24px]"},"装配：",-1)),f("div",M,_(v(i).device),1)]),f("div",N,[a[3]||(a[3]=f("div",{class:"w-[150px] font-black text-[14px] text-right h-[24px]"},"已使用：",-1)),f("div",B,[f("div",R,_(v(w)(v(i).used))+"/ "+_(v(w)(v(i).total)),1),f("div",z,[s(n,{percentage:Number(v(i).used_percent.toFixed(2)),"text-inside":"","stroke-width":18,status:v(r)(v(i).used_percent)},null,8,["percentage","status"])])])]),f("div",A,[a[4]||(a[4]=f("div",{class:"w-[150px] font-black text-[14px] text-right h-[24px]"},"已分配：",-1)),f("div",G,[f("div",J,_(v(w)(v(i).account_allocate))+"/ "+_(v(w)(v(i).total)),1),f("div",P,[s(n,{percentage:Number((v(i).account_allocate/v(i).total*100).toFixed(2)),"text-inside":"","stroke-width":18,status:v(r)(v(i).account_percent)},null,8,["percentage","status"]),v(i).account_percent>100?(p(),m("div",V,"PS:您的空间分配已达上限")):h("",!0)])])])])])),_:1}),s(l,{class:"!border-none"},{header:x((()=>a[6]||(a[6]=[f("div",{class:"card-header"},[f("span",null,"可用存储盘")],-1)]))),default:x((()=>[s(v(c),{class:"mt-[16px]","min-height":v(t)},null,8,["min-height"])])),_:1})])}}});export{X as default};
