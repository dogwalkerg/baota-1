import{G as a,M as t,ah as e,a7 as s,S as l,u as n,J as r,aM as o,o as i,F as c,e as u,U as g,al as d,bI as m,bJ as y,R as p,bK as h,bL as v,t as f,l as w,k as b,bM as S,H as L,aj as T,bN as k,bO as _,bP as x}from"./utils-lib.js?v=1734676359";import{_ as q}from"./index99.js?v=1734676359";import{g as F,s as P,r as C,R as E,i as D,h as O,c as M,w as R,k as A,l as I,q as V,J as j,p as B,M as H,z as N,G as J,I as W,aX as z,e as G,x as K,y as U,F as Y,H as $,au as X,v as Q,o as Z,A as aa,b0 as ta,C as ea,B as sa}from"./base-lib.js?v=1734676359";import{_ as la}from"./index101.js?v=1734676359";import{g as na,b as ra,c as oa,d as ia,s as ca,e as ua,f as ga,h as da,i as ma,j as ya,k as pa,l as ha,m as va,u as fa,n as wa,r as ba,o as Sa,p as La,L as Ta,q as ka,t as _a,v as xa,w as qa,x as Fa,y as Pa,z as Ca,A as Ea,B as Da,C as Oa,D as Ma,E as Ra,F as Aa,G as Ia,H as Va,a as ja,I as Ba}from"./useStore6.js?v=1734676359";import{_ as Ha}from"./index90.js?v=1734676359";import{_ as Na}from"./index272.js?v=1734676359";import{u as Ja,c as Wa}from"./column.js?v=1734676359";import{e as za}from"./validator.js?v=1734676359";var Ga=function(a){return a.TamperProof="网站防篡改",a.Syssafe="宝塔系统加固",a.Security="堡塔防入侵",a.TamperProofRefactored="网站防篡改程序-重构版",a}(Ga||{});const Ka=F("LOG-SOFT-STORE",(()=>{const n=C([]),r=C(""),o=C(),i=C([]),c=C(""),u=C(""),g=C(""),d=C("login"),m=C("");Ga.TamperProof,Ga.Syssafe,Ga.Security,Ga.TamperProofRefactored;const y=async t=>{try{const{data:e}=await a({loading:"正在获取日志数据，请稍后...",request:ya({data:JSON.stringify({name:"syssafe",search:t.search,ROWS:t.ROWS})})});return{data:e.msg.data,total:e.total||s(e.msg.page),other:{}}}catch(l){return e(l),{total:0,data:[],other:{}}}},p=async t=>{try{const e=await a({loading:"正在获取日志数据，请稍后...",request:pa({data:JSON.stringify({name:"bt_security",search:t.search,ROWS:t.ROWS})}),data:{"msg.data":[Array,a=>({data:a})],"msg.page":l()}});return{data:e.data,total:e.total,other:{}}}catch(e){return{total:0,data:[],other:{}}}},h=C("mysqlSlow"),v=C([]),f=async a=>{try{return{data:(await ha({data:JSON.stringify({limit:"5000",search:a})})).data.msg,status:!0,msg:""}}catch(t){return e(t),{status:!1,data:"",msg:"获取日志数据失败"}}},w=async(a,t)=>{try{return{data:(await va({screening:v.value.length?v.value.join(","):"",keywords:a||""})).data,status:!0,msg:""}}catch(s){return e(s),{status:!1,data:"",msg:"获取日志数据失败"}}};return{menuOptions:n,currentName:r,searchValue:m,phpData:i,phpChecked:c,logsMsg:u,logPath:g,getMenuList:async()=>{try{const t=a=>a.map((a=>({name:a,id:a})));return{data:await a({loading:"正在获取日志菜单，请稍后...",request:na(),data:[Array,t],success:a=>{var t;n.value=a,r.value=null==(t=a[0])?void 0:t.name}}),status:!0}}catch(t){return{status:!1,data:[],msg:"获取日志菜单失败"}}},getSoftLog:async(t="")=>{try{const e="Php"===r.value?ra:oa;return{...(await a({loading:"正在获取日志数据，请稍后...",request:e({data:JSON.stringify({name:r.value,search:t})})})).data}}catch(e){return{status:!1,data:[],msg:"获取日志数据失败"}}},ftpType:d,getFtpMenu:async()=>{try{const{data:t,status:e}=await a({loading:"正在获取FTP用户名,请稍后...",request:da({p:1,limit:99999,search:"",table:"ftps"}),data:{data:Array}});return{data:t,status:e,msg:"获取用户成功"}}catch(t){return{status:!1,data:[],msg:"获取用户失败"}}},getFtpLogStatus:async()=>{const a=t.load("正在获取FTP日志状态，请稍后...");try{const{status:a,msg:t}=await ca({exec_name:"getlog"});return{status:a,data:t}}catch(s){return e(s),{status:!1,data:"获取FTP日志状态失败"}}finally{a.close()}},startFtpLog:async()=>{const a=t.load("正在开启FTP服务，请稍后...");try{const{status:a,msg:t}=await ca({exec_name:"start"});return{status:a,msg:t}}catch(s){return e(s),{status:!1,msg:"开启FTP服务失败"}}finally{a.close()}},getFtpLogData:async t=>{try{const e=await a({loading:"正在获取FTP日志,请稍后...",request:ua(t),data:{data:Array,page:String}});return Array.isArray(null==e?void 0:e.data)?{data:e.data,total:s(e.page),other:{}}:{total:0,data:[],other:{}}}catch(l){return e(l),{total:0,data:[],other:{}}}},getFtpActionLog:async t=>{try{const e=await a({loading:"正在获取FTP操作日志,请稍后...",request:ga(t),data:{data:Array,page:String}});return Array.isArray(null==e?void 0:e.data)?{data:e.data,total:s(e.page),other:{}}:{total:0,data:[],other:{}}}catch(e){return{total:0,data:[],other:{}}}},renderSysSecurityLog:p,renderSysSafeLog:y,getPluginLogData:async t=>{try{let e=null;if("Docker"===r.value){const{data:l}=await a({request:ma(t)});e=l,e.total=s(l.page)}else r.value===Ga.Syssafe?e=await y(t):r.value===Ga.Security&&(e=await p(t));return{data:e.data,total:e.total,other:{}}}catch(l){return e(l),{total:0,data:[],other:{}}}},mysqlActive:h,checkList:v,getErrorMysqlData:w,getMysqlLogsData:f,handleMysqlTabClick:a=>{var t;return"mysqlSlow"===a||"mysqlSlow"===(null==(t=a.props)?void 0:t.name)?f():w()},delMysqlAllLogEvent:async()=>{try{let t={type:2,assort:"mysqlSlow"===h.value?"slow":"error"};return await a({loading:"正在清空日志,请稍候...",request:ia(t),message:!0}),{status:!0,msg:"清空日志成功"}}catch(t){return{status:!1,msg:"清空日志失败"}}},delAllLogDataEvent:async()=>{let t={type:1,path:g.value};return await a({loading:"正在清空日志,请稍候...",request:ia(t),message:!0})},delSoftLogEvent:async t=>{try{return await a({loading:"正在删除日志,请稍候...",request:ia({type:0,id:t.id}),message:!0,success:o.value}),{status:!0,msg:"删除日志成功"}}catch(e){return{status:!1,data:[],msg:"删除日志失败"}}},refreshPlugin:o}})),{payment:Ua}=n(),{currentName:Ya,logsMsg:$a,phpChecked:Xa,phpData:Qa,mysqlActive:Za,ftpType:at,logPath:tt,refreshPlugin:et}=(()=>{const a=Ka();return P(a)})(),{getSoftLog:st,getFtpMenu:lt,getFtpLogStatus:nt,startFtpLog:rt,getFtpActionLog:ot,getFtpLogData:it,delMysqlAllLogEvent:ct,delAllLogDataEvent:ut,getMysqlLogsData:gt,getErrorMysqlData:dt,delSoftLogEvent:mt}=Ka(),yt=["Docker","宝塔系统加固","堡塔防入侵"],pt={title:"FTP日志-功能介绍",ps:"记录FTP登录记录，FTP上传、下载、重命名和删除记录.",source:131,desc:["FTP登录记录","FTP上传记录","FTP重命名记录","FTP删除记录"],tabImgs:[{title:"FTP日志",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/logs/ftp-logs.png"}]},ht=C(!0);E();const vt=C(""),ft=C(""),wt=C([]),bt=C(!1),St=async(a,t)=>{const{selectedItem:e}=fa();if(Ya.value=a.name,e.value=a.name,vt.value="",yt.includes(a.name))return et.value&&et.value();if("Mysql"===a.name);else if("FTP"!==a.name)return await Lt(a)},Lt=async(a,t)=>{Ya.value=a.name;const e=await st(t);if("Php"===Ya.value)r(e)?Qa.value=e:Qa.value=Object.values(e),Qa.value=Qa.value.filter((a=>a.status)),""===Xa.value&&(Xa.value=Qa.value[0].version),kt(Xa.value);else if(o(e)){const a=e;tt.value=(null==a?void 0:a.file)||"",$a.value=(null==a?void 0:a.msg)||"暂无数据"}return e},Tt=async a=>{await i({title:"清空日志【".concat(Ya.value,"】"),icon:"warning-filled",type:"calc",content:"风险操作，清空该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),await ut(),Lt({name:Ya.value})},kt=a=>{var t;null==(t=Qa.value)||t.forEach((t=>{t.version==a&&($a.value=t.msg,tt.value=t.file)}))},_t=()=>window.open("/download?filename="+tt.value),xt=async a=>{if("ltd"!==Ua.value.authType)return{data:[],total:0,other:{}};ht.value&&(await(async()=>{var a;if("ltd"!==Ua.value.authType)return;const{data:t}=await lt();wt.value=t.map((a=>({label:a.name,value:a.name,key:a.id}))),ft.value=(null==(a=t[0])?void 0:a.name)||""})(),ht.value=!1);try{if(!(await(async()=>{if("stop"===(await nt()).data){await i({title:"FTP服务",content:"FTP服务未启动，无法获取日志,是否立即开启FTP服务?"});const a=await rt();return t.request(a),bt.value=!0,!1}return!0})()))return{data:[],total:0,other:{}};const e={...a};if(e.user_name=ft.value,delete e.ftpType,"login"===a.ftpType)return await it(e);if("action"===a.ftpType)return await ot(e)}catch(e){return{data:[],total:0,other:{}}}};var qt=function(a){return a.TamperProof="网站防篡改",a.Syssafe="宝塔系统加固",a.Security="堡塔防入侵",a.TamperProofRefactored="网站防篡改程序-重构版",a}(qt||{});qt.TamperProof,qt.Syssafe,qt.Security,qt.TamperProofRefactored;const Ft=async a=>{await i({title:"删除日志【".concat(Ya.value,"】"),type:"calc",content:"风险操作，删除该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),mt(a)},Pt=[{label:"Mysql慢日志",value:"mysqlSlow"},{label:"Mysql错误日志",value:"mysqlError"}],Ct=[{label:"删除",value:"delete",event:async(a,t)=>{const e=async a=>await ia({type:0,id:a.id});await a({title:"批量删除",content:"即将删除所选中的日志，是否继续操作?",column:[{prop:"log",label:"日志内容"},Wa()],onConfirm:async()=>(await t(e),et.value(),!1)})}}],Et=()=>[{type:"selection"},{label:"用户",prop:"username"},{label:"详情",prop:"log"},{label:"操作时间",prop:"addtime",align:"right"},Ja([{title:"删除",onClick:Ft}])],Dt=D((()=>"宝塔系统加固"===Ya.value?()=>Et().slice(1):()=>Et())),Ot=C(""),Mt=[{label:"警告",value:"warning"},{label:"错误",value:"error"},{label:"记录",value:"note"}],Rt=async()=>{await i({title:"清空日志【Mysql".concat("mysqlSlow"===Za.value?"慢日志":"错误日志","】"),icon:"warning-filled",content:"您真的要清空所有【Mysql".concat("mysqlSlow"===Za.value?"慢日志":"错误日志","】吗？")}),await ct(),At()},At=async a=>{let t=null;"mysqlSlow"===Za.value&&(t=await gt(a)),"mysqlError"===Za.value&&(t=await dt(a)),Ot.value=t.data||"暂无数据"},It=async({props:a})=>{Za.value=a.name,At("")},Vt=["Mysql","FTP","Docker","宝塔系统加固","堡塔防入侵"],jt=D((()=>Vt.includes(Ya.value))),Bt=F("LOG-SSH-STORE",(()=>({isRefreshList:C(!1),getLogs:async e=>{try{const s=await a({loading:"正在获取日志数据，请稍后...",request:wa({data:JSON.stringify(e)})});return!s.status&&s.msg?t.error(s.msg):{data:s.data,total:s.data.length,other:{}}}catch(s){return{data:[],total:0,other:{}}}},changeIpRules:async(t,e)=>{try{const s=await a({loading:"正在处理中，请稍后...",request:e?ba(t):Sa(t)});return{msg:s.data[0].msg,status:s.data[0].status,data:{ip:s.data[0].ip}}}catch(s){return{msg:"操作失败",status:!1,data:{}}}},outLogs:async t=>{try{const{count:e,type:s}=t;let l={count:e,select:s};"all"===l.select&&delete l.select;const n=await a({loading:"正在导出日志，请稍后...",request:La({data:JSON.stringify(l)}),success:a=>{window.open("/download?filename="+a.data.output_file)}});return{status:n.status,msg:"导出".concat(n.status?"成功":"失败")}}catch(e){return{status:!1,msg:"导出失败"}}}}))),Ht=()=>P(Bt()),Nt=F("LOG-SITE-STORE",(()=>{const l=Ta(),{selectedWebSite:n}=P(l),r=C(!1),o=C(!1),i=C(),c=C(!1),u=C(""),g=O({ipArea:!1,typeValue:"access",timeValue:"",searchValue:"",keywordSwitch:!1,keywordConfig:{}}),d=C(),m=O({give:"",keyword:"",cycle:""}),y=C(!1),p=C(!1),h=C(),v=C(),f=C(!1),w=O({site:[]}),b=C(!1),S=C(),L=C([]),T=O({ip:"",id:0,port:""}),k=async()=>{var a,t;try{const{data:e}=await Pa({sitename:n.value});return g.keywordConfig=e.config,m.give=null==(a=g.keywordConfig.channel)?void 0:a.split(",").filter((a=>""!==a)),m.keyword=null==(t=g.keywordConfig.keys)?void 0:t.join(","),m.cycle=g.keywordConfig.cycle,g.keywordSwitch=e.status,{data:{...m},status:!0}}catch(s){return e(s,"getKeywordAlarmData"),{msg:"获取关键字告警配置失败",status:!1}}};C([]);const _=async()=>{try{const t=await a({loading:y,request:Ia(),data:Array});return{data:t,total:t.length,other:{}}}catch(t){return{data:[],total:0,other:{}}}};return{siteList:i,getSiteList:async()=>{try{return{data:(await a({loading:"正在获取网站列表，请稍后...",request:ka(),data:{msg:[Array,a=>{i.value=a,n.value=i.value[0]||""}]}})).msg,status:!0}}catch(t){return{msg:"获取网站列表失败 ",status:!1}}},logParams:g,preLoading:c,logMsg:u,logScanForm:d,msgForm:m,getSiteLogsData:async t=>{if(n.value)try{const e=await a({loading:c,request:"error"===g.typeValue?qa(t):Fa(t),data:{msg:String}});return u.value=(null==e?void 0:e.msg)||"暂无数据",{data:e.msg||"暂无数据",status:!0}}catch(s){e(s,"getSiteLogsData")}},setKeyWordConfigEvent:async t=>{try{return await a({loading:"正在设置关键字告警...",request:Ca(t),message:!0}),{status:!0,msg:"设置关键字告警成功"}}catch(e){return{status:!1,msg:"设置关键字告警失败"}}},clearWebLogEvent:async(t,e)=>{try{const s=await a({loading:"正在清理日志中，请稍后....",request:_a({siteName:n.value,logType:e,time_search:JSON.stringify(t)}),message:!0});return{status:s.status,msg:s.msg}}catch(s){return{msg:"清理失败",status:!1}}},outWebLogEvent:async(t,e)=>{try{const s=await a({loading:"正在导出日志中，请稍后....",request:xa({siteName:n.value,logType:e,time_search:JSON.stringify(t)}),data:{msg:String,status:Boolean}});return s.status&&window.open("/download?filename="+s.msg),{status:s.status,msg:"导出".concat(s.status?"成功":"失败"),data:s.msg}}catch(s){return{msg:"导出失败",status:!1}}},getKeywordAlarmData:k,getScanData:async()=>{try{const{data:t}=await a({loading:"正在获取关键字告警配置，请稍后...",request:Pa({sitename:n.value})});return m.cycle=t.config.cycle,m.keyword=t.config.keys.join(","),""!=t.config.channel&&(m.give=t.config.channel.split(",")),{data:m,status:!0}}catch(t){return{msg:"获取关键字告警配置失败",status:!1}}},tableLoading:y,getOperateLog:async t=>{try{if(!n.value)return;t.search||(t.search=n.value);const e=await a({loading:y,request:Ea({data:JSON.stringify(t)}),data:{data:Array,page:String}});return{data:e.data,total:s(e.page),other:{}}}catch(e){return{data:[],total:0,other:{}}}},outLogs:async()=>{try{const a=await Da({search:n.value});return window.open("/download?filename="+a.data.output_file),{status:!0,msg:"导出成功"}}catch(a){return{status:!1,msg:"导出失败"}}},sForm:v,logSysForm:S,sendSource:f,logSystemDialog:b,logSystemForm:T,sourceForm:w,logSystemData:h,logSystemLoad:p,logSystemList:L,getLogSystemData:_,getLogSystemSite:async()=>{try{return await a({loading:"正在获取日志服务系统配置中,请稍后...",request:Va(),data:[Array,L]}),L.value.length>0&&(T.ip=L.value[0].ip,T.port=L.value[0].port,T.id=L.value[0].id),{data:L.value,status:!0}}catch(t){return{msg:"获取日志服务系统配置失败",status:!1}}},logSystemConfirm:async t=>{try{return await a({loading:"正在设置日志系统配置中...",request:t.server_id?Ma(t):Ra(t),message:!0}),{status:!0,msg:"设置成功"}}catch(e){return{status:!1,msg:"设置失败"}}},sendSourceConfirm:async e=>{try{const s=await a({loading:"正在设置日志源中...",request:Aa(e)});return t.request(s.data[0]),f.value=!1,s}catch(s){return{status:!1,msg:"设置失败"}}},delLogSourceEvent:async t=>{try{return await a({loading:"正在删除日志源，请稍候...",request:Oa(t),message:!0,success:_}),{status:!0,msg:"删除成功"}}catch(e){return{status:!1,msg:"删除失败"}}},onConfirmKeyConfig:async t=>{try{return await a({loading:"正在设置关键字告警配置，请稍后...",request:Ca(t),message:!0}),{status:!0,msg:"设置关键字告警成功"}}catch(e){return{status:!1,msg:"设置关键字告警失败"}}},isRefreshLogSystem:o,isRefreshList:r}})),Jt=()=>P(Nt()),{selectedItem:Wt}=fa(),zt=a=>{let t=[];const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()/1e3,l=Math.floor((new Date).getTime()/1e3);switch(a){case"7":t=[s-604800,l];break;case"30":t=[s-2592e3,l];break;case"180":t=[s-15552e3,l]}return t},Gt=async(a,t)=>{switch(a){case"ssh":Bt().outLogs(t);break;case"login":ja().outLoginLogEvent(t);break;case"crontab":ja().outShellLogEvent(t);break;case"website":const a=zt(t.day);Nt().outWebLogEvent(a,t.type)}},Kt=(a,e)=>{const s="crontab"===e?"id":"name";((a,t)=>{switch(t){case"soft":Lt(a);break;case"crontab":Xe(a)}})(a.find((a=>String(a[s])===Wt.value)),e),t.success("刷新成功")},Ut=a=>za({type:22,name:"日志",id:999,...a}),Yt={class:"flex items-start w-full"},$t=["onClick","tabindex"],Xt={key:2,class:"menu p-[20px] bg-[#f1f1f120]"},Qt={class:"flex-1"},Zt={class:"log-view"},ae={class:"flex items-center"},te=u(M({__name:"index",props:{menuOptions:{default:()=>[]},logsType:{default:"pre"},width:{default:"24"},height:{default:"68"},logContent:{default:""}},emits:["tab-click","search"],setup(a,{emit:t}){const{mainHeight:e}=n(),s=a,l=t,r=Ta(),{searchValue:o,logLoading:i,selectedItem:u}=P(r),g=D((()=>"Mysql"===s.logsType?e.value-300:"crontab"===s.logsType?e.value-248:e.value-188)),d=D((()=>"crontab"===s.logsType?"id":"name"));return R((()=>s.menuOptions[0]),(a=>{a&&(u.value=String(a[d.value]))}),{once:!0}),(a,t)=>{const e=c,s=X,n=la;return A(),I("div",Yt,[V("div",{class:Y("flex flex-col mr-[16px]"),style:J("width:".concat(a.width,"rem;"))},["crontab"==a.logsType?(A(),j(e,{key:0,class:"mb-[8px] !w-[24rem]",modelValue:B(o),"onUpdate:modelValue":t[0]||(t[0]=a=>H(o)?o.value=a:null),onSearch:B(ts),placeholder:"请输入日志名称"},null,8,["modelValue","onSearch"])):N("",!0),a.menuOptions.length>0?(A(),I("div",{key:1,class:"menu",style:J("height:".concat(B(g)-("crontab"==a.logsType?56:-5),"px"))},[(A(!0),I(W,null,z(a.menuOptions,((t,e)=>(A(),I("span",{onClick:a=>l("tab-click",t),tabindex:e,key:e,style:J("width:".concat(a.width,"rem")),class:Y("menu-hover ".concat(String(t[B(d)])===B(u)?"activeClass":""))},Q(t.tabProps)+" "+Q(t.name),15,$t)))),128))],4)):(A(),I("span",Xt,[G(s,null,{image:K((()=>t[2]||(t[2]=[V("i",{class:"svgtofont-empty !text-[4.8rem] text-#999"},null,-1)]))),description:K((()=>t[3]||(t[3]=[U("暂无数据")]))),_:1})]))],4),$(a.$slots,"LogView",{},(()=>[V("div",Qt,[V("div",Zt,[V("div",ae,[$(a.$slots,"LogLeft",{},void 0,!0),V("div",{class:"flex items-center",onClick:t[1]||(t[1]=a=>B(Ut)())},t[4]||(t[4]=[V("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),V("span",{class:"bt-link"},"需求反馈",-1)]))]),$(a.$slots,"LogRight",{},void 0,!0)]),G(n,{class:"w-full flex-1",content:a.logContent,isHtml:!0,autoScroll:!0,fullScreen:{title:"全屏查看-日志",onRefresh:()=>{B(Kt)(a.menuOptions,a.logsType)}},style:J("height:"+B(g)+"px")},null,8,["content","fullScreen","style"])])]),!0)])}}}),[["__scopeId","data-v-e4fcf379"]]),ee={class:"flex items-center"},se={key:0,class:"flex items-center inline-block"},le=M({__name:"crontab-log",setup(a){const{mainHeight:t}=n(),e=ja(),{logsMsg:s,currentItem:l,crontabForm:r}=P(e);return Z((async()=>{await ts(),await Xe(Re.value[0])})),(a,e)=>{const n=aa,o=g,i=ta,c=q;return A(),I("div",{class:"flex items-start",style:J({height:B(t)-195+"px"})},[G(te,{logsType:"crontab","menu-options":B(Re),logContent:B(s),onTabClick:B(Xe),onSearch:B(ts)},{LogLeft:K((()=>[G(n,{class:"!mr-[12px]",onClick:e[0]||(e[0]=a=>B(Qe)(B(l)))},{default:K((()=>e[7]||(e[7]=[U(" 清理日志 ")]))),_:1}),B(Ae)?(A(),j(n,{key:0,onClick:B(as)},{default:K((()=>e[8]||(e[8]=[U(" 导出日志 ")]))),_:1},8,["onClick"])):N("",!0)])),LogRight:K((()=>[V("div",ee,[B(Ae)?(A(),I("div",se,[G(o,{class:"mr-[12px]",type:"button",onChange:e[1]||(e[1]=a=>B(Xe)(B(l))),modelValue:B(r).type,"onUpdate:modelValue":e[2]||(e[2]=a=>B(r).type=a),options:B($e)},null,8,["modelValue","options"]),G(i,{modelValue:B(r).time_search,"onUpdate:modelValue":e[3]||(e[3]=a=>B(r).time_search=a),format:"YYYY/MM/DD","value-format":"x",onChange:e[4]||(e[4]=a=>B(Xe)(B(l))),onClear:e[5]||(e[5]=a=>B(Xe)(B(l))),type:"daterange",placement:"bottom-end","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])):N("",!0),G(c,{class:"ml-8px",onRefresh:e[6]||(e[6]=a=>B(Xe)(B(l)))})])])),_:1},8,["menu-options","logContent","onTabClick","onSearch"])],4)}}}),ne={class:"flex items-center"},re={class:"ml-1rem"},oe=M({__name:"login-log",setup(a){const{mainHeight:t}=n(),e=ja(),{getLoginLogsEvent:s}=e,{BtOperation:l}=d({options:[{label:"导出日志",type:"button",onClick:()=>{Ue(h.data)}},{label:"清空日志",type:"button",onClick:()=>{Ke(u)}}]}),r=m({options:Ve,key:"login_type"}),{BtTable:o,BtSearch:i,BtPage:c,refresh:u,BtRadioButton:g,config:h}=y({request:a=>{const{p:t,...e}=a;return s({page:t,...e})},columns:[{label:"IP地址（归属地）",prop:"remote_addr",minWidth:100,render:a=>{var t;return G("span",null,[a.remote_addr,U("("),(null==(t=null==a?void 0:a.area)?void 0:t.info)||"",U(")")])}},{label:"用户代理",width:800,prop:"user_agent"},{label:"登录状态",render:a=>G("span",{class:"text-".concat(a.login_type?"primary":"danger")},[U("登录"),a.login_type?"成功":"失败"])},{label:"时间",width:150,sortable:"custom",align:"right",render:a=>p(a.login_time)}],extension:[r]});return(a,e)=>{const s=Na,n=Ha;return A(),j(n,null,{"header-left":K((()=>[V("div",ne,[G(s,{ref_key:"timeRef",ref:Me,refreshFn:B(u)},null,8,["refreshFn"]),G(B(l)),V("div",{class:"flex items-center ml-1rem",onClick:e[0]||(e[0]=a=>B(Ut)())},e[1]||(e[1]=[V("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),V("span",{class:"bt-link"},"需求反馈",-1)]))])])),"header-right":K((()=>[G(B(g)),V("div",re,[G(B(i),{class:"w-[32rem]",placeholder:"请输入搜索关键字"})])])),content:K((()=>[G(B(o),{"max-height":B(t)-290,onSortChange:B(Ge)},null,8,["max-height","onSortChange"])])),"footer-right":K((()=>[G(B(c))])),_:1})}}}),ie={class:"flex items-center"},ce=M({__name:"operate-log",setup(a){const{mainHeight:e}=n(),{BtOperation:s}=d({options:[{type:"button",label:"导出日志",onClick:()=>{if(!m.data.length)return t.error("暂无数据导出");He({search:g.value.search})}},{type:"button",label:"清空日志",onClick:()=>Je(c)},{type:"button",label:"IP操作统计",onClick:ze}]}),l=h({options:je,key:"log_type",other:{placeholder:"请选择分类",filterable:!0,class:"!w-16rem mr-1rem "}}),{BtTable:r,BtSearch:o,BtPage:i,refresh:c,BtTableSelect:u,param:g,config:m}=y({request:a=>Ne({...a,table:"logs"}),columns:[{label:"用户",prop:"username",width:180},{label:"操作类型",prop:"type",width:100,sortable:!0},{label:"详情",render:function(a){const t=(new DOMParser).parseFromString(a.log,"text/html");return G("span",{innerHTML:v(t.body.innerHTML)},null)}},{label:"操作时间",width:150,prop:"addtime",align:"right",sortable:!0}],extension:[l]});return(a,t)=>{const l=Na,n=Ha;return A(),j(n,null,{"header-left":K((()=>[V("div",ie,[G(l,{ref_key:"timeRef",ref:Me,class:"inline-block",refreshFn:B(c)},null,8,["refreshFn"]),G(B(s)),V("div",{class:"flex items-center ml-1rem",onClick:t[0]||(t[0]=a=>B(Ut)())},t[1]||(t[1]=[V("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),V("span",{class:"bt-link"},"需求反馈",-1)]))])])),"header-right":K((()=>[G(B(u)),G(B(o),{class:"!w-[28rem]",placeholder:"请输入搜索关键字"})])),content:K((()=>[G(B(r),{"max-height":B(e)-286},null,8,["max-height"])])),"footer-right":K((()=>[G(B(i))])),_:1})}}}),ue={class:"flex items-center justify-between mb-[12px]"},ge={class:"flex items-center"},de={class:"ml-[1.6rem]"},me={class:"inline-flex items-center"},ye=M({__name:"run-log",setup(a){const{mainHeight:t}=n(),e=ja(),{search:s,logMsg:l,size:r}=P(e),{getRunDataEvent:o}=e;return Z(o),(a,e)=>{const n=Na,i=aa,u=c;return A(),I("div",null,[V("div",ue,[V("div",ge,[G(n,{class:"inline-block",refreshFn:B(o)},null,8,["refreshFn"]),G(i,{type:"default",onClick:e[0]||(e[0]=a=>B(Ye)())},{default:K((()=>e[3]||(e[3]=[U("清空日志")]))),_:1}),V("span",de,"日志大小："+Q(B(f)(B(r))),1),V("div",{class:"flex items-center ml-1rem",onClick:e[1]||(e[1]=a=>B(Ut)())},e[4]||(e[4]=[V("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),V("span",{class:"bt-link"},"需求反馈",-1)]))]),V("div",me,[G(u,{modelValue:B(s),"onUpdate:modelValue":e[2]||(e[2]=a=>H(s)?s.value=a:null),onSearch:B(o),placeholder:"请输入搜索关键字",class:"!w-[30rem]"},null,8,["modelValue","onSearch"])])]),G(la,{content:B(l),isHtml:!0,autoScroll:!0,fullScreen:{title:"全屏查看-运行日志",onRefresh:B(o)},style:J("height:".concat(B(t)-240,"px"))},null,8,["content","fullScreen","style"])])}}}),{getLogsMenu:pe,outWebSiteEvent:he,getLogsInfoEvent:ve,clearRunLogsEvent:fe,clearOpLogsEvent:we,getLogsDataEvent:be,clearShellLogEvent:Se,outShellLogEvent:Le,getIpDataEvent:Te,outLoginLogEvent:ke,clearLoginLogEvent:_e}=ja(),{clearDataForm:xe,outDataForm:qe,configData:Fe,selectedItem:Pe}=fa(),{currentItem:Ce,isRefreshList:Ee,crontabForm:De}=Ba(),Oe=Ta(),Me=C(),Re=C([]),Ae=C(!1),Ie=[{label:"操作日志",name:"operateLog",render:()=>G(ce,null,null)},{label:"登录日志",name:"loginLog",lazy:!0,render:()=>G(oe,null,null)},{label:"运行日志",name:"runLog",lazy:!0,render:()=>G(ye,null,null)},{label:"计划任务日志",name:"crontabLog",lazy:!0,render:()=>G(le,null,null)}],Ve=[{label:"全部",value:""},{label:"登录成功",value:"1"},{label:"登录失败",value:"0"}],je=[{label:"全部",value:"全部"},{label:"网站管理",value:"网站管理"},{label:"用户登录",value:"用户登录"},{label:"数据库管理",value:"数据库管理"},{label:"FTP管理",value:"FTP管理"},{label:"文件管理",value:"文件管理"},{label:"安装器",value:"安装器"},{label:"软件管理",value:"软件管理"},{label:"守护程序",value:"守护程序"},{label:"面板设置",value:"面板设置"},{label:"进程管理",value:"进程管理"},{label:"面板配置",value:"面板配置"},{label:"PHP配置",value:"PHP配置"},{label:"计划任务",value:"计划任务"},{label:"防火墙管理",value:"防火墙管理"}],Be=a=>{var t;null==(t=Me.value)||t.clearIntervalFn()},He=async({search:a},t)=>{a&&await i({title:"导出日志",icon:"warning-filled",content:"是否导出关键字为【".concat(a,"】的面板操作日志？")});const e=await he(a);window.open("/download?filename="+e.data.output_file)},Ne=async a=>{try{const t=a;return t.search||delete t.search,"全部"===t.log_type&&(t.log_type=""),await ve(t)}catch(t){return{data:[],total:0,other:{}}}},Je=async a=>{await i({icon:"warning-filled",type:"input",title:"清空面板操作日志",input:{content:"清空日志"},content:"风险操作，清空该日志后，将无法查询面板以往的操作记录，是否继续操作？"});const t=await we();a&&a(t)},We=[{label:"IP地址",prop:"ip"},{label:"IP属地",prop:"info"},{label:"操作次数",prop:"operation_num"}],ze=async()=>{const{data:a}=await Te();a.sort(((a,t)=>t.operation_num-a.operation_num)),w({title:"IP操作统计",area:60,component:()=>G("div",{class:"p-20px"},[ea(G(b,{"max-height":"360",column:We,data:a},null),[[sa("bt-loading"),"ipLoading"],[sa("bt-loading"),"'正在加载表格数据,请稍后...'","title"]])])})},Ge=({column:a,prop:t,order:e},s)=>{const l=S((n=t,"ascending"===e?k(_(n)):x(_(n))),s);var n;return{data:l,total:l.length,other:{}}},Ke=async a=>{try{await i({icon:"warning-filled",type:"input",title:"清空面板登录日志",input:{content:"清空日志"},content:"风险操作，清空该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),await _e(),Ee.value=!0,a&&a()}catch(t){}},Ue=async a=>{if(0===a.length)return t.error("暂无数据导出");qe.value.type=Oe.getType("login"),Fe.value={type:"login"},w({title:"导出日志",area:44,component:()=>L((()=>import("./index273.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},Ye=async a=>(await i({icon:"warning-filled",title:"清空面板运行日志",type:"calc",content:"风险操作，清空该日志后，将无法查到以往的日志记录，此操作不可逆，是否继续清空？"}),a&&a(),await fe()),$e=[{label:"全部",value:""},{label:"异常",value:"warring"}],Xe=async a=>{try{if(!T(a,"object",!1,null,!0))return t.error("当前未选定日志数据");Ce.value=a,Pe.value=String(a.id),Ae.value="webshell"===a.sType;const{type:e,time_search:s}=De.value;let l=[];const n=s;r(n)&&n.length&&(l=[n[0]/1e3,n[1]/1e3]);const o={type:e,id:a.id,time_search:JSON.stringify(l)},{status:i,msg:c}=await be(o);i||t.error(c)}catch(e){return{data:"获取日志错误!",status:!1}}},Qe=async a=>{w({title:"清理【"+a.name+"】日志",area:44,component:()=>L((()=>import("./index274.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{tips:"",type:"crontab",clearEvent:()=>Ze()},showFooter:!0})},Ze=async a=>{const{day:t}=xe.value;await i({icon:"warning-filled",type:"calc",title:"清空日志",content:"清空".concat("all"!==t?t+"天外":"","日志后，将无法查询").concat("all"!==t?t+"天外":"","日志记录，此操作不可逆，是否继续清理？")});const e=await Se({id:Ce.value.id,day:"all"===t?"":t});return Ee.value=!0,e},as=async()=>{qe.value.type=Ta().getType("crontab"),Fe.value={type:"crontab"},w({title:"导出日志",area:44,component:()=>L((()=>import("./index273.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{type:"crontab"},showFooter:!0})},ts=async a=>{const t=await pe(a);Re.value=t.data};export{_t as A,Tt as B,kt as C,St as D,Gt as E,Nt as L,Ct as T,Ut as a,te as b,Be as c,zt as d,Bt as e,Ht as f,ft as g,wt as h,ht as i,bt as j,Ka as k,At as l,Pt as m,Rt as n,Mt as o,pt as p,Ot as q,xt as r,vt as s,Ie as t,Jt as u,It as v,Dt as w,Lt as x,jt as y,yt as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
