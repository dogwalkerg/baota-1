import{b6 as e,M as a,ah as l,G as t,k as s,O as o}from"./utils-lib.js?v=1734676359";import{_ as n}from"./index90.js?v=1734676359";import{_ as m}from"./index88.js?v=1734676359";import{c as r,r as i,h as u,R as d,i as p,o as c,B as _,k as b,l as v,e as f,x as g,C as y,p as x,q as h,J as j,y as w,z as q,ae as V,ad as k}from"./base-lib.js?v=1734676359";import{g as C,v as S}from"./useMethod3.js?v=1734676359";import{getTableInfo as z,getModulesTableInfo as D}from"./database.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const J={class:"p-[20px]"},O={class:"flex items-center mt-[16px] leading-[3rem]"},U={key:0,class:"flex items-center mt-16px"},L=r({__name:"table-back",props:{compData:{default:()=>({name:"",id:0})}},setup(r,{expose:L}){const M=r,{refs:{tabActive:N}}=C(),{name:Q,id:A}=M.compData,B=i("mongodb"===N.value?"bson":"db"),F=i(!1),G=i([]),H=i([]),I=u({id:A,table_list:H.value,storage_type:B.value,file_type:B.value,password:""}),R=d([{type:"selection",width:50},{prop:"mongodb"==N.value?"collection_name":"table_name",label:"表名"},{prop:"mongodb"==N.value?"count":"rows_count",label:"行数"},{prop:"mongodb"===N.value?"size":"pgsql"===N.value?"table_size":"data_size",label:"大小"}]),E=p((()=>{let e=[{content:"分表导出：一张表存储为一个SQL文件。"},{content:"合并导出：将选中的表导出到一个SQL文件内"},{content:"备份格式：打包后压缩包内的文件格式"}];return"mysql"==N.value&&e.push({content:"压缩密码：设置备份压缩密码后请注意保存好密码！",class:"text-warning"}),e})),K=e=>{H.value=e};return c((()=>{(async()=>{const{data:e}=await t({loading:F,request:"mysql"===N.value?z({db_name:Q}):D({data:JSON.stringify({db_name:Q})},N.value)});"mysql"===N.value&&(G.value=e.tables),"mongodb"===N.value&&(G.value=e.data.collection_list),"pgsql"===N.value&&(G.value=e.data.table_list)})()})),L({onConfirm:async e=>{var t,s;try{if(0===H.value.length)return void a.error("请至少选择一项要备份的表");let l={...I,collection_list:H.value.map((e=>e.collection_name)),table_list:JSON.stringify(H.value.map((e=>e.table_name)))};"mongodb"===N.value&&(l.file_type=I.storage_type,l.storage_type="table");const o=await S(l);a.request(o),null==(s=(t=M.compData).refreshFn)||s.call(t),e()}catch(o){l(o,"数据库-表备份-onConfirm")}}}),(a,l)=>{const t=s,r=V,i=k,u=m,d=n,p=o,c=_("bt-loading"),C=_("focus");return b(),v("div",J,[f(d,null,{content:g((()=>[y(f(t,{onSelectionChange:K,"max-height":"260",column:x(R),data:x(G)},null,8,["column","data"]),[[c,x(F)],[c,"正在加载列表，请稍后...","title"]])])),"footer-left":g((()=>[h("div",null,[h("div",O,[l[8]||(l[8]=h("span",{class:"mr-[16px]"},"备份方式",-1)),"mongodb"!==x(N)?(b(),j(i,{key:0,modelValue:x(I).storage_type,"onUpdate:modelValue":l[0]||(l[0]=e=>x(I).storage_type=e)},{default:g((()=>[f(r,{value:"db"},{default:g((()=>l[4]||(l[4]=[w("合并导出")]))),_:1}),f(r,{value:"table"},{default:g((()=>l[5]||(l[5]=[w("分表导出")]))),_:1})])),_:1},8,["modelValue"])):q("",!0),"mongodb"==x(N)?(b(),j(i,{key:1,modelValue:x(I).storage_type,"onUpdate:modelValue":l[1]||(l[1]=e=>x(I).storage_type=e)},{default:g((()=>[f(r,{value:"bson"},{default:g((()=>l[6]||(l[6]=[w("bson")]))),_:1}),f(r,{value:"json"},{default:g((()=>l[7]||(l[7]=[w("json")]))),_:1})])),_:1},8,["modelValue"])):q("",!0)]),"mysql"==x(N)?(b(),v("div",U,[l[9]||(l[9]=h("span",{class:"mr-16px !w-[6.4rem]"},"压缩密码",-1)),y(f(u,{placeholder:"请输入压缩密码，可为空",modelValue:x(I).password,"onUpdate:modelValue":l[2]||(l[2]=e=>x(I).password=e),icon:"el-refresh",onIconClick:l[3]||(l[3]=()=>x(I).password=x(e)(16))},null,8,["modelValue"]),[[C]])])):q("",!0)])])),_:1}),f(p,{options:x(E),"list-style":"disc",class:"ml-[20px] mt-[36px]"},null,8,["options"])])}}});export{L as default};
