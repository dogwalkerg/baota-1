import{G as e,af as a,l as t,H as s,aj as n,b as o,o as l,ah as r,u as i,al as c,am as m,p as u,t as p,ao as d,a4 as _}from"./utils-lib.js?v=1734676359";import{_ as v}from"./index90.js?v=1734676359";import{_ as f}from"./index116.js?v=1734676359";import{i as y,r as g,b8 as j,c as b,s as h,e as x,y as k,w,o as C,n as O,k as P,l as E,p as S,J as I,x as T,q as B,z as L,M as N,F as R}from"./base-lib.js?v=1734676359";import{c as V,a as D,h as q,g as A,u as M}from"./column.js?v=1734676359";import{u as F,g as z,s as H,a as J,b as U,o as G,i as W,d as K,f as Q,k as X}from"./useController3.js?v=1734676359";import{u as Y,S as Z}from"./useStore7.js?v=1734676359";import{u as $}from"./index124.js?v=1734676359";import{getNodeVersionList as ee,setDefaultEnv as ae,getNodeJsEnvironment as te,delNodeProject as se,getPackageManagers as ne,modifyNodeProject as oe,setProject as le}from"./site.js?v=1734676359";import{i as re}from"./validator.js?v=1734676359";const ie=o(),{siteInfo:ce,isRefreshList:me,activeType:ue}=Y(),{setSiteInfo:pe}=Z(),de=y((()=>!!ce.value)),_e=g("0"),ve=g([]),fe=j("_node_mask",!1),ye=async()=>{var a;const t=await e({loading:"正在设置，请稍后...",request:ae({version:_e.value})});ie.request({status:null==(a=t.data)?void 0:a.status,msg:t.data.data||t.data.error_msg})},ge=async()=>{try{const{data:e}=await a({sName:"nodejs"});await re({name:"nodejs",softData:e})}catch(e){}},je=()=>{ce.value=null,t({title:"添加Node项目",area:80,component:()=>s((()=>import("./index299.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},be=()=>{t({title:"PM2监控",area:120,showFooter:!1,component:()=>s((()=>import("./index300.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},he=(e,a)=>{pe(e,a),t({isAsync:!0,title:"Node项目管理["+e.name+"] -- 添加时间["+e.addtime+"]",area:[84,71],component:()=>s((()=>import("./index301.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},xe=async e=>{try{const{data:a}=await ne({version:e});return a.package_managers}catch(a){r(a)}},ke=g({nodejs_versions:[],package_managers:[],user_list:[],maximum_memory:0}),we=async()=>{var e,a,t,s;try{const o=await te();return Object.assign(ke.value,{...null==o?void 0:o.data,maximum_memory:(null==(e=null==o?void 0:o.data)?void 0:e.maximum_memory)||0,nodejs_versions:n(null==(a=null==o?void 0:o.data)?void 0:a.nodejs_versions,"array",[]),user_list:n(null==(t=null==o?void 0:o.data)?void 0:t.user_list,"array",[]),package_managers:n(null==(s=null==o?void 0:o.data)?void 0:s.package_managers,"array",[])}),o.data}catch(o){return ke.value}},Ce=async a=>{a&&(await e({loading:"正在保存修改，请稍后...",request:oe(a),message:!0}),me.value=!0)},Oe=async(e,a,t,s)=>{const{label:n,value:o}=s,l=new Map([["start","批量启动选中项目后，项目将正常访问"],["stop","批量停用选中的项目后，项目将会停止运行"],["restart","批量重启选中的项目后，项目将会重新启动"],["delete","批量删除选中的项目后，项目将无法恢复"]]),r=async(e,a)=>{const t=new Map([["start",le],["stop",le],["restart",le]]),{name:s,project_config:n}=e,l=t.get(o);switch(o){case"start":case"stop":case"restart":if(l){let a={project_name:e.name,project_type:n.project_type||"nodejs",status:o};"pm2"===n.project_type&&(a.pm2_name=n.pm2_name);const t=await l(a,ue.value,o);return"start"===o?{...e,batchStatus:t.status?1:2,message:t.msg.replace(/<br>/g,"\n")}:{...e,batchStatus:t.status?1:2,message:t.status?t.data.msg:t.data.data}}case"delete":let a={project_name:s,project_type:n.project_type||"nodejs"};return"pm2"===a.project_type&&(a.pm2_name=n.pm2_name),await se(a)}};await e({title:"批量".concat(n),content:"".concat(l.get(o),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},V()],onConfirm:async()=>(await a(r),me.value=!0,!1)})},Pe={class:"content-mask"},Ee={class:"flex items-center mx-12px"},Se=b({__name:"index",setup(e){const{mainHeight:a}=i(),{getSiteList:t,setSiteInfo:o}=Z(),{activeType:r,isRefreshList:y,siteInfo:g,searchWidth:j}=h(Z()),{BtOperation:b}=c({options:[{type:"button",label:"添加Node项目",active:!0,onClick:()=>{var e;if(!(null==(e=ve.value)?void 0:e.length))return ge();je()}},{type:"button",label:"Node版本管理器",onClick:ge},{type:"button",label:"PM2监控",onClick:be}]}),V=$({key:"type_id",name:"Node分类",options:()=>[{label:"全部分类",value:"all"}],event:W,ignore:["0"],field:"type_name"}),Y=d([{label:"启动项目",value:"start",event:Oe},{label:"停用项目",value:"stop",event:Oe},{label:"重启项目",value:"restart",event:Oe},K(),Q({classList:X}),{label:"删除项目",value:"delete",event:Oe}]),{BtTable:ae,BtPage:te,BtRefresh:ne,BtSearch:oe,BtColumn:le,BtBatch:re,BtTableCategory:ce,refresh:ue,config:pe}=m({request:e=>{const{type_id:a,...s}=e;return t({data:JSON.stringify({...s,type_id:u(a)||"all"===a?"":a})})},columns:[D(),F({onClick:e=>{he(e)}}),z({type:r.value,onClick:(e,a)=>{if("setting"===a)return void he(e,"state");const t=e.run?"stop":"start";H(e,"restart"===a?a:t)}}),{label:"PID",isCustom:!0,render:e=>{const a=n(e.load_info,"object",{});if(0==Object.keys(a).length)return"--";let t=[];for(var s in e.load_info)e.load_info.hasOwnProperty(s)&&t.push(s);return t.join(",")}},{label:"CPU",isCustom:!1,render:e=>{const a=n(e.load_info,"object",{});if(0==Object.keys(a).length)return"--";let t=0;for(var s in e.load_info)t+=e.load_info[s].cpu_percent;return t.toFixed(2)+"%"}},{label:"内存",isCustom:!1,render:e=>{const a=n(e.load_info,"object",{});if(0==Object.keys(a).length)return"--";let t=0;for(var s in e.load_info)t+=e.load_info[s].memory_used;return p(t)}},q(),J(),A({table:"sites",width:200}),{label:"Node版本",isCustom:!0,render:e=>e.project_config.nodejs_version||"--"},U({onClick:e=>{he(e,"ssl")}}),M([{title:"设置",onClick:e=>{he(e)}},{title:"删除",onClick:e=>{(async e=>{await l({type:"default",title:"删除项目-".concat(e.name),content:"风险操作，此操作不可逆，删除【".concat(e.name,"】项目后您将无法管理该项目，是否继续操作？"),input:{content:"删除项目"}});try{let a=e.project_config,t={project_name:a.project_name,project_type:a.project_type||"nodejs"};a.pm2_name&&(t.pm2_name=a.pm2_name);const s=await se(t);ie.request(s),me.value=!0}catch(a){}})(e)}}])],extension:[V,Y],empty:()=>x("span",null,[k("您的列表为空，您可以"),x("span",{class:"bt-link",onClick:je},[k("添加一个项目")])])});return w(y,(async e=>{var a;if(e){if(await ue(),null==(a=g.value)?void 0:a.name){const e=pe.data.find((e=>e.name===g.value.name));e&&o(e)}y.value=!1}})),C((()=>{(async()=>{var e;try{const a=await ee();if(ve.value=[],!a.status)return void(fe.value=!0);fe.value=!1,null==(e=a.data)||e.forEach((e=>{e.setup&&ve.value.push({label:e.version,value:e.version}),1===e.is_default&&(_e.value=e.version)})),ve.value.unshift({label:"未设置",value:"0"})}catch(a){}})(),O((()=>{s((()=>import("./index299.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),s((()=>import("./index301.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)}))})),(e,t)=>{const s=f,n=_,o=v;return P(),E("div",null,[S(fe)?(P(),I(s,{key:0},{content:T((()=>[B("div",Pe,[t[3]||(t[3]=B("i",{class:"svgtofont-el-warning text-warning !text-[2.2rem] mr-4px"},null,-1)),t[4]||(t[4]=k(" 未安装Node版本管理器，")),B("span",{class:"bt-link",onClick:t[0]||(t[0]=(...e)=>S(ge)&&S(ge)(...e))},"点击安装")])])),_:1})):L("",!0),x(o,null,{"header-left":T((()=>[x(S(b)),B("div",Ee,[t[5]||(t[5]=B("span",{class:"mr-4px"},"命令行版本",-1)),x(n,{class:"!w-[10rem]",modelValue:S(_e),"onUpdate:modelValue":t[1]||(t[1]=e=>N(_e)?_e.value=e:null),options:S(ve),onChange:S(ye)},null,8,["modelValue","options","onChange"])]),B("div",{class:"flex items-center ml-1rem",onClick:t[2]||(t[2]=(...e)=>S(G)&&S(G)(...e))},t[6]||(t[6]=[B("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),B("span",{class:"bt-link"},"需求反馈",-1)]))])),"header-right":T((()=>[x(S(ce),{class:"!w-[140px] mr-[10px]"}),x(S(oe),{class:R(["mr-[10px]","!w-[".concat(S(j),"px]")]),placeholder:"请输入项目名称或备注"},null,8,["class"]),x(S(ne),{class:"mr-[10px]"}),x(S(le))])),content:T((()=>[x(S(ae),{"max-height":S(a)-220},null,8,["max-height"])])),"footer-left":T((()=>[x(S(re))])),"footer-right":T((()=>[x(S(te))])),_:1})])}}}),Ie=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"}));export{Ie as a,we as g,de as i,ke as n,ge as o,Ce as s,xe as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
