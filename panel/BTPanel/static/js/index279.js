import{u as e,af as a,aj as l,b6 as t,l as s,H as o,ah as d,j as u,a4 as r,c as p,b as n,e as m}from"./utils-lib.js?v=1734676359";import{c as i,h as f,ax as c,r as v,i as b,o as _,k as w,l as g,e as h,x as V,p as y,M as x,C as j,q as S,y as q,z as k,J as P,I as U,aX as C,aw as D,a7 as T,Q as F,ag as I,ah as M,a4 as N,bv as H}from"./base-lib.js?v=1734676359";import{_ as L}from"./index88.js?v=1734676359";import{h as O,f as E}from"./validator.js?v=1734676359";import{addPhpSite as Q,GetPHPVersion as R}from"./site.js?v=1734676359";import{u as z}from"./useStore7.js?v=1734676359";import{h as A,q as J,e as W}from"./useController4.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./useStore8.js?v=1734676359";import"./useController3.js?v=1734676359";import"./useStore9.js?v=1734676359";import"./useMethod5.js?v=1734676359";const X={class:""},B={class:"items-center flex"},G={class:"flex items-center mb-[8px]"},K={class:"flex items-center"},Y={class:"flex items-center mb-[4px]"},Z=m(i({__name:"index",props:{compData:{default:{}}},setup(m,{expose:i}){const Z=m,{panel:$}=e(),{isRefreshList:ee}=z(),ae=n(),le=f({database:!1,ftp:!1}),te=c("popupClose"),se=v(!1),oe=v(),de=v(!1),ue=v({menuType:"addDefault",path:"/www/wwwroot",ftp:!1,type:"PHP",type_id:0,ps:"",port:"",version:"",need_index:0,need_404:0,sql:!1,codeing:"utf8mb4",webname:"",add_dns_record:!1,ftp_username:"",ftp_password:"",datauser:"",datapassword:""}),re=v({ftp:!0,ftpStatus:!0,ftpData:{username:"",password:""},sql:!0,databaseStatus:!0,sqlData:{username:"",password:""},siteStatus:!1,site:{name:!1},dns:[],title:""});let pe="/www/wwwroot/";const ne=v([]),me=b((()=>A.value.filter((e=>"all"!==e.value&&Number(e.value)>=0)))),ie=()=>{var e;(null==(e=W.value)?void 0:e.setClassManage)&&W.value.setClassManage()},fe=async e=>{const{data:l}=await a({sName:e});O({name:l.name,type:"i",pluginInfo:l})},ce=()=>{E({type:"dir",path:ue.value.path,change:e=>{var a;const t=l(e,"string","");ue.value.path=t,pe=null==(a=t+"/")?void 0:a.replace(/\/\//g,"/")}})},ve=e=>{var a,l,s,o,d;"string"==typeof e&&(ue.value.ps=e.split("\n")[0],ue.value.path=(null==pe?void 0:pe.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim()),ue.value.ftp_username=null==(s=e.split("\n")[0])?void 0:s.replace(/\W/g,"_"),ue.value.ftp_password=t(16),ue.value.datauser=null==(d=null==(o=e.split("\n")[0])?void 0:o.replace(/\W/g,"_"))?void 0:d.substr(0,16),ue.value.datapassword=t(16))},be=async()=>{var e,a;const l=await Z.compData.getStatus();le.database=l.mysql,le.ftp=l.ftp,ue.value.type_id=null==(e=me.value[0])?void 0:e.value,await(async()=>{var e;try{const a=await R();ne.value=a.data;let l="00";null==(e=ne.value)||e.forEach((e=>{Number(e.version)>Number(l)&&(l=e.version)})),ue.value.version=l}catch(a){}})();const t=$.value.sitePath;t&&(ue.value.path=t,pe=null==(a=t+"/")?void 0:a.replace(/\/\//g,"/"))};return _(be),i({init:be,onConfirm:async e=>{let a=Object.assign({},ue.value);a.ftp?(re.value.ftpData.username=a.ftp_username,re.value.ftpData.password=a.ftp_password):(delete a.ftp_username,delete a.ftp_password,re.value.ftp=!1),a.sql?(re.value.sqlData.username=a.datauser,re.value.sqlData.password=a.datapassword):(delete a.datauser,delete a.datapassword,re.value.sql=!1),-1!==a.webname.split("\n")[0].indexOf(":")?a.port=a.webname.split("\n")[0].split(":")[1]:a.port=80;let l=a.webname.split("\n");const t=null==l?void 0:l.map((e=>e.split(":")[0]));l.shift(),a.webname=JSON.stringify({domain:a.webname.split("\n")[0],domainlist:l,count:l.length}),delete a.menuType,await oe.value.validate();try{se.value=!0;const e=await Q(a);ue.value.add_dns_record&&e.status&&(re.value.dns=t.filter((e=>e.length)).map((e=>({domain:e,status:!1,msg:""}))),re.value.title=e.status?"添加网站成功":e.msg),e.status&&te(),a.ftp||a.sql||re.value.dns.length?(re.value.ftpStatus=e.data.ftpStatus,re.value.databaseStatus=e.data.databaseStatus,re.value.siteStatus=e.data.siteStatus,re.value.site.name=!1,s({isAsync:!0,title:"网站添加结果",area:46,component:()=>o((()=>import("./add-result.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:re.value})):ae.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.status?"添加网站成功":e.msg,type:e.status?"success":"error",duration:e.status?3e3:0,showClose:!e.status}),ee.value=!0}catch(u){d(u)}finally{se.value=!1}}}),(e,a)=>{const l=u,t=D,s=T,o=F,d=L,n=I,m=M,i=r,f=p,c=N,v=H;return w(),g("div",X,[h(c,{model:y(ue),rules:y(J),disabled:y(se),ref_key:"addSiteFormRef",ref:oe},{default:V((()=>[h(s,{label:"域名",prop:"webname"},{default:V((()=>[h(t,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:y(de),"onUpdate:visible":a[2]||(a[2]=e=>x(de)?de.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:V((()=>[j(h(l,{onInput:ve,modelValue:y(ue).webname,"onUpdate:modelValue":a[0]||(a[0]=e=>y(ue).webname=e),type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:a[1]||(a[1]=e=>de.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"]),[[v,void 0,"popover"]])])),default:V((()=>[a[17]||(a[17]=S("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[q(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),S("br"),q(" IP地址格式：192.168.1.199 "),S("br"),q(" 泛解析添加方法 *.domain.com "),S("br"),q(" 如另加端口格式为 www.domain.com:88 ")],-1))])),_:1},8,["visible"])])),_:1}),h(s,{label:" "},{default:V((()=>[h(o,{modelValue:y(ue).add_dns_record,"onUpdate:modelValue":a[3]||(a[3]=e=>y(ue).add_dns_record=e)},{default:V((()=>a[18]||(a[18]=[q("使用DNS一键解析")]))),_:1},8,["modelValue"])])),_:1}),h(s,{label:"备注"},{default:V((()=>[h(l,{modelValue:y(ue).ps,"onUpdate:modelValue":a[4]||(a[4]=e=>y(ue).ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])])),_:1}),h(s,{label:"根目录",prop:"path"},{default:V((()=>[h(d,{modelValue:y(ue).path,"onUpdate:modelValue":a[5]||(a[5]=e=>y(ue).path=e),placeholder:"请输入根目录",icon:"el-folder-opened",width:"52rem",onIconClick:ce},null,8,["modelValue"])])),_:1}),h(s,{label:"FTP"},{default:V((()=>[S("div",B,[h(m,{class:"!w-[15rem]",modelValue:y(ue).ftp,"onUpdate:modelValue":a[6]||(a[6]=e=>y(ue).ftp=e),disabled:!y(le).ftp},{default:V((()=>[h(n,{label:"不创建",value:!1}),h(n,{label:"创建",value:!0})])),_:1},8,["modelValue","disabled"]),y(le).ftp?k("",!0):(w(),g("span",{key:0,onClick:a[7]||(a[7]=e=>fe("pureftpd")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装FTP，点击安装"))])])),_:1}),y(ue).ftp?(w(),P(s,{key:0,label:"FTP账号"},{default:V((()=>[S("div",G,[h(s,{prop:"ftp_username"},{default:V((()=>[h(l,{placeholder:"创建FTP账号",modelValue:y(ue).ftp_username,"onUpdate:modelValue":a[8]||(a[8]=e=>y(ue).ftp_username=e),width:"24rem"},null,8,["modelValue"])])),_:1}),h(s,{label:"密码",class:"!mt-0"},{default:V((()=>[h(l,{placeholder:"FTP密码",modelValue:y(ue).ftp_password,"onUpdate:modelValue":a[9]||(a[9]=e=>y(ue).ftp_password=e),width:"24rem"},null,8,["modelValue"])])),_:1})]),a[19]||(a[19]=S("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应FTP帐户，并且FTP目录指向站点所在目录。",-1))])),_:1})):k("",!0),h(s,{label:"数据库"},{default:V((()=>[S("div",K,[h(m,{class:"!w-[15rem]",modelValue:y(ue).sql,"onUpdate:modelValue":a[10]||(a[10]=e=>y(ue).sql=e),disabled:!y(le).database},{default:V((()=>[h(n,{label:"不创建",value:!1}),h(n,{label:"MySQL",value:"MySQL"})])),_:1},8,["modelValue","disabled"]),y(le).database?k("",!0):(w(),g("span",{key:0,onClick:a[11]||(a[11]=e=>fe("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),y(ue).sql?(w(),P(m,{key:1,class:"ml-[8px] !w-[15rem]",modelValue:y(ue).codeing,"onUpdate:modelValue":a[12]||(a[12]=e=>y(ue).codeing=e)},{default:V((()=>[h(n,{label:"utf8mb4",value:"utf8mb4"}),h(n,{label:"utf8",value:"utf8"}),h(n,{label:"gbk",value:"gbk"}),h(n,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])):k("",!0)])])),_:1}),y(ue).sql?(w(),P(s,{key:1,label:"数据库账号"},{default:V((()=>[S("div",Y,[h(s,{prop:"datauser"},{default:V((()=>[h(l,{placeholder:"创建数据库账号",modelValue:y(ue).datauser,"onUpdate:modelValue":a[13]||(a[13]=e=>y(ue).datauser=e)},null,8,["modelValue"])])),_:1}),h(s,{label:"密码",class:"!mt-0"},{default:V((()=>[h(l,{placeholder:"数据库密码",modelValue:y(ue).datapassword,"onUpdate:modelValue":a[14]||(a[14]=e=>y(ue).datapassword=e)},null,8,["modelValue"])])),_:1})]),a[20]||(a[20]=S("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))])),_:1})):k("",!0),h(s,{label:"PHP版本"},{default:V((()=>[h(m,{class:"!w-[15rem]",modelValue:y(ue).version,"onUpdate:modelValue":a[15]||(a[15]=e=>y(ue).version=e)},{default:V((()=>[(w(!0),g(U,null,C(y(ne),(e=>(w(),P(n,{key:e.value,label:e.name,value:e.version},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(s,{label:"网站分类"},{default:V((()=>[h(i,{modelValue:y(ue).type_id,"onUpdate:modelValue":a[16]||(a[16]=e=>y(ue).type_id=e),options:y(me),class:"!w-[15rem]"},null,8,["modelValue","options"]),h(f,{class:"ml-[8px]",onClick:ie},{default:V((()=>a[21]||(a[21]=[q("分类设置")]))),_:1})])),_:1})])),_:1},8,["model","rules","disabled"])])}}}),[["__scopeId","data-v-07b25ff7"]]);export{Z as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
