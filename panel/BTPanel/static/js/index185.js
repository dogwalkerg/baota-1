import"./ace.js?v=1734676359";import{Y as e,b3 as a,b as t}from"./utils-lib.js?v=1734676359";import{c as l,t as o,r as s,R as u,w as i,o as r,n,e as d,m as c,a2 as v}from"./base-lib.js?v=1734676359";const{load:m,request:f}=t(),g=l({name:"BtAceEditor",props:{modelValue:{type:String,default:""},isZoom:{type:Boolean,default:!1},isScrollBottom:{type:Boolean,default:!1},filePath:{type:String,default:""},request:{type:Object,default:!1},encoding:{type:String,default:"utf-8"},autoSave:{type:Boolean,default:!1},editorOption:{type:Object,default:()=>({})}},emits:["update:modelValue","save"],setup(l,{attrs:g,emit:h}){const{modelValue:p,editorOption:y}=o(l),V=s("file"),q=s(),w=u(),S=s(!1),b={theme:"ace/theme/chrome",mode:"ace/mode/nginx",wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:!1,fontSize:"12px"},P=s(!1),B=t();i((()=>p.value),(e=>{if(w.value){if(S.value)return void(S.value=!1);w.value.getValue()!==p.value&&(w.value.setValue(e),w.value.moveCursorTo(0,0)),l.isScrollBottom&&w.value.renderer.scrollBar.scrollHeight&&setTimeout((()=>{w.value.getSession().setScrollTop(w.value.renderer.scrollBar.scrollHeight)}),50)}}));const C=async({filePath:e,request:t,encoding:l})=>{const o=B.load("正在保存文件，请稍后...");try{if("file"===V.value){const t=await a({path:e,encoding:l,data:w.value.getValue()});B.request(t)}else if("request"===V.value){const e=await t.set({data:w.value.getValue(),encoding:l});B.request(e)}else h("save",w.value.getValue())}catch(s){B.error(s)}finally{o.close()}},O=()=>{P.value=!P.value};return r((async()=>{var a,t;await n(),""!==l.filePath?V.value="file":(null==(a=null==l?void 0:l.request)?void 0:a.get)&&(null==(t=null==l?void 0:l.request)?void 0:t.set)?V.value="request":V.value="model",(()=>{try{window.ace.config.set("basePath","/static/editor/");const e=window.ace.edit(q.value,{...v(b),...y.value});e.commands.addCommand({name:"保存文件",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:()=>{h("save",e.getValue()),l.autoSave&&C({filePath:l.filePath,request:l.request,encoding:l.encoding})},readOnly:!1}),e.getSession().on("change",(()=>{h("update:modelValue",e.getValue())})),w.value=e}catch(e){}})(),"model"!==V.value?(async({filePath:a,request:t})=>{const l=m("正在加载文件内容，请稍后...");try{if("file"===V.value){const t=await e({path:a});if(t.status){const{data:e}=t;w.value.setValue(e?e.data:"")}else f(t)}else if("request"===V.value){const{data:e}=await t.get();w.value.setValue(e)}else S.value=!0,h("update:modelValue",w.value.getValue());n((()=>{w.value.focus(),w.value.moveCursorTo(0,0)}))}catch(o){}finally{l.close()}})({filePath:l.filePath,request:l.request}):(w.value.setValue(p.value),n((()=>{w.value.focus(),w.value.moveCursorTo(0,0)})))})),()=>d("div",{class:"ace-editor-content h-full relative"},[d("div",c({class:"ace-editor "+(l.isZoom,""),style:"height:100%",ref:q},g),null),l.isZoom?d("div",{class:"absolute right-0 top-0 icon-zoom",title:l.isZoom?"全屏显示":"退出全屏",onClick:O},null):null])}});export{g as B};
