import{u as a,H as e,ah as t,G as s,o as u,M as l,aa as r}from"./utils-lib.js?v=1734676359";import{getWebdavConf as i,removeAuth as o,setNginxAuth as n,setWebdav as m,removeWebdav as d,addWebdav as v,getXfsDisk as c,getPathQuota as g,setSiteQuota as _,setClientMaxBodySize as p}from"./site.js?v=1734676359";import{e as h,i as b,r as y,h as z,c as f,k as w,l as q,p as N,M as j}from"./base-lib.js?v=1734676359";import{p as x}from"./validator.js?v=1734676359";import{u as S}from"./useStore7.js?v=1734676359";import E from"./cataluge-setting.js?v=1734676359";const{siteInfo:I}=S(),{payment:T}=a(),{authType:O}=T.value,M=[{label:"网站目录",name:"catalugeTab",lazy:!0,render:()=>h(E,null,null)},{label:"网站配额",lazy:!0,name:"flowQuota",render:()=>e((()=>import("./capacity-quota.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)},{label:"nginx WebDav",lazy:!0,name:"nginxWebDav",render:()=>e((()=>import("./nginx-web-dav.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)}],V=b((()=>{var a;return(null==(a=I.value)?void 0:a.tabName)||"catalugeTab"})),D=y(!1),P=y(!1),B=y(!1),L=y({auth:!1,site_name:"",site_path:"",domain:"",status:!1,user:"",pass:"",client_max_body_size:""}),k=y({domain:""}),A=async()=>{try{const{data:a}=await i({site_name:I.value.name});if(B.value=!a.need_create||!1,P.value=a.status,a.need_create)return;L.value=Object.assign(L.value,a),L.value.auth=!!a.auth,a.auth&&(L.value.user=a.auth.auth_name,L.value.pass=a.auth.auth_value)}catch(a){t(a)}},H=async a=>{L.value.auth=Boolean(a),a||(L.value.user="",L.value.pass="",s({loading:"正在设置状态，请稍后...",request:o({site_name:I.value.name}),message:!0}))},R=async()=>{s({loading:"正在保存,请稍后...",request:n({site_name:I.value.name,auth_name:L.value.user,auth_value:L.value.pass}),message:!0})},U=async a=>{L.value.status=!Boolean(a);(await s({loading:"正在设置状态,请稍后...",request:m({site_name:I.value.name,option:a?1:0}),message:!0})).status&&(L.value.status=Boolean(a))},W=async()=>{const{name:a}=I.value;await u({title:"删除【".concat(a,"】webdav"),content:"是否删除【".concat(a,"】webdav，删除后将不再对域名进行限制?"),icon:"warning-filled"});(await s({loading:"正在删除webdav，请稍后...",request:d({site_name:a}),message:!0})).status&&A()},C=async()=>{await s({loading:"正在添加,请稍后...",request:v({domain:k.value.domain,site_id:I.value.id}),message:!0}),F(),A()},F=()=>{D.value=!1,k.value.domain=""},G=y(),J=y(!1),Q=y(!1),K=y([]),X={size:[{required:!0,message:"容量不能为空",trigger:["blur"]},{validator:(a,e,t)=>{Number.isInteger(1*Y.size)?t():t(new Error("容量必须为整数"))},trigger:["blur","change"]}],alarmSize:[{required:!0,message:"触发告警大小不能为空",trigger:["blur"]},{validator:(a,e,t)=>{Y.status?Number.isInteger(1*Y.alarmNum)?t():t(new Error("触发告警大小必须为整数")):t()},trigger:["blur","change"]}],alarmNum:[{required:!0,message:"告警次数不能为空",trigger:["blur"]},{validator:(a,e,t)=>{Y.status?Number.isInteger(1*Y.alarmNum)?t():t(new Error("告警次数必须为整数")):t()},trigger:["blur","change"]}],module:[{required:!0,validator:(a,e,t)=>{Y.status&&0===Y.module.length?t(new Error("请选择告警方式")):t()},trigger:["blur","change"]}]},Y=z({used:0,size:0,status:!1,alarmSize:0,alarmNum:0,alarmModel:[],module:[],option:{}}),Z=y(),$=y(!1),aa=async a=>{var e;J.value=!0;try{Q.value=!1,K.value=[];let{quota:u}=a||I.value;if(!a)try{let{data:a}=await c({path:I.value.path});if(!a.status)return Q.value=!0,void(K.value=null==(e=a.msg)?void 0:e.split("\n"));u=(await g({path:I.value.path})).data}catch(s){t(s)}let{quota_storage:l,quota_push:r}=u;l&&(Y.used=l.used,Y.size=l.size),r&&void 0!==r.module&&(Y.status=r.status,Y.alarmSize=r.size,Y.alarmNum=r.push_count,Y.module=""===r.module?[]:r.module.split(",")),(()=>{if(0===Y.size)return void(Z.value="未配置");const a=1024*Y.size*1024;Y.size>0&&Y.used>=a?Z.value="当前容量已用完":Z.value=(Y.used/1024/1024).toFixed(2)||0})(),J.value=!1}catch(s){t(s)}finally{J.value=!1}},ea=async()=>{const{path:a}=I.value;if("ltd"!==O)return void x({sourceId:183,disablePro:!0});let e={path:a,quota_type:"site",quota_push:{status:Y.status,size:Number(Y.alarmSize),push_count:Number(Y.alarmNum),module:Y.module.join(",")},quota_storage:{size:Number(Y.size)}};if(Y.status&&0===e.quota_push.module.length)return l.error("请选择至少一种告警方式");if(e.quota_storage.size<e.quota_push.size)return l.error("容量配额必须大于触发告警大小");await G.value.validate();try{$.value=!0;const a=await _({data:JSON.stringify(e)});a.status?l.request(a):l.msg({dangerouslyUseHTMLString:!0,message:a.msg,type:"error",duration:0,showClose:!0})}catch(s){t(s)}finally{$.value=!1}},ta=async()=>{const a=l.load("正在设置,请稍后...");try{const a=await p({site_name:I.value.name,client_max_body_size:L.value.client_max_body_size});l.request(a),A()}catch(e){}finally{a.close()}},sa=f({__name:"index",setup:a=>(a,e)=>{const t=r;return w(),q("div",null,[h(t,{type:"card",modelValue:N(V),"onUpdate:modelValue":e[0]||(e[0]=a=>j(V)?V.value=a:null),options:N(M)},null,8,["modelValue","options"])])}}),ua=Object.freeze(Object.defineProperty({__proto__:null,default:sa},Symbol.toStringTag,{value:"Module"}));export{K as a,H as b,Y as c,W as d,ta as e,D as f,A as g,U as h,aa as i,k as j,F as k,C as l,Q as m,L as n,ea as o,ua as p,X as r,R as s,Z as u,J as v,B as w};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
