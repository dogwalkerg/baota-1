import{G as e,k as a,j as l,h as t,O as o}from"./utils-lib.js?v=1734676359";import{_ as r}from"./index90.js?v=1734676359";import{c as s,R as d,r as m,e as n,o as p,B as i,k as u,l as c,x as h,y as _,C as f,p as b,M as g,A as w,a7 as y,ag as v,ah as V,a4 as j}from"./base-lib.js?v=1734676359";import{_ as k}from"./index88.js?v=1734676359";import{bl as x,bm as q,bn as C}from"./firewall.js?v=1734676359";import{u as U}from"./column.js?v=1734676359";import{f as R}from"./validator.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const A={class:"px-[1.6rem] py-[1.6rem]"},D=s({__name:"row-reinforce",props:{compData:{default:()=>({})}},setup(s){const D=s.compData.key,F=d(!1),O={a:"追加",i:"只读"},T=d([]),B=m(),G=d(!1),H=m({path:"",chattr:"i",d_mode:""}),I=[{content:"【只读】无法修改、创建、删除文件和目录"},{content:"【追加】只能追加内容，不能删除或修改原有内容"},{content:"【权限】设置文件或目录在受保护状态下的权限(非继承),关闭保护后权限自动还原"},{content:"【如何填写权限】请填写Linux权限代号,如:644、755、600、555等,如果不填写,则使用文件原来的权限"}],L={path:[{required:!0,message:"请输入被保护的文件或路径",trigger:["blur","change"]}],d_mode:[{required:!0,message:"请输入权限",trigger:["blur","change"]}]},M=async()=>{await e({loading:F,request:x({s_key:D}),data:{paths:[Array,T]}})},z=()=>{R({type:"all",path:"/www/wwwroot",change:e=>{H.value.path=e}})},E=async()=>{await B.value.validate(),await e({loading:"正在添加保护文件/目录，请稍后...",request:C({...H.value,s_key:D}),message:!0}),G.value=!1,M(),H.value={path:"",chattr:"i",d_mode:""}},J=[{label:"路径",prop:"path",showOverflowTooltip:!0},{label:"模式",prop:"chattr",render:e=>O[e.chattr]},{label:"权限",prop:"s_mode",render:(e,a)=>n("span",null,[e.s_mode+(e.s_mode===e.d_mode?"":" >> "+e.d_mode)])},{label:"状态",prop:"state",render:e=>n("span",{class:"text-".concat(e.state?"primary":"danger")},[e.state?"已保护":"未保护"])},U([{title:"删除",onClick:async a=>{await e({request:q({s_key:D,path:a.path}),loading:"正在删除保护配置，请稍后...",message:!0}),M()}}])];return p((()=>M())),(e,s)=>{const d=w,m=a,p=k,x=y,q=v,C=V,U=l,R=j,D=t,O=r,M=o,K=i("bt-loading");return u(),c("div",A,[n(O,null,{"header-left":h((()=>[n(d,{type:"primary",onClick:s[0]||(s[0]=e=>G.value=!0)},{default:h((()=>s[5]||(s[5]=[_(" 添加保护文件/目录 ")]))),_:1})])),content:h((()=>[f(n(m,{"max-height":"400",column:J,data:b(T)},null,8,["data"]),[[K,b(F)],[K,"正在加载中，请稍后...","title"]])])),popup:h((()=>[n(D,{title:"添加保护文件/目录",modelValue:b(G),"onUpdate:modelValue":s[4]||(s[4]=e=>g(G)?G.value=e:null),area:42,onConfirm:E,showFooter:""},{default:h((()=>[n(R,{class:"p-2rem",ref_key:"addReinforceFormRef",ref:B,model:b(H),rules:L},{default:h((()=>[n(x,{label:"路径",prop:"path"},{default:h((()=>[n(p,{icon:"icon-file_mode",modelValue:b(H).path,"onUpdate:modelValue":s[1]||(s[1]=e=>b(H).path=e),width:"24rem",placeholder:"被保护的文件或路径",onIconClick:z,iconType:"folder"},null,8,["modelValue"])])),_:1}),n(x,{label:"模式"},{default:h((()=>[n(C,{modelValue:b(H).chattr,"onUpdate:modelValue":s[2]||(s[2]=e=>b(H).chattr=e),class:"!w-[24rem]"},{default:h((()=>[n(q,{label:"只读",value:"i"}),n(q,{label:"追加",value:"a"})])),_:1},8,["modelValue"])])),_:1}),n(x,{label:"权限",prop:"d_mode"},{default:h((()=>[n(U,{modelValue:b(H).d_mode,"onUpdate:modelValue":s[3]||(s[3]=e=>b(H).d_mode=e),width:"24rem",placeholder:"请输入权限",clearable:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"])])),_:1}),n(M,{options:I,class:"mx-[1.6rem] mt-[1.6rem]"})])}}});export{D as default};
