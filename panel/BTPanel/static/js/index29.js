import{u as e,b2 as t,l as a,H as o,G as n,a8 as i,k as r,V as l,o as s,e as m}from"./utils-lib.js?v=1734676359";import{_ as c}from"./index90.js?v=1734676359";import{_ as p}from"./index97.js?v=1734676359";import{_ as u}from"./index88.js?v=1734676359";import{_ as d}from"./index182.js?v=1734676359";import{c as _,r as g,h as v,w as f,o as h,B as b,k as j,l as y,e as E,x as w,q as D,p as x,L as I,C as T}from"./base-lib.js?v=1734676359";import{e as k,N as C,d as L,c as V,o as O}from"./useMethods.js?v=1734676359";import{c as R}from"./column.js?v=1734676359";import{g as A,G as S,F as P}from"./useStore3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const N={class:"relative p-[1.6rem]"},q={class:"flex items-center"},H=m(_({__name:"index",setup(m){const _=g(),{refs:{customLimit:H,isRefreshTableList:J},getCurrentCon:M}=A(),{mainHeight:U}=e(),G=v({loading:!1,total:0,p:1,limit:Number(localStorage.getItem("dockerimagelimit"))||20,search:""}),B=g([]),F=g([]),K=[{label:"删除",value:"delete",event:async(e,t,a,o)=>{const{label:n,value:i}=o,r=async(e,t)=>{const{id:a,name:o}=e;if("delete"===i){const e={id:a,name:o,force:"0"};return await P({data:JSON.stringify(e)})}};await e({title:"批量".concat(n,"镜像"),content:"批量".concat(n,"已选的镜像，是否继续操作！"),column:[{label:"镜像名",prop:"name"},R()],onConfirm:async()=>(await t(r),Y(),!1)})}}];f((()=>J.value),(e=>{e&&(Y(),J.value=!1)}));const z=[{active:!0,content:"从仓库中拉取",event:()=>{a({component:()=>o((()=>import("./stash-pull-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"拉取镜像",area:64})}},{active:!1,content:"导入镜像",event:()=>{a({component:()=>o((()=>import("./import-mirror-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"导入镜像",area:43,btn:"导入"})}},{active:!1,content:"构建镜像",event:()=>{a({component:()=>o((()=>import("./create-mirror-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"构建镜像",area:54,btn:"提交"})}},{active:!1,content:"线上镜像",event:()=>{a({component:()=>o((()=>import("./index28.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"Docker线上镜像搜索",area:70})}},{active:!1,content:"清理镜像",event:async()=>{a({component:()=>o((()=>import("./clear-confirm.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"清理镜像",area:35,btn:!0})}}],Q=e=>{H.value.images=!0,localStorage.setItem("dockerimagelimit",G.limit.toString()),Y("page")},W=async()=>{try{if(G.p=1,""===G.search)return G.total=B.value.length,void Y("page");const e=G.search.toLowerCase(),t=["name","id","container"],a=B.value.filter((a=>{const o={...a,container:a.containers.map((e=>e.container_name)).join("")||""};return t.some((t=>{var a;return null==(a=o[t])?void 0:a.toLowerCase().includes(e)}))}));G.total=a.length,F.value=L({limit:G.limit,list:a,p:G.p})||[]}catch(e){}},X=g(k({createEvent:async e=>{V({image:e.name})},pushDataEvent:e=>{a({component:()=>o((()=>import("./push-mirror-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"推送【".concat(e.name,"】到仓库"),area:43,btn:!0,compData:{row:e}})},exportDataEvent:e=>{a({component:()=>o((()=>import("./export-mirror-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"导出【".concat(e.name,"】镜像"),area:43,btn:"导出",compData:{row:e}})},deleteDataEvent:async e=>{const t={id:e.id,name:e.name,force:"0"};try{await s({type:"calc",title:"删除镜像【".concat(e.name,"】"),width:"35rem",content:"您真的要删除镜像【".concat(e.name,"】吗？")}),n({request:P({data:JSON.stringify(t)}),message:!0,success:()=>{Y()}})}catch(a){}},conDetailEvent:async e=>{const t={id:e.container_id,name:e.container_name};await M(t.id),O(t)}})),Y=async e=>{if(J.value=!1,G.loading=!0,"page"===e)return F.value=L({limit:G.limit,list:B.value,p:G.p})||[],void(G.loading=!1);n({request:S(),data:Array,success:e=>{B.value=e,G.total=e.length,F.value=L({limit:G.limit,list:B.value,p:G.p})||[],G.loading=!1}})};return h((async()=>{Y(),X.value=t(JSON.parse(localStorage.getItem("dockerMirrorTableColumn")||"[]"),X.value),H.value.images||setTimeout((()=>{U.value>900?G.limit=20:G.limit=10}),0)})),(e,t)=>{const a=d,o=u,n=i,s=r,m=l,g=p,v=c,f=b("bt-loading");return j(),y("div",N,[E(v,null,{"header-left":w((()=>[D("div",q,[E(a,{options:z}),D("a",{class:"ml-[1rem] bt-link",onClick:t[0]||(t[0]=e=>x(C)())},"需求反馈")])])),"header-right":w((()=>[E(o,{icon:"el-search",class:"!mr-[1rem] !w-[26rem]",modelValue:x(G).search,"onUpdate:modelValue":t[1]||(t[1]=e=>x(G).search=e),clearable:"",placeholder:"镜像名、ID、使用的容器",onIconClick:W,onClear:W,onKeyup:I(W,["enter","native"])},null,8,["modelValue"]),E(n,{name:"dockerMirrorTableColumn",column:x(X),tableRef:x(_)},null,8,["column","tableRef"])])),content:w((()=>[T(E(s,{ref_key:"imagesTable",ref:_,key:"ImageTable",column:x(X),"max-height":x(U)-220,data:x(F),description:"镜像列表为空"},null,8,["column","max-height","data"]),[[f,x(G).loading],[f,"正在加载镜像列表，请稍后...","title"]])])),"footer-left":w((()=>[E(m,{"table-ref":x(_),options:K},null,8,["table-ref"])])),"footer-right":w((()=>[E(g,{page:x(G).p,"onUpdate:page":t[2]||(t[2]=e=>x(G).p=e),row:x(G).limit,"onUpdate:row":t[3]||(t[3]=e=>x(G).limit=e),total:x(G).total,onChange:Q},null,8,["page","row","total"])])),popup:w((()=>t[4]||(t[4]=[]))),_:1})])}}}),[["__scopeId","data-v-1cd05ecd"]]);export{H as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
