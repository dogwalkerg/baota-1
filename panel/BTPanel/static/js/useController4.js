import{u as e,l as a,H as t,M as s,ai as r,af as n,ah as o,bR as i,bS as l,bT as c,bU as m,bV as u,o as g,G as p,x as d}from"./utils-lib.js?v=1734676359";import{getScanList as _,setSiteStatusMultiple as v,getDomains as b,modifyProjectRunState as f,setSiteStatus as h,setSiteBackup as w}from"./site.js?v=1734676359";import{s as y,r as j,h as E}from"./base-lib.js?v=1734676359";import{c as P}from"./column.js?v=1734676359";import{S as D}from"./useStore7.js?v=1734676359";import{useSitePhpStore as S,SITE_PHP_STORE as x}from"./useStore8.js?v=1734676359";import{c as A,d as T,f as L}from"./useController3.js?v=1734676359";import{i as O,h as I}from"./validator.js?v=1734676359";import{u as k}from"./useStore9.js?v=1734676359";const{siteInfo:R,isRefreshList:q,selectedList:V}=y(D()),{setSiteInfo:C}=D(),{plugin:F}=e(),{scanData:H}=S(),{changeStatusEvent:N}=x(),{isRefreshLocalList:M}=y(k()),J=j([]),z=j([]),B=j(),Z=async(e,a,t,s)=>{const{label:r,value:n}=s,o=new Map([["start","批量启用选中的站点后，站点将恢复正常访问"],["stop","批量停用选中的站点后，站点将无法正常访问，用户访问会显示当前网站停用后的提示页"],["backSite","批量备份选中的站点，可能耗费时间较长"]]),i=async(e,a)=>{const t=new Map([["backSite",w]]),{id:s,name:r,project_config:o}=e,i="PHPMOD"===(null==o?void 0:o.type),l=t.get(n);switch(n){case"start":case"stop":let a;return a=i?await f({sitename:r,project_action:n}):await h({name:r,id:s},n),"start"===n?{...e,batchStatus:a.status?1:2,message:a.msg.replace(/<br>/g,"\n")}:{...e,batchStatus:a.status?1:2,message:a.status?a.data.msg:a.data.data};case"backSite":if(l)return l({id:s})}};await e({title:"批量".concat(r),content:"".concat(o.get(n),"，是否继续操作？"),column:[{label:"网站名",prop:"rname"},P()],onConfirm:async()=>(await a(i),q.value=!0,M.value=!0,!1)})},$=[{label:"启动站点",value:"start",event:Z},{label:"停用站点",value:"stop",event:Z},{label:"备份站点",value:"backSite",event:Z},{label:"设置到期时间",value:"setTimeSite",event:async(e,s,r,n,o)=>{a({title:"批量设置到期时间",area:48,compData:{rowData:r.value},component:()=>t((()=>import("./index281.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>o()})}},{label:"设置PHP版本",value:"setPhpSite",event:async(e,s,r,n,o)=>{a({title:"批量设置PHP版本",area:42,compData:r.value,component:()=>t((()=>import("./index285.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),onCancel:()=>o(),showFooter:!0})}},{label:"防跨站",value:"antiCrossingStation",event:async(e,a,t,s,r)=>{g({title:"批量设置防跨站",content:"批量开启后，可防止黑客通过其他网站目录进行入侵攻击，是否继续操作？",type:"check",check:{content:"防跨站攻击(open_basedir)",value:!0,onConfirm:async e=>{let a=[],s=[];t.value.forEach((e=>{var t;"PHPMOD"===(null==(t=null==e?void 0:e.project_config)?void 0:t.type)?a.push({name:e.name,msg:"异步项目不支持",status:!1}):s.push(e.id)})),(null==s?void 0:s.length)&&await p({request:v({stat:e?"open":"close",site_ids:JSON.stringify(s)}),success:e=>{e.data.succeed.forEach((e=>{var s,r;a.push({name:null==(r=null==(s=t.value)?void 0:s.find((a=>a.id===e.id)))?void 0:r.name,msg:e.msg,status:!0})})),e.data.errors.forEach((e=>{var s,r;a.push({name:null==(r=null==(s=t.value)?void 0:s.find((a=>a.id===e.id)))?void 0:r.name,msg:e.msg,status:!0})}))}}),r(),A({title:"批量设置防跨站",resultData:a,resultTitle:"设置防跨站"})}}})}},{label:"防盗链",value:"hotLinkProtect",event:async(e,s,r,n,o)=>{a({title:"批量设置防盗链",area:50,compData:r.value,component:()=>t((()=>import("./index286.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>o()})}},{label:"流量限制",value:"limitFlowSite",event:async(e,s,r,n,o)=>{V.value=r.value,a({title:"批量设置流量限制",area:44,compData:r.value,component:()=>t((()=>import("./index287.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>o()})}},T(),{label:"部署伪静态",value:"setPseudoStatic",event:async(e,s,r,n,o)=>{a({title:"批量部署伪静态",area:72,compData:r.value,component:()=>t((()=>import("./index288.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,onCancel:()=>o()})}},L({callback:()=>{},classList:J}),{label:"复制网站域名",value:"copySiteDomain",event:async(e,a,t,s,r)=>{var n;await g({title:"批量复制网站域名",content:"批量复制网站所有域名，是否继续操作？"}),p({loading:"正在复制网站域名，请稍后...",request:b({pids:JSON.stringify(null==(n=t.value)?void 0:n.map((e=>e.id)))}),success:e=>{r(),d({value:e.data.join("\n")})}})}},{label:"删除站点",value:"delete",event:async(e,a,t,s,r)=>{ie(t.value,r)}}],G=()=>{a({title:"添加站点-支持批量建站",area:80,component:()=>t((()=>import("./index289.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},K=e=>{a({isAsync:!0,title:"网站备份数据【"+e.name+"】",area:90,component:()=>t((()=>import("./index290.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},Q=(e,r="")=>{var n;const o="PHPMOD"===(null==(n=null==e?void 0:e.project_config)?void 0:n.type);if(C(e,r),o&&"nginx"!==F.value.webserver)return s.error("当前为动态项目仅支持nginx服务器使用");a({title:"站点修改[".concat(e.rname,"] -- 添加时间[").concat(e.addtime,"]").concat(o?' -- <code class="tag">异步项目</code>':""),area:[84,71],component:()=>t(o?()=>import("./phpasync-setting.js?v=1734676359"):()=>import("./index280.js?v=1734676359"),__vite__mapDeps([]),import.meta.url)})},U=async(e,a)=>{if("monitor-setting"===a&&(a="monitor"),"monitor"===a){if(!(await ae(e,!1)))return;r("total_website",e.name)}const t="nginx"===F.value.web.type?"btwaf":"btwaf_httpd",s=(e=>{switch(e){case"monitor":return 47;case"bt_waf":return 48;case"iconWaf":return 49}})(a);"monitor"!==a&&(a=t),await O({source:s,name:a,callback:t=>{if(t&&"monitor"!==a){const a=setInterval((()=>{var s;const r=t.document.getElementsByClassName("layui-layer-page")[0];if(t.site_waf_config&&r){clearInterval(a),r&&(r.style.display="none"),t.site_waf_config(e.name);const n=t.document.getElementsByClassName("layui-layer-page")[1];n&&(null==(s=n.querySelector(".layui-layer-close"))||s.addEventListener("click",(()=>{var e;null==(e=r.querySelector(".layui-layer-close"))||e.click()})))}}),50)}}})},W=()=>{a({isAsync:!0,title:"网站安全扫描",area:[75,65],component:()=>t((()=>import("./index292.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},X=()=>{a({isAsync:!0,title:"漏洞扫描",area:[80,71],component:()=>t((()=>import("./index235.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{isSiteModule:!0}})},Y=j(!1),ee={title:"网站监控报表 --功能介绍",imgSrc:"/soft_ico/ico-total.png",ps:"快速浏览不同时间段的流量数据，发现高峰和趋势，助您迅速优化网站！",source:142,desc:["分析近期攻击","快速分析流量状况","多时段切换","排查趋势变化"],tabImgs:["https://www.bt.cn/Public/new/plugin/total/siteTraffic/traffic.png"]},ae=async(e,s=!0)=>{try{const{data:r}=await n({sName:"monitor"});return r.endtime<0?(Y.value=!0,!1):r.setup?(s&&(e=>{a({isAsync:!0,title:"流量数据",area:50,component:()=>t((()=>import("./index291.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e,showFooter:!1})})(e),!0):(await I({name:null==r?void 0:r.name,type:"i",pluginInfo:r}),!1)}catch(r){o(r)}},te=async e=>{var a,t;const r="PHPMOD"===(null==(a=null==e?void 0:e.project_config)?void 0:a.type),n=Number(e.status),o=n?"stop":"start";if(r&&1===(null==(t=null==e?void 0:e.project_config)?void 0:t.dependence)&&"nginx"!==F.value.webserver)return s.error("当前仅支持nginx服务器使用");const i=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<i/1e3)return s.error("项目已过期，请设置站点到期时间后再操作");await g({title:"提示",content:n?"停用站点【".concat(e.name,"】后，用户访问会显示当前网站停用后的提示页，是否继续操作？"):"启动站点【".concat(e.name,"】后，用户可以正常访问网站内容，是否继续操作？"),icon:"warning-filled"});const l=await N({row:e,action:o},{isAsync:r,status:n});return l.status&&(q.value=!0),l},se=j([{name:"漏洞扫描",callback:X},{name:"网站安全扫描",callback:()=>{re(z.value[0],"siteSecurity")}},{name:"网站拨测告警",callback:()=>{re(z.value[0],"siteAlarm")}},{name:"日志安全分析",callback:()=>{re({...z.value[0],tabName:"safe"},"siteLogs")}},{name:"网站防篡改",callback:()=>{re(z.value[0],"antiTamper")}},{name:"网站容量限制",callback:()=>{var e,a;if(z.value.length&&"PHPMOD"===(null==(a=null==(e=z.value[0])?void 0:e.project_config)?void 0:a.type))return s.error("异步项目不支持容量限制");re({...z.value[0],tabName:"flowQuota"},"directory")}}]),re=(e,a)=>{if(!z.value.length)return s.msg({message:"暂无网站，请添加网站后使用",type:"warning"});Q(e,a)},ne=(e="setDefaultPage")=>a({isAsync:!0,title:"高级设置",area:[96,62],component:()=>t((()=>import("./index293.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e,showFooter:!1}),oe=async()=>{try{const{data:e}=await _();if(e.hasOwnProperty("status")&&!e.status)return;H.value={loophole_num:(null==e?void 0:e.loophole_num)||0,web_scaning_times:(null==e?void 0:e.web_scaning_times)||0,time:(null==e?void 0:e.time)||0}}catch(e){o(e)}},ie=(e,s)=>{a({title:"删除站点确认",component:()=>t((()=>import("./index294.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),area:"auto",compData:e,onCancel:()=>{s&&s()}})},le=E({project_jar:[i({message:"请输入项目jar路径"})],project_name:[i({message:"请输入项目名称"})],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],port:[i({message:"请输入端口号",trigger:"blur"}),l()],project_jdk:[i({message:"请输入项目JDK"})],project_cmd:[i({message:"请输入项目执行命令"})],php_version:[i({message:"请选择PHP版本",trigger:"change"})],project_path:[i({message:"请输入项目路径"})],domain:[i({message:"请输入项目域名"})],tomcat_version:[i({message:"请选择tomcat版本",trigger:"change"})],project_script:[i({message:"请选择项目启动脚本"})],project_cwd:[i({message:"请输入项目启动目录"})],userCmd:[i({message:"请输入命令",trigger:["blur","input"]})],config_body:[{required:!0,message:"请输入配置内容",trigger:["blur","input"]}],cluster:[{required:!0,message:"请输入负载实例数量",trigger:["blur","change"]}],max_memory_limit:[{required:!0,message:"请输入内存上限",trigger:["blur","change"]}],project_exe:[i({message:"请选择项目可执行文件"})],rfile:[i({message:"请选择项目运行文件"})],run_user:[{required:!0,message:"请选择运行用户",trigger:"change"}],pjname:[i({message:"请输入项目名称"})],path:[i({message:"请选择路径"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],dotnet_version:[{required:!0,message:"请选择Net版本",trigger:["blur","change"]}],webname:[i({message:"请输入域名",trigger:"blur"}),c()],processes:[i({message:"请输入进程数"})],threads:[i({message:"请输入线程数"})],ftp_username:[{validator:(e,a,t)=>{0===a.length?t(new Error("FTP用户名不能为空！")):/^[a-zA-Z0-9_]+$/g.test(a)?a.length<=3?t(new Error("FTP用户名长度错误，需要大于3个字符！")):t():t(new Error("FTP用户名只能包含字母、数字和下划线！"))},trigger:["blur","change"]}],datauser:[{trigger:["blur","change"],validator:(e,a,t)=>{0===a.length?t(new Error("名称不能为空！")):/^[a-zA-Z0-9_]+$/g.test(a)?a.length<=3?t(new Error("名称长度错误，不能少于3个字符！")):a.length>16?t(new Error("名称长度错误，不能大于16个字符！")):t():t(new Error("名称只能包含字母、数字和下划线！"))}}],site_path:[{required:!0,message:"请输入项目目录",trigger:["blur","change"]},{valitor:(e,a,t)=>{a?t():t(new Error("请输入项目目录"))},trigger:["blur","input","change"]}],domains:[{required:!0,message:"请输入域名",trigger:"blur"},{trigger:["blur","input","change"],validator:(e,a,t)=>{const s=a.split("\n").filter((e=>e.length)),r=s.findIndex((e=>e.split(":")[0].length<3));s.map(((e,a)=>{let s=e.includes(":");(s&&!m(e)||!s&&!u(e))&&t(new Error("当前域名格式错误，第".concat(a+1,"行，内容:").concat(e)))})),-1!==r?t(new Error("第 ".concat(r+1," 个域名长度不符合要求（必须大于3个字符）"))):t()}}]});export{Q as a,K as b,ae as c,G as d,B as e,ee as f,oe as g,J as h,ne as i,X as j,W as k,te as l,ie as m,$ as n,U as o,Y as p,le as q,se as r,z as t,Z as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
