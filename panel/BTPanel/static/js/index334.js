import{_ as e}from"./index90.js?v=1734676359";import{c as a,r as l,h as t,o as n,B as o,k as s,l as d,e as r,x as c,p as i,y as m,J as u,q as p,z as _,C as v,v as y,I as w,aX as k,A as f,aT as b,at as h,ah as x,av as A,ag as C}from"./base-lib.js?v=1734676359";import{_ as D}from"./index91.js?v=1734676359";import{o as I,b as R,av as V,J as M,Z as g,j,e as X}from"./utils-lib.js?v=1734676359";import{_ as T}from"./index99.js?v=1734676359";import{u as U,B as z}from"./column.js?v=1734676359";import{M as E}from"./ssl.js?v=1734676359";import{g as N}from"./useStore10.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const W={class:"px-1.6rem py-1rem"},$={key:0,class:"p-1rem"},q={class:"w-full hint-table"},L={key:1,class:"pl-[.8rem] text-[#777] leading-[2.4rem]"},O={class:"w-full hint-table"},B={key:1},F={key:1},J={key:1},P={key:1},H={key:0,class:"flex"},S=["onClick"],Z=["onClick"],G=X(a({__name:"index",props:{compData:{type:Object,default:()=>{}}},setup(a){const X=R(),{refs:{isRefreshDomainList:G}}=N(),K=a,Q=l(!0),Y=l(!1),ee=l(!1),ae=l([]),le=l([]),te=l("name"),ne=[{title:"A",key:"A"},{title:"TXT",key:"TXT"},{title:"CNAME",key:"CNAME"},{title:"MX",key:"MX"},{title:"CAA",key:"CAA"},{title:"AAAA",key:"AAAA"}],oe=t({dns_id:"",domain_name:"",record_type:"A",fun_name:"get_dns_record"}),se=t({dns_id:"",domain_name:"",record_type:"",fun_name:"delete_dns_record",RecordId:""}),de=t({dns_id:"",domain_name:"",fun_name:"set_dns_record_status",status:1,RecordId:""}),re=l(!1),ce=l([]);U([{onClick:e=>{ye(e)},title:"删除"}]);const ie=e=>{const a=Math.floor(e/3600),l=Math.floor(e%3600/60),t=e%60;return"".concat(a>0?a+"小时":"").concat(l>0?l+"分钟":"").concat(t>0?t+"秒":"")},me=async()=>{if(Y.value)return X.error("请先保存当前修改的数据，再进行其他操作！");re.value=!0;const{data:e}=await E(oe);if(V(e)("list")){const{list:a}=e;M(a)&&(ce.value=a,ae.value=g(a)),Q.value=!M(a)}re.value=!1},ue=e=>{te.value=e,ce.value=g(ce.value)},pe=(e,a)=>{var l,t;let n=g(ae.value);const o=null==(t=null==(l=null==n?void 0:n.find((e=>e.RecordId===ce.value[0].RecordId)))?void 0:l[a])?void 0:t.split(".");ce.value[0][a]="2"==e?o?o[0]:"abc":e},_e=(e,a)=>{Y.value=!1,ee.value=!1,te.value="name",le.value=[],ce.value=g(ae.value)},ve=()=>Q.value?X.error("此域名配置的dns账号不正确"):Y.value?X.error("请先保存当前修改的数据，再进行其他操作！"):(Y.value=!0,ee.value=!0,le.value=[0],void ce.value.unshift({RecordId:0,name:"",type:"A",line:"default",value:"",ttl:600,status:"启用",remark:"",mx:0})),ye=async e=>{if(Y.value)return X.error("请先保存当前修改的数据，再进行其他操作！");se.record_type=e.type,se.domain_name=e.name,se.RecordId=e.RecordId,await I({title:"删除【".concat(e.name,"】"),content:"删除该子域名，是否继续操作？",icon:"warning"});try{const e=X.load("正在删除子域名，请稍候..."),a=await E(se);e&&e.close(),X.request(a),a.status&&(await me(),G.value=!0)}catch(a){}};return n((()=>{var e;(null==(e=K.compData.row)?void 0:e.dns_id)&&(oe.dns_id=K.compData.row.dns_id,oe.domain_name=K.compData.row.domain,se.dns_id=K.compData.row.dns_id,de.dns_id=K.compData.row.dns_id,me())})),(l,t)=>{const n=f,I=b,R=T,V=h,M=j,g=C,U=x,N=D,ae=A,oe=e,se=o("bt-loading");return s(),d("div",W,[r(oe,null,{"header-left":c((()=>[r(n,{type:"primary",onClick:ve,disabled:i(Q)},{default:c((()=>t[13]||(t[13]=[m("添加")]))),_:1},8,["disabled"]),"WestDns"===a.compData.row.dns.dns_name?(s(),u(I,{key:0,type:"warning",class:"h-[100%] !ml-[1rem]",closable:!1,"show-icon":""},{title:c((()=>t[14]||(t[14]=[p("span",{class:"text-[1.3rem]"},[p("span",null," 提示：WestDns 西部数码不支持修改解析记录的主机记录和记录类型")],-1)]))),_:1})):_("",!0)])),"header-right":c((()=>[r(R,{onRefresh:me,class:"!mr-[.8rem]"})])),content:c((()=>[v((s(),u(ae,{class:"w-full sub-domain-table",data:i(ce),"row-key":"RecordId","expand-row-keys":i(le),"max-height":550},{empty:c((()=>[m(y(i(Q)?"此域名配置的dns账号不正确":"列表为空"),1)])),default:c((()=>[r(V,{type:"expand",width:"1","min-width":"1"},{default:c((()=>[i(Y)?(s(),d("div",$,["name"===i(te)?(s(),d(w,{key:0},[t[20]||(t[20]=p("div",{class:"text-[#777] pl-[.8rem]"},[m("要解析www.bt.cn，请填写www。主机记录就是域名前缀，"),p("span",{class:"text-orange font-bold"},"点击下列选项可自行填充"),m("：")],-1)),p("table",q,[p("tbody",null,[p("tr",{onClick:t[0]||(t[0]=e=>pe("www","name"))},t[15]||(t[15]=[p("th",null,"www",-1),p("td",{class:"text-[#777]"},"解析后的域名为www.bt.cn",-1)])),p("tr",{onClick:t[1]||(t[1]=e=>pe("@","name"))},t[16]||(t[16]=[p("th",null,"@",-1),p("td",{class:"text-[#777]"},"直接解析主域名bt.cn",-1)])),p("tr",{onClick:t[2]||(t[2]=e=>pe("*","name"))},t[17]||(t[17]=[p("th",null,"*",-1),p("td",{class:"text-[#777]"},"泛解析，匹配其他所有域名*.bt.cn",-1)])),p("tr",{onClick:t[3]||(t[3]=e=>pe("mail","name"))},t[18]||(t[18]=[p("th",null,"mail",-1),p("td",{class:"text-[#777]"},"将域名解析为mail.bt.cn，通常用于解析邮箱服务器",-1)])),p("tr",{onClick:t[4]||(t[4]=e=>pe("2","name"))},t[19]||(t[19]=[p("th",null,"二级域名",-1),p("td",{class:"text-[#777]"},"如：abc.bt.cn，填写abc",-1)]))])])],64)):(s(),d("div",L,[t[27]||(t[27]=p("div",null,"将域名指向云服务器，请选择「A」",-1)),t[28]||(t[28]=p("div",null,"将域名指向另一个域名，请选择「CNAME」",-1)),t[29]||(t[29]=p("div",null,"建立邮箱请选择「MX」，根据邮箱服务商提供的MX记录",-1)),p("table",O,[p("tbody",null,[p("tr",{onClick:t[5]||(t[5]=e=>pe("A","type"))},t[21]||(t[21]=[p("th",null,"A",-1),p("td",{class:"text-[#777]"},"将域名指向IPv4地址",-1)])),p("tr",{onClick:t[6]||(t[6]=e=>pe("CNAME","type"))},t[22]||(t[22]=[p("th",null,"CNAME",-1),p("td",{class:"text-[#777]"},"将域名指向另外一个域名",-1)])),p("tr",{onClick:t[7]||(t[7]=e=>pe("MX","type"))},t[23]||(t[23]=[p("th",null,"MX",-1),p("td",{class:"text-[#777]"},"如果需要设置邮箱，让邮箱能收到邮件，就需要添加MX记录。",-1)])),p("tr",{onClick:t[8]||(t[8]=e=>pe("TXT","type"))},t[24]||(t[24]=[p("th",null,"TXT",-1),p("td",{class:"text-[#777]"},"设置文本记录",-1)])),p("tr",{onClick:t[9]||(t[9]=e=>pe("CAA","type"))},t[25]||(t[25]=[p("th",null,"CAA",-1),p("td",{class:"text-[#777]"},"CA证书颁发机构授权校验",-1)])),p("tr",{onClick:t[10]||(t[10]=e=>pe("AAAA","type"))},t[26]||(t[26]=[p("th",null,"AAAA",-1),p("td",{class:"text-[#777]"},"用来指定主机名（或域名）对应的IPv6地址（例如：ff06:0:0:0:0:0:0:c3）记录。",-1)]))])])]))])):_("",!0)])),_:1}),r(V,{label:"主机记录",prop:"name"},{default:c((({row:e,$index:l})=>[i(Y)&&0==l?(s(),u(M,{key:0,disabled:"WestDns"===a.compData.row.dns.dns_name&&!i(ee),modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,type:"text",size:"small",placeholder:"根据下方提示填写",title:"".concat(e.name,".").concat(K.compData.row.domain),onFocus:t[11]||(t[11]=e=>ue("name"))},{append:c((()=>[m(y(".".concat(a.compData.row.domain)),1)])),_:2},1032,["disabled","modelValue","onUpdate:modelValue","title"])):(s(),d("span",B,y(e.name),1))])),_:1}),r(V,{label:"记录类型",prop:"type",width:"100"},{default:c((({row:e,$index:l})=>[i(Y)&&0==l?(s(),u(U,{key:0,onFocus:t[12]||(t[12]=e=>ue("type")),size:"small",disabled:"WestDns"===a.compData.row.dns.dns_name&&!i(ee),modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,class:"!w-[8rem]",placeholder:"请选择",onChange:a=>((e,a)=>{a.type=e})(a,e)},{default:c((()=>[(s(),d(w,null,k(ne,(e=>r(g,{key:e.key,label:e.title,value:e.key},null,8,["label","value"]))),64))])),_:2},1032,["disabled","modelValue","onUpdate:modelValue","onChange"])):(s(),d("span",F,y(e.type),1))])),_:1}),r(V,{label:"解析请求来源",prop:"line",width:"100"},{default:c((({row:e})=>[p("span",null,y(e.line),1)])),_:1}),r(V,{label:"记录值",prop:"value"},{default:c((({row:e,$index:a})=>[i(Y)&&0==a?(s(),u(M,{key:0,modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,type:"text",placeholder:"必填",size:"small"},null,8,["modelValue","onUpdate:modelValue"])):(s(),d("span",J,y(e.value),1))])),_:1}),r(V,{label:"TTL",prop:"ttl",width:"100"},{default:c((({row:e})=>[p("span",null,y(ie(e.ttl)),1)])),_:1}),r(V,{label:"状态",prop:"status",width:"80"},{default:c((({row:e})=>[r(i(z),{data:["暂停","启用"],modelValue:"启用"===e.status,onClick:a=>(async e=>{let a;try{de.RecordId=e.RecordId,de.status="启用"===e.status?1:0,de.domain_name=e.name.indexOf(K.compData.row.domain)>-1?e.name:"".concat(e.name,".").concat(K.compData.row.domain),a=X.load("正在修改状态，请稍候...");const l=await E(de);X.request(l),l.status&&(_e(),await me())}catch(l){}finally{a&&a.close()}})(e)},null,8,["modelValue","onClick"])])),_:1}),r(V,{label:"备注",prop:"remark",width:"120"},{default:c((({row:e,$index:l})=>[i(Y)&&0==l?(s(),u(M,{key:0,disabled:"WestDns"===a.compData.row.dns.dns_name,modelValue:e.remark,"onUpdate:modelValue":a=>e.remark=a,type:"text",size:"small",placeholder:"请输入备注"},null,8,["disabled","modelValue","onUpdate:modelValue"])):(s(),d("span",P,y(e.remark),1))])),_:1}),r(V,{label:"操作",width:"140",align:"right"},{default:c((({row:e,$index:a})=>[i(Y)&&0==a?(s(),d("div",H,[r(n,{type:"primary",onClick:a=>(async e=>{if(!e.name)return void X.error("主机记录不能为空");if(!e.value)return void X.error("记录值不能为空");const a=X.load("正在修改子域名，请稍候...");let l={fun_name:"update_dns_record",dns_id:K.compData.row.dns_id,domain_name:e.name.indexOf(K.compData.row.domain)>-1?e.name:"".concat(e.name,".").concat(K.compData.row.domain),domain_dns_value:e.value,record_type:e.type,RecordId:e.RecordId,mx:e.mx,RecordLine:e.line,remark:e.remark};0===l.RecordId&&(delete l.RecordId,l.fun_name="create_dns_record");try{const e=await E(l);a&&a.close(),X.request(e),e.status&&(Y.value=!1,ee.value=!1,te.value="name",le.value=[],await me(),G.value=!0)}catch(t){}})(e)},{default:c((()=>t[30]||(t[30]=[m("保存")]))),_:2},1032,["onClick"]),r(n,{type:"default",onClick:e=>_e()},{default:c((()=>t[31]||(t[31]=[m("取消")]))),_:2},1032,["onClick"])])):(s(),d(w,{key:1},[p("span",{class:"bt-link cursor-pointer",onClick:l=>((e,a)=>{if(Y.value)return X.error("请先保存当前修改的数据，再进行其他操作！");if(Y.value=!0,le.value=[e.RecordId],0!==a){let l=e.name.replace(".".concat(K.compData.row.domain),"");const t=ce.value[0];e.name.replace(".".concat(K.compData.row.domain),"")===e.name&&(l="@"),ce.value[0]={...e,name:l},ce.value[a]=t}else ce.value[0]={...e,name:e.name.replace(".".concat(K.compData.row.domain),"")}})(e,a)},"修改",8,S),r(N),p("span",{class:"bt-link cursor-pointer",onClick:a=>ye(e)},"删除",8,Z)],64))])),_:1})])),_:1},8,["data","expand-row-keys"])),[[se,i(re)],[se,"正在加载子域名列表，请稍后...","title"]])])),_:1})])}}}),[["__scopeId","data-v-9df75ba7"]]);export{G as default};
