import{c as e,r as a,ax as s,h as t,i as l,k as u,l as o,e as r,x as i,p as n,X as p,y as d,v as m,q as c,F as _,z as h,J as f,C as g,D as q,a7 as b,aj as x,a4 as v}from"./base-lib.js?v=1734676359";import{ay as y}from"./validator.js?v=1734676359";import{J as w,M as V,G as j,j as z}from"./utils-lib.js?v=1734676359";import{addDatabaseQuota as k,databaseQuotaCheck as B,restoreDataAuth as M}from"./database.js?v=1734676359";import{g as C,m as U}from"./useMethod3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const D={class:"p-[20px]"},N={class:"flex items-center"},E={key:0},F=["disabled"],O={class:"flex items-center"},T={class:"mt-8 leading-10 list-disc"},J=e({__name:"index",props:{compData:{default:{}}},setup(e,{expose:J}){var G;const R=e,{refreshTableList:A}=C(),H=a(),I=a(!1),K=a(),{quota:L,name:P}=R.compData,{used:S,size:X,quota_push:Y,quota_storage:Z}=L,$=s("popupClose"),Q=(e,a,s)=>{""===a&&s(new Error("请输入配置数据"));/^(0|[1-9][0-9]*)$/.test(a)&&0!==a?s():s(new Error("请输入大于等于0的正整数")),s()},W=t({size:[{required:!0,message:"请输入容量配额",trigger:"blur"},{validator:Q}],"quota_push.size":[{trigger:"blur",validator:Q}],"quota_push.push_count":[{required:!0,message:"请输入容量配额",trigger:"blur"},{validator:Q}]}),ee=t({used:S,size:X,quota_push:Y,quota_storage:Z,module:w(Y.module)?Y.module:null==(G=Y.module)?void 0:G.split(",")}),ae=l({get:()=>Object.keys(Z).includes("insert_accept")?Z.insert_accept?"text-[#20a53a]":"text-danger":"text-warning",set:e=>e}),se=l({get:()=>Object.keys(Z).includes("insert_accept")?Z.insert_accept?"正常":"已撤销":"未配置",set:e=>e}),te=l((()=>-1===ee.used?"未配置容量大小":((e,a=2)=>{var s;if(0===e)return"0 Bytes";const t=a<0?0:a,l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat(null==(s=e/Math.pow(1024,l))?void 0:s.toFixed(t))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][l]})(ee.used))),le=e=>{e<1&&(ee.quota_push.status=!1)},ue=e=>{e&&Number(ee.size)<=0&&(V.error("请输入容量配额"),ee.quota_push.status=!1)},oe=async()=>{var e;null==(e=K.value)||e.refresh(),V.success("刷新成功")},re=async()=>{I.value=!0,await j({request:B(),message:!0}),await A(),U.value.forEach((e=>{if(e.id===R.compData.id){const{quota_storage:a}=e.quota,s=Object.keys(a).includes("insert_accept");se.value=s?a.insert_accept?"正常":"已撤销":"未配置",ae.value=s?a.insert_accept?"text-[#20a53a]":"text-danger":"text-warning"}})),I.value=!1,V.success("刷新成功")},ie=async()=>{await j({loading:"正在恢复，请稍后...",request:M({db_name:P}),message:!0}),$(),A()};return J({onConfirm:async e=>{var a;await H.value.validate();const s={db_name:P,quota_push:{module:null==(a=ee.module)?void 0:a.join(","),status:ee.quota_push.status,size:Number(ee.quota_push.size),push_count:Number(ee.quota_push.push_count)||0},quota_storage:{size:Number(ee.size)}};await j({loading:"正在提交，请稍后...",request:k(JSON.stringify(s)),message:!0}),A(),e()}}),(e,a)=>{const s=z,t=b,l=x,w=y,V=v;return u(),o("div",D,[r(V,{ref_key:"quotaDBFormRef",ref:H,model:n(ee),rules:n(W),class:"px-[2rem] flex justify-center flex-col justify-items-start addfrom"},{default:i((()=>[r(t,{label:"当前已用容量：",prop:"used"},{default:i((()=>[r(s,{modelValue:n(te).split(" ")[0],"onUpdate:modelValue":a[0]||(a[0]=e=>n(te).split(" ")[0]=e),class:"mr-4",width:"16rem",readonly:"",textType:n(te).split(" ")[1]},p({_:2},[n(te).split(" ")[1]?{name:"append",fn:i((()=>[d(m(n(te).split(" ")[1]),1)])),key:"0"}:void 0]),1032,["modelValue","textType"])])),_:1}),r(t,{label:"当前容量配额：",prop:"size"},{default:i((()=>[r(s,{modelValue:n(ee).size,"onUpdate:modelValue":a[1]||(a[1]=e=>n(ee).size=e),class:"mr-4",width:"16rem",type:"number",onChange:le},{append:i((()=>a[6]||(a[6]=[d(" MB ")]))),_:1},8,["modelValue"])])),_:1}),r(t,{label:"写入权限状态："},{default:i((()=>[c("div",N,[c("span",{class:_(n(ae))},m(n(se)),3),"已撤销"===n(se)?(u(),o("span",E,[a[7]||(a[7]=d("【")),c("span",{class:"bt-link",onClick:ie},"恢复数据库写入权限"),a[8]||(a[8]=d("】"))])):h("",!0),c("i",{disabled:n(I),class:_("svgtofont-el-".concat(n(I)?"loading":"refresh","  bt-link ml-4px")),onClick:re},null,10,F)])])),_:1}),r(t,{label:"设置容量告警："},{default:i((()=>[r(l,{modelValue:n(ee).quota_push.status,"onUpdate:modelValue":a[2]||(a[2]=e=>n(ee).quota_push.status=e),onChange:ue},null,8,["modelValue"])])),_:1}),n(ee).quota_push.status?(u(),f(t,{key:0},{default:i((()=>[r(t,{label:"触发告警大小：",prop:"quota_push.size"},{default:i((()=>[r(s,{modelValue:n(ee).quota_push.size,"onUpdate:modelValue":a[3]||(a[3]=e=>n(ee).quota_push.size=e),class:"mr-4",width:"16rem",type:"number",min:1},{append:i((()=>a[9]||(a[9]=[d(" MB ")]))),_:1},8,["modelValue"])])),_:1}),r(t,{label:"告警次数：",class:"mt-20px",prop:"quota_push.push_count"},{default:i((()=>[c("div",O,[a[10]||(a[10]=c("span",{class:"text-[1.2rem] text-[#666666] whitespace-nowrap"},"每日最多触发",-1)),r(s,{modelValue:n(ee).quota_push.push_count,"onUpdate:modelValue":a[4]||(a[4]=e=>n(ee).quota_push.push_count=e),class:"mx-4",width:"10rem",type:"number"},null,8,["modelValue"]),a[11]||(a[11]=c("span",{class:"text-[1.2rem] text-[#666666] whitespace-nowrap"},"次告警",-1))])])),_:1}),r(t,{label:"告警方式：",class:"mt-20px"},{default:i((()=>[r(w,{ref_key:"alertItemRef",ref:K,class:"!w-[28rem]",modelValue:n(ee).module,"onUpdate:modelValue":a[5]||(a[5]=e=>n(ee).module=e),isMult:!0,needAll:!1,name:"channel",limit:["sms"]},null,8,["modelValue"])])),_:1})])),_:1})):h("",!0),c("ul",T,[g(c("li",null,[a[12]||(a[12]=d("点击配置后告警状态未更新，尝试点击【")),c("span",{class:"bt-link",onClick:oe},"手动刷新"),a[13]||(a[13]=d("】"))],512),[[q,n(ee).quota_push.status]]),a[14]||(a[14]=c("li",null,"温馨提示：此功能为企业版专享功能",-1)),a[15]||(a[15]=c("li",{class:"text-danger"},"到达限额容量后仅撤销当前数据库用户插入权限",-1)),a[16]||(a[16]=c("li",{class:"text-danger"},"使用面板导入或使用root账号导入，不受配额影响",-1)),a[17]||(a[17]=c("li",null,"配额容量：如需取消容量配额，请设为“0”",-1)),a[18]||(a[18]=c("li",null,"此处是直接计算数据文件大小，与实际占用会存在些许误差",-1)),a[19]||(a[19]=c("li",null,"写入权限状态需在后台计算获取，若进入状态不是最新，请重新手动刷新权限",-1))])])),_:1},8,["model","rules"])])}}});export{J as default};
