import{s as e,g as a,r as s,h as t,R as l,e as o,c as r,B as n,k as p,l as i,x as u,q as c,F as d,p as m,C as f,D as v,aT as w,a7 as y,A as b,a4 as g}from"./base-lib.js?v=1734676359";import{v as h,x as F,o as _,G as x,M as C,U as T,k,_ as P,e as j}from"./utils-lib.js?v=1734676359";import{_ as I}from"./index88.js?v=1734676359";import{u as R,I as A}from"./useStore5.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const L=a("FTP-BATCH-EDIT-PAW",(()=>({updateFtpInfoRef:s(),ftpForm:t({type:"0",password:h(12)}),typeOptions:s([{label:"所有密码一致",value:"0"},{label:"所有密码不一致",value:"1"}])}))),V=()=>e(L()),{rowData:q,isRefreshFtpList:B}=R(),{ftpForm:D,updateFtpInfoRef:S}=V(),E=t({password:[{validator:(e,a,s)=>{a.length>=6||"0"!==D.value.type?s():s(new Error("FTP密码长度不能少于6位！"))},trigger:["blur"]}]}),O=()=>{D.value.password=h(12)},U=()=>{F({value:D.value.password})},W=()=>{var e;q.value.selectedList.length>0&&F({value:null==(e=q.value.selectedList.map((e=>"".concat(e.name,"--").concat(e.password))))?void 0:e.join("\n")})},H=()=>{q.value.selectedList.forEach((e=>{e.password=h(12)}));const e=document.querySelector(".refreshAllBtn");null==e||e.blur()},G=async e=>{try{await S.value.validate(),await _({title:"提示",width:"35rem",content:"修改FTP密码后，旧密码将无法登录FTP账号，是否继续操作？"});const a=(()=>{const e=q.value.selectedList.map((e=>({id:e.id,ftp_username:e.name,new_password:"0"==D.value.type?D.value.password:e.password})));return{data:JSON.stringify(e)}})(),s=await x({loading:"正在修改FTP密码，请稍候...",request:A(a),data:Array});s.every((e=>e.status))&&(C.success("批量修改FTP密码成功！"),q.value.clearSelection(),B.value=!0,e&&e())}catch(a){}},J=l([{label:"用户名",prop:"name",fixed:!0,minWidth:100},{label:"密码",fixed:!0,minWidth:200,isCustom:!0,render:e=>{const a={lt:"<",gt:">",nbsp:" ",amp:"&",quot:'"'};return e.password=e.password.replace(/&(lt|gt|nbsp|amp|quot);/gi,(function(e,s){return a[s]})),o("input",{type:"text",value:e.password,class:"bt-table-input !w-[18rem]",placeholder:"点击编辑密码",title:"点击编辑密码",onBlur:a=>{if(a.target.value.length<6&&(C.error("FTP密码长度不能少于6位！"),a.target.value=e.password),e.password===a.target.value)return!1;e.password=a.target.value}},null)}}]),M={class:"mt-[1.6rem] flex"},N=j(r({__name:"index",setup(e,{expose:a}){const{rowData:s}=R(),{ftpForm:t,typeOptions:l,updateFtpInfoRef:r}=V();return a({onConfirm:G}),(e,a)=>{const h=w,F=T,_=y,x=k,C=b,j=I,R=P,A=g,L=n("bt-loading");return p(),i("div",{class:d("1"==m(t).type?"pt-2rem pr-2rem":"p-2rem")},[o(h,{class:d(["!w-full","1"==m(t).type?"warn":""]),icon:"svgtofont-el-warning",type:"warning",closable:!1},{title:u((()=>a[2]||(a[2]=[c("span",null,"批量改密已选FTP用户，默认自动化改密，支持自定义",-1)]))),_:1},8,["class"]),o(A,{ref_key:"updateFtpInfoRef",ref:r,rules:m(E),model:m(t),class:"bt-custom-form"},{default:u((()=>[o(_,{label:"类型",class:"typeClass"},{default:u((()=>[o(F,{type:"button",class:"!flex",modelValue:m(t).type,"onUpdate:modelValue":a[0]||(a[0]=e=>m(t).type=e),options:m(l)},null,8,["modelValue","options"])])),_:1}),f(o(_,{label:" ",class:"typeClass"},{default:u((()=>[f(o(x,{"max-height":200,ref:"showFtpTableRef",column:m(J),data:m(s).selectedList,description:"FTP列表为空"},null,8,["column","data"]),[[L,"正在加载FTP列表，请稍后...","title"]]),c("div",M,[o(C,{type:"default",onClick:m(W),class:"inline-block flex items-center"},{default:u((()=>a[3]||(a[3]=[c("i",{class:"svgtofont-icon-copy"},null,-1),c("span",{class:"mb-[2px] ml-[4px]"},"复制所有",-1)]))),_:1},8,["onClick"]),o(C,{type:"default",onClick:m(H),class:"refreshAllBtn"},{default:u((()=>a[4]||(a[4]=[c("i",{class:"svgtofont-el-refresh"},null,-1),c("span",{class:"mb-[2px] ml-[4px]"},"刷新所有",-1)]))),_:1},8,["onClick"])])])),_:1},512),[[v,"1"===m(t).type]]),f(o(_,{label:"密码",class:"relative mt-[16px] typeClass",prop:"password"},{default:u((()=>[o(j,{modelValue:m(t).password,"onUpdate:modelValue":a[1]||(a[1]=e=>m(t).password=e),style:{width:"26rem"},name:"password",icon:"el-refresh",onIconClick:m(O)},null,8,["modelValue","onIconClick"]),o(R,{icon:"icon-copy",class:"w-1.8rem h-1.8rem cursor-pointer absolute top-0 right-16",onClick:m(U)},null,8,["onClick"])])),_:1},512),[[v,"0"==m(t).type]])])),_:1},8,["rules","model"])],2)}}}),[["__scopeId","data-v-9335991e"]]);export{N as default};
