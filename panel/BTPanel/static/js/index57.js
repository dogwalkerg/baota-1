import{ah as a,l as t,H as e,G as s,b as n,u as r,al as l,am as i,p as o,ao as p,c}from"./utils-lib.js?v=1734676359";import{_ as u}from"./index90.js?v=1734676359";import{_ as m}from"./index116.js?v=1734676359";import{u as v}from"./index124.js?v=1734676359";import{g as d,b8 as h,r as _,i as f,c as y,s as g,e as w,y as x,w as j,o as b,n as k,k as P,l as O,p as T,J as C,x as E,q as S,z as I,F as q}from"./base-lib.js?v=1734676359";import{c as L,a as R,h as A,g as D,u as V}from"./column.js?v=1734676359";import{u as B,g as M,a as N,b as J,l as z,o as F,h as H,i as G,s as U,j as W,d as Y,f as $,k as K}from"./useController3.js?v=1734676359";import{u as Q,S as X}from"./useStore7.js?v=1734676359";import{getPyVersion as Z,changeProjectConf as aa,createPythonProject as ta,getPythonAppInfo as ea,getPythonProjectInfo as sa,pythonRecreateProject as na,advanceCheckPort as ra,setProject as la,removeProject as ia}from"./site.js?v=1734676359";import{f as oa}from"./validator.js?v=1734676359";const pa=d("SITE-PYTHON-STORE",(()=>({checkPythonVersion:async()=>{try{const a=await Z();return{data:a.data,status:a.status}}catch(t){a(t)}}}))),ca=n(),{activeType:ua,isRefreshList:ma,siteInfo:va,rowData:da}=Q(),{getClassList:ha,getProjectConfig:_a,addGeneralProject:fa,getRootUser:ya,setSiteInfo:ga}=X(),{checkPythonVersion:wa}=pa(),xa=h("_python_mask",!1),ja=()=>{va.value=null,t({title:"添加Python项目",area:[68],component:()=>e((()=>import("./index304.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},ba=()=>{t({isAsync:!0,title:"设置命令行环境",area:60,component:()=>e((()=>import("./index305.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},ka=a=>{da.value=a,t({title:"项目【".concat(a.name||"","】模块管理"),area:60,isAsync:!0,component:()=>e((()=>import("./index306.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:a})},Pa=a=>{t({title:"终端",area:[90,50],isAsync:!0,showFooter:!1,component:()=>e((()=>import("./index307.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{hostInfo:{pj_name:a.name},row:a}})},Oa=async(a,s="")=>{try{if(["running","failure"].includes(a.project_config.prep_status))return"failure"===a.project_config.prep_status&&await na({name:a.name}),t({isAsync:!0,title:"正在创建Python项目，请耐心等候...",area:52,component:()=>e((()=>import("./index308.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{type:"createPythonProject",logPath:"/www/server/python_project/vhost/logs/".concat(a.name,".log"),endMsg:"尝试启动项目",failMsg:"环境准备失败",successMsg:"创建成功",isClear:!0,completeEvent:async(a,t)=>{a||ca.error("环境准备失败"),ma.value=!0,t()}}});ga(a,s),t({title:"Python项目管理["+a.name+"] -- 添加时间["+a.addtime+"]",area:[84,76],component:()=>e((()=>import("./index309.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})}catch(n){}},Ta=_(),Ca=_([]),Ea=f((()=>{var a;return null==(a=va.value)?void 0:a.id})),Sa=_([]),Ia=_({envType:0,rfile:"",pjname:"",port:"",path:"",framework:"",stype:"command",xsgi:"wsgi",requirement_path:!1,auto_run:!1,venv_path:"",version:"",parm:"",env:"",envPath:"",app:"",processes:"",threads:"",user:"www",is_http:!0,listenMsg:"",initialize:""}),qa=async(a=!1)=>{var t;try{const e=await wa();if(Ta.value=[],Ta.value=e.data.cpy_installed.concat(e.data.pypy_installed),a)return ca.success("Python版本，刷新成功");Ia.value.version=e.data.cpy_installed[0]||"",Sa.value=e.data.command_path.filter((a=>"project"===a.type)),Ia.value.venv_path=null==(t=Sa.value[0])?void 0:t.python_path}catch(e){}},La=async()=>{try{await qa();const t=await ya();if(Ca.value=t.data,Ea.value){const t=await _a({data:JSON.stringify({name:va.value.name})}),{project_config:e,listen:s}=t.data,{call_app:n,env_file:r,env_list:l,stype:i,project_cmd:o}=e;r&&(Ia.value.envPath=r,Ia.value.envType=2),(null==l?void 0:l.length)>0&&(a=l,Ia.value.env=a.map((a=>a.k+"="+a.v)).join("\n"),Ia.value.envType=1,Ia.value.envType=1),Object.assign(Ia.value,{...e,app:n,requirement_path:!!e.requirement_path,parm:"command"===i?o:""}),!s.includes(Number(Ia.value.port))&&s.length>0&&(Ia.value.listenMsg="当前监听端口".concat(s.join(",")))}}catch(t){}var a},Ra=()=>{Object.assign(Ia.value,{envType:0,rfile:"",pjname:"",port:"",path:"",framework:"",stype:"command",xsgi:"wsgi",requirement_path:!1,auto_run:!1,venv_path:"",version:"",parm:"",env:"",envPath:"",app:"",processes:"",threads:"",user:"www",is_http:!0,listenMsg:"",initialize:""})},Aa=async a=>{var t,e;try{if(!Ea.value&&"command"!==a.stype){const t=await(async a=>{if(!a.port)return!1;try{const t=await ra({port:a.port},"python");return t.status||(ca.request(t),a.port=""),t.status}catch(t){}})(a);if(!t)return ca.error("端口被占用，请更换端口"),!1}let{pjname:n,port:r,path:l,version:i,parm:o,framework:p,requirement_path:c,envPath:u,stype:m,rfile:v,app:d,initialize:h,processes:_,threads:f,is_http:y,user:g,auto_run:w,envType:x,env:j,xsgi:b}=a;const k="command"!==m;1===x&&(j=(a=>{let t=a.split("\n").filter((a=>""!==a)),e=[];return t.forEach((a=>{let t=a.split("=");e.push({k:t[0],v:t[1]})})),e})(j));const P=(null==(e=null==(t=va.value)?void 0:t.project_config)?void 0:e.requirement_path)||void 0;let O={pjname:n,port:r,stype:m,path:l,user:g,requirement_path:c?P:void 0,env_file:2===x?u:"",env_list:JSON.stringify(1===x?j:[]),framework:p,project_cmd:k?void 0:o,xsgi:k?b:void 0,rfile:k?v:void 0,call_app:k?d:void 0,version:i};Ea.value?O={...O,processes:_,threads:f,is_http:y,auto_run:w}:O.initialize=h;const T={data:JSON.stringify(Ea.value?{name:va.value.name,data:O}:O)},C=Ea.value?aa:ta,E=await s({loading:"正在提交，请稍后...",request:C(T),message:!0});return ma.value=!0,E.status}catch(n){}},Da=()=>{oa({type:"dir",path:Ia.value.path,change:a=>{var t;if(a){Ia.value.path=a;let e=null==(t=a.substring(a.lastIndexOf("/")+1))?void 0:t.replace(/\./g,"_").replace(/\/\//g,"/");Ia.value.pjname=e,Na()}}})},Va=()=>{oa({type:"file",path:Ia.value.rfile,change:a=>{Ia.value.rfile=a,Ma()}})},Ba=()=>{oa({type:"file",path:Ia.value.envPath,change:a=>{Ia.value.envPath=a}})},Ma=async()=>{try{const a=await ea({runfile:Ia.value.rfile});if(!a.status)return void ca.request(a);const{framework:t,xsgi:e,call_app:s}=a.data;t&&(Ia.value.framework=a.data.framework),e&&(Ia.value.xsgi=a.data.xsgi),s&&(Ia.value.app=a.data.call_app)}catch(t){a(t)}},Na=async()=>{try{const a=Ia.value.path,t=await sa({path:a});if(!t.status)return void ca.request(t);const{framework:e,requirement_path:s,runfile:n,xsgi:r,call_app:l}=t.data;e&&(Ia.value.framework=t.data.framework),n&&(Ia.value.rfile=t.data.runfile),r&&(Ia.value.xsgi=t.data.xsgi),l&&(Ia.value.app=t.data.call_app)}catch(t){a(t)}},Ja=async(a,t,e,s)=>{const{label:n,value:r}=s,l=new Map([["start","批量启动选中项目后，项目将正常访问"],["stop","批量停用选中的项目后，项目将会停止运行"],["restart","批量重启选中的项目后，项目将会重新启动"],["delete","批量删除选中的项目后，项目将无法恢复"]]),i=async(a,t)=>{const e=new Map([["start",la],["stop",la],["restart",la],["delete",ia]]),{name:s}=a,n=e.get(r);switch(r){case"start":case"stop":case"restart":if(n){const t=await n({data:JSON.stringify({name:s})},ua.value,r);return"start"===r?{...a,batchStatus:t.status?1:2,message:t.msg.replace(/<br>/g,"\n")}:{...a,batchStatus:t.status?1:2,message:t.status?t.data.msg:t.data.data}}case"delete":if(n)return await n({data:JSON.stringify({name:s})},ua.value)}};await a({title:"批量".concat(n),content:"".concat(l.get(r),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},L()],onConfirm:async()=>(await t(i),ma.value=!0,!1)})},za={class:"content-mask"},Fa={class:"flex items-center ml-[12px]"},Ha=y({__name:"index",setup(t){const{mainHeight:s}=r(),{getSiteList:n,setSiteInfo:d}=X(),{activeType:h,isRefreshList:_,siteInfo:f,searchWidth:y}=g(X()),{BtOperation:L}=l({options:[{type:"button",label:"添加Python项目",active:!0,onClick:ja},{type:"button",label:"Python版本管理",onClick:()=>z("py")},{type:"button",label:"命令行环境管理",onClick:ba},{type:"button",label:"项目守护隔离时间",onClick:H}]}),Q=v({key:"type_id",name:"Python分类",options:()=>[{label:"全部分类",value:"all"}],event:G,ignore:["0"],field:"type_name"}),Z=p([{label:"启动项目",value:"start",event:Ja},{label:"停用项目",value:"stop",event:Ja},{label:"重启项目",value:"restart",event:Ja},Y(),$({classList:K}),{label:"删除项目",value:"delete",event:Ja}]),{BtTable:aa,BtPage:ta,BtRefresh:ea,BtSearch:sa,BtColumn:na,BtBatch:ra,BtTableCategory:la,refresh:ia,config:oa}=i({request:a=>{const{type_id:t,...e}=a;return n({data:JSON.stringify({...e,type_id:o(t)||"all"===t?"":t})})},columns:[R(),B({onClick:Oa}),M({onClick:(a,t)=>{if("setting"===t)return void Oa(a,"state");const e=a.run?"stop":"start";U(a,"restart"===t?t:e)}}),A(),N(),D({table:"sites",width:200}),J({onClick:a=>Oa(a,"ssl")}),V([{title:"终端",onClick:Pa},{title:"设置",onClick:a=>Oa(a)},{title:"模块",onClick:ka},{title:"删除",onClick:a=>{W(a,h.value)}}])],extension:[Q,Z],empty:()=>w("span",null,[x("您的列表为空，您可以"),w("span",{class:"bt-link",onClick:ja},[x("添加一个项目")])])});return j(_,(async a=>{var t;if(a){if(await ia(),null==(t=f.value)?void 0:t.name){const a=oa.data.find((a=>a.name===f.value.name));a&&d(a)}_.value=!1}})),b((()=>{(async()=>{try{const a=await wa();xa.value=!1,a.data.cpy_installed.length||a.data.pypy_installed.length||(xa.value=!0),Ta.value=a.data.cpy_installed.concat(a.data.pypy_installed)}catch(t){a(t)}})(),k((()=>{e((()=>import("./index304.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),e((()=>import("./index309.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)}))})),(a,t)=>{const e=c,n=m,r=u;return P(),O("div",null,[T(xa)?(P(),C(n,{key:0},{content:E((()=>[S("div",za,[t[3]||(t[3]=S("i",{class:"svgtofont-el-warning text-warning !text-[2.2rem] mr-4px"},null,-1)),t[4]||(t[4]=x(" 未安装Python版本， ")),w(e,{onClick:t[0]||(t[0]=a=>T(z)("py",T(ia))),class:"!text-[1.4rem]"},{default:E((()=>t[2]||(t[2]=[x("点击安装")]))),_:1})])])),_:1})):I("",!0),w(r,null,{"header-left":E((()=>[w(T(L)),S("div",Fa,[w(e,{href:"https://www.bt.cn/bbs/thread-125161-1-1.html"},{default:E((()=>t[5]||(t[5]=[x(" Python项目教程 ")]))),_:1}),t[6]||(t[6]=S("i",{class:"svgtofont-el-link text-primary text-[1.6rem] ml-[4px]"},null,-1))]),S("div",{class:"flex items-center ml-1rem <xl:hidden",onClick:t[1]||(t[1]=(...a)=>T(F)&&T(F)(...a))},t[7]||(t[7]=[S("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),S("span",{class:"bt-link"},"需求反馈",-1)]))])),"header-right":E((()=>[w(T(la),{class:"!w-[140px] mr-[10px]"}),w(T(sa),{class:q(["mr-[10px]","!w-[".concat(T(y),"px]")]),placeholder:"请输入项目名称或备注"},null,8,["class"]),w(T(ea),{class:"mr-[10px]"}),w(T(na))])),content:E((()=>[w(T(aa),{"max-height":T(s)-220},null,8,["max-height"])])),"footer-left":E((()=>[w(T(ra))])),"footer-right":E((()=>[w(T(ta))])),_:1})])}}}),Ga=Object.freeze(Object.defineProperty({__proto__:null,default:Ha},Symbol.toStringTag,{value:"Module"}));export{Ra as $,Ea as a,Na as b,Va as c,Ma as d,Ba as e,Ga as f,qa as g,La as i,Da as o,Ia as p,Aa as s,Ca as u,Ta as v};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
