import{G as t,ah as a,M as e,u as s,l as n,H as o,ai as r,o as i}from"./utils-lib.js?v=1734676359";import{g as l,h as c,e as u,y as m,I as y}from"./base-lib.js?v=1734676359";import{i as d,f as p}from"./validator.js?v=1734676359";import{u as h,S as g}from"./useStore7.js?v=1734676359";import{delProxyProject as _,batchDelNginx as w,addProxyProject as f,getProxyConfigFile as v}from"./site.js?v=1734676359";import{c as b}from"./useController3.js?v=1734676359";const x=l("SITE-PROXY-STORE",(()=>{const{isRefreshList:s}=h();return{deleteProxySiteEvent:async(a,e)=>{try{let n={remove_path:e?1:0,id:a.id,site_name:a.name};const o=await t({loading:"正在删除反向代理项目，请稍候...",request:_(n),message:!0});return s.value=!0,{status:o.status,msg:o.msg}}catch(n){return{status:!1,msg:"删除项目失败"}}},multDeleteProxySiteEvent:async a=>{try{const e=await t({loading:"正在删除反向代理项目，请稍候...",request:w(a),message:!1});return s.value=!0,{status:e.status,msg:e.msg,data:e.data.data.map((t=>({...t,name:t.site_name})))}}catch(e){return{status:!1,msg:"删除项目失败",data:[]}}},addProxySiteEvent:async t=>{try{return{...await f(t)}}catch(e){a(e)}},getConfigEvent:async t=>{try{const{data:a}=await v(t);return a.status||e.error(a.msg),{data:a.data,status:a.status}}catch(a){return{msg:"获取配置失败",status:!1}}}}})),{plugin:E}=s(),{isRefreshList:S}=h(),{setSiteInfo:k}=g(),{deleteProxySiteEvent:L,multDeleteProxySiteEvent:R,addProxySiteEvent:C,getConfigEvent:P}=x(),j=()=>{n({title:"添加反向代理项目",area:62,component:()=>o((()=>import("./index312.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},I=(t,a="")=>{k(t,a),n({title:"反向代理项目管理["+t.name+"] -- 添加时间["+t.addtime+"]",area:[84,70],component:()=>o((()=>import("./index313.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},T=async(t,a)=>{var e,s;"monitor"===a&&r("total_website",t.name);const n="nginx"===(null==(s=null==(e=E.value)?void 0:e.web)?void 0:s.type)?"btwaf":"btwaf_httpd";await d({name:"total"===a?"total":"monitor"===a?"monitor":n,callback:e=>{if("monitor"!==a&&e&&!["total","monitor"].includes(a)&&"btwaf"===n){const a=setInterval((()=>{var s;const n=e.document.getElementsByClassName("layui-layer-page")[0];if(e.site_waf_config&&n){clearInterval(a),n&&(n.style.display="none"),e.site_waf_config(t.name);const o=e.document.getElementsByClassName("layui-layer-page")[1];o&&(null==(s=o.querySelector(".layui-layer-close"))||s.addEventListener("click",(()=>{var t;null==(t=n.querySelector(".layui-layer-close"))||t.click()})))}}),50)}}})},U=async t=>{await i({title:"".concat("删除反向代理项目【".concat(t.name,"】")),content:"".concat("风险操作，此操作不可逆，删除【".concat(t.name,"】项目后您将无法管理该项目，是否继续操作？")),type:"check",check:{content:"同时删除网站根目录",onConfirm:async a=>await L(t,a)}})},D=async(t,a)=>{await i({title:"批量删除反向代理项目",content:"批量删除选中的项目后，项目将无法恢复，是否继续操作？",type:"check",check:{content:"同时删除网站根目录",onConfirm:async e=>{let s={remove_path:e?1:0,site_list:JSON.stringify(t.map((t=>({id:t.id,site_name:t.name}))))};const{data:n}=await R(s);b({resultData:n,resultTitle:"批量删除反向代理项目"}),a()}}})},O=[{content:"目标：可以填写你需要代理的站点，目标如果选URL地址则必须为可正常访问的URL，如果选UNIX则必须是套接字文件"},{content:"http地址示例：http://127.0.0.1:15700"},{content:"unix地址示例：/tmp/panel.sock"},{content:()=>u(y,null,[m("发送域名：将域名添加到请求头传递到后端服务器，默认为目标URL域名，若设置不当可能导致代理无法正常访问，例如："),u("br",null,null),m("http://192.168.100.20:19888，则发送域名保持$http_host即可"),u("br",null,null),m("http://www.bt.cn，则发送域名应当改为www.bt.cn"),u("br",null,null),m("上面例子仅为常见情况，请以实际为准")])}],q=[{value:"url",label:"URL地址"},{value:"unix",label:"unix地址"}],N=async(t,a,s)=>{let n;try{await a();const{remark:s,targetType:o,proxysite:r,domains:i,todomain:l}=t.value,c={remark:s,proxy_type:"url"===o?"http":"unix",proxy_pass:r,domains:i,proxy_host:l};n=e.load("正在添加项目，请稍后...");const u=await C(c);return e.msg({dangerouslyUseHTMLString:!0,message:u.msg,type:u.status?"success":"error",duration:u.status?2e3:0,showClose:!u.status,customClass:"!max-w-[66rem] bt-message-error-html"}),u.status&&(S.value=!0),u.status}catch(o){return!1}finally{null==n||n.close()}},A=t=>{p({type:"file",path:t,change:a=>{t=a}})},B=c({title:"标题",body:"网页内",keywords:"关键词",descriptions:"描述",title_update:"标题更新",keywords_update:"关键词更新",description_update:"描述更新",tail_hash_update:"尾部script代码块更新",title_hash_update:"头部head代码块更新"});export{I as a,j as b,A as c,U as d,N as e,B as f,O as h,D as m,T as o,q as t};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
