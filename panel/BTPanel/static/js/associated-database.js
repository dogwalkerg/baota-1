import{G as a,M as e,k as l,j as s,h as t}from"./utils-lib.js?v=1734676359";import{c as n,r as o,e as d,y as u,o as i,B as r,k as p,l as m,C as f,p as c,x as b,q as v,M as y,I as _,aX as V,J as q,a7 as k,ag as g,ah as j,a4 as h}from"./base-lib.js?v=1734676359";import{getFtpInfo as w,getMysqlInfo as x,getSiteInfo as C,modifyFtpLink as U,modifyMysqlLink as F}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const A={class:"p-[20px]"},M=n({__name:"associated-database",setup(n){const M=o(!1),P=o(!1),T=o([]),B=o([]),G=o({pid:"",site:"",id:"",type:"mysql"}),H=o([{prop:"rname",label:"站点名称"},{label:"FTP用户",render:function(a){return d("div",null,[a.ftp.name?a.ftp.name:"--"," ",d("span",{class:"cursor-pointer bt-link",onClick:()=>{I(a,"ftp")}},[u("切换")])])}},{label:"数据库",render:function(a){return d("div",null,[a.mysql.name?a.mysql.name:"--"," ",d("span",{class:"cursor-pointer bt-link",onClick:()=>{I(a,"mysql")}},[u("切换")])])}}]),I=async(e,l)=>{G.value.type=l,await a({request:"ftp"===l?w():x(),data:[Array,T]}),G.value.pid=e[l].id,G.value.site=e.rname,M.value=!0,G.value.id=e.id},J=async()=>{a({loading:P,request:C(),data:[Array,B]})},R=async()=>{const{type:l,pid:s,id:t}=G.value;if(!s)return void e.error("请选择用户");const n={["ftp"===l?"ftp_id":"sql_id"]:s,pid:t},o="ftp"===l?U:F;(await a({loading:"正在切换，请稍后...",request:o(n),message:!0})).status&&(M.value=!1,J())};return i(J),(a,e)=>{const n=l,o=s,u=k,i=g,w=j,x=h,C=t,U=r("bt-loading");return p(),m("div",null,[f(d(n,{"max-height":"560",column:c(H),data:c(B)},null,8,["column","data"]),[[U,c(P)]]),d(C,{title:"ftp"===c(G).type?"切换FTP用户":"切换数据库用户",modelValue:c(M),"onUpdate:modelValue":e[3]||(e[3]=a=>y(M)?M.value=a:null),area:42,"show-footer":"",onConfirm:R},{default:b((()=>[v("div",A,[d(x,{modelValue:c(G),"onUpdate:modelValue":e[2]||(e[2]=a=>y(G)?G.value=a:null),ref:"websiteFormRef"},{default:b((()=>[d(u,{label:"站点名称"},{default:b((()=>[d(o,{disabled:"",modelValue:c(G).site,"onUpdate:modelValue":e[0]||(e[0]=a=>c(G).site=a)},null,8,["modelValue"])])),_:1}),d(u,{label:"ftp"===c(G).type?"ftp用户":"数据库用户",prop:"pid"},{default:b((()=>[d(w,{modelValue:c(G).pid,"onUpdate:modelValue":e[1]||(e[1]=a=>c(G).pid=a),class:"w-[24rem]"},{default:b((()=>[(p(!0),m(_,null,V(c(T),((a,e)=>(p(),q(i,{key:e,label:a.name,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"])])),_:1},8,["modelValue"])])])),_:1},8,["title","modelValue"])])}}});export{M as default};
