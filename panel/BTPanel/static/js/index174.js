import{c as e,r as a,i as s,o as l,k as r,l as d,e as o,x as t,p as i,I as u,aX as n,J as m,y as p,N as c,P as _,a7 as v,ag as b,ah as f,a4 as g}from"./base-lib.js?v=1734676359";import{v as h,G as w,M as j,j as V,c as y,e as x}from"./utils-lib.js?v=1734676359";import{_ as k}from"./index88.js?v=1734676359";import{g as q,b as C,p as I}from"./useMethod3.js?v=1734676359";import{addModulesDatabase as M}from"./database.js?v=1734676359";import{_ as U}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const A={class:"p-[24px]"},S=x(e({__name:"index",props:{compData:{default:()=>({options:[]})}},setup(e,{expose:x}){const S=e,{refs:{tabActive:D},refreshTableList:E}=q(),L=a(),F=a(!1),G=a([]),H=s((()=>{var e,a;return(null==(a=null==(e=G.value)?void 0:e.find((e=>e.id===J.value.sid)))?void 0:a.db_host)||""})),J=a({name:"",db_user:"",password:h(16),dataAccess:"127.0.0.1",address:"",codeing:"utf8mb4",dtype:"MySQL",ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),N={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]},{validator:(e,a,s)=>{/^\d/.test(a)&&s(new Error("数据库名不能以数字开头")),s()}}],db_user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},P=e=>{J.value.db_user=e,J.value.ps=e},Q=async()=>{try{F.value=!0;const{status:e,msg:a,err_msg:s}=await I(J.value.sid);if(!e)throw j.error(s),new Error("服务器连接失败");F.value=!1}catch(e){}};return l((async()=>{var e,a;G.value=await(null==(e=S.compData)?void 0:e.refresh())||[],J.value.sid=null==(a=G.value[0])?void 0:a.id})),x({onConfirm:async e=>{await L.value.validate(),await Q();let a={...J.value,sid:String(J.value.sid)};await w({loading:"正在添加数据库, 请稍后...",request:M(a,D.value),message:!0}),E(),e()}}),(e,a)=>{const s=_,l=v,w=V,j=k,x=b,q=f,I=y,M=g;return r(),d("div",A,[o(M,{disabled:i(F),model:i(J),ref_key:"addFormRef",ref:L,rules:N,onSubmit:a[5]||(a[5]=c((()=>{}),["prevent"]))},{default:t((()=>[o(l,{label:"数据库名",prop:"name"},{default:t((()=>[o(s,{class:"w-[38rem]",ref:"data_name",placeholder:"新的数据库名称",modelValue:i(J).name,"onUpdate:modelValue":a[0]||(a[0]=e=>i(J).name=e),onInput:P},null,8,["modelValue"])])),_:1}),o(l,{label:"用户名",prop:"db_user"},{default:t((()=>[o(w,{width:"38rem",placeholder:"数据库用户",modelValue:i(J).db_user,"onUpdate:modelValue":a[1]||(a[1]=e=>i(J).db_user=e)},null,8,["modelValue"])])),_:1}),o(l,{label:"密码",prop:"password"},{default:t((()=>[o(j,{width:"38rem",icon:"el-refresh",modelValue:i(J).password,"onUpdate:modelValue":a[2]||(a[2]=e=>i(J).password=e),modelModifiers:{sync:!0},onIconClick:a[3]||(a[3]=()=>i(J).password=i(h)(16)),isActive:!0},null,8,["modelValue"])])),_:1}),o(l,{label:"添加至",prop:"sid",class:"!mb-0"},{default:t((()=>[o(q,{class:"!w-[24rem]",modelValue:i(J).sid,"onUpdate:modelValue":a[4]||(a[4]=e=>i(J).sid=e)},{default:t((()=>[(r(!0),d(u,null,n(i(G),((e,a)=>(r(),m(x,{key:a,label:e.ps+(e.db_host?"（"+e.db_host+"）":""),value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),o(I,{class:"ml-[8px]",onClick:i(C)},{default:t((()=>a[6]||(a[6]=[p("管理远程数据库")]))),_:1},8,["onClick"])])),_:1}),o(l,{label:" ",class:"!mb-0"},{default:t((()=>[o(U,{server:{sid:i(J).sid,ip:i(H)}},null,8,["server"])])),_:1})])),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-32f69ddc"]]);export{S as default};
