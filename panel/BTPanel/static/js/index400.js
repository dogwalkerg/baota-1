import{o as a,l as t,H as e,G as s,bb as l,S as i,k as o,V as r,b as n}from"./utils-lib.js?v=1734676359";import{_ as p}from"./index90.js?v=1734676359";import{_ as u}from"./index97.js?v=1734676359";import{_ as m}from"./index99.js?v=1734676359";import{c,r as d,h as f,o as b,B as _,k,l as w,e as g,x as h,y,C as j,p as v,R as x,A as R}from"./base-lib.js?v=1734676359";import{c as C,a as H,i as A,g as D,u as q}from"./column.js?v=1734676359";import{r as S}from"./useController3.js?v=1734676359";import{DelBackup as T,BackupSite as B}from"./site.js?v=1734676359";import{u as E}from"./useStore7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const L={class:"h-full"},O=c({__name:"index",props:{compData:{default:()=>[]}},setup(c){const O=c,{isRefreshList:U}=E(),V=n(),z=d(!1),G=d(),I=d([]),P=d(),$=[{label:"删除",value:"delete",event:async(a,t,e,s)=>{const l=async a=>await T({id:a.id});await a({title:"批量删除备份文件",content:"批量删除已选备份文件，是否继续操作？",column:[{prop:"filename",label:"文件名"},C()],onConfirm:async()=>(await t(l),await X(),U.value=!0,!1)})}}],{id:F,name:J}=O.compData,K=f({p:1,limit:10,search:F,type:0,table:"backup",total:0}),M=a=>{a.backup_status?V.error("备份中的文件不可下载"):window.open("/download?filename="+a.filename,"_self")},N=async(t,e=!1)=>{try{"boolean"!=typeof e&&(e=!1),e||await a({width:"40rem",title:"删除备份",content:'<p>删除选中站点备份文件后，<span class="text-danger">该站点备份文件将永久消失</span>，是否继续？</p>',icon:"warning-filled",isHtml:!0});const s=await T({id:t.id});return e||(V.request(s),U.value=!0),await X(),0===I.value.length&&(K.p=1,X()),s}catch(s){}},Q=a=>{t({isAsync:!0,title:"备份日志",area:64,compData:a,component:()=>e((()=>import("./backup-log.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},W=async()=>{(await s({loading:"正在备份站点...",request:B({id:F,backstage:1}),message:!0})).status&&(X(),U.value=!0)},X=async(a=!1,t=!0)=>{t&&(z.value=!0),await s({request:l({p:K.p,limit:K.limit,search:F,type:K.type.toString(),table:"backup"}),data:{data:[Array,I],page:i(K)}}),t&&(z.value=!1),a&&V.success("刷新成功"),clearTimeout(P.value),I.value.some((a=>1===a.backup_status))&&(P.value=setTimeout((()=>{X(!1,!1)}),3e3))},Y=x([H(),{label:"文件名称",prop:"name"},{label:"存储位置",width:100,render:a=>{if(-1!=a.filename.indexOf("|")){let t=a.filename.match(/\|(.+)\|/,"$1");return g("span",null,[S[t[1]]])}return g("span",null,[y("本地")])}},A({prop:"size"}),{width:160,prop:"addtime",label:"备份时间"},D({table:"backup"}),q([{isHide:a=>1===a.backup_status,onClick:M,title:"下载"},{isHide:a=>1===a.backup_status,render:a=>g("span",{class:"cursor-pointer text-".concat(a.backup_status?"danger":"primary"),onClick:()=>{a.backup_status?Q(a):N(a)}},[a.backup_status?"备份中":"删除",a.backup_status?g("span",{class:"omit"},null):""])}])]);return b((()=>{X()})),(a,t)=>{const e=R,s=m,l=o,i=r,n=u,c=p,d=_("bt-loading");return k(),w("div",L,[g(c,null,{"header-left":h((()=>[g(e,{type:"primary",onClick:W},{default:h((()=>t[3]||(t[3]=[y("备份站点")]))),_:1})])),"header-right":h((()=>[g(s,{onRefresh:t[0]||(t[0]=()=>X(!0))})])),content:h((()=>[j(g(l,{ref_key:"routeBackupRef",ref:G,data:v(I),"max-height":408,column:v(Y)},null,8,["data","column"]),[[d,v(z)],[d,"正在加载中，请稍后...","title"]])])),"footer-left":h((()=>[g(i,{options:$,tableRef:v(G)},null,8,["tableRef"])])),"footer-right":h((()=>[g(n,{page:v(K).p,"onUpdate:page":t[1]||(t[1]=a=>v(K).p=a),row:v(K).limit,"onUpdate:row":t[2]||(t[2]=a=>v(K).limit=a),total:v(K).total},null,8,["page","row","total"])])),_:1})])}}});export{O as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
