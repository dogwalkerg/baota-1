import{R as e,o as a,G as l,l as t,H as s,M as o,U as n,e as u}from"./utils-lib.js?v=1734676359";import{_ as c}from"./index101.js?v=1734676359";import{c as i,ar as d,r,h as m,o as p,k as f,l as v,q as _,e as g,p as h,M as y,x as b,y as w,F as D,v as k,G as x,aj as V,A as j,b0 as C}from"./base-lib.js?v=1734676359";import{g as M,ba as z,bb as H,bc as S}from"./useStore3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const q={class:"flex flex-col"},O={class:"flex items-center border-[#ececec] border-b pb-[1rem]"},R={class:"flex items-center justify-between"},U={class:"btnGroup flex my-[1.6rem] items-center"},E={class:"action flex items-center relative"},G={class:"h-[50rem] overflow-y-auto"},T=u(i({__name:"con-log",props:{compData:{default:()=>({})}},setup(u){const i=u;M();const T=d(i,"compData"),A=r(new Date((new Date).setHours(0,0,0,0)),new Date((new Date).setHours(23,59,59,999))),F=r({logs:"",split_status:!0,split_type:"size",split_size:1388444647424,split_hour:2,split_minute:0,save:180,logs_path:""}),I=r(!1),J=r("all"),N=r([]),P=r(),L=r(!1),B=m({date:[]}),K=[{label:"全部",value:"all"},{label:"最近7天",value:"7"},{label:"最近30天",value:"30"}],Q=e=>{N.value=[],B.date=[],J.value=e,L.value=!1,ee()},W=()=>{P.value.handleOpen()},X=m({disabledDate:e=>{const a=new Date;a.setHours(23,59,59,999);const l=a.getTime();return e.getTime()>l}}),Y=e=>{J.value="",e.forEach(((e,a)=>{1==a&&e.setHours(23,59,59,999),B.date[a]=Math.floor(e/1e3)})),L.value=!0,ee()},Z=async e=>{try{I.value=!e,await a({icon:"warning-filled",title:"".concat(e?"开启":"关闭","日志切割"),width:"35rem",content:"".concat(e?"开启后":"关闭后将无法","对该容器日志进行切割，是否继续操作？")});const t={pid:T.value.id,type:e?"add":"del"};e&&(t.log_path=F.value.logs_path,t.split_type=F.value.split_type,t.split_size=F.value.split_size,t.split_hour=F.value.split_hour,t.split_minute=F.value.split_minute,t.save=F.value.save),l({loading:"正在设置日志切割状态，请稍候...",request:z({data:JSON.stringify(t)}),message:!0,success:a=>{I.value=e}})}catch(t){"cancel"===t&&(I.value=!e)}},$=()=>{t({title:"配置日志切割任务",area:50,showFooter:!0,component:()=>s((()=>import("./log-cut-config.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{data:F,id:T.value.id,path:F.value.logs_path},close(){ee()}})},ee=async e=>{const a={id:T.value.id};if("all"!=J.value)if(B.date.length>0)a.time_search=B.date;else{const e=Math.floor(Date.now()/1e3);let l=0;"7"==J.value?l=e-604800:"30"==J.value&&(l=e-2592e3),a.time_search=[l,e]}await l({request:H({data:JSON.stringify(a)}),success:({data:a})=>{F.value=a,I.value=a.split_status,e&&o.success("刷新成功")}})},ae=async()=>{window.open("/download?filename=".concat(F.value.logs_path))},le=async()=>{await a({title:"清空日志",content:"删除当前容器的所有日志吗,是否继续！"}),await l({request:S({log_path:F.value.logs_path}),message:!0,success:({status:e})=>{e&&ee()}})};return p((()=>ee())),(a,l)=>{const t=V,s=j,o=n,u=C,i=c;return f(),v("div",q,[_("div",O,[l[5]||(l[5]=_("span",null,"日志切割",-1)),g(t,{modelValue:h(I),"onUpdate:modelValue":l[0]||(l[0]=e=>y(I)?I.value=e:null),class:"ml-[.7rem]",onChange:Z},null,8,["modelValue"]),_("span",{class:"ml-[2rem]"},[l[4]||(l[4]=_("span",null,"开启后每天2点0分进行切割日志文件，如需修改请点击",-1)),_("span",{class:"bt-link",onClick:$}," 编辑配置 ")])]),_("div",null,[_("div",R,[_("div",U,[g(s,{type:"default",size:"default",onClick:l[1]||(l[1]=e=>ee(!0))},{default:b((()=>l[6]||(l[6]=[w("刷新日志")]))),_:1}),l[9]||(l[9]=_("div",{class:"line mx-[1rem] w-[.1rem] h-[2rem] bg-[#ccc] align-middle"},null,-1)),g(s,{type:"default",size:"default",onClick:ae},{default:b((()=>l[7]||(l[7]=[w("下载日志")]))),_:1}),g(s,{type:"default",size:"default",onClick:le},{default:b((()=>l[8]||(l[8]=[w("清空日志")]))),_:1})]),_("div",E,[g(o,{class:D(h(L)?"w-[21.5rem]":""),type:"button",modelValue:h(J),"onUpdate:modelValue":l[2]||(l[2]=e=>y(J)?J.value=e:null),options:K,onChange:Q},null,8,["class","modelValue"]),g(s,{style:x(h(L)?"background:#20a53a; color:#fff;margin: 0 0 0 0rem;":"margin: 0 0 0 1rem;"),onClick:W},{default:b((()=>[w(k(h(L)?"".concat(h(e)(h(B).date[0],"yyyy-MM-dd")," - ").concat(h(e)(h(B).date[1],"yyyy-MM-dd")):"自定义时间"),1)])),_:1},8,["style"]),g(u,{modelValue:h(N),"onUpdate:modelValue":l[3]||(l[3]=e=>y(N)?N.value=e:null),class:"!absolute left-[21.9rem]",ref_key:"datePickerRef",ref:P,type:"daterange","range-separator":"","start-placeholder":"自定义时间","end-placeholder":"","default-time":h(A),"disabled-date":h(X).disabledDate,onChange:Y},null,8,["modelValue","default-time","disabled-date"])])]),_("div",G,[g(i,{class:"h-full",content:h(F).logs,fullScreen:{title:"全屏查看容器".concat(a.compData.name?"【".concat(a.compData.name,"】"):"","日志"),onRefresh:ee}},null,8,["content","fullScreen"])])])])}}}),[["__scopeId","data-v-9bc941c8"]]);export{T as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
