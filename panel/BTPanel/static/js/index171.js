import{c as e,ax as a,r as t,R as s,i as l,h as o,w as r,k as i,l as n,e as u,x as p,y as c,p as d,q as m,v as f,I as v,J as h,C as _,D as b,A as w,aZ as g,at as z,b7 as x,au as y,av as k}from"./base-lib.js?v=1734676359";import{u as j,t as q,b as D}from"./utils-lib.js?v=1734676359";import{A as E}from"./useMethod3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./database.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const C={class:"p-[2rem]"},O={class:"h-[40rem] border border-[#EBEEF5] mt-[1rem]"},I={class:"ml-[0.5rem]"},A=e({__name:"index",props:{compData:{default:()=>({path:"",refreshEvent:()=>{}})}},setup(e,{expose:A}){const F=D(),{panel:M}=j();E();const B=e,H=a("popupSetFooter"),J=a("buttonText");let P=!0;const R=t(),S=t([]),T=s([".sql",".zip",".bak",".gz"].join(",")),Z={"x-http-token":window.vite_public_request_token},G=window.location.protocol+"//"+window.location.host+"/files?action=upload",K=l((()=>{var e;return B.compData.path?B.compData.path:null==(e=M.value.backupPath+"/database")?void 0:e.replace(/\/\//g,"/")})),L=o({f_size:0,f_path:K.value,f_name:"",f_start:0}),N=()=>{F.success("导入成功"),B.compData.refreshEvent()},Q=(e,a,t)=>{t.push(a),F.error("导入失败")},U=e=>{L.f_size=e.size,L.f_name=e.name,L.f_start=0},V=(e,a)=>{const t=e.name.substring(e.name.lastIndexOf(".")+1),s=["sql","zip","bak","gz"];if(-1===s.indexOf(t))return!1;S.value=a.filter((e=>{let a=e.name.substring(e.name.lastIndexOf(".")+1);return-1!==s.indexOf(a)}))||[]},W=(e,a,t)=>{L.f_start=e.percent,S.value=t.map((t=>(t.uid===a.uid&&(t.percentage=e.percent),t)))};return r((()=>S.value.length),(e=>{if(0===e)return void H(!1);const a=["success","fail","ready"];for(let t=0;t<S.value.length;t++)if(!a.includes(S.value[t].status))return void H(!1);S.value.some((e=>"success"!==e.status))&&(J.value=P?"开始上传":"重新上传",H(!0))})),A({onConfirm:()=>{S.value.map((e=>{"success"!==e.status&&(e.status="ready")})),P=!1,R.value.submit(),H(!1)}}),(e,a)=>{const t=w,s=g,l=z,o=x,r=y,j=k;return i(),n("div",C,[u(s,{class:"upload-demo",ref_key:"upload",ref:R,name:"blob",data:d(L),action:G,headers:Z,accept:d(T),multiple:!0,"show-file-list":!1,"auto-upload":!1,"file-list":d(S),"on-error":Q,"on-success":N,"on-progress":W,"on-change":V,"before-upload":U},{default:p((()=>[u(t,{type:"primary"},{default:p((()=>a[0]||(a[0]=[c("导入")]))),_:1})])),_:1},8,["data","accept","file-list"]),m("div",O,[u(j,{height:"400",data:d(S)},{empty:p((()=>[u(r,{description:"只支持'.sql', '.zip', '.bak', '.gz'文件格式导入"})])),default:p((()=>[u(l,{prop:"name","show-overflow-tooltip":!0,label:"名称"},{default:p((e=>[a[1]||(a[1]=m("i",{style:{color:"#409eff"},class:"svgtofont-el-document"},null,-1)),m("span",I,f(e.row.name),1)])),_:1}),u(l,{prop:"name",label:"是否成功",width:"300"},{default:p((e=>["success"===e.row.status?(i(),n(v,{key:0},[c("上传成功！")],64)):"fail"===e.row.status?(i(),n(v,{key:1},[c("上传失败!")],64)):"ready"===e.row.status?(i(),n(v,{key:2},[c("等待上传")],64)):(i(),h(o,{key:3,percentage:Math.floor(e.row.percentage)},null,8,["percentage"]))])),_:1}),u(l,{width:"120",prop:"size",label:"大小"},{default:p((e=>[c(f(d(q)(e.row.size)),1)])),_:1}),u(l,{prop:"name",width:"180",align:"right","show-overflow-tooltip":!0,label:"操作"},{default:p((e=>[_(u(t,{type:"text",size:"small",onClick:a=>{return t=e.row,void(S.value=S.value.filter((e=>e.name!==t.name)));var t}},{default:p((()=>a[2]||(a[2]=[c("删除")]))),_:2},1032,["onClick"]),[[b,"ready"===e.row.status||"fail"===e.row.status]])])),_:1})])),_:1},8,["data"])]),a[3]||(a[3]=m("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-2rem"},[m("li",null,"仅支持sql、zip、sql.gz、(tar.gz|gz|tgz)")],-1))])}}});export{A as default};
