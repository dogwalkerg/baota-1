import{c as e,p as a,r as t,h as l,o as s,k as n,J as r,x as i,C as o,q as d,e as c,v as u,F as m,L as p,l as f,y as v,z as g,D as w,G as h,aY as b}from"./base-lib.js?v=1734676359";import{_ as x}from"./bt_logo_new.js?v=1734676359";import{s as y,f as k,t as _,h as D,i as V}from"./api2.js?v=1734676359";import{e as j}from"./utils-lib.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const E={class:"flex !justify-center !w-full items-center"},C={class:"text-[2rem] text-dark inline-block mr-2 font-bold mt-12x"},q={key:0,class:"absolute el-form-item__error"},z={class:"flex justify-end items-centertext-[1.2rem] mt-[1rem]"},I={key:0,class:"view-con",style:{background:"#fff"}},B={class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-[#20a53a]",size:"default"},H={key:1,class:"flex justify-end items-centertext-[1.2rem] mt-[1rem] h-[1.68rem]"},U={key:0},F={class:"more-bind"},K=j(e({__name:"bind-user",props:{compData:{default:null}},emits:["close"],setup(e,{expose:j,emit:K}){const M=e,{BtLink:J,BtDivider:L,BtImage:O,ElForm:T,ElFormItem:$,ElPopover:A,ElInput:G,ElButton:N}=a(M.compData.dependencies.components),{Message:P,isUndefined:S,inputFocus:Y,rsaEncrypt:Q,useAxios:R}=a(M.compData.dependencies.hooks);y(R);const W=K,X=t(!1),Z=t("获取验证码"),ee=l({username:"",password:"",code:""}),ae=l({username:!1,password:!1,code:!1}),te=t(""),le=t(0),se=t(),ne=t(!1),re=t(1),ie=t({username:[{validator:(e,a,t)=>{var l,s;if((null==(l=M.compData)?void 0:l.dependencies.title)&&(ne.value=!1),/^1[3456789]\d{9}$/.test(a))t();else if(""===a)t(new Error("请输入宝塔官网账号"));else{if(null==(s=M.compData)?void 0:s.dependencies.title)return ne.value=!0,void t(new Error(" "));t(new Error(" 请输入正确的手机号 "))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,t)=>{a.length>=8?t():t(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,t)=>{X.value||t(),6===a.length?t():t(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),oe=async()=>{await se.value.validate();const e={...ee};if(X.value){if(!ee.code)return P.error("请输入验证码");e.token=te.value,delete e.password}else delete e.code;const a=P.load("绑定堡塔账号，请稍候 ...");try{e.username=Q(e.username),e.password=Q(e.password);const a=await k({...e});if(P.request(a),a.status)return window.location.reload(),void W("close");if(S(a.data))return!1;if(!a.status&&"[]"===JSON.stringify(a.data))return P.request(a);-1===a.data.code&&(te.value=a.data.token,X.value=!0)}catch(t){}finally{a.close()}},de=async()=>{let e;try{e=P.load("正在绑定中......");const{data:a}=await _({client:2});a.status||a.success?window.location.href="/":(e.close(),P.error(a.msg||a.res))}catch(a){null==e||e.close()}},ce=async()=>{if(!ee.username||!ee.password)return P.error("请先输入手机号和密码");ae.username=!0,ae.password=!0,(e=>{le.value&&clearInterval(le.value);const a=()=>{if(--e<=0)return clearInterval(le.value),Z.value="获取验证码",void(ae.code=!1);Z.value="重新获取验证码(".concat(e,"s)")};a(),le.value=setInterval(a,1e3),ae.code=!0})(60);const e=await D({username:ee.username,token:te.value});P.request(e)},ue=t(!1),me=e=>{var a;re.value=e,(null==(a=M.compData)?void 0:a.dependencies.onChangeType)&&M.compData.dependencies.onChangeType(1===e?"bind":"other")};return j({onOpen:()=>{Y(se.value.$el,"username")},onCancel:()=>{se.value.clearValidate()}}),s((()=>{var e;(async()=>{try{const e=await V();e.status?(ue.value=2===e.data.client&&1===e.data.login,2===e.data.client&&1===e.data.login?me(2):me(1)):me(1)}catch(e){me(1)}})(),null==(e=se.value)||e.clearValidate()})),(e,t)=>{var l;const s=b;return n(),r(a(T),{ref_key:"bindUserInfo",ref:se,size:"medium",rules:a(ie),model:a(ee),autocomplete:"off",class:m(["bind-user-info",{"bind-form":!!(null==(l=e.compData)?void 0:l.dependencies.title)}])},{default:i((()=>{var l,b,y,k,_,D,V,j,K,M,O,T,P;return[o(d("div",null,[c(a($),{class:"text-center !mb-5 flex justify-center"},{default:i((()=>{var l;return[d("div",E,[d("h3",C,u((null==(l=e.compData)?void 0:l.dependencies.title)||"切换宝塔官网账号"),1),c(a(A),{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:i((()=>t[9]||(t[9]=[d("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)]))),_:1})])]})),_:1}),(n(),r(a($),{prop:"username",key:1,class:m({"!mb-[3rem]":!!(null==(l=e.compData)?void 0:l.dependencies.title)})},{default:i((()=>{var l;return[c(a(G),{modelValue:a(ee).username,"onUpdate:modelValue":t[0]||(t[0]=e=>a(ee).username=e),clearable:"",required:"",name:"username",autocomplete:"off",class:"!leading-[4rem] !h-[4rem]",placeholder:"宝塔官网账号",disabled:a(ae).username,onKeyup:t[1]||(t[1]=p((e=>oe()),["enter"]))},null,8,["modelValue","disabled"]),(null==(l=e.compData)?void 0:l.dependencies.title)&&a(ne)?(n(),f("span",q,[t[11]||(t[11]=d("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),c(a(J),{class:"!text-[12px]",href:"https://www.bt.cn/register"},{default:i((()=>t[10]||(t[10]=[v(" 免费注册 ")]))),_:1})])):g("",!0)]})),_:1},8,["class"])),(n(),r(a($),{prop:"password",key:2},{default:i((()=>[c(a(G),{modelValue:a(ee).password,"onUpdate:modelValue":t[2]||(t[2]=e=>a(ee).password=e),clearable:"",required:"",type:"password",name:"password",class:"!leading-[4rem] !h-[4rem]",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:a(ae).password,onKeyup:t[3]||(t[3]=p((e=>oe()),["enter","native"]))},null,8,["modelValue","disabled"])])),_:1})),o(c(a($),{prop:"code"},{default:i((()=>[c(a(G),{modelValue:a(ee).code,"onUpdate:modelValue":t[4]||(t[4]=e=>a(ee).code=e),clearable:"",autocomplete:"off",placeholder:"验证码",onKeyup:t[5]||(t[5]=p((e=>oe()),["enter","native"])),type:"text"},{append:i((()=>[c(a(N),{class:"relative top-0 rounded-none rounded-r-[3px]",type:"primary",size:"default",disabled:a(ae).code,plain:"",onClick:ce},{default:i((()=>[v(u(a(Z)),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1},512),[[w,a(X)]]),c(a(N),{type:"primary",class:"w-[100%] mt-[1.2rem]",size:"default",onClick:t[6]||(t[6]=e=>oe())},{default:i((()=>{var a,t;return[v(u((null==(a=e.compData)?void 0:a.dependencies.btn)||((null==(t=e.compData)?void 0:t.dependencies.title)?"绑定账号":"切换账号")),1)]})),_:1}),d("div",z,[c(a(J),{href:"https://www.bt.cn/register"},{default:i((()=>t[12]||(t[12]=[v("注册账号")]))),_:1}),c(a(L)),c(a(J),{href:"https://www.bt.cn/login.html?page=reset"},{default:i((()=>t[13]||(t[13]=[v("忘记密码")]))),_:1}),c(a(L)),c(a(J),{href:"https://www.bt.cn/bbs"},{default:i((()=>t[14]||(t[14]=[v("问题反馈")]))),_:1})])],512),[[w,1===a(re)]]),o(d("div",null,[(null==(b=e.compData)?void 0:b.dependencies.title)?g("",!0):(n(),f("div",{key:0,class:"view-con",style:h((null==(y=e.compData)?void 0:y.dependencies.title)?"":"background:#fff;")},[d("div",{class:"app-box",style:h((null==(k=e.compData)?void 0:k.dependencies.title)?"":"background:#fff;")},t[15]||(t[15]=[d("img",{alt:"",src:x},null,-1)]),4),t[17]||(t[17]=d("div",{class:"change-icon"},[d("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[d("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1)),d("div",{class:"app-box",style:h((null==(_=e.compData)?void 0:_.dependencies.title)?"":"background:#fff;")},t[16]||(t[16]=[d("div",{class:"ali-icon"},null,-1)]),4)],4)),d("div",{class:m({"bg-white":null==(D=e.compData)?void 0:D.dependencies.title,"rounded-[4px]":null==(V=e.compData)?void 0:V.dependencies.title}),style:h({border:(null==(j=e.compData)?void 0:j.dependencies.title)?"1px solid #ddd":"none","padding-top":(null==(K=e.compData)?void 0:K.dependencies.title)?"2rem":"0"})},[(null==(M=e.compData)?void 0:M.dependencies.title)?(n(),f("div",I,t[18]||(t[18]=[d("div",{class:"app-box",style:{background:"#fff"}},[d("img",{alt:"",src:x})],-1),d("div",{class:"change-icon"},[d("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[d("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1),d("div",{class:"app-box",style:{background:"#fff"}},[d("div",{class:"ali-icon"})],-1)]))):g("",!0),c(a($),{class:m(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(O=e.compData)?void 0:O.dependencies.title,"!pt-0":null==(T=e.compData)?void 0:T.dependencies.title}])},{default:i((()=>[c(s),t[19]||(t[19]=d("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold"},"阿里云用户专享特权：",-1)),t[20]||(t[20]=d("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] flex items-center"},[d("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),v(" 免费使用原本需要付费的功能： ")],-1)),t[21]||(t[21]=d("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] ml-[1.9rem] flex items-center"},[d("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),v(" 异常监控推送 ")],-1)),t[22]||(t[22]=d("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] ml-[1.9rem] flex items-center"},[d("img",{src:"/static/img/soft_ico/ico-btapp.png",class:"w-[2rem] mr-[1rem]"}),v(" 堡塔app ")],-1)),t[23]||(t[23]=d("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1.5rem] flex items-center"},[d("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),v(" 宝塔官方付费软件均享额外折扣 ")],-1))])),_:1},8,["class"]),c(a(N),{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:de},{default:i((()=>t[24]||(t[24]=[v("一键激活专享特权")]))),_:1}),d("div",B,[d("span",{class:"cursor-pointer hover:text-[#1d9534]",onClick:t[7]||(t[7]=e=>me(1))},"已有宝塔账号登录")]),(null==(P=e.compData)?void 0:P.dependencies.title)?(n(),f("div",H)):g("",!0)],6)],512),[[w,2===a(re)]]),1===a(re)&&a(ue)?(n(),f("div",U,[t[26]||(t[26]=d("div",{class:"more-title"},[d("span",null,"更多绑定方式")],-1)),d("div",F,[o(d("div",{class:"bind-box",onClick:t[8]||(t[8]=e=>me(2))},t[25]||(t[25]=[d("i",{class:"tencent_ico"},null,-1),v(" 阿里云账号 ")]),512),[[w,1===a(re)]])])])):g("",!0)]})),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-e294e30f"]]);export{K as default};
