import{_ as e}from"./index100.js?v=1734676359";import{u as s,o as a,R as t,_ as n,d as l,b as i,a5 as r,e as c}from"./utils-lib.js?v=1734676359";import{c as o,r as d,h as u,i as m,o as p,B as v,C as g,p as f,k as y,l as b,q as w,e as k,J as x,I as _,y as h,v as S,z as E,x as C,F as T,aX as j,D as F,A as I,aY as z}from"./base-lib.js?v=1734676359";import{o as D}from"./validator.js?v=1734676359";import{scanSingleSite as q}from"./site.js?v=1734676359";import{u as J}from"./useStore7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const M={id:"safeDetectList"},O={key:0},P={class:"progress-header"},N={class:"progress-header-cot"},R={class:"flex items-center"},A={key:0,class:"scan-icon relative h-[8rem] w-[8rem] flex"},B={key:1},H={class:"progress-header-cot"},L={class:"scanning-progress-title"},X={class:"text-danger"},Y={class:"scanning-progress-cont"},G={class:"progress-header-cot"},K={class:"progress-cont-list"},Q={key:0},U={class:"inline-grid grid-cols-4 w-full mt-20px"},V=["onClick"],W={class:"progress_type"},Z={class:"flex-1"},$={key:0,class:"text-danger mr-4px"},ee={key:1},se={key:2,class:"text-primary"},ae={key:3},te={class:"progress_fold text-[1.2rem] flex items-center"},ne={class:"mr-4px"},le={class:"progress_item_body"},ie={class:"flex flex-col py-8px px-12px text-[1.2rem]"},re={class:"whitespace-normal leading-2rem"},ce={class:"whitespace-normal leading-2rem"},oe=c(o({__name:"index",setup(c,{expose:o}){const oe=i(),{siteInfo:de}=J(),{payment:ue}=s(),me=d(!1),pe=d([{name:"vulscan",title:"漏洞扫描"},{name:"webscan",title:"网站配置安全性"},{name:"filescan",title:"文件泄露"},{name:"backup",title:"备份文件"},{name:"webshell",title:"木马程序"},{name:"index",title:"首页内容风险"},{name:"webhorse",title:"挂马排查"},{name:"deadchain",title:"坏链检测"},{name:"database",title:"数据库安全"},{name:"ftps",title:"网站FTP风险"},{name:"backend",title:"网站后台安全"}]),ve=d(0),ge=d(""),fe=d(""),ye=u({scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"#20a53a",progressConfig:{},statusTotal:{},result:{},progressStatus:{},active:{}});let be=null;const we=u({title:"安全扫描-功能介绍",height:36,ps:"扫描服务器系统的漏洞，异常用户，已安装软件的安全问题并提供修复方案.",source:66,desc:["漏洞扫描","网站配置安全性","文件泄露","备份文件","木马程序"],tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/security-Introduction.png"]}),ke=m((()=>ye.scanStatus&&!ye.isEnd?"正在扫描":"定期扫描网站，提升网站安全性")),xe=m((()=>ye.scanStatus&&!ye.isEnd?"".concat(ge.value||""):ye.time?"上次检测时间：".concat(ye.time):"当前安全风险未知，请立即检测")),_e=(e,s)=>{var a,t;if(s.data){const e=JSON.parse(s.data.replace(/'/g,'"'));if(e.hasOwnProperty("end")&&e.end){if((null==(t=null==(a=e.webinfo)?void 0:a.result)?void 0:t[e.type].length)>0?(ye.progressConfig[e.type]=e.webinfo.result[e.type],ye.statusTotal[e.type]=e.webinfo.result[e.type].length):ye.statusTotal[e.type]=0,ge.value=e.info,ve.value===pe.value.length-1)return null==be||be.close(),ve.value=0,ye.scanStatus=!1,void(ye.isEnd=!0);let s=(new Date).getTime();ve.value++,null==be||be.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:s,name:de.value.name,scan_list:[pe.value[ve.value].name]})}else ge.value=e.info,fe.value=e.type,e.is_error&&ye.error++}},he=async()=>{if(ye.scanStatus&&!ye.isEnd||ye.isEnd,ye.scanStatus&&!ye.isEnd)return await a({title:"取消扫描",content:"确定取消扫描吗?",icon:"warning"}),null==be||be.close(),ve.value=0,void Se();ye.isEnd&&(await(null==be?void 0:be.close()),ve.value=0,await Se()),ye.scanStatus=!0,be=r({route:"/ws_project",onMessage:_e});let e=(new Date).getTime();null==be||be.send({"x-http-token":window.vite_public_request_token}),null==be||be.send({mod_name:"webscanning",def_name:"ScanSingleSite",ws_callback:e,name:de.value.name,scan_list:[pe.value[ve.value].name]})},Se=()=>{ye.scanStatus=!1,ye.isEnd=!1,ye.error=0,ye.warn=0,ye.time=0,ye.progress=0,ye.progressConfig={vulscan:[],webscan:[],filescan:[],backup:[],webshell:[],index:[],webhorse:[],deadchain:[],database:[],ftps:[],backend:[]},ye.statusTotal={},ye.result={},ye.progressStatus={},ye.active={vulscan:!1,webscan:!1,filescan:!1,backup:!1,webshell:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1}},Ee=async()=>{me.value=!0;try{const e=await q({data:JSON.stringify({name:de.value.name})});if(!e.status)return void oe.request(e);ye.isEnd=ye.time||!1,ye.time=t(e.data.time,"yyyy-MM-dd")}catch(e){}finally{me.value=!1}};return p((()=>{Ee(),Se()})),o({onRefresh:async()=>{Ee(),Se()}}),(s,a)=>{const t=n,i=I,r=z,c=l,o=e,d=v("bt-loading");return g((y(),b("div",M,["ltd"===f(ue).authType?(y(),b("div",O,[w("div",P,[w("div",N,[w("div",R,[f(ye).scanStatus&&!f(ye).isEnd?(y(),b("div",A,[a[0]||(a[0]=w("div",{class:"animate-spin absolute top-0 border-[#F39C12] border-b-2 rounded-full h-full w-full bg-#cccccc00"},null,-1)),k(t,{icon:"scanning-danger",size:60,color:"#F39C12",class:"m-auto"})])):(y(),b("div",B,[f(ye).warn||f(ye).error?(y(),x(t,{key:0,icon:"scanning-danger",size:70,color:"#ef0808"})):(y(),x(t,{key:1,icon:"scanning-"+(f(ye).isEnd?"success":"danger"),size:72,color:f(ye).isEnd?"#20a53a":"#F39C12"},null,8,["icon","color"]))]))])]),w("div",H,[w("div",L,[f(ye).isEnd?(y(),b(_,{key:1},[a[3]||(a[3]=h(" 检测完成 ")),f(ye).error>0||f(ye).warn>0?(y(),b(_,{key:0},[a[2]||(a[2]=h(" ，共发现 ")),f(ye).error>0?(y(),b(_,{key:0},[w("span",X,S(f(ye).error),1),a[1]||(a[1]=h(" 项风险 "))],64)):E("",!0)],64)):E("",!0)],64)):(y(),b(_,{key:0},[h(S(f(ke)),1)],64))]),w("div",Y,S(f(xe)),1)]),w("div",G,[k(i,{class:T({"warning-hover":f(ye).scanStatus&&!f(ye).isEnd}),type:f(ye).scanStatus&&!f(ye).isEnd?"warning":"primary",onClick:he,plain:!(!f(ye).scanStatus||f(ye).isEnd)},{default:C((()=>[h(S(f(ye).scanStatus&&!f(ye).isEnd?"取消扫描":f(ye).isEnd?"重新检测":"立即检测"),1)])),_:1},8,["class","type","plain"]),f(ye).isEnd?(y(),x(i,{key:0,type:"default",onClick:f(D)},{default:C((()=>a[4]||(a[4]=[h(" 立即修复 ")]))),_:1},8,["onClick"])):E("",!0)])]),k(r,{class:"!mt-0 !mb-20px !bg-[#F1F1F1]"}),w("div",K,[f(ye).scanStatus||f(ye).isEnd?E("",!0):(y(),b("div",Q,[a[5]||(a[5]=w("div",{class:"font-bold text-[1.6rem] text-[#666] mb-[2rem]"},"支持网站以下安全扫描项:",-1)),w("div",U,[(y(!0),b(_,null,j(f(pe),((e,s)=>(y(),b("div",{key:s,class:"flex flex-col inline-block items-center mb-[20px]"},[k(c,{class:"w-[4rem] inline-block mb-8px opacity-90",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),h(" "+S(e.title),1)])))),128))])])),f(ye).scanStatus||f(ye).isEnd?(y(!0),b(_,{key:1},j(f(pe),((e,s)=>(y(),b("div",{key:s,class:T([e.name+"_item "+(f(ye).active[e.name]?"active":""),"progress_item"])},[w("div",{class:"progress_item_header",onClick:s=>(e=>{ye.active[e]=!ye.active[e]})(e.name)},[w("div",W,[w("span",null,S(e.title),1)]),w("div",Z,[f(ye).statusTotal[e.name]?(y(),b("span",$," 发现"+S(f(ye).statusTotal[e.name])+"项危险 ",1)):E("",!0),f(ye).scanStatus&&f(fe)==e.name?(y(),b("span",ee," 正在扫描... ")):E("",!0),f(ye).scanStatus||f(ye).statusTotal[e.name]?E("",!0):(y(),b("span",se," 无风险项 ")),f(ye).scanStatus&&f(fe)!=e.name&&!f(ye).statusTotal[e.name]?(y(),b("span",ae," 等待扫描 ")):E("",!0)]),w("div",te,[w("span",ne,S(f(ye).active[e.name]?"收起":"展开"),1),w("i",{class:T(f(ye).active[e.name]?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down")},null,2)])],8,V),g(w("div",le,[(y(!0),b(_,null,j(f(ye).progressConfig[e.name],((s,a)=>(y(),b("div",{key:a,class:"progress_item_info"},[w("div",ie,[w("span",null,S(s.name||s),1),g(w("div",null,[k(r,{class:"!my-8px"}),w("span",re,S(s.repair),1)],512),[[F,s.repair]]),g(w("div",null,[k(r,{class:"!my-8px"}),w("span",ce," 修复方案：删除【"+S(s)+"】 ",1)],512),[[F,"webshell"===e.name]])])])))),128))],512),[[F,f(ye).active[e.name]]])],2)))),128)):E("",!0)])])):(y(),x(o,{key:1,data:f(we)},null,8,["data"]))])),[[d,f(me)]])}}}),[["__scopeId","data-v-5e1dce59"]]);export{oe as default};
