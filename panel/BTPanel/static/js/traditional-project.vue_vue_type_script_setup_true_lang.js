import{c as e,r as l,ax as a,i as t,w as o,k as r,J as s,x as n,e as d,q as u,p as i,l as c,aX as p,I as m,y as _,z as v,v as f,M as w,m as j,ah as g,a7 as y,aN as b,Q as x,aw as h,ag as V,G as k,A as U,F as C,af as D,ad as I,aj as N}from"./base-lib.js?v=1734676359";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1734676359";import{D as q,j as B,bR as F,G as M,aj as W,_ as z,E as P,c as R,db as S}from"./utils-lib.js?v=1734676359";import{_ as E}from"./index88.js?v=1734676359";import{u as G}from"./useStore7.js?v=1734676359";import{f as J}from"./validator.js?v=1734676359";import{n as A,g as Q,i as X,o as $,u as H,s as K}from"./index55.js?v=1734676359";import{checkPathStatus as L,getRunList as T}from"./site.js?v=1734676359";import{B as Y}from"./index185.js?v=1734676359";const Z={class:"flex items-center"},ee={class:"flex items-center"},le={key:0,class:"text-1.2rem ml-[0.8rem] text-[#999]"},ae={key:0,class:"text-danger text-[1.2rem]"},te=e({__name:"advanced-config",props:{ps:{},rowData:{}},setup(e,{expose:k}){var U;const C=e,D=l(),I=l((null==(U=C.rowData)?void 0:U.project_name)||!1),N=l(!1),O=a("nodeData",{user_list:[]}),{BtForm:F,param:M}=q({data:()=>{var e,l,a,t,o;const r=(null==(l=null==(e=O.value)?void 0:e.user_list)?void 0:l.length)&&-1===(null==(a=O.value.user_list)?void 0:a.findIndex((e=>"www"===e)));return{run_user:I.value?(null==(t=C.rowData)?void 0:t.run_user)||"":r?O.value.user_list[0]:"www",port:(null==(o=C.rowData)?void 0:o.port)||"",release_firewall:!1,project_ps:(null==C?void 0:C.ps)||"",domains:""}},options:()=>t((()=>[{type:"slots",key:"custom",rules:{run_user:[{required:!0,message:"请选择运行用户",trigger:"change"}]}}]))});return o((()=>C.ps),(e=>{M.value.project_ps=e||""}),{immediate:!0}),k({formData:M,popover:D}),(e,l)=>{const a=V,t=g,o=y,k=B,U=b,q=x,W=h;return r(),s(i(F),j({class:"mt-2rem"},e.$attrs),{custom:n((()=>[d(o,{label:"运行用户",prop:"run_user"},{default:n((()=>[u("div",Z,[d(t,{modelValue:i(M).run_user,"onUpdate:modelValue":l[0]||(l[0]=e=>i(M).run_user=e),class:"mr-8px !w-[16rem]"},{default:n((()=>[(r(!0),c(m,null,p(i(O).user_list,((e,l)=>(r(),s(a,{key:l,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),l[7]||(l[7]=u("span",{class:"text-[1.2rem] text-[#666]"},"* 无特殊需求请选择www用户",-1))])])),_:1}),d(o,{label:"项目端口"},{default:n((()=>{var e,a,t,o,p,w;return[u("div",ee,[d(k,{width:"20rem",type:"number",class:"mr-12px !w-[20rem]",min:1,max:65535,modelValue:i(M).port,"onUpdate:modelValue":l[1]||(l[1]=e=>i(M).port=e),placeholder:"请输入项目的真实端口"},null,8,["modelValue"]),i(I)?v("",!0):(r(),c(m,{key:0},[""===i(M).port?(r(),c("span",le,"* 若不清楚端口可不填写")):(r(),s(q,{key:1,modelValue:i(M).release_firewall,"onUpdate:modelValue":l[2]||(l[2]=e=>i(M).release_firewall=e)},{default:n((()=>[l[9]||(l[9]=_(" 放行端口 ")),d(U,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:n((()=>l[8]||(l[8]=[u("i",{class:"svgtofont-el-question text-warning"},null,-1)]))),_:1})])),_:1},8,["modelValue"]))],64))]),i(I)&&(null==(a=null==(e=C.rowData)?void 0:e.listen)?void 0:a.length)&&!(null==(o=null==(t=C.rowData)?void 0:t.listen)?void 0:o.includes(i(M).port))?(r(),c("span",ae," 项目端口可能有误，检测到当前项目监听了以下端口[ "+f(null==(w=null==(p=C.rowData)?void 0:p.listen)?void 0:w.join(","))+" ]",1)):v("",!0)]})),_:1}),d(o,{label:"项目备注"},{default:n((()=>[d(k,{modelValue:i(M).project_ps,"onUpdate:modelValue":l[3]||(l[3]=e=>i(M).project_ps=e),placeholder:"请输入项目备注",width:"24rem"},null,8,["modelValue"])])),_:1}),i(I)?v("",!0):(r(),s(o,{key:0,label:"绑定域名"},{default:n((()=>[d(W,{ref_key:"popover",ref:D,placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:i(N),"onUpdate:visible":l[6]||(l[6]=e=>w(N)?N.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:n((()=>[d(k,{rows:6,resize:"none",width:"40rem",modelValue:i(M).domains,"onUpdate:modelValue":l[4]||(l[4]=e=>i(M).domains=e),onFocus:l[5]||(l[5]=e=>N.value=!0),type:"textarea",placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])])),default:n((()=>[l[10]||(l[10]=u("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[_(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),u("br"),_(" IP地址格式：192.168.1.199"),u("br"),_(" 泛解析添加方法 *.domain.com"),u("br"),_(" 如另加端口格式为 www.domain.com:88 ")],-1))])),_:1},8,["visible"])])),_:1}))])),_:1},16)}}}),oe={key:0,class:"ml-8px text-[1.2rem] text-danger leading-[2rem]"},re={class:"flex items-center"},se={class:"flex items-center"},ne={class:"flex items-center custom-refresh-select"},de={class:"el-input-group__append !h-3rem !flex items-center"},ue={class:"flex items-center"},ie={key:0,class:"pl-[12rem]"},ce=e({__name:"node-project",setup(e,{expose:o}){const{siteInfo:f}=G(),w=l(!1),j=l([]),b=l(""),h=l(A.value.nodejs_versions),C=l(A.value.package_managers),D=l(),I=a("getNodeData",(e=>{})),N=()=>{J({type:"dir",path:ce.value.project_cwd,change:async e=>{var l;if(ce.value.project_cwd=e,!X.value){let a=null==(l=e.substring(e.lastIndexOf("/")+1))?void 0:l.replace(/\W/g,"_");ce.value.project_name||(ce.value.project_name=a),b.value=a;const t=await ee(ce.value.project_cwd);Object.assign(ce.value,t);const o=await S(e);o.node_modules&&(ce.value.not_install_pkg=!0),w.value=!o.package_json}}})},S=async e=>{const{data:l}=await M({request:L({path:e})});return l},Y=()=>{J({type:"file",path:ce.value.project_cwd,change:e=>{ce.value.userCmd=e}})},Z=async e=>{const l=await H(e);C.value=l,ce.value.pkg_manager=l[0]||""},ee=async e=>{let l={};try{const a=await T({data:JSON.stringify({project_cwd:e})}),t=W(a.data,"object",{});if(0===Object.keys(t).length)l.project_script="0";else{let e=Object.keys(t);j.value=e.map((e=>({label:e+":"+t[e],value:e}))),l.project_script=e[0]||""}if(X.value){let e=f.value.project_config.project_script;l.project_script=e,l.userCmd=e,!j.value.find((l=>l.value===e))&&(l.project_script="0")}return l}catch(a){return l}},{BtForm:le,submit:ae,param:ce}=q({data:async()=>{var e,l;if(await Q(),C.value=A.value.package_managers,h.value=A.value.nodejs_versions,X.value){const{project_config:e,ps:l}=f.value,a=await ee(e.project_cwd);return b.value=l,{...e,project_type:e.project_type||"nodejs",userCmd:"",...a}}return{project_name:"",project_script:"",project_cwd:"/www/wwwroot",project_type:"nodejs",pkg_manager:(null==(e=C.value)?void 0:e.at(0))||"",not_install_pkg:!1,run_user:"www",nodejs_version:(null==(l=h.value)?void 0:l.at(0))||"",userCmd:""}},options:e=>t((()=>[{type:"slots",key:"custom",rules:{project_cwd:[F({message:"请输入项目启动目录"})],project_name:[F({message:"请输入项目名称"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_script:[F({message:"请选择项目启动脚本"})]}}])),submit:async(e,l)=>{await l();const a=D.value.formData;return{...e.value,project_script:"0"===e.value.project_script?e.value.userCmd:e.value.project_script,...a,domains:a.domains?a.domains.split("\n"):[]}}}),pe=async()=>{const e=await ae();K(e)};return o({submit:ae}),(e,l)=>{const a=E,t=y,o=B,q=V,F=g,M=z,W=P,S=R,G=x,J=O,A=U;return r(),c("div",{class:"overflow-auto",style:k({"max-height":i(X)?"76rem":"50rem"})},[d(i(le),{"label-width":"80px"},{custom:n((()=>[d(t,{label:"项目目录",prop:"project_cwd"},{default:n((()=>[u("div",null,[d(a,{modelValue:i(ce).project_cwd,"onUpdate:modelValue":l[0]||(l[0]=e=>i(ce).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择Node项目目录",onIconClick:N,width:"32rem"},null,8,["modelValue"]),i(w)?(r(),c("div",oe,"* 文件夹中未检测到package.json文件，建议前往传统项目进行项目添加")):v("",!0)])])),_:1}),d(t,{label:"项目名称",prop:"project_name"},{default:n((()=>[d(o,{disabled:i(X),modelValue:i(ce).project_name,"onUpdate:modelValue":l[1]||(l[1]=e=>i(ce).project_name=e),width:"32rem",placeholder:"请输入Node项目名称"},null,8,["disabled","modelValue"])])),_:1}),d(t,{label:"启动选项",prop:"project_script"},{default:n((()=>[u("div",re,[d(F,{placeholder:"请选择项目目录进行操作",modelValue:i(ce).project_script,"onUpdate:modelValue":l[2]||(l[2]=e=>i(ce).project_script=e),class:"!w-[30rem]",disabled:"/www/wwwroot/"===i(ce).project_cwd||"/www/wwwroot"===i(ce).project_cwd},{default:n((()=>[d(q,{label:"自定义启动命令",value:"0"}),(r(!0),c(m,null,p(i(j),(e=>(r(),s(q,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"]),l[8]||(l[8]=u("span",{class:"ml-8px text-[1.2rem]"},"* 自动获取package.json文件中的启动模式",-1))])])),_:1}),"0"===i(ce).project_script?(r(),s(t,{key:0,label:" "},{default:n((()=>[d(a,{modelValue:i(ce).userCmd,"onUpdate:modelValue":l[3]||(l[3]=e=>i(ce).userCmd=e),placeholder:"请输入自定义启动命令",icon:"el-folder-opened",onIconClick:Y,width:"32rem"},null,8,["modelValue"])])),_:1})):v("",!0),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n((()=>[u("div",se,[u("div",ne,[d(F,{modelValue:i(ce).nodejs_version,"onUpdate:modelValue":l[4]||(l[4]=e=>i(ce).nodejs_version=e),class:"!w-[16rem]",onChange:Z},{default:n((()=>[(r(!0),c(m,null,p(i(h),(e=>(r(),s(q,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),u("div",de,[d(W,{title:"刷新Node版本",class:"!flex",onClick:l[5]||(l[5]=e=>i(I)(!0))},{default:n((()=>[d(M,{icon:"el-refresh",class:"!text-[14px]"})])),_:1})])]),l[10]||(l[10]=u("span",{class:"ml-8px text-[1.2rem] text-[#666]"},"* 请根据项目选择合适的Node版本，",-1)),d(S,{onClick:i($)},{default:n((()=>l[9]||(l[9]=[_("安装其他版本")]))),_:1},8,["onClick"])])])),_:1}),d(t,{label:"包管理器"},{default:n((()=>[u("div",ue,[d(F,{modelValue:i(ce).pkg_manager,"onUpdate:modelValue":l[6]||(l[6]=e=>i(ce).pkg_manager=e),class:"!w-[16rem]"},{default:n((()=>[(r(!0),c(m,null,p(i(C),((e,l)=>(r(),s(q,{key:l,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),l[12]||(l[12]=u("span",{class:"text-[1.2rem] text-[#666 mx-8px"},"* 请选择项目的包管理器",-1)),i(X)?v("",!0):(r(),s(G,{key:0,modelValue:i(ce).not_install_pkg,"onUpdate:modelValue":l[7]||(l[7]=e=>i(ce).not_install_pkg=e)},{default:n((()=>l[11]||(l[11]=[_(" 不安装node_module ")]))),_:1},8,["modelValue"]))])])),_:1})])),_:1}),d(J,{isShowDivider:!i(X)},{config:n((()=>{var e,l;return[d(te,{ref_key:"advancedConfigRef",ref:D,"label-width":"80px",type:"node",rowData:{...null==(e=i(f))?void 0:e.project_config,listen:null==(l=i(f))?void 0:l.listen},ps:i(b)},null,8,["rowData","ps"])]})),_:1},8,["isShowDivider"]),i(X)?(r(),c("div",ie,[d(A,{type:"primary",onClick:pe},{default:n((()=>l[13]||(l[13]=[_("保存修改")]))),_:1})])):v("",!0),l[14]||(l[14]=u("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-32px"},[u("li",null,"【启动选项】：默认读取package.json中的scripts列表，也可以选择[自定义启动命令]选项来手动输入启动命令"),u("li",null,"【自定义启动命令】：可以选择启动文件，或直接输入启动命令，支持的启动方式：例：npm/node/pm2/yarn"),u("li",null,"【项目端口】：错误的端口会导致访问502，若不知道端口，可先随意填写，启动项目后再改为正确端口"),u("li",null,"【运行用户】：为了安全考虑，默认使用www用户运行，root用户运行可能带来安全风险")],-1))],4)}}}),pe={class:"flex items-center"},me={class:"flex items-center custom-refresh-select"},_e={class:"el-input-group__append !h-3rem !flex items-center"},ve={key:2,class:"mt-2rem"},fe={class:"flex items-center"},we={class:"flex items-center"},je={class:"text-[1.2rem] text-[#666] ml-[0.8rem]"},ge={class:"flex items-center"},ye={key:3,class:"mt-2rem"},be={class:"flex items-center"},xe={key:0,class:"mb-[2rem]"},he=e({__name:"pm-project",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:o}){const{siteInfo:w}=G(),j=l(A.value.nodejs_versions),b=l(A.value.package_managers),h=t((()=>X.value?w.value.ps:ae.value.project_name)),M=l(),W=a("getNodeData",(e=>{})),L=(e,l)=>{J({type:l,path:"file"===e?ae.value.project_file:ae.value.project_cwd,change:async l=>{var a,t;const o=ae.value.project_name;if("cwd"===e){ae.value.project_cwd=l;let e=null==(a=l.substring(l.lastIndexOf("/")+1))?void 0:a.replace(/\W/g,"_");o||(ae.value.project_name=e)}else{ae.value.project_cwd=l.substring(0,l.lastIndexOf("/"));let a=null==(t=ae.value.project_cwd.substring(ae.value.project_cwd.lastIndexOf("/")+1))?void 0:t.replace(/\W/g,"_");if(o||(ae.value.project_name=a),"file"===e&&(ae.value.project_file=l),"config_file"===e){ae.value.config_file=l;const e=await(async e=>{try{const{data:l}=await S({path:e});return l.data}catch(l){}})(l);ae.value.config_body=e}}}})},T=e=>{oe()},Z=async e=>{const l=await H(e);b.value=l,ae.value.pkg_manager=l[0]||""},{BtForm:ee,submit:le,param:ae,clearValidate:oe}=q({data:async()=>{var e,l;if(await Q(),b.value=A.value.package_managers,j.value=A.value.nodejs_versions,X.value){const{project_config:e,ps:l}=w.value;return{...e,project_ps:l,watch:"true"===e.watch}}return{add_type:0,project_name:"",project_type:"pm2",project_cwd:"",project_file:"",pkg_manager:(null==(e=b.value)?void 0:e.at(0))||"yarn",not_install_pkg:!1,nodejs_version:(null==(l=j.value)?void 0:l.at(0))||"",cluster:1,max_memory_limit:1024,watch:!1,config_file:"",config_body:"",project_args:"",env:""}},options:()=>t((()=>[{type:"slots",key:"custom",rules:{project_name:[F({message:"请输入项目名称"})],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_cwd:[F({message:"请输入项目启动目录"})],cluster:[{required:!0,message:"请输入负载实例数量",trigger:["blur","change"]}],max_memory_limit:[{required:!0,message:"请输入内存上限",trigger:["blur","change"]}]}}])),submit:async(e,l)=>{let a;await l();let t=M.value.formData;return a={...e.value,...t,domains:t.domains?t.domains.split("\n"):[]},0===a.add_type&&(delete a.config_file,delete a.config_body),delete a.add_type,a}}),re=async()=>{const e=await le();K(e)};return o({submit:le}),(e,l)=>{const a=B,t=y,o=V,q=g,F=z,S=P,G=R,J=D,Q=I,H=E,K=N,le=x,oe=Y,se=O,ne=U;return r(),c("div",{class:"overflow-auto",style:k({"max-height":i(X)?"68rem":"50rem"})},[d(i(ee),{"label-width":"90px"},{custom:n((()=>[d(t,{label:"项目名称",prop:"project_name"},{default:n((()=>[d(a,{modelValue:i(ae).project_name,"onUpdate:modelValue":l[0]||(l[0]=e=>i(ae).project_name=e),width:"32rem",disabled:i(X),placeholder:"请输入Node项目名称"},null,8,["modelValue","disabled"])])),_:1}),i(X)&&i(ae).pm2_name?(r(),s(t,{key:0,label:"PM2服务名"},{default:n((()=>[d(a,{modelValue:i(ae).pm2_name,"onUpdate:modelValue":l[1]||(l[1]=e=>i(ae).pm2_name=e),width:"32rem",disabled:""},null,8,["modelValue"])])),_:1})):v("",!0),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n((()=>[u("div",pe,[u("div",me,[d(q,{onChange:Z,modelValue:i(ae).nodejs_version,"onUpdate:modelValue":l[2]||(l[2]=e=>i(ae).nodejs_version=e),class:"!w-[16rem]"},{default:n((()=>[(r(!0),c(m,null,p(i(j),(e=>(r(),s(o,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),u("div",_e,[d(S,{title:"刷新Node版本",class:"!flex",onClick:l[3]||(l[3]=e=>i(W)(!0))},{default:n((()=>[d(F,{icon:"el-refresh",class:"!text-[14px]"})])),_:1})])]),l[22]||(l[22]=u("span",{class:"ml-8px text-[1.2rem] text-[#666]"},"* 请根据项目选择合适的Node版本，",-1)),d(G,{onClick:i($)},{default:n((()=>l[21]||(l[21]=[_("安装其他版本")]))),_:1},8,["onClick"])])])),_:1}),i(X)?v("",!0):(r(),s(t,{key:1,label:"添加方式",prop:"add_type"},{default:n((()=>[d(Q,{modelValue:i(ae).add_type,"onUpdate:modelValue":l[4]||(l[4]=e=>i(ae).add_type=e),onChange:T},{default:n((()=>[d(J,{label:0},{default:n((()=>l[23]||(l[23]=[_("自定义添加")]))),_:1}),d(J,{label:1},{default:n((()=>l[24]||(l[24]=[_("从文件/内容添加")]))),_:1})])),_:1},8,["modelValue"])])),_:1})),0===i(ae).add_type?(r(),c("div",ve,[d(t,{label:"启动文件",prop:"project_file"},{default:n((()=>[d(H,{modelValue:i(ae).project_file,"onUpdate:modelValue":l[5]||(l[5]=e=>i(ae).project_file=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目启动文件",onIconClick:l[6]||(l[6]=e=>L("file","file")),width:"32rem"},null,8,["modelValue"])])),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n((()=>[d(H,{modelValue:i(ae).project_cwd,"onUpdate:modelValue":l[7]||(l[7]=e=>i(ae).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目运行目录",onIconClick:l[8]||(l[8]=e=>L("cwd","dir")),width:"32rem"},null,8,["modelValue"])])),_:1}),d(t,{label:"负载实例数量",prop:"cluster"},{default:n((()=>[u("div",fe,[d(a,{width:"10rem",class:"!w-[10rem]",type:"number",modelValue:i(ae).cluster,"onUpdate:modelValue":l[9]||(l[9]=e=>i(ae).cluster=e),min:1},null,8,["modelValue"]),l[25]||(l[25]=u("span",{class:"text-[1.2rem] text-[#666] ml-[0.8rem]"},"* 若实例数量大于1，则开启集群模式",-1))])])),_:1}),d(t,{label:"内存上限",prop:"max_memory_limit"},{default:n((()=>[u("div",we,[d(a,{width:"16rem",class:"!w-[16rem]",type:"number","text-type":"MB",min:1,modelValue:i(ae).max_memory_limit,"onUpdate:modelValue":l[10]||(l[10]=e=>i(ae).max_memory_limit=e)},null,8,["modelValue"]),u("span",je,"* 超过上限PM2会自动重启项目，系统最大可用内存为["+f(i(A).maximum_memory)+"MB]",1)])])),_:1}),d(t,{label:"自动重载"},{default:n((()=>[d(K,{modelValue:i(ae).watch,"onUpdate:modelValue":l[11]||(l[11]=e=>i(ae).watch=e)},null,8,["modelValue"])])),_:1}),d(t,{label:"包管理器"},{default:n((()=>[u("div",ge,[d(q,{modelValue:i(ae).pkg_manager,"onUpdate:modelValue":l[12]||(l[12]=e=>i(ae).pkg_manager=e),class:"!w-[16rem]"},{default:n((()=>[(r(!0),c(m,null,p(i(b),((e,l)=>(r(),s(o,{key:l,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),l[27]||(l[27]=u("span",{class:"text-[1.2rem] text-[#666 mx-8px"},"* 请选择项目的包管理器",-1)),i(X)?v("",!0):(r(),s(le,{key:0,modelValue:i(ae).not_install_pkg,"onUpdate:modelValue":l[13]||(l[13]=e=>i(ae).not_install_pkg=e)},{default:n((()=>l[26]||(l[26]=[_(" 不安装node_module ")]))),_:1},8,["modelValue"]))])])),_:1})])):(r(),c("div",ye,[d(t,{label:"配置文件"},{default:n((()=>[u("div",be,[d(H,{modelValue:i(ae).config_file,"onUpdate:modelValue":l[14]||(l[14]=e=>i(ae).config_file=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目配置文件",onIconClick:l[15]||(l[15]=e=>L("config_file","file")),width:"32rem"},null,8,["modelValue"]),l[28]||(l[28]=u("span",{class:"text-1.2rem text-#999 leading-[18px] ml-4px"},"* 请选择pm2的ecosystem配置文件或粘贴内容",-1))])])),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n((()=>[d(H,{modelValue:i(ae).project_cwd,"onUpdate:modelValue":l[16]||(l[16]=e=>i(ae).project_cwd=e),readOnly:"",icon:"el-folder-opened",placeholder:"请选择项目运行目录",onIconClick:l[17]||(l[17]=e=>L("cwd","dir")),width:"30rem"},null,8,["modelValue"])])),_:1}),d(t,{label:"内容",prop:"config_body"},{default:n((()=>[d(oe,{modelValue:i(ae).config_body,"onUpdate:modelValue":l[18]||(l[18]=e=>i(ae).config_body=e),style:{height:"24rem"},class:"!h-[24rem] w-[58rem]"},null,8,["modelValue"])])),_:1})])),d(se,{"is-show-divider":!i(X)},{config:n((()=>{var e;return[0===i(ae).add_type?(r(),c("div",xe,[d(t,{label:"参数"},{default:n((()=>[d(a,{width:"32rem ",placeholder:"请输入项目参数",modelValue:i(ae).project_args,"onUpdate:modelValue":l[19]||(l[19]=e=>i(ae).project_args=e)},null,8,["modelValue"])])),_:1}),d(t,{label:"环境变量"},{default:n((()=>[d(a,{width:"32rem",placeholder:"请输入项目环境变量，一行一个",resize:"none",rows:3,modelValue:i(ae).env,"onUpdate:modelValue":l[20]||(l[20]=e=>i(ae).env=e),type:"textarea"},null,8,["modelValue"])])),_:1})])):v("",!0),d(te,{ref_key:"advanceConfigRef",ref:M,"label-width":"90px",rowData:null==(e=i(w))?void 0:e.project_config,ps:i(h)},null,8,["rowData","ps"])]})),_:1},8,["is-show-divider"])])),_:1}),i(X)?(r(),s(ne,{key:0,type:"primary",class:"!mt-[1.2rem] !ml-10rem",onClick:re},{default:n((()=>l[29]||(l[29]=[_(" 保存修改 ")]))),_:1})):v("",!0),u("ul",{class:C(["mt-[8px] leading-8 text-[1.2rem] list-disc ml-32px",{"mb-[20px]":i(X)}])},l[30]||(l[30]=[u("li",null,"【启动文件】用于启动nodejs项目的启动文件，通常是一个js文件",-1),u("li",null,"【配置文件】用于pm2直接启动服务的文件，通常是名为ecosystem.config.cjs",-1),u("li",null,"【运行目录】运行项目时默认的运行目录，通常为启动文件或配置文件所在目录",-1),u("li",null,"【负载实例数】集群模式，有些项目可能不支持，实例数量>1时为开启集群模式",-1),u("li",null,"【负载均衡】开启集群模式后将根据实例数自动负载均衡",-1)]),2)],4)}}}),Ve={class:"flex items-center"},ke={class:"flex items-center custom-refresh-select"},Ue={class:"el-input-group__append !h-3rem !flex items-center"},Ce=e({__name:"traditional-project",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:o}){const{siteInfo:f}=G(),w=l(A.value.nodejs_versions);l(A.value.package_managers);const j=l(),b=a("getNodeData",(e=>{})),x=async(e,l)=>{J({type:l,path:"file"===e?D.value.project_file:D.value.project_cwd,change:async l=>{var a,t;"file"===e?D.value.project_file=l:D.value.project_cwd=l;const o=D.value.project_name;if("cwd"===e&&""===o){let e=null==(a=l.substring(l.lastIndexOf("/")+1))?void 0:a.replace(/\W/g,"_");D.value.project_name=e}if("file"===e){D.value.project_cwd=l.substring(0,l.lastIndexOf("/"));let e=null==(t=D.value.project_cwd.substring(D.value.project_cwd.lastIndexOf("/")+1))?void 0:t.replace(/\W/g,"_");""===o&&(D.value.project_name=e)}}})},{BtForm:h,submit:C,param:D}=q({data:async()=>{var e,l;return await Q(),w.value=A.value.nodejs_versions,X.value?null==(e=f.value)?void 0:e.project_config:{project_name:"",nodejs_version:(null==(l=w.value)?void 0:l.at(0))||"",project_file:"",project_cwd:"",project_type:"general",project_args:"",env:""}},options:()=>t((()=>[{type:"slots",key:"custom",rules:{project_name:[F({message:"请输入项目名称"})],nodejs_version:[{required:!0,message:"请选择Node版本",trigger:["blur","change"]}],project_file:[{required:!0,message:"请输入项目启动文件",trigger:["blur","change"]}],project_cwd:[F({message:"请输入项目启动目录"})]}}])),submit:async(e,l)=>{let a=!1;await l();let t=j.value.formData;return a={...e.value,...t,domains:t.domains?t.domains.split("\n"):[]},a}}),I=async()=>{const e=await C();K(e)};return o({submit:C}),(e,l)=>{const a=B,t=y,o=V,C=g,N=z,q=P,F=R,M=E,W=O,S=U;return r(),c("div",{class:"overflow-auto",style:k({"max-height":i(X)?"76rem":"52rem"})},[d(i(h),{"label-width":"80px"},{custom:n((()=>[d(t,{label:"项目名称",prop:"project_name"},{default:n((()=>[d(a,{modelValue:i(D).project_name,"onUpdate:modelValue":l[0]||(l[0]=e=>i(D).project_name=e),width:"32rem",disabled:i(X),placeholder:"请输入项目名称"},null,8,["modelValue","disabled"])])),_:1}),d(t,{label:"Node版本",prop:"nodejs_version"},{default:n((()=>[u("div",Ve,[u("div",ke,[d(C,{modelValue:i(D).nodejs_version,"onUpdate:modelValue":l[1]||(l[1]=e=>i(D).nodejs_version=e),class:"!w-[16rem]"},{default:n((()=>[(r(!0),c(m,null,p(i(w),(e=>(r(),s(o,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),u("div",Ue,[d(q,{title:"刷新Node版本",class:"!flex",onClick:l[2]||(l[2]=e=>i(b)(!0))},{default:n((()=>[d(N,{icon:"el-refresh",class:"!text-[14px]"})])),_:1})])]),l[10]||(l[10]=u("span",{class:"ml-8px text-[1.2rem] text-[#666]"},"* 请根据项目选择合适的Node版本，",-1)),d(F,{onClick:i($)},{default:n((()=>l[9]||(l[9]=[_("安装其他版本")]))),_:1},8,["onClick"])])])),_:1}),d(t,{label:"启动文件",prop:"project_file"},{default:n((()=>[d(M,{modelValue:i(D).project_file,"onUpdate:modelValue":l[3]||(l[3]=e=>i(D).project_file=e),readOnly:"",placeholder:"请选择项目启动文件",icon:"el-folder-opened",onIconClick:l[4]||(l[4]=e=>x("file","file")),width:"32rem"},null,8,["modelValue"])])),_:1}),d(t,{label:"运行目录",prop:"project_cwd"},{default:n((()=>[d(M,{modelValue:i(D).project_cwd,"onUpdate:modelValue":l[5]||(l[5]=e=>i(D).project_cwd=e),readOnly:"",placeholder:"请选择项目运行目录",icon:"el-folder-opened",onIconClick:l[6]||(l[6]=e=>x("cwd","dir")),width:"32rem"},null,8,["modelValue"])])),_:1}),d(t,{label:"参数"},{default:n((()=>[d(a,{width:"32rem ",placeholder:"请输入项目参数",modelValue:i(D).project_args,"onUpdate:modelValue":l[7]||(l[7]=e=>i(D).project_args=e)},null,8,["modelValue"])])),_:1}),d(t,{label:"环境变量"},{default:n((()=>[d(a,{width:"32rem",placeholder:"请输入项目环境变量，一行一个，格式参照key=value",resize:"none",rows:3,modelValue:i(D).env,"onUpdate:modelValue":l[8]||(l[8]=e=>i(D).env=e),type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1}),d(W,{"is-show-divider":!i(X)},{config:n((()=>{var e,l;return[d(te,{ref_key:"advanceConfigRef",ref:j,"label-width":"80px",rowData:{...null==(e=i(f))?void 0:e.project_config,listen:null==(l=i(f))?void 0:l.listen},ps:i(D).project_name},null,8,["rowData","ps"])]})),_:1},8,["is-show-divider"]),i(X)?(r(),s(S,{key:0,type:"primary",class:"!mt-[1.2rem] !ml-10rem",onClick:I},{default:n((()=>l[11]||(l[11]=[_(" 保存修改 ")]))),_:1})):v("",!0),l[12]||(l[12]=u("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-32px"},[u("li",null,"【启动文件】用于启动nodejs项目的启动文件，通常是一个js文件"),u("li",null,"【运行目录】运行项目时默认的运行目录，通常为启动文件或配置文件所在目录")],-1))],4)}}});export{ce as _,he as a,Ce as b};
