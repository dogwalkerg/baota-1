import{c as e,r as a,R as l,w as t,o as s,k as o,J as n,x as u,e as m,p as d,q as i,l as r,aX as c,I as p,z as _,y as h,v,a7 as f,ag as b,ah as g,aj as V,ae as y,ad as w,a4 as U}from"./base-lib.js?v=1734676359";import{bV as D,G as k,j as x,a4 as T,U as j,O as E}from"./utils-lib.js?v=1734676359";import{_ as N}from"./validator.js?v=1734676359";import{addMonitor as R,getDataList as S}from"./site.js?v=1734676359";import{_ as q}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const L={class:"flex"},P={class:"flex"},A={class:"flex min-h-[3.2rem] items-start"},H={class:"items-center h-[3.2rem]"},I=e({__name:"add-monitor",props:{compData:{default:()=>{}}},setup(e,{expose:I}){const J=a(null),z=e,C=a({name:"",method:2,site_name:"",site_url:"",access:"http",send_msg:!1,push_method:[],type:"day",week:1,where1:1,hour:1,minute:19,switch_config:!1,scan_config:{thesaurus:1,scan_args:!1,title_hash:!1,tail_hash:!1,keywords:!1,descriptions:!1,title:!1,search_monitor:!1,scan_ua:"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)"},id:""}),B=l([]),F=["周一","周二","周三","周四","周五","周六","周日"],G=a(!!z.compData.id),M=[{content:"如果是本机端口转发，目标IP为：127.0.0.1"},{content:"如果目标IP不填写，默认则为本机端口转发!"}],O=[{label:"全站扫描",value:1},{label:"快速扫描",value:2},{label:"单URL",value:3}],X=[{label:"HTTPS",value:"https"},{label:"HTTP",value:"http"}],K=[{label:"每天",value:"day"},{label:"N天",value:"day-n"},{label:"每星期",value:"week"},{label:"每月",value:"month"}],Q={name:[{required:!0,trigger:["blur","change"],message:"请输入监控名"}],site_name:[{validator:(e,a,l)=>{if("auto"!==a)l();else{if(0===C.value.site_url.length&&l(new Error("请输入网站域名")),3!==C.value.method&&!D(C.value.site_url))return l(new Error("检测网站域名格式不正确"));l()}},trigger:["blur","change"]}],push_method:[{validator:(e,a,l)=>{C.value.send_msg&&(a.length>0&&l(),l(new Error("请选择通知方式"))),l()},trigger:["blur","change"]}],type:[{validator:(e,a,l)=>"day-n"!==a&&"month"!==a||!(C.value.where1<0||C.value.where1>31)?C.value.hour<0||C.value.hour>23?l(new Error("请输入正确小时范围[0-23]")):C.value.minute<0||C.value.minute>59?l(new Error("请输入正确分钟范围[0-59]")):void l():l(new Error("请输入正确天数范围[0-31]")),trigger:["blur","change"]}]},W=()=>{const e=C.value.scan_config;return{scan_args:Number(e.scan_args),title:Number(e.title),keywords:Number(e.keywords),descriptions:Number(e.descriptions),title_hash:Number(e.title_hash),tail_hash:e.tail_hash,search_monitor:Number(e.search_monitor),scan_ua:e.scan_ua,thesaurus:e.thesaurus}},Y=e=>{var a;3===e?C.value.site_name="auto":z.compData.isSite&&(C.value.site_name=(null==(a=z.compData)?void 0:a.site_name)||z.compData.name)};return t((()=>C.value.site_name),(()=>{var e,a,l,t;const s=(null==(e=null==O?void 0:O.find((e=>e.value===C.value.method)))?void 0:e.label)||"";C.value.name=("auto"===C.value.site_name?(null==(a=C.value)?void 0:a.site_url)||"":(null==(l=z.compData)?void 0:l.site_name)||(null==(t=z.compData)?void 0:t.name)||"")+s})),I({onConfirm:async e=>{await J.value.validate();let a=C.value.site_name;a="auto"===a?C.value.site_url:a;let l={name:C.value.name,method:C.value.method,site_name:a,url:C.value.access+"://"+a,send_msg:Number(C.value.send_msg),type:C.value.type,hour:C.value.hour,minute:C.value.minute,id:C.value.id};const t=C.value;l.send_msg&&(l.send_type=t.push_method[0]),"week"===t.type&&(l.week=t.week),t.switch_config&&(l.scan_config=W()),G.value&&(l.id=t.id),await k({loading:"正在提交，请稍后...",request:R(G.value,l),message:!0}),z.compData.refreshEvent&&z.compData.refreshEvent(),e()}}),s((()=>{(async()=>{var e;await k({loading:"正在获取网站列表，请稍后...",request:S({type:"sites"}),data:{data:[Array,B]}}),C.value.site_name=G.value?z.compData.site_name:B.value[0].name,z.compData.isSite&&(C.value.site_name=(null==(e=z.compData)?void 0:e.site_name)||z.compData.name)})(),G.value&&(()=>{var e,a,l,t,s,o;C.value={...z.compData,...z.compData.crontab_info,...z.compData.scan_config,access:null==(e=z.compData.url)?void 0:e.split("://")[0],where1:(null==(a=z.compData.crontab_info)?void 0:a.where1)||"",hour:(null==(l=z.compData.crontab_info)?void 0:l.where_hour)||"",minute:(null==(t=z.compData.crontab_info)?void 0:t.where_minute)||"",send_msg:!!z.compData.send_msg,push_method:null==(s=z.compData.send_type)?void 0:s.split(","),id:z.compData.id};let n=null==(o=z.compData.crontab_info)?void 0:o.type;C.value.type="每星期"===n?"week":"每月"===n?"month":"每天"===n?"day":"day-n"})()})),(e,a)=>{const l=x,t=f,s=T,D=b,k=g,R=j,S=V,I=N,z=y,G=w,W=E,Z=U;return o(),n(Z,{ref_key:"monitorFormRef",ref:J,rules:Q,model:d(C),class:"p-[2rem] addfrom overflow-auto max-h-[60rem]","label-width":"10rem"},{default:u((()=>[m(t,{label:"监控名",prop:"name"},{default:u((()=>[m(l,{modelValue:d(C).name,"onUpdate:modelValue":a[0]||(a[0]=e=>d(C).name=e),width:"26rem",placeholder:"请输入监控名",clearable:""},null,8,["modelValue"])])),_:1}),m(t,{label:"检测方式"},{default:u((()=>[m(s,{modelValue:d(C).method,"onUpdate:modelValue":a[1]||(a[1]=e=>d(C).method=e),options:O,onChange:Y,class:"!w-[26rem]"},null,8,["modelValue"])])),_:1}),m(t,{label:"检测网站",prop:"site_name"},{default:u((()=>[i("div",L,[m(k,{modelValue:d(C).site_name,"onUpdate:modelValue":a[2]||(a[2]=e=>d(C).site_name=e),class:"!w-[20rem] mr-4",disabled:!(3!==d(C).method&&!e.compData.isSite)},{default:u((()=>[(o(!0),r(p,null,c(d(B),((e,a)=>(o(),n(D,{key:a,value:e.name,label:"".concat(e.name,"[").concat(e.ps,"]")},null,8,["value","label"])))),128)),m(D,{label:"自定义网站",value:"auto"})])),_:1},8,["modelValue","disabled"]),"auto"===d(C).site_name?(o(),n(l,{key:0,modelValue:d(C).site_url,"onUpdate:modelValue":a[3]||(a[3]=e=>d(C).site_url=e),width:"20rem",placeholder:"请输入网站域名",clearable:""},null,8,["modelValue"])):_("",!0)])])),_:1}),m(t,{label:"访问网站方式"},{default:u((()=>[m(R,{modelValue:d(C).access,"onUpdate:modelValue":a[4]||(a[4]=e=>d(C).access=e),options:X},null,8,["modelValue"])])),_:1}),m(t,{label:"发送告警"},{default:u((()=>[m(S,{modelValue:d(C).send_msg,"onUpdate:modelValue":a[5]||(a[5]=e=>d(C).send_msg=e)},null,8,["modelValue"])])),_:1}),!d(C).send_msg?_("",!0):(o(),n(t,{key:0,label:"通知方式",prop:"push_method"},{default:u((()=>[m(I,{class:"!w-[26rem]",modelValue:d(C).push_method,"onUpdate:modelValue":a[6]||(a[6]=e=>d(C).push_method=e),"collapse-tags":"","collapse-tags-tooltip":""},null,8,["modelValue"])])),_:1})),m(t,{label:"检测频率",prop:"type"},{default:u((()=>[i("div",P,[m(s,{class:"!w-[8rem] mr-4",modelValue:d(C).type,"onUpdate:modelValue":a[7]||(a[7]=e=>d(C).type=e),options:K},null,8,["modelValue"]),"week"===d(C).type?(o(),n(k,{key:0,class:"!w-[8rem] mr-4",modelValue:d(C).week,"onUpdate:modelValue":a[8]||(a[8]=e=>d(C).week=e)},{default:u((()=>[(o(),r(p,null,c(F,((e,a)=>m(D,{key:a,label:e,value:a+1},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])):_("",!0),"day-n"===d(C).type||"month"===d(C).type?(o(),n(l,{key:1,type:"number",class:"!w-[13rem] mr-4",min:"0",max:"31",modelValue:d(C).where1,"onUpdate:modelValue":a[9]||(a[9]=e=>d(C).where1=e),iconTitle:"day-n"===d(C).type?"天":"日",textType:"day-n"===d(C).type?"天":"日"},{append:u((()=>[h(v("day-n"===d(C).type?"天":"日"),1)])),_:1},8,["modelValue","iconTitle","textType"])):_("",!0),m(l,{type:"number",class:"!w-[13rem] mr-4",min:"0",max:"23",modelValue:d(C).hour,"onUpdate:modelValue":a[10]||(a[10]=e=>d(C).hour=e),iconTitle:"时",textType:"时"},{append:u((()=>a[21]||(a[21]=[h(" 时 ")]))),_:1},8,["modelValue"]),m(l,{type:"number",class:"!w-[13rem]",min:"0",max:"59",modelValue:d(C).minute,"onUpdate:modelValue":a[11]||(a[11]=e=>d(C).minute=e),iconTitle:"分",textType:"分"},{append:u((()=>a[22]||(a[22]=[h(" 分 ")]))),_:1},8,["modelValue"])])])),_:1}),m(q,null,{config:u((()=>[m(t,{label:"敏感词库"},{default:u((()=>[m(G,{modelValue:d(C).scan_config.thesaurus,"onUpdate:modelValue":a[12]||(a[12]=e=>d(C).scan_config.thesaurus=e),class:"border-[#ccc] border-1 !w-[26rem] rounded-[.2rem] px-[1rem] py-[.5rem] flex flex-col !items-start"},{default:u((()=>[m(z,{value:1},{default:u((()=>a[23]||(a[23]=[h("全选")]))),_:1}),m(z,{value:2},{default:u((()=>a[24]||(a[24]=[h("自定义词库")]))),_:1}),m(z,{value:3},{default:u((()=>a[25]||(a[25]=[h("默认词库")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),m(t,{label:"检测带参数的URL"},{default:u((()=>[i("div",A,[i("div",H,[m(S,{modelValue:d(C).scan_config.scan_args,"onUpdate:modelValue":a[13]||(a[13]=e=>d(C).scan_config.scan_args=e)},null,8,["modelValue"])]),a[26]||(a[26]=i("div",{class:"unit"},[i("p",null,"扫描时检测带参数的URL，如URL: https://bt.cn?a=b"),i("p",null,[h(" 开启前 "),i("span",{class:"ml-[2rem]"},"不检测")]),i("p",null,[h(" 开启后 "),i("span",{class:"ml-[2rem]"},"检测")]),i("p",null,"注意，开启后检测页面将成倍增长，可能会导致检测时间大量增加")],-1))])])),_:1}),m(t,{label:"头部JS检测"},{default:u((()=>[m(S,{modelValue:d(C).scan_config.title_hash,"onUpdate:modelValue":a[14]||(a[14]=e=>d(C).scan_config.title_hash=e)},null,8,["modelValue"]),a[27]||(a[27]=i("span",{class:"unit"},"监控页面源码中的title_hash标签是否有修改",-1))])),_:1}),m(t,{label:"尾部JS检测"},{default:u((()=>[m(S,{modelValue:d(C).scan_config.tail_hash,"onUpdate:modelValue":a[15]||(a[15]=e=>d(C).scan_config.tail_hash=e)},null,8,["modelValue"]),a[28]||(a[28]=i("span",{class:"unit"},"监控页面源码中的tail_hash标签是否有修改",-1))])),_:1}),m(t,{label:"关键词检测"},{default:u((()=>[m(S,{modelValue:d(C).scan_config.keywords,"onUpdate:modelValue":a[16]||(a[16]=e=>d(C).scan_config.keywords=e)},null,8,["modelValue"]),a[29]||(a[29]=i("span",{class:"unit"},"监控页面源码中的keywords标签是否有修改",-1))])),_:1}),m(t,{label:"描述检测"},{default:u((()=>[m(S,{modelValue:d(C).scan_config.descriptions,"onUpdate:modelValue":a[17]||(a[17]=e=>d(C).scan_config.descriptions=e)},null,8,["modelValue"]),a[30]||(a[30]=i("span",{class:"unit"},"监控页面源码中的descriptions标签是否有修改",-1))])),_:1}),m(t,{label:"标题检测"},{default:u((()=>[m(S,{modelValue:d(C).scan_config.title,"onUpdate:modelValue":a[18]||(a[18]=e=>d(C).scan_config.title=e)},null,8,["modelValue"]),a[31]||(a[31]=i("span",{class:"unit"},"监控页面源码中的title标签是否有修改",-1))])),_:1}),m(t,{label:"搜索引擎收录监控"},{default:u((()=>[m(S,{modelValue:d(C).scan_config.search_monitor,"onUpdate:modelValue":a[19]||(a[19]=e=>d(C).scan_config.search_monitor=e)},null,8,["modelValue"]),a[32]||(a[32]=i("span",{class:"unit"},"监控搜索引擎是否存在风险关键词",-1))])),_:1}),m(t,{label:"自定义访问UA"},{default:u((()=>[m(l,{type:"textarea",modelValue:d(C).scan_config.scan_ua,"onUpdate:modelValue":a[20]||(a[20]=e=>d(C).scan_config.scan_ua=e),width:"36rem",height:"10rem",placeholder:"请输入自定义访问UA",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),m(W,{options:M,class:"pl-[3.6rem]"})])),_:1},8,["model"])}}});export{I as default};
