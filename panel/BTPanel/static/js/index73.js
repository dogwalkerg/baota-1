import{_ as e}from"./index90.js?v=1734676359";import{u as a,c4 as t,J as l,c5 as s,t as n,c6 as i,D as r,c7 as o,a6 as c,c8 as d,c9 as p,b as u,b6 as m,U as _,aO as h,a4 as x,aM as b,l as k,ca as g,o as y,cb as v,x as f,cc as w,cd as C,ce as T,cf as O,al as j,bJ as q,bY as D,cg as V,c as B}from"./utils-lib.js?v=1734676359";import{_ as L}from"./we-com.js?v=1734676359";import{s as Y,g as M,r as W,h as P,i as A,c as E,bC as U,o as z,B as F,k as H,l as J,e as S,x as I,p as N,J as R,z as G,C as K,q as Q,v as X,y as Z,w as $}from"./base-lib.js?v=1734676359";import{u as ee}from"./column.js?v=1734676359";import{u as ae}from"./index124.js?v=1734676359";import{e as te}from"./validator.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";import{B as le}from"./index87.js?v=1734676359";import{_ as se}from"./index335.js?v=1734676359";import{b as ne,g as ie}from"./form-item.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./index107.js?v=1734676359";const re=M("VHOST-ACCOUNT-STORE",(()=>{const{payment:e}=a(),r=W(!1),o=P({number:0,limit:0}),c=W({accunt_id:0,username:"",password:"",email:"",expireType:0,package_id:0,mountpoint:"",expire_date:"",remark:""}),d=W({}),p=W(0),u=A((()=>{switch(e.value.authType){case"pro":return o.limit=10,"当前为专业版，可创建子用户为 ".concat(o.number,"/").concat(o.limit);case"ltd":return o.limit=30,"当前为企业版，可创建子用户为 ".concat(o.number,"/").concat(o.limit)}})),m=W([]),_=W(!1),h=W([]),x=W(!1),b=W([]),k=W(!1),g=W({});return{isEdit:r,formData:c,editorForm:d,resetFormData:()=>{c.value={username:"",password:"",email:"",expireType:0,package_id:0,mountpoint:"",expire_date:"",remark:""},r.value=!1},packageOptions:m,packageLoading:_,renderPackageOptions:async()=>{try{_.value=!0;const{data:{list:e}}=await t();if(l(e)){if(r.value){const a=e.find((e=>e.package_id===c.value.package_id));g.value=a}else c.value.package_id=e[0].package_id,g.value=e[0];m.value=e.map((e=>({label:e.package_name+(e.remark?"(".concat(e.remark,")"):""),value:e.package_id,data:e})))}}catch(e){}finally{_.value=!1}},accountTypeLoading:k,renderAccountTypeOptions:async()=>{const{data:e}=await i();if(l(e))return b.value=e.map((e=>({label:e.type_name,value:e.type_id}))),e},diskOptions:h,diskLoading:x,renderDiskOptions:async()=>{try{x.value=!0;const{data:e}=await s();if(l(e)){if(r.value){const{mountpoint:a}=e.find((e=>e.mountpoint===c.value.mountpoint));c.value.mountpoint=a}else c.value.mountpoint=e[0].mountpoint;h.value=e.map((e=>({label:"".concat(e.mountpoint,"(").concat(n(e.used),"/").concat(n(e.total),") 配额：").concat(e.is_user_quota?"启用":"未启用"),value:e.mountpoint,data:e})))}}catch(e){}finally{x.value=!1}},selectPackageOptions:g,changePackageEvent:e=>{const a=m.value.find((a=>a.data.package_id===e));g.value=a.data},refreshList:()=>{p.value=(new Date).getTime()},refreshInfo:p,checkedAccountLimit:u,accountAuth:o}})),oe=()=>{const e=re(),a=Y(e);return{...e,...a}},ce={class:"p-[2rem]"},de={class:"custom-table"},pe=["disabled"],ue=E({__name:"index",setup(e,{expose:a}){const{isEdit:t,formData:l,packageOptions:s,packageLoading:i,renderPackageOptions:b,changePackageEvent:k,selectPackageOptions:g,diskOptions:y,diskLoading:v,renderDiskOptions:f,refreshList:w,resetFormData:C}=oe(),{request:T,load:O}=u(),{BtForm:j,submit:q}=r({data:l.value,options:e=>A((()=>[ne("用户名","username",{attrs:{class:"!w-[32rem]",clearable:!0,placeholder:"请输入用户名",disabled:t.value},rules:[{required:!0,message:"用户名不能为空！",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}]}),ie("密码","password",{attrs:{class:"!w-[32rem]",placeholder:"请输入密码"},rules:t.value?[]:[{required:!0,clearable:!0,message:"密码不能为空！"},o({complex:{length:6}})]},(()=>e.value.password=m(12))),{type:"slots",key:"expire_time"},{type:"slots",key:"package_id"},!t.value&&{type:"slots",key:"mountpoint"},ne("备注","remark",{attrs:{class:"!w-[32rem]",clearable:!0,placeholder:"请输入备注内容，可为空"}})])),submit:async(e,a,l)=>{await a();let s={...e.value,email:"vhost@bt.cn"};0===s.expireType?s.expire_date="0000-00-00":s.expire_date=c(s.expire_date)?s.expire_date:U(s.expire_date,"YYYY-MM-DD"),delete s.expireType;const{max_site_limit:n,disk_space_quota:i,monthly_bandwidth_limit:r,max_email_account:o,max_database:u,php_start_children:m,php_max_children:_}=g.value;s={...s,disk_space_quota:i,monthly_bandwidth_limit:r,max_site_limit:n,max_email_account:o,max_database:u,php_start_children:m,php_max_children:_},t.value?delete s.mountpoint:delete s.account_id;let h=null;const x=O("正在提交表单信息，请稍候...");try{if(h=await(t.value?d(s):p(s)),T(h),C(),w(),!h.status)return!1}catch(b){}finally{x.close()}return h}});return z((()=>{b(),f()})),a({onConfirm:q,onCancel:C}),(e,a)=>{const r=_,o=se,c=h,d=x,p=le,u=F("bt-loading");return H(),J("div",ce,[S(N(j),null,{expire_time:I((()=>[S(c,{prop:"expire_date",label:"到期时间"},{default:I((()=>[S(r,{modelValue:N(l).expireType,"onUpdate:modelValue":a[0]||(a[0]=e=>N(l).expireType=e),options:[{label:"永久",value:0},{label:"自定义",value:1}]},null,8,["modelValue"]),N(l).expireType?(H(),R(o,{key:0,class:"!w-[15rem] ml-[3.5rem]",modelValue:N(l).expire_date,"onUpdate:modelValue":a[1]||(a[1]=e=>N(l).expire_date=e),type:"date","date-format":"YYYY-MM-DD",placeholder:"选择到期日期"},null,8,["modelValue"])):G("",!0)])),_:1})])),package_id:I((()=>[S(c,{prop:"expire_date",label:"资源包"},{default:I((()=>[K((H(),J("div",null,[S(d,{modelValue:N(l).package_id,"onUpdate:modelValue":a[2]||(a[2]=e=>N(l).package_id=e),options:N(s),placeholder:"请选择资源包",onChange:N(k),clearable:"",class:"!w-[28rem]"},null,8,["modelValue","options","onChange"]),S(p,{trigger:"hover",placement:"right","popper-style":"padding:0",width:"240px"},{reference:I((()=>a[4]||(a[4]=[Q("span",{class:"bt-link text-[12px] ml-[15px]"},"详情",-1)]))),default:I((()=>[Q("table",de,[Q("tbody",null,[Q("tr",null,[a[5]||(a[5]=Q("td",null,"资源名称",-1)),Q("td",null,X(N(g).package_name),1)]),Q("tr",null,[a[6]||(a[6]=Q("td",null,"备注",-1)),Q("td",null,X(N(g).remark),1)]),Q("tr",null,[a[7]||(a[7]=Q("td",null,"磁盘配额（MB）",-1)),Q("td",null,X(N(g).disk_space_quota?N(n)(N(g).disk_space_quota,!0,0):"无限制"),1)]),Q("tr",null,[a[8]||(a[8]=Q("td",null,"每月带宽限制（MB）",-1)),Q("td",null,X(N(g).monthly_bandwidth_limit?N(n)(N(g).monthly_bandwidth_limit,!0,0):"无限制"),1)]),Q("tr",null,[a[9]||(a[9]=Q("td",null,"最大网站数",-1)),Q("td",null,X(N(g).max_site_limit?N(g).max_site_limit:"无限制"),1)]),Q("tr",null,[a[10]||(a[10]=Q("td",null,"数据库数量",-1)),Q("td",null,X(N(g).max_database?N(g).max_database:"无限制"),1)]),Q("tr",null,[a[11]||(a[11]=Q("td",null,"启动子进程数量",-1)),Q("td",null,X(N(g).php_start_children),1)]),Q("tr",null,[a[12]||(a[12]=Q("td",null,"最大子进程数量",-1)),Q("td",null,X(N(g).php_max_children),1)])])])])),_:1})])),[[u,N(i)],[u,"small","size"],[u,"horizontal","type"],[u,"获取列表中","title"]])])),_:1})])),mountpoint:I((()=>[S(c,{prop:"expire_date",label:"存储磁盘"},{default:I((()=>[K((H(),J("div",{disabled:N(t)},[S(d,{modelValue:N(l).mountpoint,"onUpdate:modelValue":a[3]||(a[3]=e=>N(l).mountpoint=e),options:N(y),placeholder:"请选择存储磁盘",clearable:"",class:"!w-[28rem]"},null,8,["modelValue","options"])],8,pe)),[[u,N(v)],[u,"small","size"],[u,"horizontal","type"],[u,"获取列表中","title"]])])),_:1})])),_:1})])}}}),{request:me}=u(),{refreshList:_e,accountAuth:he,isEdit:xe,formData:be}=oe(),ke=(e=!1)=>{if(b(e))xe.value=!0,be.value={account_id:e.account_id,username:e.username,password:"",email:e.email,package_id:e.package_id,expireType:"0000-00-00"!==e.expire_date?1:0,expire_date:"0000-00-00"!==e.expire_date?e.expire_date:"",mountpoint:e.mountpoint,remark:e.remark};else if(he.value.number>=he.value.limit)return void me({type:"warning",content:"当前用户数量已达上限，如需更多用户管理，请联系客服。"});k({title:"".concat(e?"编辑":"添加","用户"),area:"500px",component:ue,showFooter:!0})},ge=e=>{y({title:"删除用户".concat(e.username),content:"是否删除该用户".concat(e.username,"，是否继续？"),onConfirm:async()=>{const a=await O({account_id:e.account_id,is_del_resources:!0});me(a),_e()}})},ye=async e=>{const{data:a}=await v({account_id:e.account_id});b(a)&&window.open(a.login_url+"?token="+a.token)},ve=async()=>{try{let e=[];const{data:a}=await i();return l(a)&&(e=[{label:"全部分类",value:"all"},...a.map((e=>({label:e.name,value:Number(e.type_id)})))]),e||[]}catch(e){return[]}},fe={class:"ml-[10px] flex items-center h-[30px] font-bold text-[#666]"},we=E({__name:"index",setup(t){const{mainHeight:l}=a(),{refreshInfo:s,checkedAccountLimit:i}=oe(),{BtOperation:r}=j({options:[{type:"button",label:"添加用户",active:!0,onClick:()=>ke()}]}),{BtTable:o,BtSearch:c,BtRefresh:p,BtPage:u,BtColumn:m,BtTableCategory:_,refresh:h}=q({request:e=>(async e=>{const a=await g(e);return a.data.list?(he.value.number=a.data.page.count,{data:a.data.list,total:a.data.page.count}):{data:[],total:0}})({rows:e.limit,search_value:e.search,p:e.p,type_id:e.type_id}),columns:[{label:"用户名",prop:"username",minWidth:100,render:e=>S("span",{class:"text-primary cursor-pointer",onClick:()=>ye(e)},[e.username])},{label:"资源包",prop:"package_name",isCustom:!0,minWidth:100},{label:"磁盘配额",prop:"quota",minWidth:100,isCustom:!0,render:e=>S("span",{class:0===e.disk_space_status?"text-error":""},[0===e.disk_space_used&&0===e.disk_space_quota?"-":n(e.disk_space_used,!0,0),Z(" / "),0===e.disk_space_quota?"无限制":n(e.disk_space_quota,!0,0)])},{label:"带宽",prop:"name",minWidth:100,isCustom:!0,render:e=>S("span",{class:0===e.monthly_bandwidth_status?"text-error":""},[n(e.monthly_bandwidth_used,!0,0),Z(" / "),0===e.monthly_bandwidth_limit?"无限制":n(e.monthly_bandwidth_limit,!0,0)])},{label:"状态",prop:"status",minWidth:60,isCustom:!0,render:e=>{const a=new Map([[-1,"所有"],[0,"停用"],[1,"正常"],[2,"过期"]]);return S("span",{onClick:()=>(async e=>{y({title:"".concat(1===e.status?"停用":"启用","用户").concat(e.username),content:"是否".concat(1===e.status?"停用":"启用","该用户").concat(e.username,"，是否继续？"),onConfirm:async()=>{const a=await d({account_id:e.account_id,status:1===e.status?0:1});me(a),_e()}})})(e),class:"cursor-pointer ".concat(1===e.status||-1===e.status?"text-primary":"text-danger")},[a.get(e.status)])}},{label:"过期时间",prop:"expire_date",minWidth:80,isCustom:!0,render:e=>"0000-00-00"===e.expire_date?"永久":e.expire_date},{label:"备注",prop:"remark",minWidth:200,isCustom:!0,render:e=>e.remark?e.remark:"--"},{label:"登录信息",prop:"info",minWidth:65,isCustom:!0,render:e=>S("span",{class:"text-primary cursor-pointer",onClick:()=>(e=>{const{login_url:a,username:t,init_password:l}=e;f({value:"账号: ".concat(a,"\n用户: ").concat(t,"\n初始密码: ").concat(l)})})(e)},[Z("复制")])},ee([{onClick:ye,title:"登录虚拟主机",width:100},{onClick:e=>ke(e),title:"编辑"},{onClick:ge,title:"删除"}])],extension:[D(),V(),ae({key:"type_id",name:"",options:()=>[{label:"全部分类",value:"all"}],event:{get:ve,add:w,update:C,delete:T}})]});return $((()=>s.value),h),(a,t)=>{const s=B,n=e;return H(),R(n,null,{"header-left":I((()=>[S(N(r)),Q("div",fe,[Z(X(N(i))+"，更多信息 ",1),S(s,{href:"https://www.bt.cn/new/wechat_customer",class:"mx-[10px]"},{default:I((()=>t[1]||(t[1]=[Q("img",{src:L,class:"w-[14px] h-[14px]"},null,-1),Z("联系客服")]))),_:1})]),Q("div",{class:"flex items-center mr-[10px]",onClick:t[0]||(t[0]=e=>N(te)({name:"用户管理",type:35,id:62}))},t[2]||(t[2]=[Q("i",{class:"svgtofont-desired text-[1.6rem] mr-[4px]"},null,-1),Q("span",{class:"bt-link"},"需求反馈",-1)])),S(s,{href:"https://www.bt.cn/bbs/thread-141273-1-1.html",class:"mr-[10px]"},{default:I((()=>t[3]||(t[3]=[Z(">> 使用文档")]))),_:1})])),"header-right":I((()=>[S(N(c),{placeholder:"请输入用户名称",class:"!w-[270px] mr-[10px]"}),S(N(p),{class:"mr-[10px]"}),S(N(m))])),content:I((()=>[S(N(o),{"min-height":N(l)},null,8,["min-height"])])),"footer-right":I((()=>[S(N(u))])),_:1})}}});export{we as default};
