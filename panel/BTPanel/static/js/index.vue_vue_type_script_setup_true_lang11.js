import{M as e,G as a,h as l}from"./utils-lib.js?v=1734676359";import{c as s,r as t,h as o,k as n,l as u,e as r,x as p,C as i,p as c,A as f,aZ as d,D as m,y as _,q as y,I as w,aX as h,ah as v,ag as b}from"./base-lib.js?v=1734676359";import{q as k,r as g}from"./firewall.js?v=1734676359";const x=s({__name:"index",emits:["upload-success"],setup(a,{expose:l,emit:s}){const _=s,y={"x-http-token":window.vite_public_request_token},w=window.location.protocol+"//"+window.location.host+"/files?action=upload",h=t([]),v=t(null),b=t(null),k=[".json"].join(","),g=o({f_size:0,f_path:"/www/server/panel/data/firewall",f_name:"",f_start:0}),x=()=>{_("upload-success")},P=()=>{e.error("导入失败")},U=e=>{e.value=e,g.f_size=e.size,g.f_name=e.name,g.f_start=0},q=(e,a)=>{h.value=a},L=(e,a,l)=>{g.f_start=e.percent,h.value=l.map((l=>(l.uid===a.uid&&(l.percentage=e.percent),l)))};return l({onConfirm:()=>v.value.submit(),open:()=>b.value.$el.click(),fileData:g}),(e,a)=>{const l=f,s=d;return n(),u("div",null,[r(s,{class:"upload-demo",ref_key:"uploadRef",ref:v,name:"blob",data:c(g),action:w,headers:y,accept:c(k),"on-error":P,multiple:!1,"show-file-list":!1,"auto-upload":!0,"on-success":x,"on-progress":L,"file-list":c(h),"on-change":q,"before-upload":U},{default:p((()=>[i(r(l,{ref_key:"uploadButtonRef",ref:b,size:"small",type:"primary"},null,512),[[m,!1]])])),_:1},8,["data","accept","file-list"])])}}}),P={class:"mx-8px inline-block"},U={class:"p-20px flex items-center"},q=s({__name:"index",props:{type:{default:"ALL"},refreshFn:{type:Function,default:()=>{}}},setup(s){const i=s,d=t(null),m=o({showPopup:!1,type:"ALL"}),q=[{label:"所有方向",value:"ALL"},{label:"入站",value:"INPUT"},{label:"出站",value:"OUTPUT"}],L=()=>{d.value.open()},V=async()=>{"port"!==i.type&&"ip"!==i.type?j():m.showPopup=!0},j=async l=>{let s={rule:i.type};l&&(s={...s,chain:l}),"country_rule"===i.type&&(s={rule_name:i.type});const t=await a({loading:"正在导出中，请稍后...",request:k(s),data:{status:Boolean,msg:String}});t.status?window.open("/download?filename="+t.msg):e.request(t)},C=async()=>{m.showPopup=!1,j(m.type)},z=async()=>{const e=d.value.fileData.f_name,l=d.value.fileData.f_path;let s={};s="country_rule"===i.type?{rule_name:i.type,file_name:e}:{rule:i.type,file:l+"/"+e},await a({loading:"正在导入中，请稍后...",request:g(s),message:!0}),i.refreshFn()};return(e,a)=>{const s=f,t=b,o=v,i=l;return n(),u("div",P,[r(s,{onClick:L},{default:p((()=>a[2]||(a[2]=[_("导入规则")]))),_:1}),r(s,{onClick:V},{default:p((()=>a[3]||(a[3]=[_("导出规则")]))),_:1}),r(x,{ref_key:"fileUploadRef",ref:d,onUploadSuccess:z,class:"w-0 h-0"},null,512),r(i,{title:"导出规则","show-footer":"",modelValue:c(m).showPopup,"onUpdate:modelValue":a[1]||(a[1]=e=>c(m).showPopup=e),area:42,onConfirm:C},{default:p((()=>[y("div",U,[a[4]||(a[4]=y("div",{class:"inline-block mr-[2rem]"},"导出方向",-1)),r(o,{modelValue:c(m).type,"onUpdate:modelValue":a[0]||(a[0]=e=>c(m).type=e),class:"!w-[30rem]",placeholder:"请选择导出方向"},{default:p((()=>[(n(),u(w,null,h(q,(e=>r(t,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"])])}}});export{q as _};
