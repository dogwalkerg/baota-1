import{_ as e}from"./index101.js?v=1734676359";import{getBackupSize as a,getImportSize as s}from"./database.js?v=1734676359";import{M as t}from"./utils-lib.js?v=1734676359";import{c as l,r,o as c,aB as i,k as n,l as m,q as o,v as u,p,e as d,z as v}from"./base-lib.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const f={class:"p-2rem flex-wrap"},x={class:"relative w-full text-[1.6rem] flex items-center mb-2rem"},g={class:"flex flex-col ml-1rem leading-2rem"},y={class:"text-[1.2rem] mt-[8px]"},D={class:"grid grid-cols-3 leading-3rem py-1rem text-[1.4rem]"},b={class:"flex items-center mr-1rem"},h={class:"truncate flex-1"},_={class:"flex items-center mr-1rem"},j={class:"truncate flex-1"},w={class:"flex items-center"},F={class:"truncate flex-1"},k={key:0,class:"pl-2rem mt-2re leading-8 text-[1.2rem] list-disc"},C=l({__name:"index",props:{compData:{default:()=>({type:"",refreshFn:()=>{},successFlag:!1,config:{id:"",name:"",path:""}})}},emits:["close","onCancel"],setup(l,{expose:C,emit:T}){const O=l,S=T,{id:q,name:z,path:B}=O.compData.config,H=r(""),M=r(""),N=r("获取中...\t"),A=r(!0),E=r(null),G=r("import"===O.compData.type?"导入":"recover"===O.compData.type?"恢复":"压缩"),I=async()=>{try{const{data:e}="backup"===O.compData.type?await a({id:Number(q)}):await s({name:z});if(!e.status)return K(),A.value=!1,void(N.value=e.msg);N.value!==e.msg&&(N.value=e.msg),(null==e?void 0:e.total)&&(H.value=e.total,M.value=e.speed);let t=(-1!==e.msg.indexOf("成功!")||-1!==e.msg.indexOf("successful"))&&e.status;if(t)return void J();(null==e?void 0:e.speed)&&A.value&&!t&&(E.value=setTimeout((function(){I()}),1e3))}catch(e){K()}},J=()=>{A.value=!1,"repair"===O.compData.type&&(t.success("修复完成，请按 Ctrl+F5 刷新缓存，或等待2s自动刷新！"),setTimeout((()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()}),2e3)),S("close"),K(),O.compData.refreshFn&&O.compData.refreshFn()},K=()=>{E.value=null,clearTimeout(E.value)};return c((()=>I())),i((()=>K())),C({onCancel:K}),(a,s)=>{const t=e;return n(),m("div",f,[o("div",x,[s[0]||(s[0]=o("i",{class:"svgtofont-el-loading text-3rem animate-spin"},null,-1)),o("div",g,[o("span",null,"正在"+u(p(G))+"数据库文件，请稍后...",1),o("span",y,"当前"+u(p(G))+"任务为后台"+u(p(G))+"，可关闭此页面进行其他操作",1)])]),s[2]||(s[2]=o("hr",{class:"!border-[#dedede]"},null,-1)),o("div",D,[o("div",b,[o("span",null,u(p(G))+"数据库：",1),o("div",h,u(a.compData.config.name),1)]),o("div",_,[o("div",null,u(p(G))+"大小：",1),o("div",j,u(p(H)||"--"),1)]),o("div",w,[o("div",null,u(p(G))+"速度：",1),o("div",F,u(p(M)||"--"),1)])]),d(t,{class:"h-[30rem]",content:p(N)},null,8,["content"]),"import"===a.compData.type?(n(),m("ul",k,s[1]||(s[1]=[o("li",null,"导入完成后，可到导入->导入日志查看导入结果",-1)]))):v("",!0)])}}});export{C as default};
