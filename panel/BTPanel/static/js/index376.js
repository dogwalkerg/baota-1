import{_ as e}from"./index90.js?v=1734676359";import{o as a,G as t,b3 as s,db as n,b4 as l,_ as o,k as c,V as i,h as r,a5 as u,dh as p,b as m}from"./utils-lib.js?v=1734676359";import{B as d}from"./index185.js?v=1734676359";import{c as f,r as h,h as v,o as g,k as b,l as y,q as x,p as _,e as w,z as k,J as C,y as j,v as q,x as I,M as V,A as E,aY as T}from"./base-lib.js?v=1734676359";import{a as F,u as z,c as A}from"./column.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./ace.js?v=1734676359";import"./index91.js?v=1734676359";const D={class:"p-[2rem]"},J={class:"title-box flex items-center justify-between"},M={class:"flex items-center"},O={key:0,class:"scan-icon relative h-[8rem] w-[8rem]"},U={class:"scan-title flex flex-col items-start ml-[2rem]"},B={class:"font-bold text-[1.8rem] text-[#444]"},G={class:"text-danger"},H={class:"text-[1.2rem] text-[#666] mt-[1.2rem]"},N={class:"flex items-center ml-[1.2rem]"},S={class:"p-[2rem]"},Y=f({__name:"index",props:{compData:{default:()=>{}}},setup(f){const Y=f,K=m(),L=h("loading"),P=h(!1),Q=h("");let R={},W=null;const X=v({scanInfo:"",scanCount:0,scanningCount:0,scanningText:"进行中"}),Z=h(),$=h([]),ee=[{label:"删除",value:"delete",event:async(e,a,t,s)=>{const{label:n,value:l}=s,o=async(e,a)=>{const{path:t}=e;if("delete"===l){const e=await p({path:t,type:"File"});return e.status&&($.value=$.value.filter((e=>e.path!==t))),e}};await e({title:"批量".concat(n,"文件"),content:"批量".concat(n,"已选的文件，是否继续操作！"),column:[{label:"文件名",prop:"name"},A()],onConfirm:async()=>(await a(o),!1)})}}],ae=(e,a)=>{if("token error"===a.data)return K.error("token error"),void(null==W||W.close());const t=JSON.parse(a.data);X.scanInfo=t.info,t.is_count&&(X.scanCount=t.count,X.scanningCount=t.is_count),t.path&&$.value.push({path:t.path,name:t.path.substring(t.path.lastIndexOf("/")+1)}),t.result&&(L.value="success",X.scanningText="已完成",X.scanInfo="扫描已完成",X.scanningCount=X.scanCount,t.result.length>0&&(L.value="danger"),null==W||W.close())},te=async()=>{$.value=[],W=u({route:"/ws_panel",onMessage:ae}),L.value="loading",X.scanningText="进行中",null==W||W.send({def_name:"ws_webshell_check",mod_name:"files",path:Y.compData.row.path,ws_callback:"1"})},se=async()=>{await a({title:"提示",content:"查杀正在进行中，确定要停止扫描吗？",icon:"question-filled"}),X.scanningText="已取消",L.value="success",null==W||W.close()},ne=async()=>{t({request:s({path:R.path,data:Q.value,encoding:"utf-8"}),message:!0})},le=(({openFileEvent:e,falseAlarmEvent:a,deleteEvent:t})=>[F(),{label:"文件名",prop:"name",width:160},{label:"文件路径",prop:"path"},z([{onClick:a,title:"误报"},{onClick:e,title:"打开文件",width:70},{onClick:t,title:"删除"}])])({openFileEvent:async e=>{t({request:n({path:e.path}),success:a=>{Q.value=a.data.data,P.value=!0,R=e}})},falseAlarmEvent:async e=>{try{await a({title:"提示",content:"是否确定提交误报反馈",icon:"question-filled",type:"calc"}),t({request:l({filename:e.path}),message:!0,success:()=>{$.value=$.value.filter((a=>a.path!==e.path))}})}catch(s){}},deleteEvent:async(e,s=!1)=>{try{await a({title:"提示",content:"确定删除文件【"+e.path+"】?删除后文件将移至回收站，是否继续操作?",icon:"question-filled",type:"calc"}),t({request:p({path:e.path,type:"File"}),message:!0,success:a=>{a.status&&($.value=$.value.filter((a=>a.path!==e.path)))}})}catch(n){}}});return g((()=>{te()})),(a,t)=>{const s=o,n=E,l=T,u=c,p=i,m=d,f=r,h=e;return b(),y("div",D,[x("div",J,[x("div",M,["loading"==_(L)?(b(),y("div",O,[t[3]||(t[3]=x("div",{class:"animate-spin absolute top-0 border-primary border-b-2 rounded-full h-full w-full bg-[#cccccc00]"},null,-1)),w(s,{icon:"scanning-scan",size:60,color:"#20a53a",class:"absolute top-0 left-0 right-0 bottom-0 m-[auto] h-[8rem] w-[6rem]"})])):k("",!0),"success"==_(L)?(b(),C(s,{key:1,icon:"scanning-success",size:60,color:"#20a53a"})):k("",!0),"danger"==_(L)?(b(),C(s,{key:2,icon:"scanning-danger",size:60,color:"#ef0808"})):k("",!0),x("div",U,[x("span",B,[j(" 查杀"+q(_(X).scanningText)+" ，已扫描文件 "+q(_(X).scanningCount)+" /"+q(_(X).scanCount)+" 个；发现木马文件 ",1),x("span",G,q(_($).length),1),t[4]||(t[4]=j(" 个 "))]),x("span",H,q(_(X).scanInfo.length>70?"..."+_(X).scanInfo.substring(_(X).scanInfo.length-70):_(X).scanInfo),1)])]),x("div",N,["loading"===_(L)?(b(),C(n,{key:0,type:"default",onClick:se},{default:I((()=>t[5]||(t[5]=[j(" 取消 ")]))),_:1})):k("",!0),"loading"!=_(L)?(b(),C(n,{key:1,type:"primary",onClick:t[0]||(t[0]=e=>te())},{default:I((()=>t[6]||(t[6]=[j(" 重新查杀 ")]))),_:1})):k("",!0)])]),w(l),w(h,null,{content:I((()=>[w(u,{ref_key:"safeTable",ref:Z,column:_(le),data:_($)},null,8,["column","data"])])),"footer-left":I((()=>[w(p,{"table-ref":_(Z),options:ee},null,8,["table-ref"])])),popup:I((()=>[w(f,{title:"在线编辑",showFooter:"",modelValue:_(P),"onUpdate:modelValue":t[2]||(t[2]=e=>V(P)?P.value=e:null),area:70,onConfirm:ne},{default:I((()=>[x("div",S,[w(m,{modelValue:_(Q),"onUpdate:modelValue":t[1]||(t[1]=e=>V(Q)?Q.value=e:null),class:"!h-[40rem]"},null,8,["modelValue"])])])),_:1},8,["modelValue"])])),_:1})])}}});export{Y as default};
