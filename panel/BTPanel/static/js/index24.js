import{g as a,a as e,b as t,s as l,r as s,c as n}from"./useStore3.js?v=1734676359";import{c as i,R as o,ax as p,r,w as d,o as c,k as u,l as m,q as f,e as _,p as y,L as v,y as g,x,F as k,I as w,aX as h,J as b,C,D,v as A,z as j,ar as I,A as q,ao as z,an as R,ap as T,i as L,n as E,b5 as P,aN as V,aY as M,W as O,b6 as S,aB as H,G as B,au as N,h as F,B as W}from"./base-lib.js?v=1734676359";import{u as G,G as K,a7 as U,c as $,b as J,e as X,l as Y,H as Q,ai as Z,o as aa}from"./utils-lib.js?v=1734676359";import{_ as ea}from"./index88.js?v=1734676359";import{N as ta,u as la}from"./useMethods.js?v=1734676359";import{o as sa}from"./validator.js?v=1734676359";import{s as na}from"./vue-virtual-scroller.esm.js?v=1734676359";import"./vue-virtual-scroller.js?v=1734676359";import{o as ia}from"./useController.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";const oa={class:"flex flex-1 relative items-center mb-20px"},pa={class:"text-[1.2rem] text-[#666] leading-[2rem] mx-[2rem] flex items-center"},ra={class:"w-full flex items-center"},da={class:"flex flex-1 relative flex-wrap"},ca=["onClick"],ua=X(i({__name:"index",setup(l,{expose:s}){const{refs:{deployMenuData:n}}=a(),{mainWidth:i}=G(),L=J(),E=o([]),P=o(""),V=p("appData",{loading:!1,list:[],total:0}),M=p("appParams",{p:1,row:200,query:"",force:0}),O=p("getAppList",(a=>{})),S=()=>Math.floor((i.value-420)/140),H=r(),B=async a=>{if(M.p=1,N(),"installed"===n.value.app_type)return await W("all"),void(a&&L.success("刷新成功"));M.force=a?1:0,await O(M)},N=async()=>await K({request:e(),data:[Array,E],success:a=>{H.value=a.slice(S(),a.length)}}),F=async a=>{var e,t;P.value=(null==(t=null==(e=H.value)?void 0:e.find((e=>e.type===a)))?void 0:t.desc)||"",n.value.app_type=a,M.query="",M.p=1,M.force=0,await O(M)},W=async a=>{var e,l;V.loading=!0,P.value=(null==(l=null==(e=E.value)?void 0:e.find((e=>e.type===a)))?void 0:l.desc)||"",n.value.app_type="installed",K({request:t({app_type:a,p:1,row:20,query:M.query||""}),loading:I(V,"loading"),success:a=>{a.status?(V.list=a.data.data.map(((a,e)=>({...a,index:e})))||[],a.data.page?V.total=U(a.data.page):V.total=0):L.error(a.msg)}})},X=()=>{"installed"===n.value.app_type&&W("all"),n.value.app_type="installed"};d((()=>i.value),(()=>{var a,e,t;H.value=E.value.slice(S(),null==(a=E.value)?void 0:a.length),P.value=(null==(t=null==(e=H.value)?void 0:e.find((a=>a.type===n.value.app_type)))?void 0:t.desc)||""})),c(N);const Y=r();return s({testRef:Y}),(a,e)=>{var t,l;const s=ea,i=$,o=q,p=T,r=z,d=R;return u(),m("div",{ref_key:"testRef",ref:Y},[f("div",oa,[e[11]||(e[11]=f("span",{class:"w-[80px] pr-16px text-[14px] flex justify-end flex-shrink-0"},"应用搜索",-1)),_(s,{class:"!w-[52rem]",ref:"searchRef",icon:"el-search",modelValue:y(M).query,"onUpdate:modelValue":e[0]||(e[0]=a=>y(M).query=a),clearable:"",onClear:e[1]||(e[1]=a=>B(!1)),onIconClick:e[2]||(e[2]=a=>B(!1)),placeholder:"支持应用名称、字段模糊搜索",onKeyup:e[3]||(e[3]=v((a=>B(!1)),["enter","native"]))},null,8,["modelValue"]),f("span",pa,[e[9]||(e[9]=g(" 如果您希望添加其它Docker应用，请 ")),f("span",{class:"bt-link",onClick:e[4]||(e[4]=a=>y(sa)())},"联系客服"),e[10]||(e[10]=g(" ,或进行 ")),f("span",{class:"bt-link",onClick:e[5]||(e[5]=a=>y(ta)())},"需求反馈"),_(i,{href:"https://www.bt.cn/bbs/thread-137717-1-1.html",class:"ml-4px"},{default:x((()=>e[8]||(e[8]=[g(">>使用帮助")]))),_:1})])]),f("div",ra,[e[15]||(e[15]=f("span",{class:"w-[80px] pr-16px text-[14px] flex justify-end"},"应用分类",-1)),f("div",{class:k(["class-item",{on:"all"===y(n).app_type}]),onClick:e[6]||(e[6]=a=>F("all"))},"全部",2),f("div",{class:k(["class-item flex-shrink-0",{on:"installed"===y(n).app_type}]),onClick:X},"已安装",2),f("div",da,[(u(!0),m(w,null,h(null==(t=y(E))?void 0:t.slice(0,S()),((a,e)=>(u(),m("div",{key:e,onClick:e=>F(a.type),class:k(["class-item",y(n).app_type===a.type?"on":""])},A(a.desc),11,ca)))),128)),(null==(l=y(H))?void 0:l.length)?(u(),b(d,{key:0,"show-timeout":200,onCommand:F},{dropdown:x((()=>[_(r,null,{default:x((()=>[(u(!0),m(w,null,h(y(H),((a,e)=>(u(),b(p,{key:e,command:a.type},{default:x((()=>[g(A(a.desc),1)])),_:2},1032,["command"])))),128))])),_:1})])),default:x((()=>[_(o,{type:"default",class:k(["AppClassButton",{on:y(H).some((a=>a.type===y(n).app_type))}])},{default:x((()=>[e[12]||(e[12]=g(" 更多 ")),C(f("span",null,"（"+A(y(P))+"）",513),[[D,y(P)]]),e[13]||(e[13]=f("i",{class:"svgtofont-el-arrow-down ml-[.5rem]"},null,-1))])),_:1},8,["class"])])),_:1})):j("",!0)]),C(_(o,{title:"更新列表",class:"refresh !mr-[1.2rem]",onClick:e[7]||(e[7]=a=>B(!0))},{default:x((()=>e[14]||(e[14]=[g(" 更新应用列表 ")]))),_:1},512),[[D,"installed"!==y(n).app_type]])])],512)}}}),[["__scopeId","data-v-5b455e42"]]),ma=["src"],fa={class:"AppContent"},_a={class:"w-full flex items-start justify-between"},ya={class:"flex-col flex flex-grow-0"},va={class:"AppRow"},ga=["title"],xa=["href"],ka={key:0,class:"flex items-center"},wa={key:0,class:"flex items-center"},ha={key:1},ba={class:"mx-8px"},Ca=["innerHTML","title"],Da={key:1,class:"AppDescribe"},Aa={class:"AppRow"},ja={class:"flex items-center flex-1"},Ia={class:"flex items-center"},qa={class:"truncate max-w-[24rem]"},za={key:0,class:"flex"},Ra={key:1,class:"flex flex-col"},Ta={key:0,class:"absolute bottom-14px w-[80%]"},La=X(i({__name:"index",props:{data:{default:()=>({})}},emits:["refresh"],setup(e,{emit:t}){const n=e,{refs:{deployMenuData:i}}=a(),o=J(),d=t,c=p("appData",{loading:!1,list:[],total:0}),v=p("getAppList",(a=>{})),I=p("appParams",{p:1,row:200,query:"",force:0});r(!1);const z=p("getAppImages"),R=a=>{const e="".concat("/static/img/soft_ico/dkapp","/ico-dkapp_").concat(null==a?void 0:a.replace(/-+[{0-9},\.,]+$/,""),".png");return z(e,null==a?void 0:a.replace(/-+[{0-9},\.,]+$/,""))},T=L((()=>{switch(n.data.status){case"running":return["运行中","success"];case"exited":return["已停止","danger"];case"initializing":return["安装中","info"];default:return["异常","warning"]}})),O=async({name:a,type:e})=>{i.value.app_type=e,I.query="",await v(),E((()=>{const e=c.list.find((e=>e.appname===a));e&&Y({title:"".concat(e.appname,"安装配置"),area:70,component:()=>Q((()=>import("./add-app-soft.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{appData:e,openDependInstall:O},showFooter:!0})}))},S=async()=>{Y({title:"更新配置",area:42,component:()=>Q((()=>import("./app-update.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:n.data,showFooter:!0})},H=(a,e)=>{if(e&&"initializing"!==n.data.status)return;let t=!1;"log"===a&&"initializing"===n.data.status&&(t=!0);const l={back:()=>Q((()=>import("./backup-view.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),log:()=>Q((()=>import("./app-log.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)};Y({title:"back"===a?"应用备份":"应用日志",area:"back"===a?88:82,compData:{...n.data,isInit:t},component:l[a]})},B=async a=>{await aa({title:"提示",content:"确定要".concat({rebuild:"重建",start:"启动",restart:"重启",stop:"停止"}[a],"【").concat(n.data.service_name,"】吗?"),icon:"warning-filled"}),await K({request:l({service_name:n.data.service_name,status:a,app_name:n.data.appname}),loading:"正在操作,请稍后...",message:!0}),d("refresh")},N=async()=>{await aa({title:"提示",content:"确定要删除【".concat(n.data.appname,"】吗?"),icon:"warning-filled",type:"check",check:{content:"同时删除此应用的所有数据",onConfirm:async a=>{await K({request:s({id:n.data.id,delete_data:Number(a)}),loading:"正在删除,请稍后...",message:!0}),d("refresh")}}})},F=()=>window.open("http://"+n.data.domain);return(a,e)=>{const t=P,l=V,s=q,p=M;return u(),m("div",{class:k(["AppItem relative",{"!h-[12.8rem]":!a.data.installed}])},[f("img",{src:R(a.data.appname),onError:e[0]||(e[0]=a=>{a.target.src.includes("icon_plug")?a.target.style.display="none":a.target.src="/static/img/soft_ico/icon_plug.svg"}),class:"AppImg"},null,40,ma),f("div",fa,[f("div",_a,[f("div",ya,[f("div",va,[f("span",{class:k(["text-[1.6rem] font-600",{"truncate leading-[22px] !font-normal flex-1 max-w-[fit-content]":a.data.installed}]),title:a.data.installed?a.data.service_name:a.data.apptitle},[g(A(a.data.installed?a.data.service_name:a.data.apptitle)+" ",1),a.data.installedCount?(u(),m("span",{key:0,class:"mx-8px bt-link text-[1.2rem] font-normal",onClick:e[1]||(e[1]=a=>y(i).app_type="installed")},"已安装 ("+A(a.data.installedCount)+")",1)):j("",!0),a.data.help?(u(),m("a",{key:1,href:a.data.help,target:"_blank",class:"ml-8px bt-link text-[1.2rem] font-normal"}," >>帮助",8,xa)):j("",!0)],10,ga),a.data.installed?(u(),m("div",ka,[_(t,{type:y(T)[1],class:k(["mx-[0.8rem]",{"cursor-pointer":"initializing"===a.data.status}]),onClick:e[2]||(e[2]=a=>H("log",!0))},{default:x((()=>["initializing"===a.data.status?(u(),m("span",wa,e[13]||(e[13]=[g("正在安装 "),f("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin"},null,-1)]))):(u(),m("span",ha,A(y(T)[0]),1))])),_:1},8,["type","class"]),_(l,{class:"item",effect:"dark",content:"进入安装目录",placement:"top"},{default:x((()=>[f("i",{class:"svgtofont-folder-open mr-[0.4rem]",onClick:e[3]||(e[3]=a=>(async()=>{var a;{const{router:e}=await Q((()=>import("./utils-lib.js?v=1734676359").then((a=>a.dH))),__vite__mapDeps([]),import.meta.url),t=null==(a=n.data.appinfo.filter((a=>"app_path"===a.fieldKey))[0])?void 0:a.fieldValue;Z("Path",t);let l=o.load("正在跳转,请稍后...");e.push({path:"/files"}),l.close()}})())})])),_:1}),_(l,{class:"item",effect:"dark",content:"打开日志",placement:"top"},{default:x((()=>[f("i",{class:"svgtofont-left-logs",onClick:e[4]||(e[4]=a=>H("log"))})])),_:1}),f("span",ba,"已安装:"+A(a.data.createat),1)])):j("",!0)]),f("div",null,[a.data.installed?j("",!0):(u(),m("span",{key:0,innerHTML:a.data.appdesc,title:a.data.appdesc,class:"AppNoSetDes"},null,8,Ca)),a.data.installed?(u(),m("div",Da,[f("div",Aa,[_(t,{type:"info",class:"mr-[0.8rem]",effect:"plain"},{default:x((()=>[g("版本:"+A(a.data.m_version+(a.data.s_version?".":"")+a.data.s_version),1)])),_:1}),(u(!0),m(w,null,h(a.data.port,((a,e)=>C((u(),b(t,{type:"info",class:"mr-[0.8rem]",effect:"plain",key:a},{default:x((()=>[g("端口:"+A(a),1)])),_:2},1024)),[[D,e<2]]))),128)),_(l,{placement:"top"},{content:x((()=>[f("div",null,[(u(!0),m(w,null,h(a.data.port,((e,t)=>{var l;return C((u(),m("span",{key:t},[g(A(e)+" ",1),C(f("span",null,",",512),[[D,t!==(null==(l=a.data.port)?void 0:l.length)-1]])])),[[D,t>1]])})),128))])])),default:x((()=>{var e;return[(null==(e=a.data.port)?void 0:e.length)>=3?(u(),b(t,{key:0,type:"info"},{default:x((()=>{var e;return[g(" +"+A((null==(e=a.data.port)?void 0:e.length)-2),1)]})),_:1})):j("",!0)]})),_:1})]),f("div",ja,[a.data.domain?(u(),b(t,{key:0,type:"info",class:"mr-[0.8rem] cursor-pointer",effect:"plain",onClick:F},{default:x((()=>[f("div",Ia,[e[14]||(e[14]=f("i",{class:"svgtofont-icon-max-black mr-[0.4rem] !text-[1.4rem]"},null,-1)),_(l,{effect:"dark",content:"点击跳转域名:"+a.data.domain,placement:"top-start"},{default:x((()=>[f("span",qa,"域名:"+A(a.data.domain),1)])),_:1},8,["content"])])])),_:1})):j("",!0),a.data.domain?(u(),m("span",{key:1,class:"bt-link",onClick:e[5]||(e[5]=e=>(async a=>{ia({id:a.site_id,name:a.site_name,addtime:a.site_addtime})})(a.data))}," >管理网站")):j("",!0)])])):j("",!0)])]),a.data.installed?(u(),m("div",za,[(r=a.data,r.canUpdate&&r.installed?(u(),b(s,{key:0,size:"small",onClick:S},{default:x((()=>e[15]||(e[15]=[g("更新")]))),_:1})):j("",!0)),_(s,{size:"small",onClick:e[6]||(e[6]=a=>H("back"))},{default:x((()=>e[16]||(e[16]=[g("备份")]))),_:1})])):j("",!0),a.data.installed?j("",!0):(u(),m("div",Ra,[a.data.installed?j("",!0):(u(),b(s,{key:0,type:"primary",onClick:e[7]||(e[7]=e=>(async a=>{Y({title:"".concat(a.appname,"安装配置"),area:70,component:()=>Q((()=>import("./add-app-soft.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{appData:n.data,openDependInstall:O},showFooter:!0})})(a.data))},{default:x((()=>e[17]||(e[17]=[g("安装")]))),_:1}))]))]),a.data.installed?(u(),m("div",Ta,[_(p,{class:"!my-[0.8rem] w-full"}),"exited"===a.data.status?(u(),b(s,{key:0,size:"small",onClick:e[8]||(e[8]=a=>B("start"))},{default:x((()=>e[18]||(e[18]=[g("启动 ")]))),_:1})):j("",!0),"exited"!==a.data.status?(u(),b(s,{key:1,size:"small",onClick:e[9]||(e[9]=a=>B("stop"))},{default:x((()=>e[19]||(e[19]=[g("停止 ")]))),_:1})):j("",!0),_(s,{size:"small",onClick:e[10]||(e[10]=a=>B("restart"))},{default:x((()=>e[20]||(e[20]=[g("重启 ")]))),_:1}),_(s,{size:"small",onClick:e[11]||(e[11]=e=>{return t=a.data,void Y({title:"详情展示",area:64,component:()=>Q((()=>import("./detail-view.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:t,btns:!1});var t})},{default:x((()=>e[21]||(e[21]=[g("详情 ")]))),_:1}),_(s,{type:"default",plain:"",size:"small",class:"danger-button",onClick:e[12]||(e[12]=a=>B("rebuild"))},{default:x((()=>e[22]||(e[22]=[g("重建 ")]))),_:1}),_(s,{type:"default",plain:"",size:"small",class:"danger-button",onClick:N},{default:x((()=>e[23]||(e[23]=[g("卸载")]))),_:1})])):j("",!0),a.data.installed?j("",!0):(u(),b(t,{key:1,type:"info",class:"absolute bottom-6"},{default:x((()=>[g(A(a.data.appTypeCN),1)])),_:1}))])],2);var r}}}),[["__scopeId","data-v-48ab0081"]]),Ea={class:"w-full !h-[4rem] p-2rem inline-block flex justify-center items-center text-[1.2rem]"},Pa=X(i({__name:"index",setup(e){const{mainHeight:l,mainWidth:s}=G(),{refs:{deployMenuData:n,isRefreshAppList:i,isRefreshInstallList:o}}=a(),v=J(),k=r(null),w=r(!1),h=r(!1);let A=null;const{getCachedImage:I}=la();O("getAppImages",I);const q=p("appData",{loading:!1,list:[],total:0}),z=p("appParams",{p:1,row:20,query:"",force:0}),R=p("getAppList",(a=>{})),T=L((()=>s.value<1125?1:s.value<1632?2:3)),E=L((()=>(s.value-35)/T.value));S(k,(()=>{P()}),{distance:15});const P=async()=>{w.value||(w.value=!0,h.value=!0,q.list.length<q.total&&(z.p++,"installed"===n.value.app_type?await V("all"):await R(z)),w.value=!1)},V=async(a,e)=>{try{e||(q.loading=!0),n.value.app_type="installed",await K({request:t({app_type:a||"all",p:1,row:20,query:z.query||""}),success:a=>{a.status?(q.list=a.data.data.map(((a,e)=>({...a,index:e})))||[],a.data.page?q.total=U(a.data.page):q.total=0):v.error(a.msg)}})}catch(l){}finally{q.loading=!1}},F=()=>{q.list.some((a=>"initializing"===a.status))&&(A=setTimeout((()=>{V("all",!0),F()}),3e4))};return d((()=>n.value.app_type),(async a=>{k.value.scrollTop=0,h.value=!1,"installed"===a?(clearTimeout(A),await V("all"),F()):clearTimeout(A)})),d((()=>i.value),(a=>{a&&(R(z),i.value=!1)})),d((()=>o.value),(a=>{a&&(clearTimeout(A),V("all"),o.value=!1)})),c((()=>{"installed"===n.value.app_type?o.value=!0:i.value=!0})),H((()=>{clearTimeout(A)})),(a,e)=>{const t=$,s=M,i=N;return u(),m("div",{ref_key:"scrollContainerRef",ref:k,style:B("height:".concat(y(l)-240,"px")),class:"overflow-hidden relative scrollBox"},[C(_(y(na),{class:"AppList",style:B("height:".concat(y(l)-280,"px;width: calc(20px + ").concat(y(E),"px * ").concat(y(T),");")),items:y(q).list,"item-size":"installed"===y(n).app_type?175:145,itemSecondarySize:y(E),gridItems:y(T),buffer:100,"key-field":"index",itemClass:"app-item",onScrollEnd:P},{default:x((({item:a})=>[_(La,{data:a,onRefresh:V},null,8,["data"])])),after:x((()=>[y(h)&&y(q).list.length&&"installed"!==y(n).app_type?(u(),b(s,{key:0},{default:x((()=>[f("span",Ea,[e[2]||(e[2]=g("没有更多了,如没有想要的应用可")),_(t,{onClick:y(ta)},{default:x((()=>e[1]||(e[1]=[g("提交需求反馈")]))),_:1},8,["onClick"])])])),_:1})):j("",!0)])),_:1},8,["style","items","item-size","itemSecondarySize","gridItems"]),[[D,y(q).list.length]]),y(q).list.length?j("",!0):(u(),b(i,{key:0,class:"w-full"},{description:x((()=>[f("span",null,[e[3]||(e[3]=g("未查询到搜索内容,")),f("span",{class:"inline-flex bt-link",onClick:e[0]||(e[0]=(...a)=>y(ta)&&y(ta)(...a))},"提交需求反馈")])])),_:1}))],4)}}}),[["__scopeId","data-v-9650efa5"]]),Va={class:"w-full"},Ma={class:"px-[1.6rem] pt-[1.6rem]"},Oa=X(i({__name:"index",setup(e){const{refs:{deployMenuData:t}}=a(),l=J(),s=r(null),i=F({loading:!1,list:[],total:0}),o=F({p:1,row:200,query:"",force:0});return O("getAppList",(async(a={query:o.query,p:o.p,row:o.row,force:0})=>{K({request:n({...a,app_type:t.value.app_type}),loading:I(i,"loading"),success:e=>{e.status?(1===a.force&&l.success("刷新成功"),i.list=e.data.data.map(((a,e)=>({...a,index:e}))),i.total=U(e.data.page),t.value.maximum_cpu=e.data.maximum_cpu,t.value.maximum_memory=e.data.maximum_memory+" MB"):l.error(e.msg)}})})),O("appData",i),O("appParams",o),(a,e)=>{const t=W("bt-loading");return u(),m("div",Va,[f("div",Ma,[_(ua,{ref_key:"TopToolsRef",ref:s,class:"mb-8px"},null,512)]),C(_(Pa,null,null,512),[[t,y(i).loading],[t,"正在加载列表，请稍后...","title"]])])}}}),[["__scopeId","data-v-7438ea5e"]]);export{Oa as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
