import{G as e,M as a,J as t,bU as s,bV as n,o as l,bX as r,an as o,ao as i,D as u,bR as c,bS as d,l as m,j as p,ah as v,_ as g,e as h,u as y,O as _,b as f,x as w,a4 as b,X as x,aj as E,H as k,bY as V,v as R,aa as C}from"./utils-lib.js?v=1734676359";import{s as P,g as D,r as q,c as L,e as T,y as I,az as j,k as S,l as z,q as U,x as O,p as H,M as F,v as A,C as B,D as N,i as M,aw as J,A as K,ah as W,ag as X,o as G,a1 as Y,a5 as Q,aY as Z,aj as $,t as ee,B as ae,I as te,aX as se,J as ne,N as le,z as re,j as oe,F as ie,h as ue,W as ce,a7 as de,Q as me,a4 as pe,w as ve}from"./base-lib.js?v=1734676359";import{n as ge,k as he,D as ye}from"./useController.js?v=1734676359";import{_ as _e}from"./index90.js?v=1734676359";import{B as fe}from"./index353.js?v=1734676359";import{h as we,F as be,i as xe,j as Ee}from"./form-item.js?v=1734676359";import{au as ke,av as Ve,aw as Re,ax as Ce,ay as Pe,az as De,aA as qe,aB as Le,aC as Te,aD as Ie,aE as je,aF as Se,aG as ze,aH as Ue,aI as Oe,aJ as He,aK as Fe,aL as Ae,aM as Be,aN as Ne,aO as Me,aP as Je,aQ as Ke,aR as We,aS as Xe,aT as Ge,aU as Ye,aV as Qe,aW as Ze,aX as $e,aY as ea,aZ as aa,a_ as ta,a$ as sa,b0 as na,b1 as la,b2 as ra,b3 as oa,b4 as ia,b5 as ua}from"./useStore3.js?v=1734676359";import{f as ca}from"./validator.js?v=1734676359";import{B as da}from"./index185.js?v=1734676359";import{S as ma}from"./useStore7.js?v=1734676359";import{c as pa,a as va,b as ga,u as ha}from"./column.js?v=1734676359";import{saveFileBody as ya,getRedirectList as _a}from"./site.js?v=1734676359";import{_ as fa}from"./index101.js?v=1734676359";const wa=D("DOCKERSITE-DOMAIN-STORE",(()=>{const s=q();return{isRefreshDomain:q(!1),port:s,delMultDomainEvent:async e=>{const t=a.load("正在删除域名，请稍后...");try{const{data:a}=await Ce(e);let t=a.success.map((e=>({name:e,status:!0})));const s=Object.entries(a.error).map((([e,a])=>({name:e,msg:a,status:!1})));return t=t.concat(s),{data:t,status:!0}}catch(s){return{status:!1,msg:"删除域名失败"}}finally{t.close()}},getDomainListEvent:async a=>{try{return{data:(await e({request:ke(a)})).data,status:!0}}catch(t){return{status:!1,msg:"获取域名信息失败"}}},addDomainEvent:async a=>{try{const t=await e({loading:"正在添加域名，请稍后...",request:Re(a)});return{status:t.status,msg:t.msg,data:t.data}}catch(t){return{status:!1,msg:"添加域名失败"}}},setPortEvent:async a=>{try{return{...await e({loading:"正在设置HTTPS端口，请稍候...",request:Ve(a),message:!0})}}catch(t){return{status:!1,msg:"设置https端口失败"}}},delDomainEvent:async e=>{var s;let n=a.load("正在删除域名，请稍后...");try{const a=await Ce(e),n=(null==(s=a.data)?void 0:s.hasOwnProperty("status"))?a.data:a;return t(n.data)?{status:n.status,msg:n.data[0].msg}:{status:n.status,msg:(null==n?void 0:n.data)||(null==n?void 0:n.error_msg)||n.msg}}catch(l){return{status:!1,msg:"删除域名失败"}}finally{n.close()}}}})),ba=()=>P(wa()),{siteInfo:xa}=ge(),{port:Ea,isRefreshDomain:ka}=ba(),{getDomainListEvent:Va,setPortEvent:Ra,addDomainEvent:Ca,delDomainEvent:Pa,delMultDomainEvent:Da}=wa(),qa=q(!1),La=q(""),Ta=async()=>{var e,t;try{const s=La.value,n=["21","25","443","888","8888","8443"];if(""===s)return a.error("域名不能为空"),!1;let l=String(s.match(/:(\d+)/g)).replace(/:/g,"");if(n.includes(l))return a.error("端口不能为常用端口21、25、443、888、8888、8443"),!1;if(!(await ja()))return!1;const r=(e=>{const{name:a,id:t}=xa.value;return{id:t,site_name:a,domains:e}})(s),o=await Ca(r);return o.status&&he({title:"域名添加结果",resultData:(null==(e=null==o?void 0:o.data)?void 0:e.domains)||(null==(t=null==o?void 0:o.data)?void 0:t.data)||[],autoTitle:"添加域名完成"}),ka.value=!0,La.value="",o.status}catch(s){}},Ia=async()=>{try{const e=(()=>{const e=xa.value;return{site_name:e.name,id:e.id}})(),a=await Va(e);return Ea.value=Number(a.data.https_port)||"未开启",{data:a.data.domain_list,total:a.data.domain_list.length,other:{port:a.data.https_port}}}catch(e){return{data:[],total:0,other:{}}}},ja=async(e=La.value)=>{let t=e.trim().replace(" ","").split("\n");const l=t.findIndex((e=>e.split(":")[0].length<3));for(var r=0;r<t.length;r++){var o=t[r];let e=o.includes(":");if(e&&!s(o))return a.error("第"+(r+1)+"行【"+o+"】域名格式错误"),!1;if(!e&&!n(o))return a.error("第"+(r+1)+"行【"+o+"】域名格式错误"),!1}return-1!==l?(a.error("第 ".concat(l+1," 个域名长度不符合要求（必须大于3个字符）")),!1):t},Sa=async e=>{try{const a=await Ra({site_name:xa.value.name,https_port:e.value.port});(null==a?void 0:a.status)&&(Ea.value=Number(e.value.port))}catch(a){}},za=async e=>{try{await l({icon:"warning-filled",title:"删除【".concat(e.name,"】"),content:"删除".concat(e.name,"后，将无法使用该域名访问网站，是否继续操作？")});const t=(e=>{const{id:a,name:t}=xa.value;return{id:a,site_name:t,domain:e.name,port:e.port}})(e),s=await Pa(t);return a.request(s),ka.value=!0,s}catch(t){}},Ua=async e=>{try{await l({icon:"warning-filled",title:"批量删除",content:"同时删除选中的域名，是否继续？",type:"calc"});let a=[];const t=(e=>{const{name:a}=xa.value,t=e.map((e=>({id:e.id,port:e.port,domain:e.name,site_name:a})));return{del_domain_list:JSON.stringify(t)}})(e);return a=(await Da(t)).data,await he({resultData:a,autoTitle:"删除域名完成"}),ka.value=!0,{status:!0,msg:"删除域名成功"}}catch(a){return{status:!1,msg:"删除域名失败"}}},Oa=async()=>{try{return await Ia()}catch(e){return{data:[],total:0,other:{}}}},Ha={class:""},Fa={class:"flex items-end mb-[12px]"},Aa=L({__name:"index",setup(e){const{isRefreshDomain:a,port:t}=ba(),s=i([{label:"删除",value:"delete",event:async(e,a,t,s)=>{Ua(t.value)}}]),{BtTable:n,BtBatch:l,config:v}=r({request:Oa,columns:[{type:"selection",width:40},{label:"域名",prop:"name",width:400,render:e=>T("div",{class:"truncate"},[T("a",{class:"bt-link",href:"http://".concat(e.name,":").concat(e.port),target:"_blank"},[e.name])])},{label:"端口",prop:"port"},{label:"操作",align:"right",render:e=>1===v.data.length?T("span",null,[I("不可操作")]):j("span",{class:"cursor-pointer bt-link",onClick:()=>{za(e)}},"删除")}],extension:[s,o(a)]}),g=()=>{const{BtForm:e,submit:a}=u({data:{port:t.value},options:e=>M((()=>[we("HTTPS端口",(()=>T(fe,{modelValue:e.value.port,"onUpdate:modelValue":a=>e.value.port=a},null)),"port",{attrs:{min:1,max:65535},rules:[c({message:"请输入端口号",trigger:"blur"}),d()]})])),submit:Sa});m({title:"更换端口",area:42,showFooter:!0,component:()=>T(e,{class:"p-2rem"},null),onConfirm:a})};return(e,a)=>{const s=p,r=J,o=K,i=_e;return S(),z("div",Ha,[U("div",Fa,[T(r,{ref:"popover",placement:"top-start",width:"41rem","popper-class":"green-tips-popover !p-0 !border-none",visible:H(qa),"onUpdate:visible":a[2]||(a[2]=e=>F(qa)?qa.value=e:null),"trigger-keys":[],trigger:"focus"},{default:O((()=>a[3]||(a[3]=[U("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[I(" 如需绑定外网，请换行填写，每行一个域名，默认为80端口 "),U("br"),I(" IP地址格式：192.168.1.199 "),U("br"),I(" 泛解析添加方法 *.domain.com "),U("br"),I(" 如另加端口格式为 www.domain.com:88 ")],-1)]))),reference:O((()=>[T(s,{modelValue:H(La),"onUpdate:modelValue":a[0]||(a[0]=e=>F(La)?La.value=e:null),type:"textarea",resize:"none",rows:4,width:"42rem",onFocus:a[1]||(a[1]=e=>qa.value=!0),placeholder:"如需绑定外网，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])])),_:1},8,["visible"]),T(o,{type:"primary",class:"absolute",style:{right:"4rem",top:"5rem"},onClick:H(Ta)},{default:O((()=>a[4]||(a[4]=[I("添加")]))),_:1},8,["onClick"])]),T(i,null,{"header-right":O((()=>[U("div",null,[I(" HTTPS端口："+A(H(t))+" ",1),B(U("span",{class:"bt-link cursor-pointer",onClick:g},"更换",512),[[N,"number"==typeof H(t)]])])])),content:O((()=>[T(H(n),{"max-height":440})])),"footer-left":O((()=>[T(H(l))])),_:1}),a[5]||(a[5]=U("ul",{class:"mt-[.8rem] leading-8 text-[1.2rem] list-disc ml-2rem"},[U("li",null,"建议所有域名都使用默认的80端口")],-1))])}}}),Ba=D("DOCKER-SITE-SITE-DIR-STORE",(()=>{const{siteInfo:t}=ge(),s=q([]),n=q({path:"",run_path:"",userini:!1});return{dirOptions:s,resetData:()=>{s.value=[],n.value.path="",n.value.run_path=""},getFormData:()=>n,getDir:async()=>{try{const a={id:t.value.id},s=await e({loading:"正在获取版本，请稍后...",request:Pe(a)});s.status?n.value.path=s.data.path:v(s)}catch(a){v(a)}},formData:n,saveDirPath:async(s,n)=>{if(!s)return void a.error("请选择目录");const l={site_name:t.value.name,id:t.value.id,..."path"===n?{path:s}:{run_path:s}};e({loading:"正在获取版本，请稍后...",message:!0,request:"path"===n?qe(l):Le(l)})},setDirUser:async a=>{const s={id:t.value.id,status:a?1:0};e({loading:"正在设置，请稍后...",message:!0,request:Te(s)})},getUserini:async()=>{try{const a={id:t.value.id},l=await e({loading:"正在获取版本，请稍后...",request:De(a)});l.status?(n.value.userini=l.data.userini,n.value.run_path=l.data.runPath.runPath,s.value=l.data.runPath.dirs.map((e=>({label:e,value:e})))):v(l)}catch(a){v(a)}}}})),Na={class:"p-[2rem] overflow-auto"};const Ma=h(L({__name:"index",setup(e,{expose:a}){const t=Ba(),{dirOptions:s,formData:n}=P(t),{getDir:l,resetData:r,saveDirPath:o,setDirUser:i,getUserini:c}=t,{BtForm:d}=u({data:()=>n.value,options:e=>M((()=>[we("网站目录",(()=>T("div",null,[T("div",{class:"formItem"},[T(p,{modelValue:e.value.path,"onUpdate:modelValue":a=>e.value.path=a,width:"32rem"},{append:()=>T(K,{onClick:()=>(e=>{ca({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(a,t)=>{e.value.path=a}})})(e)},{default:()=>[T(g,{icon:"icon-file_mode",class:"cursor-pointer"},null)]})}),T(K,{type:"primary",class:"!ml-[1.2rem]",onClick:()=>o(e.value.path,"path")},{default:()=>[I("保存")]})]),T("span",{class:"formTips"},[I("当前网站的部署目录，可以选择其他目录")])])),"path",{rules:[{required:!1,trigger:"change",message:"请选择网站目录"}]}),we("运行目录",(()=>{let a;return T("div",null,[T("div",{class:"formItem"},[T(W,{class:"!w-[32rem]",modelValue:e.value.run_path,"onUpdate:modelValue":a=>e.value.run_path=a},(t=a=s.value.map((e=>T(X,{key:e.value,label:e.label,value:e.value},null))),"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!Q(t)?a:{default:()=>[a]})),T(K,{type:"primary",class:"!ml-[1.2rem]",onClick:()=>o(e.value.run_path,"run_path")},{default:()=>[I("保存")]})]),T("span",{class:"formTips"},[I("部分程序需要指定二级目录作为运行目录，如ThinkPHP5,Laravel")])]);var t}),"run_path",{rules:[{required:!1,trigger:"change",message:"请选择网站运行目录"}]}),be((()=>T("div",null,[T(Z,null,null),T("div",{class:"formItem"},[T("span",{class:"formLabel"},[I("防跨站攻击")]),T($,{class:"mr-[12px]",modelValue:e.value.userini,"onUpdate:modelValue":a=>e.value.userini=a,onChange:i},null),T("span",{class:"text-[#999]"},[I("防跨站攻击(open_basedir)，防止黑客通过其他网站目录进行入侵攻击")])])])),{key:"userini",rules:[]})]))});return G((()=>{l(),c()})),Y((()=>{r()})),a({init:()=>{l(),c()}}),(e,a)=>(S(),z("div",Na,[T(H(d))]))}}),[["__scopeId","data-v-ee825c1d"]]),Ja=D("SITE-PSEUDO-STORE",(()=>({delPseudoStaticEvent:async a=>{try{await e({loading:"正在删除伪静态规则，请稍候...",request:Ie(a),message:!0})}catch(t){return{status:!1,msg:"删除失败"}}},getReWriteListEvent:async a=>{try{const{data:t}=await e({request:je(a)});return{data:t,status:status}}catch(t){return{status:!1,msg:"获取伪静态列表失败"}}},setTemplateEvent:async a=>{try{const t=await e({loading:"正在设置模板，请稍候...",request:Se(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"设置模板失败"}}}}))),{siteInfo:Ka}=ge(),{getFileEvent:Wa}=ma(),{plugin:Xa,getGlobalInfo:Ga}=y(),{webserver:Ya}=ee(Xa.value),{delPseudoStaticEvent:Qa,getReWriteListEvent:Za,setTemplateEvent:$a}=Ja(),et=q(""),at=q([]),tt=q(""),st=q([]),nt=q(!1),lt=q(""),rt=q(!1),ot=[{content:"请选择您的应用，若设置伪静态后，网站无法正常访问，请尝试设置回default"},{content:"您可以对伪静态规则进行修改，修改完后保存即可。"}],it=e=>!at.value.includes(e),ut=async e=>{await l({title:"删除伪静态模板【".concat(e.name,"】"),content:"删除后不可恢复，确定删除吗？",icon:"warning-filled"});(await Qa(e)).status&&(await ct(),await mt())},ct=async()=>{const e={siteName:Ka.value.name};rt.value=!0;const a=await Za(e);dt(a.data),rt.value=!1},dt=async e=>{st.value=e.rewrite,at.value=e.default_list,lt.value=e.sitePath+"/.htaccess",tt.value=e.rewrite[0]||""},mt=async(e={site_name:Ka.value.name})=>{try{rt.value=!0;const a=e.path?await Wa(e):await ze(e);return et.value=a.data.data,rt.value=!1,a}catch(a){return rt.value=!1,{data:"获取伪静态内容失败"}}},pt=e=>{let a="/www/server/panel/rewrite/".concat(Ya.value,"/").concat(e,".conf");mt({path:"0.当前"===e?"":a})},vt=async(e={rewrite_conf:et.value,site_name:"".concat(Ka.value.name)})=>{const t=await Ue(e);a.request(t),t.status&&ct()},gt=async()=>{await Ga(),await ct(),await mt()},ht={class:"h-full"},yt={class:"flex items-center justify-between"},_t={class:"flex items-center justify-between"},ft=["onClick"],wt={class:"my-[12px]"},bt=L({__name:"index",setup(e){const t=()=>{const{BtForm:e,submit:t}=u({options:()=>M((()=>[{type:"input",label:"模板名称",key:"name",attrs:{placeholder:"请输入模板名称"},rules:[{required:!0,message:"请输入模板名称",trigger:"blur"}]}])),submit:async(e,t)=>(await t(),await(async e=>{try{const t={...e,data:et.value};if(t.name=t.name.trim(),t.name.includes(" "))return a.error("模板名称不能包含空格");if(""===t.name)return a.error("模板名称不能为空");if(st.value.includes(t.name))return a.error("模板名称不能和已有的模板名称重复且不可为空");const s=await $a(t);return s.status&&(nt.value=!1,await ct(),await mt()),s.status}catch(t){return!1}})(e.value))});m({title:"另存为模板",area:42,showFooter:!0,component:()=>T(e,{class:"p-2rem"},null),onConfirm:t})};return G(gt),(e,a)=>{const s=X,n=W,l=da,r=K,o=_,i=ae("bt-loading");return S(),z("div",ht,[B((S(),z("div",null,[U("div",yt,[T(n,{class:"!w-[15rem]",modelValue:H(tt),"onUpdate:modelValue":a[0]||(a[0]=e=>F(tt)?tt.value=e:null),onChange:H(pt)},{default:O((()=>[(S(!0),z(te,null,se(H(st),((e,a)=>(S(),ne(s,{key:a,value:e},{default:O((()=>[U("div",_t,[U("span",null,A(e),1),H(it)(e)?(S(),z("span",{key:0,class:"el-icon-close cursor-pointer text-[1.4rem] ml-1rem",onClick:le((a=>H(ut)({name:e})),["stop"])},null,8,ft)):re("",!0)])])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue","onChange"]),a[3]||(a[3]=U("span",{class:"flex items-center"},[I("规则转换工具： "),U("a",{class:"bt-link",href:"https://www.bt.cn/Tools"},[I("Apache转Nginx "),U("i",{class:"svgtofont-el-link"})])],-1))]),U("div",wt,[T(l,{id:"staticContentRef",request:!1,class:"!h-[40rem] !w-full border border-[#DCDFE6] rounded-[4px]",modelValue:H(et),"onUpdate:modelValue":a[1]||(a[1]=e=>F(et)?et.value=e:null),onSave:H(vt)},null,8,["modelValue","onSave"])]),U("div",null,[T(r,{type:"primary",onClick:a[2]||(a[2]=e=>H(vt)())},{default:O((()=>a[4]||(a[4]=[I("保存")]))),_:1}),T(r,{onClick:t},{default:O((()=>a[5]||(a[5]=[I("另存为模板")]))),_:1})]),T(o,{options:H(ot),class:"ml-[20px] mt-[20px]"},null,8,["options"])])),[[i,H(rt)],[i,"正在加载内容，请稍候...","title"]])])}}}),xt=f(),{siteInfo:Et}=ge(),kt=q("master"),Vt=q("server_block"),Rt=[{label:"server块",value:"server_block"},{label:"HTTP块",value:"http_block"}],Ct=[{content:"主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作"}],Pt=[{content:"保存前请检查输入的配置文件是否正确，错误的配置可能会导致网站访问异常"},{content:"如果您对此配置不熟悉，请勿添加自定义配置"},{isHtml:!0,content:'server块的nginx官方配置文档：<a class="text-primary cursor-pointer" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#server" target="_blank" >点击跳转</a>'}],Dt=[{content:"保存前请检查输入的配置文件是否正确，错误的配置可能会导致网站访问异常"},{content:"如果您对此配置不熟悉，请勿添加自定义配置"},{isHtml:!0,content:'http块的nginx官方配置文档：<a class="text-primary cursor-pointer" href="https://nginx.org/en/docs/http/ngx_http_core_module.html#http" target="_blank" >点击跳转</a>'}],qt=q(Pt),Lt=q(""),Tt=q(!1),It=async()=>{try{Tt.value=!0;const{data:e}=await Oe({site_name:Et.value.name});return e.status?"master"===kt.value?Lt.value=e.data.site_conf:(Lt.value=e.data[Vt.value],qt.value="server_block"===Vt.value?Pt:Dt):xt.error(e.msg),{data:Lt.value}}catch(e){return{data:""}}finally{Tt.value=!1}};oe((()=>{xt.error("主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作")}),3e3);const jt=async()=>{if("master"===kt.value)return{status:!1,msg:"主配置文件不允许修改，如需自定义配置请到上方自定义配置文件中操作"};let e=xt.load("正在保存内容，请稍候...");try{const e=await He({site_name:Et.value.name,conf_type:Vt.value,body:Lt.value});return xt.msg({dangerouslyUseHTMLString:!0,message:e.msg,type:e.status?"success":"error",duration:e.status?2e3:0,showClose:!e.status}),e}catch(a){return v(a),{status:!1,msg:"保存文件失败"}}finally{e.close()}},St={class:"h-full"},zt={key:0,class:"mb-1rem text-[#666] flex items-center"},Ut={class:"mt-1rem"},Ot={key:0,class:"ml-[20px] mt-[2rem]"},Ht=L({__name:"files",props:{type:{}},setup(e){const a=e;return(e,t)=>{const s=b,n=_,l=da,r=K,o=ae("bt-loading");return S(),z("div",St,[U("div",null,["master"!==H(kt)?(S(),z("div",zt,[t[4]||(t[4]=U("span",null,"选择配置块：",-1)),T(s,{class:"!w-[16rem]",modelValue:H(Vt),"onUpdate:modelValue":t[0]||(t[0]=e=>F(Vt)?Vt.value=e:null),options:H(Rt),onChange:t[1]||(t[1]=e=>H(It)())},null,8,["modelValue","options"])])):re("",!0),B(T(n,{options:H(Ct),"list-style":"none",class:"ml-[12px] text-[1.2rem] mb-1rem"},null,8,["options"]),[[N,"master"===H(kt)]]),B(T(l,{class:ie(["!w-[64rem] border border-[#DCDFE6] rounded-[4px]","master"===a.type?"!h-[50rem]":"!h-[34rem]"]),modelValue:H(Lt),"onUpdate:modelValue":t[2]||(t[2]=e=>F(Lt)?Lt.value=e:null),id:1e3*Math.random(),editorOption:{readOnly:"master"===H(kt),mode:"ace/mode/nginx"},request:{get:H(It),set:H(jt)}},null,8,["modelValue","class","id","editorOption","request"]),[[o,H(Tt)]]),U("div",Ut,["master"!==H(kt)?(S(),ne(r,{key:0,type:"primary",onClick:H(jt)},{default:O((()=>t[5]||(t[5]=[I("保存")]))),_:1},8,["onClick"])):re("",!0),T(r,{type:"default",onClick:t[3]||(t[3]=e=>H(w)({value:H(Lt)}))},{default:O((()=>t[6]||(t[6]=[I("复制")]))),_:1})])]),"master"!==H(kt)?(S(),z("div",Ot,[T(n,{options:H(qt)},null,8,["options"])])):re("",!0)])}}}),Ft=h(L({__name:"index",setup(e,{expose:a}){const t=ue({site_conf:"",http_block:"",server_block:""});ce("configList",t),ce("tabActive",kt);const{BtTabs:s}=x({type:"card",value:kt,options:[{label:"主配置文件",name:"master",render:()=>T(Ht,{type:"master"},null)},{label:"自定义配置文件",name:"custom",lazy:!0,render:()=>T(Ht,{type:"custom"},null)}]});return a({init:It}),(e,a)=>(S(),z("div",null,[T(H(s),{onChange:H(It)},null,8,["onChange"])]))}}),[["__scopeId","data-v-a15321c0"]]),At=D("DOCKERSITE-REDIRECT-STORE",(()=>({changeStatusEvent:async a=>{try{const t=await e({loading:"正在修改，请稍后...",request:Fe(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"修改状态失败"}}},delRedirectEvent:async a=>{try{const t=await e({loading:"正在删除，请稍后...",request:Ae(a),message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"删除重定向失败"}}},getRedirectFileEvent:async a=>{try{return{data:{content:(await e({loading:"正在获取内容，请稍候...",request:Be(a)})).data.data,redirect_conf_file:a.path},status:!0}}catch(t){return{status:!1,msg:"获取配置文件失败"}}},getRedirectDataEvent:async a=>{try{const t=await e({request:_a(a,"proxy"),data:Array});return{data:t,total:t.length,other:{}}}catch(t){return{data:[],total:0,other:{}}}},submitRedirectEvent:async(a,t)=>{try{const s=await e({loading:"正在提交，请稍后...",request:t?Fe(a):Ne(a),message:!0});return{status:s.status,msg:s.msg}}catch(s){return{status:!1,msg:"添加重定向失败"}}},isRefreshList:q(!1),saveFileEvent:async a=>{try{const t=await e({loading:"正在保存内容，请稍候...",request:ya(a),data:{status:Boolean,msg:String},message:!0});return{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"保存文件失败"}}},getDomainListEvent:async a=>{try{return{data:(await e({request:ke(a)})).data,status:!0}}catch(t){return{status:!1,msg:"获取域名信息失败"}}}}))),Bt=()=>P(At()),{siteInfo:Nt}=ge(),{isRefreshList:Mt}=Bt(),{getDomainListEvent:Jt,changeStatusEvent:Kt,delRedirectEvent:Wt,getRedirectDataEvent:Xt,getRedirectFileEvent:Gt,submitRedirectEvent:Yt,saveFileEvent:Qt}=At(),Zt=q([]),$t=q(!1),es=q(!1),as=q(""),ts=q(""),ss=q(!1),ns=q(),ls=q(!1),rs=q(),os=q(),is=[{content:"设置域名重定向后，该域名的404重定向将失效"},{content:"取消重定向时，由于浏览器会缓存重定向信息，在清除缓存前，浏览器仍会根据缓存自动重定向"}],us=[{content:"重定向类型：表示访问选择的“域名”或输入的“路径”时将会重定向到指定URL"},{content:"目标URL：可以填写你需要重定向到的站点，目标URL必须为可正常访问的URL，否则将返回错误"},{content:"重定向方式：使用301表示永久重定向，使用302表示临时重定向"},{content:"保留URI参数：表示重定向后访问的URL是否带有子路径或参数如设置访问http://b.com"},{content:"重定向到http://a.com 保留URI参数： http://b.com/1.html ---\x3e http://a.com/1.html"},{content:"不保留URI参数：http://b.com/1.html ---\x3e http://a.com"}],cs=e=>{let a={...e,type:e.type?0:1,redirectdomain:JSON.stringify(e.redirectdomain)};return delete a.redirect_conf_file,a.site_name=Nt.value.name,delete a.sitename,a},ds=async(e,a,t,s)=>{const{label:n,value:l}=s,r=new Map([["start","批量启用选中的规则后，配置的重定向域名/目录将会生效"],["stop","批量停用选中的规则后，配置的重定向域名/目录将会失效"],["delete","批量删除当前选中的规则后，配置的重定向域名/目录将会彻底失效"]]),o=async e=>{const a=new Map([["start",Fe],["stop",Fe],["delete",Ae]]),{redirectname:t}=e,s=a.get(l);switch(l){case"start":case"stop":if(s){const a=cs({...e,type:"stop"===l?1:0});return await s(a)}case"delete":if(s)return await s({site_name:Nt.value.name,redirectname:t})}};await e({title:"批量".concat(n),content:"".concat(r.get(l),"，是否继续操作？"),column:[{label:"规则名称",render:e=>{var a;return e.errorpage?"404错误页面":"domain"===e.domainorpath?null==(a=E(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath}},pa()],onConfirm:async()=>{await a(o),Mt.value=!0}})},ms=async e=>{try{const a=cs(e),t=await Kt(a);return t.status&&(Mt.value=!0),t}catch(a){return{status:!1,msg:"修改状态失败"}}},ps=async e=>{var a;try{await l({title:"删除重定向【".concat("domain"===e.domainorpath?null==(a=E(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath,"】"),content:"删除选中的规则后，配置的重定向域名/目录将指向源地址，是否继续操作？",icon:"warning-filled",type:"calc"});const{name:t}=Nt.value,{redirectname:s}=e,n={proxy:{site_name:t,redirectname:s}},r=await Wt(n.proxy);return r.status&&(Mt.value=!0),r}catch(t){return{status:!1,msg:"删除重定向失败"}}},vs=async(e={data:as.value,encoding:"utf-8",path:ts.value})=>await Qt(e),gs=e=>{ls.value=!!e,os.value=e||!1,m({title:"".concat(e?"编辑":"添加","重定向").concat(e?"【".concat(e.sitename,"】"):""),area:68,component:()=>k((()=>import("./add-redirect.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),btn:!0})},hs=async()=>{try{const e=await(async(e=!1)=>{const t={sitename:Nt.value.name};try{const s=await Xt(t);return e&&a.success("刷新成功"),ss.value=!1,ns.value=null,Array.isArray(s.data)&&s.data.forEach((e=>{e.errorpage&&(ss.value=!0,ns.value=e)})),s}catch(s){return{data:[],total:0,other:{}}}})();return Zt.value=Array.isArray(e.data)?e.data:[],e}catch(e){}},ys=async e=>{try{const a=(e=>{const{name:a}=Nt.value,{holdpath:t,type:s,redirectdomain:n}=e;return{...e,site_name:a,holdpath:t?"1":"0",type:s?"1":"0",redirectdomain:JSON.stringify(n),redirectname:e.redirectname||(new Date).getTime()}})(e),t=await Yt(a,ls.value);return t.status&&(Mt.value=!0),t.status}catch(a){return!1}},_s=async()=>{try{const e={site_name:Nt.value.name,id:Nt.value.id},a=await Jt(e);return rs.value=a.data.domain_list.filter((e=>!Zt.value.some((a=>a.sitename.includes(e.name))))),a}catch(e){return{status:!1,msg:"获取域名失败"}}},fs={class:"h-full"},ws=L({__name:"index",setup(e){const t=f(),{isRefreshList:s}=Bt(),n=i([{label:"启用重定向规则",value:"start",event:ds},{label:"停用重定向规则",value:"stop",event:ds},{label:"删除重定向规则",value:"delete",event:ds}]),{BtTable:l,BtRefresh:u,BtBatch:c}=r({request:hs,columns:[va(),{label:"被重定向",render:e=>{var a;return e.errorpage?"404错误页面":"domain"===e.domainorpath?null==(a=E(e.redirectdomain,"array",[]))?void 0:a.join("、"):e.redirectpath}},{label:"重定向类型",prop:"domainorpath",render:e=>e.errorpage?"错误":"domain"===e.domainorpath?"域名":"路径"},{label:"重定向到",render:e=>e.topath?e.topath:e.tourl},ga({prop:"type",event:ms,data:["已停止","运行中"]}),ha([{width:70,title:"配置文件",onClick:e=>{if(!e.type)return t.warn("请先启用重定向规则再查看配置文件");d(e)}},{title:"编辑",onClick:e=>{gs(e)}},{onClick:ps,title:"删除"}])],extension:[V(),n,o(s)]}),d=async e=>{const s=t.load("正在查询配置文件内容，请稍候...");await(async e=>{try{es.value=!0;let t={path:e.redirect_conf_file};const s=await Gt(t);s.status?($t.value=!0,as.value=s.data.content,ts.value=s.data.redirect_conf_file):(a.error(s.msg),$t.value=!1),es.value=!1}catch(t){$t.value=!1}})(e),s.close(),m({title:"另存为模板",area:54,showFooter:!1,component:()=>T("div",{class:"p-[20px]"},[I("提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换"),B(T(da,{class:"!h-[36rem] my-[8px]",ref:"aceEditor",modelValue:as.value,"onUpdate:modelValue":e=>as.value=e,filePath:ts.value,onSave:()=>vs()},null),[[ae("bt-loading"),es.value]]),T(K,{type:"primary",onClick:()=>vs()},{default:()=>[I("保存")]}),T("ul",{class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[20px]"},[T("li",null,[I("此处为该负载均衡的配置文件，若您不了解配置规则,请勿随意修改。")])])])})};return(e,a)=>{const t=_e,s=_;return S(),z("div",fs,[T(t,null,{"header-left":O((()=>[T(H(K),{type:"primary",onClick:a[0]||(a[0]=e=>H(gs)())},{default:O((()=>a[1]||(a[1]=[I("添加重定向")]))),_:1})])),"header-right":O((()=>[T(H(u))])),content:O((()=>[T(H(l),{"max-height":460})])),"footer-left":O((()=>[T(H(c))])),_:1}),T(s,{class:"mt-2rem",options:H(is),"list-style":"disc"},null,8,["options"])])}}}),{siteInfo:bs}=ge(),xs=q(),Es=q(!1),ks=q(!1),Vs=ue({fix:"jpg,jpeg,gif,png,js,css",domains:"",return_rule:"404",http_status:!1,status:!1}),Rs=q(null),Cs=[{content:'【URL后缀】一般填写文件后缀,每个文件后缀使用","分隔,如: png,jpg'},{content:"【许可域名】允许作为来路的域名，每行一个域名,如: www.bt.cn"},{content:"【响应资源】可设置404/403等状态码，也可以设置一个有效资源，如：/security.png"},{content:"【允许空HTTP_REFERER请求】是否允许浏览器直接访问，若您的网站访问异常，可尝试开启此功能"}],Ps=e=>{if(!Vs.status)return a.error("请先启用防盗链!")},Ds=e=>{Vs.status=e,e||(Vs.http_status=!1)},qs=async a=>{var t;await Rs.value.validate();let s={...Vs,domains:null==(t=Vs.domains)?void 0:t.replace(/\n/g,",")};Es.value?s.site_ids=JSON.stringify(xs.value.map((e=>e.id))):(s.id=bs.value.id,s.site_name=bs.value.name);const n=Je;await e({loading:"正在设置防盗链，请稍后...",request:n(s),message:!Es.value}),Ls(xs.value)},Ls=async e=>{var a,t;if(xs.value=e||[],!e){const{id:e,name:n}=bs.value;try{ks.value=!0;const{data:s}=await Me({id:e,name:n});s&&(Vs.fix=s.fix||"jpg,jpeg,gif,png,js,css",Vs.domains=(null==(t=null==(a=s.domains)?void 0:a.toString())?void 0:t.replace(/,/g,"\n"))||"",Vs.return_rule=s.return_rule||"404",Vs.http_status=s.http_status||!1,Vs.status=s.status||!1)}catch(s){v(s)}finally{ks.value=!1}}},Ts={fix:[{required:!0,message:"请输入url后缀",trigger:"blur"}],return_rule:[{required:!0,message:"请输入响应资源",trigger:"blur"}]},Is={class:"p-[20px]"},js=L({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:a,emit:t}){const s=e;return G((()=>{Ls(s.compData)})),a({onConfirm:qs}),(e,a)=>{const t=p,s=de,n=me,l=K,r=pe,o=_,i=ae("bt-loading");return B((S(),z("div",Is,[T(r,{ref_key:"hotFormRef",ref:Rs,model:H(Vs),rules:H(Ts)},{default:O((()=>[T(s,{label:"URL后缀",prop:"fix"},{default:O((()=>[T(t,{modelValue:H(Vs).fix,"onUpdate:modelValue":a[0]||(a[0]=e=>H(Vs).fix=e),width:"30rem"},null,8,["modelValue"])])),_:1}),T(s,{label:"许可域名"},{default:O((()=>[T(t,{width:"30rem",modelValue:H(Vs).domains,"onUpdate:modelValue":a[1]||(a[1]=e=>H(Vs).domains=e),type:"textarea",resize:"none",rows:8,placeholder:"默认添加主域名，可追加其他的允许域名，一行一个，可为空"},null,8,["modelValue"])])),_:1}),T(s,{label:"响应资源",prop:"return_rule"},{default:O((()=>[T(t,{width:"30rem",modelValue:H(Vs).return_rule,"onUpdate:modelValue":a[2]||(a[2]=e=>H(Vs).return_rule=e)},null,8,["modelValue"])])),_:1}),T(s,{label:" "},{default:O((()=>[T(n,{modelValue:H(Vs).status,"onUpdate:modelValue":a[3]||(a[3]=e=>H(Vs).status=e),onChange:H(Ds)},{default:O((()=>a[6]||(a[6]=[I("启用防盗链")]))),_:1},8,["modelValue","onChange"]),T(n,{disabled:!H(Vs).status,title:"".concat(H(Vs).status?"":"需开启防盗链"),modelValue:H(Vs).http_status,"onUpdate:modelValue":a[4]||(a[4]=e=>H(Vs).http_status=e),onChange:H(Ps)},{default:O((()=>a[7]||(a[7]=[I(" 允许空HTTP_REFERER请求 ")]))),_:1},8,["disabled","title","modelValue","onChange"])])),_:1}),H(Es)?re("",!0):(S(),ne(s,{key:0,label:" "},{default:O((()=>[T(l,{type:"primary",onClick:a[5]||(a[5]=e=>H(qs)())},{default:O((()=>a[8]||(a[8]=[I("保存")]))),_:1})])),_:1}))])),_:1},8,["model","rules"]),H(Es)?re("",!0):(S(),ne(o,{key:0,options:H(Cs),class:"ml-[20px] mt-[20px]"},null,8,["options"]))])),[[i,H(ks)]])}}}),Ss=D("DOCKERSITE-LOGS-STORE",(()=>({getErrorLogsEvent:async e=>{try{const{data:a}=await Ke(e);return{data:a,status:!0}}catch(a){return{msg:"获取错误日志失败",status:!1}}},getResLogEvent:async e=>{try{const a=await Ke(e);return{data:a.data,status:a.status}}catch(a){return{msg:"获取日志失败",status:!1}}}}))),zs=f(),{siteInfo:Us}=ge(),Os=q("cache"),Hs=q({site_name:"",domain_list:[],site_port:[],port_conf:"",ssl_port_conf:"",site_path:"",ssl_info:{},err_age_404:"",err_age_502:"",ip_limit:{ip_black:[],ip_white:[]},basic_auth:[],proxy_cache:{},gzip:{},sub_filter:{},websocket:{},security:{},redirect:{},proxy_log:{},http_block:"",server_block:"",remark:"",proxy_info:[],ipv6_status:!1}),Fs=async()=>{const e=await We({site_name:Us.value.name});e.status?Hs.value=e.data:zs.error(e.msg)},As=q(!1),Bs=q(!1),Ns=q(),Ms=ue({status:!1,time:"",unit:"m"}),Js=[{label:"分钟",value:"m"},{label:"小时",value:"h"},{label:"天",value:"d"}],Ks=[{content:"缓存是一种用于加速网站性能和提高用户体验的技术"},{content:"开启后资源会被缓存，如果影响网站访问请关闭"},{content:"缓存键由主机名、URI 和请求参数组成"},{content:"默认忽略的响应头有：Set-Cookie|Cache-Control|expires|X-Accel-Expires"},{content:"默认缓存的静态资源有：css|js|jpg|jpeg|gif|png|webp|woff|eot|ttf|svg|ico|css.map|js.map"}],Ws={time:[{required:!0,message:"请输入正确的缓存时间",trigger:"blur",validator:(e,a,t)=>{a?isNaN(Number(a))?t(new Error("请输入数字")):Number(a)<1?t(new Error("请输入正确数字")):t():t(new Error("目标URL不能为空"))}},{}]},Xs=async()=>{await l({title:"清理缓存【".concat(Us.value.name,"】"),width:"35rem",icon:"warning-filled",content:"清理后包含所有URL的及站点的缓存都会被清空,是否继续？"}),await e({loading:"正在清理缓存，请稍后...",request:Xe({site_name:Us.value.name}),message:!0})},Gs=async()=>{let a={site_name:Us.value.name,cache_status:Ms.status?1:0,expires:"".concat(Ms.time).concat(Ms.unit)};await Ns.value.validate(),await e({loading:Bs,request:Ge(a),message:!0})},Ys=q(),Qs=ue({status:!1,type:"",level:1,minLength:"",unit:"m"}),Zs=[{label:"k",value:"k"},{label:"m",value:"m"}],$s=[{content:"用于对 HTTP 响应的内容进行压缩，以减少数据传输量，提高网站性能和加载速度"},{content:"压缩级别1-9，例如：1为压缩速度最快，但压缩率较低；9为压缩速度最慢，但压缩率最高，建议默认"},{content:"如果开启gzip后影响网站正常访问，请关闭此功能 和请求参数组成"}],en={type:[{required:!0,message:"请输入压缩类型",trigger:["blur","change"]}],minLength:[{required:!0,message:"请输入正确的压缩最小长度",trigger:"blur",validator:(e,a,t)=>{a?isNaN(Number(a))?t(new Error("请输入数字")):Number(a)<1?t(new Error("请输入正确数字")):t():t(new Error("压缩最小长度不能为空"))}},{}]},an=e=>{Qs.status=e.gzip_status,Qs.type=e.gzip_types,Qs.level=e.gzip_comp_level;let a="",t="m";e.gzip_min_length&&e.gzip_min_length.length>1&&(a=e.gzip_min_length.slice(0,-1),t=e.gzip_min_length.slice(-1)),Qs.minLength=a,Qs.unit=t},tn=async()=>{const a={site_name:Us.value.name,gzip_status:Qs.status?1:0,gzip_min_length:"".concat(Qs.minLength).concat(Qs.unit),gzip_comp_level:Qs.level,gzip_types:Qs.type};await Ys.value.validate(),await e({loading:Bs,request:Ye(a),message:!0})},sn=ue({loading:!1,type:"black",white:[],black:[]}),nn=e=>{sn.type="ipBlackList"===Os.value?"black":"white",cn.value.address="",cn.value.types=sn.type,sn.white=e.ip_white.map((e=>({ip:e,type:"white"}))),sn.black=e.ip_black.map((e=>({ip:e,type:"black"})))},ln=async a=>{const t=!!Array.isArray(a);await l({title:"".concat(t?"批量删除IP":"删除".concat("white"===a.type?"白名单":"黑名单","【").concat(a.ip,"】")),content:t?"批量删除选中的IP，是否继续操作？":"删除".concat("white"===a.type?"白名单":"黑名单","【").concat(a.ip,"】，是否继续操作？")});let s={site_name:Us.value.name};t?(s.ip_type=sn.type,s.ips=a.map((e=>e.ip)).join("\n")):(s.ip_type=a.type,s.ip=a.ip);const n=t?ra:oa;(await e({loading:"正在删除，请稍后...",request:n(s),message:!0})).status&&Fs()},rn=q([va(),{label:"IP",prop:"ip",minWidth:120},ha([{title:"删除",onClick:e=>{ln(e)}}])]),on=[{label:"删除IP",value:"delete",event:async(e,a,t,s)=>{ln(t.value)}}],un=()=>{cn.value.address="",m({isAsync:!0,title:"添加IP".concat("ipBlackList"===Os.value?"黑":"白","名单"),area:40,btn:"确认",component:()=>k((()=>import("./add-ip.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{listType:sn.type,refreshEvent:()=>{cn.value.address="",Fs()}}})},cn=q({types:sn.type,address:""}),dn=[{content:"一行一条配置，多个IP请换行"}],mn=q(),pn={address:[{validator:(e,a,t)=>{a.length>0?t():t(new Error("请输入IP地址"))},trigger:["blur","change"]}]},vn=async a=>{const{types:t,address:s}=cn.value,n={site_name:Us.value.name,ip_type:t,ips:s};(await e({loading:Bs,request:Qe(n),message:!0})).status&&(cn.value.address="",Fs(),a())},gn=q([]),hn=e=>{fn.value=e||!1,m({isAsync:!0,title:"".concat(e?"编辑":"添加","编辑http认证").concat(e?"【".concat(e.auth_name,"】"):""),area:48,btn:"确认",component:()=>k((()=>import("./http-auth-add.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{refreshEvent:Fs,proxy_info:Hs.value.proxy_info,isEdit:!!e,row:e}})},yn=q([{label:"名称",prop:"auth_name"},{label:"路径",prop:"auth_path"},ha([{onClick:hn,title:"编辑"},{onClick:async a=>{await l({title:"删除http认证【".concat(a.auth_name,"】"),content:"删除http认证【".concat(a.auth_name,"】，是否继续操作？")});(await e({loading:"正在删除http认证，请稍候...",request:sa({site_name:Us.value.name,auth_path:a.auth_path,name:a.auth_name}),message:!0})).status&&Fs()},title:"删除"}])]),_n=e=>{gn.value=e||[]},fn=q(),wn=q({name:R(5),path:"",user:"",password:""}),bn=[{content:"例如我设置了加密访问/test/,那我访问http://aaa.com/test/时就要输入账号密码才能访问"}],xn=q(),En={name:[{required:!0,message:"请输入名称",trigger:["blur","change"]}],path:[{required:!0,message:"请输入路径",trigger:["blur","change"]}],user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},kn=(e,a)=>{const t=Hs.value.proxy_info.map((e=>({value:e.proxy_path})));a(e?t.filter((a=>a.value.includes(e))):t)},Vn=async a=>{let t=wn.value;await xn.value.validate();const s={site_name:Us.value.name,auth_path:t.path,username:t.user,password:t.password,name:t.name},n=fn.value?Ze:$e;(await e({loading:Bs,request:n(s)})).status&&(Fs(),a&&a())},Rn=()=>{fn.value&&(wn.value.name=fn.value.auth_name,wn.value.path=fn.value.auth_path)},Cn=q(),Pn=ue({type:"default",accessLog:"",address:"",port:"514"}),Dn={accessLog:[{validator:(e,a,t)=>{"file"!==Pn.type||a?t():t(new Error("请选择日志目录"))},trigger:["blur","change"]}],address:[{validator:(e,a,t)=>{"rsyslog"!==Pn.type||a?t():t(new Error("请输入接收地址"))},trigger:["blur","change"]}]},qn=[{content:"指定目录可选择自定义的日志存储目录，请注意此目录必须www用户可写"},{content:"发送到远程服务器设置之后本地不会保存日志内容，填写前请确保日志接收端可正常访问"}],Ln=[{label:"默认",value:"default"},{label:"不记录日志",value:"off"},{label:"指定目录",value:"file"},{label:"发送到远程服务器",value:"rsyslog"}],Tn=e=>{ca({type:"dir",path:"/www/wwwlogs",change:e=>{Pn.accessLog=e}})},In=e=>{e?(Pn.type=e.log_type,Pn.accessLog=e.log_path,Pn.address=e.rsyslog_host):Pn.type="default"},jn=async()=>{await Cn.value.validate();const a={site_name:Us.value.name,log_type:Pn.type,log_path:"file"==Pn.type?Pn.accessLog:Pn.address};await e({loading:"正在设置日志配置，请稍后...",request:na(a),message:!0})},Sn=ue({websocket:!1}),zn=async a=>{(await e({loading:Bs,request:ea({site_name:Us.value.name,websocket_status:a?1:0}),message:!0})).status||(Sn.websocket=!a)},Un=e=>{Sn.websocket=!!e&&e.websocket_status},On=a=>{e({loading:"正在设置，请稍后...",request:aa({site_name:Us.value.name,status:a?"1":"0"}),message:!0})},Hn=async(a,t,s,n)=>{try{const l=await e({loading:a,request:ta({site_name:Us.value.name})});t.value=l.data.data,s.value=l.data.encoding||"utf-8",n.value=l.data.status}catch(l){}},Fn=async(a,t)=>{e({request:la({site_name:Us.value.name,file_body:a,encoding:t}),message:!0})},An={class:"h-full"},Bn={class:"mb-[1.6rem]"},Nn={class:"flex"},Mn=L({__name:"error-log",setup:e=>(G(rl),(e,a)=>{const t=ae("bt-loading");return B((S(),z("div",An,[U("div",Bn,"日志大小："+A(H(tl).size),1),U("div",Nn,[T(fa,{content:H(tl).logs,isHtml:!0,fullScreen:{title:"全屏查看[错误]日志",onRefresh:H(rl)},style:{height:"58rem",width:"99.5%"}},null,8,["content","fullScreen"])])])),[[t,H(al)]])})}),Jn={class:"h-full"},Kn=L({__name:"response-log",setup:e=>(G(ul),(e,a)=>{const t=ae("bt-loading");return S(),z("div",Jn,[U("div",null,"日志大小："+A(H(ol).size),1),B(T(fa,{class:"mt-[16px]",content:H(ol).logs,isHtml:!0,fullScreen:{title:"全屏查看[响应]日志",onRefresh:H(il)},style:{height:"58rem",width:"99.5%"}},null,8,["content","fullScreen"]),[[t,H(al)]])])})}),Wn={class:"p-[16px]"},Xn={class:"mt-[1.6rem]"},Gn={class:"mt-[1.6rem]"},Yn={class:"ml-[20px]"},Qn=L({__name:"config",setup:(e,{expose:a})=>(ve((()=>Hs.value.proxy_log),(e=>{In(e)})),G((()=>{In(Hs.value.proxy_log)})),a({onConfirm:jn}),(e,a)=>{const t=b,s=de,n=g,l=K,r=p,o=pe,i=_,u=ae("bt-loading");return S(),z("div",Wn,[B((S(),ne(o,{ref_key:"logFormRef",ref:Cn,class:"h-[48rem]",model:H(Pn),"label-width":"60px",rules:H(Dn),disabled:H(Bs)},{default:O((()=>[T(s,{label:"日志",prop:"type"},{default:O((()=>[T(t,{class:"!w-[24rem]",modelValue:H(Pn).type,"onUpdate:modelValue":a[0]||(a[0]=e=>H(Pn).type=e),options:H(Ln),placeholder:"请选择"},null,8,["modelValue","options"])])),_:1}),B(U("div",Xn,[T(s,{label:"访问日志",prop:"accessLog"},{default:O((()=>[T(r,{modelValue:H(Pn).accessLog,"onUpdate:modelValue":a[2]||(a[2]=e=>H(Pn).accessLog=e),placeholder:"请选择或输入目录，例如：/www/wwwlogs",width:"35rem"},{append:O((()=>[T(l,{onClick:a[1]||(a[1]=e=>H(Tn)("accessLog"))},{default:O((()=>[T(n,{icon:"el-folder-opened",class:"cursor-pointer"})])),_:1})])),_:1},8,["modelValue"])])),_:1})],512),[[N,"file"===H(Pn).type]]),B(U("div",Gn,[T(s,{label:"接收地址",prop:"address"},{default:O((()=>[T(r,{modelValue:H(Pn).address,"onUpdate:modelValue":a[3]||(a[3]=e=>H(Pn).address=e),placeholder:"接收地址，如：202.96.128.86:9204",width:"24rem"},null,8,["modelValue"])])),_:1})],512),[[N,"rsyslog"===H(Pn).type]]),T(s,{class:"mt-[1.6rem]",label:" "},{default:O((()=>[T(l,{type:"primary",onClick:H(jn)},{default:O((()=>a[4]||(a[4]=[I("保存")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules","disabled"])),[[u,H(As)]]),U("div",Yn,[T(i,{options:H(qn)},null,8,["options"])])])})}),{getErrorLogsEvent:Zn,getResLogEvent:$n}=Ss(),{siteInfo:el}=ge(),al=q(!1),tl=q({logs:"",size:"0 b"}),sl=q("response"),nl=q([{label:"响应日志",name:"response",lazy:!0,render:()=>T(Kn,null,null)},{label:"错误日志",name:"error",lazy:!0,render:()=>T(Mn,null,null)},{label:"配置",name:"config",lazy:!0,render:()=>T(Qn,null,null)}]),ll=()=>{var e;sl.value=(null==(e=el.value)?void 0:e.tabName)||"response"},rl=async()=>{const e=el.value.name;try{al.value=!0;const a=await Zn({site_name:e,type:"error"});return tl.value.size=a.data.size||"0 b",tl.value.logs=a.data.msg||"暂无日志信息",a}catch(a){return v(a),{msg:"获取错误日志失败",status:!1}}finally{al.value=!1}},ol=ue({alert:!1,showIp:!1,ipData:0,logs:"",size:"0 b"}),il=async(e=el.value.name)=>{try{al.value=!0;const a=await $n({site_name:e,type:"access"});return ol.logs=a.data.msg||"暂无日志信息",ol.size=a.data.size||"0 b",a}catch(a){return v(a),{msg:"获取日志失败",status:!1}}finally{al.value=!1}},ul=async()=>{await il(),Fs()},cl=L({__name:"index",setup:e=>(G(ll),(e,a)=>{const t=C;return S(),z("div",null,[T(t,{type:"card",modelValue:H(sl),"onUpdate:modelValue":a[0]||(a[0]=e=>F(sl)?sl.value=e:null),options:H(nl)},null,8,["modelValue","options"])])})}),{siteInfo:dl}=ge(),ml=q([]),pl=()=>({version:"",oldVersion:""}),vl=async t=>{const s=await e({request:ia({id:dl.value.id})});s.status?(t.value.version="".concat(s.data.used.name,":").concat(s.data.used.version),t.value.oldVersion="".concat(s.data.used.name,":").concat(s.data.used.version),ml.value=s.data.runtime_list.map((e=>({label:"PHP-".concat(e.version,"(").concat(e.name,")"),value:"".concat(e.name,":").concat(e.version)})))):a.error(s.msg)},gl={class:"p-[16px]"},hl={class:"ml-[20px]"},yl=L({__name:"index",setup(t,{expose:s}){const{BtForm:n,submit:r,param:o}=u({data:pl,options:()=>M((()=>[xe("PHP版本","version",ml.value,{attrs:{class:"!w-[22rem]"},rules:[{required:!0,message:"请选择PHP版本",trigger:"change"}]}),Ee("切换",{label:" ",attrs:{type:"primary",onClick:r}})])),submit:async(t,s,n)=>{await s(),(async({version:t,oldVersion:s},n)=>{try{if(t===s)return void a.error("当前版本与原版本一致，无需切换");await l({title:"切换PHP版本",content:"切换PHP版本可能会导致无法访问，是否切换？"}),e({loading:"正在切换PHP版本，请稍后...",request:ua({id:dl.value.id,runtime_name:t}),message:!0,success:e=>{e.status&&(n.value.oldVersion=t)}})}catch(r){}})(t.value,o)}});return G((()=>{vl(o)})),Y((()=>{ml.value=[]})),s({init:()=>{vl(o)}}),(e,a)=>{const t=_;return S(),z("div",gl,[T(H(n)),U("div",hl,[T(t,{options:[{content:"切换PHP版本可能会导致网站无法访问"},{content:"如果网站访问异常，建议删除网站重新创建以选择新的PHP版本"}]})])])}}}),_l=h(L({__name:"index",setup(e){const{settingTabActive:a,siteInfo:t}=P(ye()),s=q(a.value||"domain"),{BtTabs:n}=x({type:"left-bg-card",value:s,options:[{label:"域名管理",name:"domain",lazy:!0,render:()=>T(Aa,null,null)},{label:"网站目录",name:"dir",lazy:!0,render:()=>T(Ma,null,null)},{label:"反向代理",name:"urlProxy",lazy:!0,render:()=>k((()=>import("./index368.js?v=1734676359").then((e=>e.ac))),__vite__mapDeps([]),import.meta.url)},{label:"全局配置",name:"golbalConfig",lazy:!0,render:()=>k((()=>import("./index369.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)},{label:"伪静态",name:"pseudo",lazy:!0,render:()=>T(bt,null,null)},{label:"配置文件",name:"configFile",lazy:!0,render:()=>T(Ft,null,null)},{label:"SSL",name:"ssl",lazy:!0,render:()=>k((()=>import("./index370.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)},..."PHP"===t.value.type?[{label:"PHP",name:"php",lazy:!0,render:()=>T(yl,null,null)}]:[],{label:"重定向",name:"redirect",lazy:!0,render:()=>T(ws,null,null)},{label:"防盗链",name:"antiLeech",lazy:!0,render:()=>T(js,null,null)},{label:"日志",name:"siteLogs",lazy:!0,render:()=>T(cl,null,null)}]});return ve((()=>a.value),(e=>{e&&(s.value=a.value,a.value="")})),(e,a)=>(S(),ne(H(n)))}}),[["__scopeId","data-v-e2509047"]]),fl=Object.freeze(Object.defineProperty({__proto__:null,default:_l},Symbol.toStringTag,{value:"Module"}));export{Un as A,Sn as B,zn as C,Hn as D,On as E,Fn as F,Fs as G,os as H,ys as I,_s as J,rs as K,us as L,vn as M,cn as N,dn as O,mn as P,pn as Q,Rn as R,Vn as S,on as T,wn as U,fn as V,kn as W,bn as X,xn as Y,En as Z,fl as _,Xs as a,Ns as b,Ms as c,Ws as d,Bs as e,As as f,Ks as g,Hs as h,Qs as i,tn as j,Ys as k,Zs as l,en as m,$s as n,Gs as o,Os as p,un as q,nn as r,an as s,Js as t,sn as u,rn as v,hn as w,_n as x,gn as y,yn as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
