import{_ as a}from"./index90.js?v=1734676359";import{c as e,r as t,o as l,B as s,k as r,l as n,e as o,x as i,y as d,C as p,p as u,q as m,M as c,I as b,aX as v,J as f,v as _,A as w,bL as y,bM as h}from"./base-lib.js?v=1734676359";import{G as k,a1 as x,R as g,a6 as j,t as C,k as V,h as q,b as H,o as I,e as A}from"./utils-lib.js?v=1734676359";import{_ as J}from"./index101.js?v=1734676359";import{u as M}from"./column.js?v=1734676359";import{getPM2Monit as O,getPM2Logs as S,setPM2Status as U}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const B={class:"p-2rem"},D={class:"p-2rem"},G={class:"p-2rem w-full relative"},L=["title"],N=A(e({__name:"index",setup(e){const A=H(),N=t([]),R=t(!1),X=t(!1),z=t(""),E=t(!1),F=t({}),K=t({}),P=t(""),Q=t(!1),T=async(a=!1)=>{const e=await k({loading:R,request:O(),data:{data:[Array,a=>a.map((a=>{var e;return a.id=null!=(e=a.id)?e:a.name+"(集群)",a}))]}});N.value=e.data,a&&A.success("刷新成功")},W=async(a,e)=>{try{E.value=!0;let t={mode:a.mode,log_type:e};x(a.id)?t.id=a.id:t.name=a.name;const{data:l}=await S(t);z.value=l.data}catch(t){}finally{E.value=!1}},Y=async(a,e=!1)=>{let t="online"===a.status?"stop":"start",l=e?"重启":"stop"===t?"停止":"启动";await I({title:"修改集群状态",content:"即将".concat(l,"集群，是否继续？")});let s={mode:a.mode,status:e?"restart":t,name:a.name};x(a.id)?s.id=a.id:s.name=a.name;(await k({loading:"正在".concat(l,"集群，请稍后..."),request:U(s)})).status&&T()},Z=(a,e)=>{z.value="",X.value=!0,F.value=a,P.value=e,W(a,e)},$=[{label:"ID",prop:"id",width:100},{label:"服务名称",prop:"name",width:110,render:a=>a.data?a.name:o("span",{class:"text-primary cursor-pointer",onClick:()=>(a=>{F.value=a,K.value=a.pm2_env,Q.value=!0})(a)},[a.name])},{label:"pid",prop:"pid",render:a=>{var e;return null!=(e=a.pid)?e:"--"}},{label:"运行用户",prop:"user",width:75},{label:"重启次数",prop:"restart",width:75,render:a=>a.restart||"--"},{label:"创建时间",prop:"addtime",width:150,render:a=>g(a.uptime)},{label:"cpu使用率",prop:"cpu",render:a=>j(a.cpu)?a.cpu+"%":"--"},{label:"内存占用",prop:"memory",render:a=>void 0!==a.memory?C(a.memory):"--"},{label:"日志",prop:"log",width:120,render:a=>o("div",null,[o("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"all")},[d("全部/")]),o("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"err")},[d("错误/")]),o("span",{class:"bt-link cursor-pointer",onClick:()=>Z(a,"out")},[d("运行")])])},{label:"自动重载",width:75,prop:"auto_restart",render:a=>a.data?"--":a.auto_restart?"是":"否"},{label:"状态",prop:"status",render:a=>{let e="online"===a.status;return o("span",{class:"text-".concat(e?"primary":"danger")},[e?"运行中":"已停止"])}},M([{onClick:a=>Y(a),isHide:a=>!("online"===a.status),title:"停止",width:26},{onClick:a=>Y(a),isHide:a=>"online"===a.status,title:"启动",width:26},{onClick:a=>Y(a,!0),title:"重启",width:26}])];return l((()=>{T()})),(e,t)=>{const l=w,k=V,x=J,g=q,j=y,C=h,H=a,I=s("bt-loading");return r(),n("div",B,[o(H,null,{"header-left":i((()=>[o(l,{onClick:t[0]||(t[0]=a=>T(!0)),type:"default"},{default:i((()=>t[4]||(t[4]=[d("刷新数据")]))),_:1})])),content:i((()=>[p(o(k,{column:u($),data:u(N),"row-key":"id","max-height":500,"tree-props":{children:"data"}},null,8,["column","data"]),[[I,u(R)]])])),"footer-left":i((()=>t[5]||(t[5]=[m("ul",{class:"mt-8px leading-8 text-[1.2rem] list-disc ml-20px"},[m("li",null,"如果pm2项目无法加载监控信息，可修改node命令行版本号再试")],-1)]))),popup:i((()=>[o(g,{title:"日志展示",modelValue:u(X),"onUpdate:modelValue":t[2]||(t[2]=a=>c(X)?X.value=a:null),area:[60]},{default:i((()=>[m("div",D,[o(l,{loading:u(E),type:"primary",onClick:t[1]||(t[1]=a=>W(u(F),u(P)))},{default:i((()=>t[6]||(t[6]=[d("刷新日志")]))),_:1},8,["loading"]),p(o(x,{title:"全屏查看日志",class:"h-[40rem] mt-12px",content:u(z)},null,8,["content"]),[[I,u(E)]])])])),_:1},8,["modelValue"]),o(g,{title:"详情展示【".concat(u(F).name,"】"),modelValue:u(Q),"onUpdate:modelValue":t[3]||(t[3]=a=>c(Q)?Q.value=a:null),area:70},{default:i((()=>[m("div",G,[o(C,{column:1,border:"",class:"max-h-[46rem] w-full overflow-auto"},{default:i((()=>[(r(!0),n(b,null,v(Object.entries(u(K)),((a,e)=>(r(),f(j,{key:e},{label:i((()=>[d(_(a[0]),1)])),default:i((()=>[m("span",{title:String(JSON.stringify(a[1])),class:"w-340px truncate inline-block"},_(a[1]),9,L)])),_:2},1024)))),128))])),_:1})])])),_:1},8,["title","modelValue"])])),_:1})])}}}),[["__scopeId","data-v-a1e17b11"]]);export{N as default};
