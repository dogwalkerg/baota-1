import{c as e,r as a,h as t,o as s,n as r,k as o,l,e as d,x as i,q as m,p as u,y as c,z as p,A as n,a7 as f,a4 as _}from"./base-lib.js?v=1734676359";import{_ as j}from"./index335.js?v=1734676359";import{b as y,e as h}from"./utils-lib.js?v=1734676359";import{setSiteEtimeMultiple as b,setModulesEtimeMultiple as v,setEdate as x}from"./site.js?v=1734676359";import{c as D}from"./useController3.js?v=1734676359";import{u as g}from"./useStore7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const w={class:"p-2rem"},k={class:"flex items-center"},q={key:0,class:"text-[#888] mt-[8px] ml-10rem"},C=h(e({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:h,emit:C}){const Y=y(),A=e,{rowData:E,siteType:T}=A.compData,V=!!Array.isArray(E),{isRefreshList:M}=g(),R=C,S=a(),z=t({edate:E.edate||""}),H={edate:[{required:!0,message:"请选择到期时间",trigger:"blur"}]},I=e=>e.getTime()<Date.now()-864e5,L=()=>{z.edate="",O(),B()},O=()=>{const e=document.querySelector(".date .el-input__inner");e&&(e.value="永久")},U=e=>{},B=async e=>{try{if(V){let e=[],a=[];E.forEach((a=>{e.push(a.id)}));const t=await b({edate:z.edate?z.edate:"0000-00-00",sites_id:e});Object.keys(t.error).forEach((e=>{a.push({name:e,status:!1})})),await t.success.forEach((e=>{a.push({name:e,status:!0})})),D({title:"批量设置到期时间",resultTitle:"设置到期时间",resultData:a}),M.value=!0,R("close")}else{let e,a=Y.load("正在设置到期时间，请稍后...");if(T){const e=await v({sites_id:E.id,edate:z.edate?z.edate:"0000-00-00"});e.data.status?(Y.request(e),M.value=!0):Y.error(e.data.msg)}else e=await x({id:E.id,edate:z.edate?z.edate:"0000-00-00"}),Y.request(e),e.status&&(M.value=!0);a.close(),R("close")}}catch(a){}};return h({onConfirm:B}),s((()=>{"0000-00-00"===E.edate&&(z.edate="",r((()=>{O()})))})),(e,a)=>{const t=j,s=n,r=f,y=_;return o(),l("div",w,[d(y,{ref_key:"formRef",ref:S,model:u(z),rules:H},{default:i((()=>[d(r,{label:"到期时间",prop:"edate"},{default:i((()=>[m("div",k,[d(t,{modelValue:u(z).edate,"onUpdate:modelValue":a[0]||(a[0]=e=>u(z).edate=e),"value-format":"YYYY-MM-DD","disabled-date":I,class:"date",onChange:U,type:"date",placeholder:"选择日期"},null,8,["modelValue"]),d(s,{type:"default",class:"!ml-[.4rem]",onClick:L},{default:i((()=>a[1]||(a[1]=[c(" 设为永久 ")]))),_:1})])])),_:1})])),_:1},8,["model"]),u(z).edate?(o(),l("div",q,"* 到期当天24点后过期")):p("",!0)])}}}),[["__scopeId","data-v-60b11b59"]]);export{C as default};
