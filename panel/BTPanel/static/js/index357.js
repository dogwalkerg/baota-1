import{u as a,R as e,t as l,G as t,M as s,o,dh as n,S as i,k as r,h as d,j as u,e as p}from"./utils-lib.js?v=1734676359";import{_ as m}from"./index90.js?v=1734676359";import{c,R as v,r as f,h as g,az as h,o as x,B as w,k as y,l as b,e as _,x as k,y as C,p as j,C as V,M as q,q as U,I as z,aX as A,J as R,N as S,z as I,A as M,ag as B,ah as F}from"./base-lib.js?v=1734676359";import{_ as J}from"./index97.js?v=1734676359";import{i as N,u as P,a as D}from"./column.js?v=1734676359";import{y as G,i as H}from"./useMethod3.js?v=1734676359";import{getBackupDatabase as L,getMysqlCloudServer as O,getMysqlBackupInfo as T,inputDatabase as X,getMysqlAllBackup as E,backupDatabase as K}from"./database.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const Q={class:"p-20px"},W={class:"p-20px flex flex-col"},Y={key:0},Z={class:"p-16px flex flex-col bg-[#f0f0f0]"},$=p(c({__name:"index",setup(p,{expose:c}){var $;const{panel:aa}=a(),ea=v([]),la=f(null==($=ea.value[0])?void 0:$.id),ta=f(!1),sa=f([]),oa=g({p:1,limit:10,total:0}),na=f({}),ia=f(""),ra=f("detail"),da=f(!1),ua=f([]),pa=f(!1),ma=f(),ca=f(!1),va=f([]),fa=[{label:"数据库名称",prop:"name"},{label:"大小",prop:"size",render:a=>l(a.size)}],ga=(aa.value.backupPath+"/database/mysql/all_backup/").replace(/\/\//g,"/"),ha=async()=>{const a=await t({request:L({sid:la.value}),loading:pa,data:{status:Boolean,msg:String,data:[Array,ua]}});a.status||(s.error(a.msg||"获取数据库备份列表失败"),ua.value=[])},xa=async()=>{await wa(),ha(),da.value=!0},wa=async()=>{var a;await t({loading:"正在获取服务器数据，请稍后...",request:O(),data:[Array,ea]}),la.value=null==(a=ea.value[0])?void 0:a.id},ya=async a=>"detail"===ra.value?a():"我已知晓"!==ia.value?(s.error("输入错误，请重新输入！"),!1):(await t({request:X({file:na.value.path}),loading:"正在导入数据库，请稍后...",message:!0}),void(ia.value="")),ba=async()=>{await t({request:E({...oa}),loading:ta,data:{data:[Array,sa],page:i(oa)}})},_a=async()=>{const a=ma.value.tableSelectList;if(!a.length)return s.error("请选择需要备份的数据库");await t({request:K({sid:la.value,db_list:JSON.stringify(a.map((a=>a.name)))}),loading:"正在备份中，请稍后...",message:!0}),da.value=!1,ba()},ka=[{label:"文件名称",prop:"name"},{label:"备份时间",prop:"mtime",width:200,render:a=>{const l=new Date(1e3*a.mtime);return h("span",e(l))}},N({prop:"size",width:100}),P([{onClick:async a=>{await t({request:T({file:a.path}),loading:"正在获取数据库详情，请稍后...",data:{data:[Array,va]}}),ra.value="detail",ca.value=!0},title:"详情"},{onClick:async a=>{na.value=a,await t({request:T({file:a.path}),loading:"正在获取数据库详情，请稍后...",data:{data:[Array,va]}}),ca.value=!0,ra.value="restore"},title:"恢复"},{onClick:async a=>{window.open("/download?filename="+encodeURIComponent(a.path))},title:"下载"},{onClick:async a=>{await o({title:"删除文件",content:"删除选中数据库备份文件后，该数据库备份文件将永久消失，是否继续操作？",icon:"warning-filled"}),await t({request:n({path:a.path}),loading:"正在删除文件，请稍后...",message:!0}),ba()},title:"删除"}])],Ca=[D(),{label:"数据库名称",prop:"name",width:200},{label:"表数量",prop:"table_num"},H([],"mysql"),{label:"大小",prop:"size"}];return x(ba),c({init:ba}),(a,e)=>{const l=M,t=r,s=J,o=B,n=F,i=m,p=d,c=u,v=w("bt-loading"),f=w("focus");return y(),b("div",null,[_(i,null,{"header-left":k((()=>[_(l,{onClick:xa,type:"primary"},{default:k((()=>e[10]||(e[10]=[C("数据库备份")]))),_:1}),_(l,{onClick:e[0]||(e[0]=a=>j(G)((()=>ba()),j(ga)))},{default:k((()=>e[11]||(e[11]=[C("从本地上传")]))),_:1})])),content:k((()=>[V(_(t,{column:ka,data:j(sa)},null,8,["data"]),[[v,j(ta)]])])),"footer-right":k((()=>[_(s,{total:j(oa).total,page:j(oa).p,"onUpdate:page":e[1]||(e[1]=a=>j(oa).p=a),row:j(oa).limit,"onUpdate:row":e[2]||(e[2]=a=>j(oa).limit=a),onChange:e[3]||(e[3]=a=>ba())},null,8,["total","page","row"])])),popup:k((()=>[_(p,{title:"数据库备份",modelValue:j(da),"onUpdate:modelValue":e[5]||(e[5]=a=>q(da)?da.value=a:null),onConfirm:_a,showFooter:"",area:60},{default:k((()=>[U("div",Q,[_(i,null,{"header-right":k((()=>[_(n,{class:"!w-[16rem]",modelValue:j(la),"onUpdate:modelValue":e[4]||(e[4]=a=>q(la)?la.value=a:null),onChange:ha},{default:k((()=>[(y(!0),b(z,null,A(j(ea),((a,e)=>(y(),R(o,{key:e,label:a.ps,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),content:k((()=>[V(_(t,{ref_key:"backupTableRef",ref:ma,column:Ca,data:j(ua),"max-height":"360"},null,8,["data"]),[[v,j(pa)],[v,"正在加载列表，请稍后...","title"]])])),_:1})])])),_:1},8,["modelValue"]),_(p,{title:"restore"===j(ra)?"恢复数据库":"数据库详情",modelValue:j(ca),"onUpdate:modelValue":e[8]||(e[8]=a=>q(ca)?ca.value=a:null),showFooter:"",area:60,onConfirm:ya,onCancel:e[9]||(e[9]=a=>ia.value="")},{default:k((()=>[U("div",W,[_(t,{column:fa,data:j(va),"max-height":"360"},null,8,["data"]),"restore"===j(ra)?(y(),b("div",Y,[e[13]||(e[13]=U("div",{class:"flex items-center my-12px text-[1.4rem]"},[U("i",{class:"text-orange svgtofont-el-warning-filled !text-[4rem] mr-8px"}),U("span",null,"恢复后会覆盖当前数据库数据，此操作不可逆，是否继续操作？")],-1)),U("div",Z,[e[12]||(e[12]=U("span",{class:"mb-4px"},[C("请手动输入 "),U("span",{class:"text-danger"},'"我已知晓"'),C(" ，完成验证")],-1)),V(_(c,{modelValue:j(ia),"onUpdate:modelValue":e[6]||(e[6]=a=>q(ia)?ia.value=a:null),width:"52rem",onPasteCapture:e[7]||(e[7]=S((()=>{}),["prevent"]))},null,8,["modelValue"]),[[f]])])])):I("",!0)])])),_:1},8,["title","modelValue"])])),_:1}),e[14]||(e[14]=U("ul",{class:"mt-16px leading-8 text-[1.2rem] list-disc ml-20px"},[U("li",null,"恢复仅限于在本页面进行的备份进行恢复，非本页面的备份数据可能无法正确恢复，请注意。")],-1))])}}}),[["__scopeId","data-v-9a917553"]]);export{$ as default};
