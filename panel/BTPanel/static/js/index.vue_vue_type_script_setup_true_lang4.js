import{M as a,ah as e,G as l,h as s}from"./utils-lib.js?v=1734676359";import{c as t,r as o,h as n,k as r,l as d,e as u,x as i,I as m,aX as c,y as p,q as f,p as v,M as b,A as y,ao as _,an as x,ah as h,a7 as w,a4 as g,v as S,J as T,ap as V,ag as k}from"./base-lib.js?v=1734676359";import{g as q,r as M,q as j}from"./useMethod3.js?v=1734676359";import{syncDataToPanel as L,syncModuleDataToPanel as A}from"./database.js?v=1734676359";const C={class:"inline-block flex flex-col py-[1.2rem] mb-[0.8rem]"},D={class:"text-[#666] text-[1.4rem] mb-[8px]"},F=["innerHTML"],H={class:"p-[16px]"},J=t({__name:"index",props:{compData:{default:()=>[]}},setup(t){var J;const N=t,{refs:{tabActive:U},refreshTableList:G}=q(),I=o(N.compData),O=o((null==(J=I.value[0])?void 0:J.id)||""),P=n({}),R=o(),X=o(!1),z=[{label:"从面板同步到服务器",name:"SyncToServer",description:"将面板的数据库同步到本地服务器中"},{label:"从服务器同步到面板",name:"SyncToPanel",description:"从服务器获取所有数据库，并同步到面板中<br>（数据库密码无法同步，需在面板重新配置）"}],B=async a=>{if("SyncToServer"===a)E();else{const a=await M();O.value=a[0].id,I.value=a,X.value=!0}},E=async()=>{const l=a.load("正在同步...");try{const e=await j();a.request(e),G()}catch(s){e(s,"syncToServer")}finally{l.close()}},K=async()=>{await R.value.validate();let a={sid:Number(O.value)};await l({loading:"正在获取数据库,请稍候...",request:"mysql"===U.value?L(a):A({data:JSON.stringify(a)},U.value),message:!0}),G()};return(a,e)=>{const l=y,t=V,o=_,n=x,q=k,M=h,j=w,L=g,A=s;return r(),d("div",null,[u(n,{onCommand:B},{dropdown:i((()=>[u(o,null,{default:i((()=>[(r(),d(m,null,c(z,((a,e)=>u(t,{command:a.name,key:e},{default:i((()=>[f("div",C,[f("span",D,S(a.label),1),f("span",{class:"text-[#999] text-[1.2rem] leading-1.8rem",innerHTML:a.description},null,8,F)])])),_:2},1032,["command"]))),64))])),_:1})])),default:i((()=>[u(l,{type:"default"},{default:i((()=>e[2]||(e[2]=[p(" 同步数据库 "),f("i",{class:"svgtofont-el-arrow-down ml-4px"},null,-1)]))),_:1})])),_:1}),u(A,{title:"从服务器获取",modelValue:v(X),"onUpdate:modelValue":e[1]||(e[1]=a=>b(X)?X.value=a:null),area:46,onConfirm:K,showFooter:""},{default:i((()=>[f("div",H,[u(L,{ref_key:"syncFormRef",ref:R,model:v(P)},{default:i((()=>[u(j,{label:"数据库位置"},{default:i((()=>[u(M,{modelValue:v(O),"onUpdate:modelValue":e[0]||(e[0]=a=>b(O)?O.value=a:null),class:"!w-[28rem]"},{default:i((()=>[(r(!0),d(m,null,c(v(I),((a,e)=>(r(),T(q,{key:e,value:a.id,label:a.ps+"（服务器地址："+a.db_host+"）"},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model"])])])),_:1},8,["modelValue"])])}}});export{J as _};
