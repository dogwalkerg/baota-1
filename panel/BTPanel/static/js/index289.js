import{u as e,af as a,aj as l,b6 as t,o as s,G as o,j as n,c as r,O as d,e as u,b as p,l as i,H as c,ah as m,h as v,d as _,k as w,V as f,X as b}from"./utils-lib.js?v=1734676359";import{c as h,h as y,r as g,e as x,y as V,I as k,o as j,k as P,l as q,x as S,p as U,M as C,C as D,q as I,aX as L,v as F,z as H,J as z,aw as M,a7 as O,ag as T,ah as E,a4 as R,bv as N,ax as A,w as Q,F as J,D as $,az as W,B,A as Y}from"./base-lib.js?v=1734676359";import{checkAutoInstall as X,createAsync as G,getSwooleCorrespondencePhp as K,getSystemUserListAsync as Z,GetPHPVersion as ee,checkInstallAsync as ae,addPhpSite as le,setDeploymentInfo as te,getDeploymentList as se,getPluginInfo as oe,createWebsiteMultiple as ne,delPhpUploadApp as re,getPhpAppUploadList as de,getFtpMysqlStatus as ue}from"./site.js?v=1734676359";import pe from"./index279.js?v=1734676359";import{_ as ie}from"./index88.js?v=1734676359";import{h as ce,f as me,i as ve}from"./validator.js?v=1734676359";import{u as _e}from"./useStore7.js?v=1734676359";import{q as we}from"./useController4.js?v=1734676359";import{c as fe}from"./useController3.js?v=1734676359";import{_ as be}from"./index90.js?v=1734676359";import{a as he,u as ye,c as ge}from"./column.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./useStore8.js?v=1734676359";import"./useStore9.js?v=1734676359";import"./useMethod5.js?v=1734676359";const xe={class:"flex"},Ve={class:"flex items-center h-3.2rem"},ke=["onClick"],je={key:0,class:"text-[1.2rem] ml-[8px] flex items-center"},Pe={key:1,class:"text-[1.2rem] ml-[8px] flex items-center"},qe={class:"flex items-center"},Se={class:"flex items-center mb-[4px]"},Ue=u(h({__name:"index",props:{compData:{default:{}}},setup(u,{expose:p}){const i=u,{panel:c}=e(),{isRefreshList:m}=_e(),v=y({database:!1}),_=g(),w=g(!1),f=g({site_path:"/www/wwwroot",project_cmd:"",install_dependence:0,php_version:"",swoole_version:4,domains:"",sql:!1,project_ps:"",project_port:"",codeing:"utf8mb4",open_proxy:!1,project_proxy_path:"",datauser:"",datapassword:"",run_user:"www",composer_version:""}),b=g(!1),h=g([]),A=g([]);g({});const Q=g(!1),J=g({});let $="/www/wwwroot/";const W=[{content:"当前仅支持nginx服务器使用"},{content:"【swoole版本】开启自动安装依赖时会给对应版本的php安装swoole"},{content:x(k,null,[V("【自动安装项目依赖】只尝试"),x("span",{class:"text-danger"},[V("composer install")]),V("进行安装依赖，最终安装结果请前往 项目-日志-安装依赖日志 进行确认，若安装依赖不成功，项目会"),x("span",{class:"text-danger"},[V("启动失败")])])},{content:"安装依赖不成功，可能和composer版本有关，可尝试切换composer版本"}],B=async e=>{const l="mysql"===e?e:"php-"+(Number(e)/10).toFixed(1),{data:t}=await a({sName:l});ce({name:t.name,type:"i",pluginInfo:t})},Y=()=>{me({type:"dir",path:f.value.site_path.replace(/\/$/,""),change:e=>{l(e,"string",""),f.value.site_path=e,Q.value=!0,ee()}})},ee=async()=>{try{const e=await X({path:f.value.site_path});f.value.composer_version=e.data?"2.7.3":"",f.value.install_dependence=e.data?1:0}catch(e){}},ae=async()=>{try{const e="php-"+(Number(f.value.php_version)/10).toFixed(1);e&&ve({name:e})}catch(e){}},le=async e=>{var a;f.value.php_version=e,J.value=null!=(a=h.value.find((a=>a.php_version===e)))?a:{}},te=e=>{var a,l,s,o;"string"==typeof e&&(f.value.site_path&&f.value.site_path!==$.replace(/\/$/,"")||(Q.value=!1),Q.value||(f.value.site_path=(null==$?void 0:$.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim())),f.value.datauser=null==(o=null==(s=e.split("\n")[0])?void 0:s.replace(/\W/g,"_"))?void 0:o.substr(0,16),f.value.datapassword=t(16),f.value.project_ps=e.split("\n")[0])},se=e=>{f.value.composer_version=e,f.value.install_dependence=e?1:0},oe=async e=>{f.value.swoole_version=e,await ne()},ne=async()=>{var e,a,l;try{const t=await K({swoole_version:f.value.swoole_version});if(t.status){h.value=t.data;const s=null==(e=h.value)?void 0:e.filter((e=>e.setup_status));f.value.php_version=null==(a=s[0])?void 0:a.php_version,J.value=null!=(l=s[0])?l:{}}}catch(t){}},re=async()=>{var e;const a=await i.compData.getStatus();v.database=a.mysql;const l=c.value.sitePath;l&&(f.value.site_path=l,$=null==(e=l+"/")?void 0:e.replace(/\/\//g,"/")),ne(),(async()=>{try{const e=await Z();A.value=e.data}catch(e){}})()};return j(re),p({init:re,onConfirm:async e=>{var a;await _.value.validate(),(null==(a=J.value)?void 0:a.swoole_status)||await s({width:50,title:"提示",isHtml:!0,content:"当前版本PHP-安装扩展未安装swoole，可能导致项目无法启动，是否继续操作？",icon:"warning-filled"});const l=(e=>{var a;let l={...e,sql_user:e.datauser,sql_pwd:e.datapassword,sql_codeing:e.codeing,install_dependence:e.install_dependence,open_proxy:e.open_proxy?1:0,webname:{domain:"",domainlist:[],count:0}},t=null==(a=e.domains)?void 0:a.split("\n");return t.forEach(((e,a)=>{0===a?l.webname.domain=e:l.webname.domainlist.push(t[a])})),l.webname.count=l.webname.domainlist.length,l.webname=JSON.stringify(l.webname),delete l.domains,delete l.datauser,delete l.datapassword,delete l.codeing,l})(f.value),t=await o({request:G(l),message:!0});(null==t?void 0:t.status)&&(m.value=!0,e())}}),(e,a)=>{const l=n,t=M,s=O,o=ie,u=T,p=E,i=r,c=R,m=d,y=N;return P(),q("div",null,[x(c,{ref_key:"addSwooleSiteFormRef",ref:_,disabled:U(w),model:U(f),rules:U(we)},{default:S((()=>[x(s,{label:"绑定域名",prop:"domains"},{default:S((()=>[x(t,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:U(b),"onUpdate:visible":a[2]||(a[2]=e=>C(b)?b.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:S((()=>[D(x(l,{onInput:te,modelValue:U(f).domains,"onUpdate:modelValue":a[0]||(a[0]=e=>U(f).domains=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:a[1]||(a[1]=e=>b.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"]),[[y,void 0,"popover"]])])),default:S((()=>[a[16]||(a[16]=I("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[V(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),I("br"),V(" IP地址格式：192.168.1.199 "),I("br"),V(" 泛解析添加方法 *.domain.com "),I("br"),V(" 如另加端口格式为 www.domain.com:88 ")],-1))])),_:1},8,["visible"])])),_:1}),x(s,{label:"项目目录",prop:"site_path"},{default:S((()=>[x(o,{modelValue:U(f).site_path,"onUpdate:modelValue":a[3]||(a[3]=e=>U(f).site_path=e),placeholder:"请输入项目目录",icon:"el-folder-opened",width:"52rem",onFocus:a[4]||(a[4]=e=>Q.value=!0),onBlur:ee,onIconClick:Y},null,8,["modelValue"])])),_:1}),x(s,{label:"swoole版本"},{default:S((()=>[I("div",xe,[I("div",null,[x(p,{modelValue:U(f).swoole_version,"onUpdate:modelValue":a[5]||(a[5]=e=>U(f).swoole_version=e),class:"!w-[8rem]",onChange:oe},{default:S((()=>[x(u,{label:"2.x",value:2}),x(u,{label:"4.x",value:4}),x(u,{label:"5.x",value:5})])),_:1},8,["modelValue"])]),x(s,{label:"PHP版本",prop:"php_version"},{default:S((()=>{var e,l,t;return[I("div",Ve,[x(p,{modelValue:U(f).php_version,"onUpdate:modelValue":a[6]||(a[6]=e=>U(f).php_version=e),placeholder:"请选择PHP版本",class:"!w-[14rem]",onChange:le},{default:S((()=>[(P(!0),q(k,null,L(U(h),((e,l)=>(P(),z(u,{key:l,disabled:!e.setup_status,label:"PHP-".concat(e.php_version),value:e.php_version},{default:S((()=>[I("span",null,"PHP-"+F(e.php_version),1),e.setup_status?H("",!0):(P(),q(k,{key:0},[a[17]||(a[17]=V(" [ ")),I("span",{class:"mx-[4px] bt-link",onClick:a=>B(e.php_version)},"未安装",8,ke),a[18]||(a[18]=V(" ] "))],64))])),_:2},1032,["disabled","label","value"])))),128))])),_:1},8,["modelValue"]),U(f).php_version?(P(),q(k,{key:0},[(null==(e=U(J))?void 0:e.swoole_status)?!(null==(l=U(J))?void 0:l.setup_swoole_isactive)&&(null==(t=U(J))?void 0:t.swoole_version)?(P(),q("span",Pe,[V(" 当前php未安装swoole"+F(U(f).swoole_version)+"扩展 ",1),x(i,{class:"ml-[4px]",onClick:ae},{default:S((()=>a[21]||(a[21]=[V(">>立即安装")]))),_:1})])):H("",!0):(P(),q("span",je,[a[20]||(a[20]=V(" 当前php未安装swoole扩展 ")),x(i,{class:"ml-[4px]",onClick:ae},{default:S((()=>a[19]||(a[19]=[V(">>立即安装")]))),_:1})]))],64)):H("",!0)])]})),_:1})])])),_:1}),x(s,{label:"数据库"},{default:S((()=>[I("div",qe,[x(p,{class:"!w-[16rem]",modelValue:U(f).sql,"onUpdate:modelValue":a[7]||(a[7]=e=>U(f).sql=e),disabled:!U(v).database},{default:S((()=>[x(u,{label:"不创建",value:!1}),x(u,{label:"MySQL",value:"MYSQL"})])),_:1},8,["modelValue","disabled"]),U(v).database?H("",!0):(P(),q("span",{key:0,onClick:a[8]||(a[8]=e=>B("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),U(f).sql?(P(),z(p,{key:1,class:"!w-[16rem] ml-[8px]",modelValue:U(f).codeing,"onUpdate:modelValue":a[9]||(a[9]=e=>U(f).codeing=e)},{default:S((()=>[x(u,{label:"utf8mb4",value:"utf8mb4"}),x(u,{label:"utf8",value:"utf8"}),x(u,{label:"gbk",value:"gbk"}),x(u,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])):H("",!0)])])),_:1}),U(f).sql?(P(),z(s,{key:0,label:"数据库账号"},{default:S((()=>[I("div",Se,[x(s,{prop:"datauser"},{default:S((()=>[x(l,{placeholder:"创建数据库账号",modelValue:U(f).datauser,"onUpdate:modelValue":a[10]||(a[10]=e=>U(f).datauser=e)},null,8,["modelValue"])])),_:1}),x(s,{label:"密码",class:"!mt-0"},{default:S((()=>[x(l,{placeholder:"数据库密码",modelValue:U(f).datapassword,"onUpdate:modelValue":a[11]||(a[11]=e=>U(f).datapassword=e)},null,8,["modelValue"])])),_:1})]),a[22]||(a[22]=I("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))])),_:1})):H("",!0),x(s,{label:"运行用户"},{default:S((()=>[x(p,{class:"!w-[16rem]",modelValue:U(f).run_user,"onUpdate:modelValue":a[12]||(a[12]=e=>U(f).run_user=e)},{default:S((()=>[(P(!0),q(k,null,L(U(A),(e=>(P(),z(u,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),a[23]||(a[23]=I("span",{class:"text-[#999] text-[1.2rem] ml-[.4rem]"},"* 无特殊需求请选择www用户",-1))])),_:1}),x(s,{label:"启动命令",prop:"project_cmd"},{default:S((()=>[x(l,{modelValue:U(f).project_cmd,"onUpdate:modelValue":a[13]||(a[13]=e=>U(f).project_cmd=e),width:"52rem",placeholder:"请输入项目的启动命令，例：php serve.php"},null,8,["modelValue"])])),_:1}),x(s,{label:"依赖安装"},{default:S((()=>[x(p,{class:"!w-[16rem]",modelValue:U(f).composer_version,"onUpdate:modelValue":a[14]||(a[14]=e=>U(f).composer_version=e),"empty-values":[null,void 0],onChange:se},{default:S((()=>[x(u,{label:"不安装",value:""}),x(u,{label:"用composer2.7.3安装",value:"2.7.3"}),x(u,{label:"用composer1.10.27安装",value:"1.10.27"})])),_:1},8,["modelValue"])])),_:1}),x(s,{label:"备注"},{default:S((()=>[x(l,{modelValue:U(f).project_ps,"onUpdate:modelValue":a[15]||(a[15]=e=>U(f).project_ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])])),_:1})])),_:1},8,["disabled","model","rules"]),x(m,{class:"mt-2rem pl-1rem",options:W})])}}}),[["__scopeId","data-v-dad57cfa"]]),Ce={class:"flex"},De={class:"mr-2rem"},Ie={key:1,class:"!text-[1.2rem]"},Le={class:"flex items-center"},Fe={class:"flex items-center mb-[4px]"},He=u(h({__name:"index",props:{compData:{default:{}}},setup(u,{expose:i}){const c=u,{panel:m}=e(),{isRefreshList:v}=_e(),_=p(),w=y({database:!1}),f=g(),b=g(!1),h=g({site_path:"/www/wwwroot",project_cmd:"php think run",install_dependence:0,php_version:"",thinkphp_version:!0,domains:"",sql:!1,project_ps:"",project_port:"",codeing:"utf8mb4",open_proxy:!1,project_proxy_path:"",datauser:"",datapassword:"",run_user:"www",composer_version:""}),D=g(!1),F=g([]),N=g([]),A=g({}),Q=g(!1);let J="/www/wwwroot/";const $=[{content:"当前仅支持nginx服务器使用"},{content:"【fileinfo版本】若未安装，项目会启动失败"},{content:x(k,null,[V("【自动安装项目依赖】只尝试"),x("span",{class:"text-danger"},[V("composer install")]),V("进行安装依赖，最终安装结果请前往 项目-日志-安装依赖日志 进行确认，若安装依赖不成功，项目会"),x("span",{class:"text-danger"},[V("启动失败")])])},{content:"安装依赖不成功，可能和composer版本有关，可尝试切换composer版本"}],W=()=>{me({type:"dir",path:h.value.site_path.replace(/\/$/,""),change:e=>{l(e,"string",""),h.value.site_path=e,Q.value=!0,B()}})},B=async()=>{try{const e=await X({path:h.value.site_path});h.value.composer_version=e.data?"2.7.3":"",h.value.install_dependence=e.data?1:0}catch(e){}},Y=async(e=!1)=>{try{let a;e&&(a=_.load("正在检查安装信息，请稍后..."));const l=await ae({name:"fileinfo",php_version:h.value.php_version});e&&a.close(),A.value=l}catch(a){}},K=async()=>{try{const e="php-"+(Number(h.value.php_version)/10).toFixed(1);ve({name:e})}catch(e){}},le=async e=>{h.value.php_version=e,Y(!0)},te=e=>{var a,l,s,o;"string"==typeof e&&(h.value.site_path&&h.value.site_path!==J.replace(/\/$/,"")||(Q.value=!1),Q.value||(h.value.site_path=(null==J?void 0:J.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim())),h.value.datauser=null==(o=null==(s=e.split("\n")[0])?void 0:s.replace(/\W/g,"_"))?void 0:o.substr(0,16),h.value.datapassword=t(16),h.value.project_ps=e.split("\n")[0])},se=async()=>{var e;const a=await c.compData.getStatus();w.database=a.mysql;const l=m.value.sitePath;l&&(h.value.site_path=l,J=null==(e=l+"/")?void 0:e.replace(/\/\//g,"/")),await(async()=>{var e;try{const a=await ee();F.value=a.data.filter((e=>"纯静态"!==e.name)),F.value=F.value.reverse(),h.value.php_version=(null==(e=F.value)?void 0:e.length)?F.value[0].version:""}catch(a){}})(),await Y(),(async()=>{try{const e=await Z();N.value=e.data}catch(e){}})()};return j(se),i({init:se,onConfirm:async e=>{await f.value.validate(),A.value.status||await s({width:50,title:"提示",isHtml:!0,content:"当前版本PHP-安装扩展未安装fileinfo，可能导致项目无法启动，是否继续操作？",icon:"warning-filled"});const a=(e=>{var a;let l={...e,sql_user:e.datauser,sql_pwd:e.datapassword,sql_codeing:e.codeing,install_dependence:e.install_dependence?1:0,open_proxy:e.open_proxy?1:0,webname:{domain:"",domainlist:[],count:0}},t=null==(a=e.domains)?void 0:a.split("\n");return t.forEach(((e,a)=>{0===a?l.webname.domain=e:l.webname.domainlist.push(t[a])})),l.webname.count=l.webname.domainlist.length,l.webname=JSON.stringify(l.webname),delete l.domains,delete l.datauser,delete l.datapassword,delete l.codeing,l})(h.value);(await o({loading:b,request:G(a),message:!0})).status&&(v.value=!0,e())}}),(e,l)=>{const t=n,s=M,o=O,u=ie,p=T,i=E,c=r,m=R,v=d;return P(),q("div",null,[x(m,{ref_key:"addThinkphpSiteFormRef",ref:f,disabled:U(b),model:U(h),rules:U(we)},{default:S((()=>[x(o,{label:"绑定域名",prop:"domains"},{default:S((()=>[x(s,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:U(D),"onUpdate:visible":l[2]||(l[2]=e=>C(D)?D.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:S((()=>[x(t,{onInput:te,modelValue:U(h).domains,"onUpdate:modelValue":l[0]||(l[0]=e=>U(h).domains=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:l[1]||(l[1]=e=>D.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])])),default:S((()=>[l[15]||(l[15]=I("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[V(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),I("br"),V(" IP地址格式：192.168.1.199 "),I("br"),V(" 泛解析添加方法 *.domain.com "),I("br"),V(" 如另加端口格式为 www.domain.com:88 ")],-1))])),_:1},8,["visible"])])),_:1}),x(o,{label:"项目目录",prop:"site_path"},{default:S((()=>[x(u,{modelValue:U(h).site_path,"onUpdate:modelValue":l[3]||(l[3]=e=>U(h).site_path=e),placeholder:"请输入项目目录",icon:"el-folder-opened",width:"52rem",onFocus:l[4]||(l[4]=e=>Q.value=!0),onIconClick:W},null,8,["modelValue"])])),_:1}),x(o,{label:"PHP版本"},{default:S((()=>[I("div",Ce,[I("div",De,[x(i,{class:"!w-[16rem]",modelValue:U(h).php_version,"onUpdate:modelValue":l[5]||(l[5]=e=>U(h).php_version=e),onChange:le},{default:S((()=>[(P(!0),q(k,null,L(U(F),(e=>(P(),z(p,{key:e.value,label:e.name,value:e.version},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),x(o,{label:"fileinfo版本"},{default:S((()=>[U(A).status?(P(),q("span",Ie,"当前php已安装fileinfo扩展")):(P(),z(c,{key:0,onClick:K},{default:S((()=>l[16]||(l[16]=[V("当前php未安装fileinfo扩展 >>立即安装")]))),_:1}))])),_:1})])])),_:1}),x(o,{label:"数据库"},{default:S((()=>[I("div",Le,[x(i,{class:"!w-[16rem]",modelValue:U(h).sql,"onUpdate:modelValue":l[6]||(l[6]=e=>U(h).sql=e),disabled:!U(w).database},{default:S((()=>[x(p,{label:"不创建",value:!1}),x(p,{label:"MySQL",value:"MYSQL"})])),_:1},8,["modelValue","disabled"]),U(w).database?H("",!0):(P(),q("span",{key:0,onClick:l[7]||(l[7]=e=>(async e=>{const{data:l}=await a({sName:e});ce({name:l.name,type:"i",pluginInfo:l})})("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),U(h).sql?(P(),z(i,{key:1,class:"ml-[8px] !w-[16rem]",modelValue:U(h).codeing,"onUpdate:modelValue":l[8]||(l[8]=e=>U(h).codeing=e)},{default:S((()=>[x(p,{label:"utf8mb4",value:"utf8mb4"}),x(p,{label:"utf8",value:"utf8"}),x(p,{label:"gbk",value:"gbk"}),x(p,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])):H("",!0)])])),_:1}),U(h).sql?(P(),z(o,{key:0,label:"数据库账号"},{default:S((()=>[I("div",Fe,[x(o,{prop:"datauser"},{default:S((()=>[x(t,{placeholder:"创建数据库账号",modelValue:U(h).datauser,"onUpdate:modelValue":l[9]||(l[9]=e=>U(h).datauser=e)},null,8,["modelValue"])])),_:1}),x(o,{label:"密码",class:"!mt-0"},{default:S((()=>[x(t,{placeholder:"数据库密码",modelValue:U(h).datapassword,"onUpdate:modelValue":l[10]||(l[10]=e=>U(h).datapassword=e)},null,8,["modelValue"])])),_:1})]),l[17]||(l[17]=I("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))])),_:1})):H("",!0),x(o,{label:"运行用户"},{default:S((()=>[x(i,{class:"!w-[16rem]",modelValue:U(h).run_user,"onUpdate:modelValue":l[11]||(l[11]=e=>U(h).run_user=e)},{default:S((()=>[(P(!0),q(k,null,L(U(N),(e=>(P(),z(p,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),l[18]||(l[18]=I("span",{class:"text-[#999] text-[1.2rem] ml-[.4rem]"},"* 无特殊需求请选择www用户",-1))])),_:1}),x(o,{label:"启动命令",prop:"project_cmd"},{default:S((()=>[x(t,{modelValue:U(h).project_cmd,"onUpdate:modelValue":l[12]||(l[12]=e=>U(h).project_cmd=e),width:"52rem",placeholder:"请输入项目的启动命令，例：php serve.php"},null,8,["modelValue"])])),_:1}),x(o,{label:"依赖安装"},{default:S((()=>[x(i,{class:"!w-[16rem]",modelValue:U(h).composer_version,"onUpdate:modelValue":l[13]||(l[13]=e=>U(h).composer_version=e),"empty-values":[null,void 0]},{default:S((()=>[x(p,{label:"不安装",value:""}),x(p,{label:"用composer2.7.3安装",value:"2.7.3"}),x(p,{label:"用1.10.27安装",value:"1.10.27"})])),_:1},8,["modelValue"])])),_:1}),x(o,{label:"备注"},{default:S((()=>[x(t,{modelValue:U(h).project_ps,"onUpdate:modelValue":l[14]||(l[14]=e=>U(h).project_ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])])),_:1})])),_:1},8,["disabled","model","rules"]),x(v,{class:"mt-2rem pl-1rem",options:$})])}}}),[["__scopeId","data-v-c81d23b6"]]),ze={class:"flex items-center"},Me={class:"flex items-center mb-[4px]"},Oe=u(h({__name:"index",props:{compData:{default:{}}},setup(s,{expose:r}){const u=s,{panel:p}=e(),{isRefreshList:i}=_e(),c=y({database:!1}),m=g(),v=g(!1),_=g({site_path:"/www/wwwroot",project_cmd:"",install_dependence:0,php_version:"",domains:"",sql:!1,project_ps:"",project_port:"",codeing:"utf8mb4",open_proxy:!1,project_proxy_path:"",datauser:"",datapassword:"",run_user:"www",composer_version:""}),w=g(!1),f=g([]),b=g([]),h=g(!1);let D="/www/wwwroot/";const F=[{content:"当前仅支持nginx服务器使用"},{content:x(k,null,[V("【自动安装项目依赖】只尝试"),x("span",{class:"text-danger"},[V("composer install")]),V("进行安装依赖，最终安装结果请前往 项目-日志-安装依赖日志 进行确认，若安装依赖不成功，项目会"),x("span",{class:"text-danger"},[V("启动失败")])])},{content:"安装依赖不成功，可能和composer版本有关，可尝试切换composer版本"}],N=()=>{me({type:"dir",path:_.value.site_path.replace(/\/$/,""),change:e=>{l(e,"string",""),_.value.site_path=e,h.value=!0,A()}})},A=async()=>{try{const e=await X({path:_.value.site_path});_.value.composer_version=e.data?"2.7.3":"",_.value.install_dependence=e.data?1:0}catch(e){}},Q=e=>{var a,l,s,o;"string"==typeof e&&(_.value.site_path&&_.value.site_path!==D.replace(/\/$/,"")||(h.value=!1),h.value||(_.value.site_path=(null==D?void 0:D.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim())),_.value.datauser=null==(o=null==(s=e.split("\n")[0])?void 0:s.replace(/\W/g,"_"))?void 0:o.substr(0,16),_.value.datapassword=t(16),_.value.project_ps=e.split("\n")[0])},J=async()=>{var e;const a=await u.compData.getStatus();c.database=a.mysql;const l=p.value.sitePath;l&&(_.value.site_path=l,D=null==(e=l+"/")?void 0:e.replace(/\/\//g,"/")),(async()=>{var e;try{const a=await ee();f.value=a.data.filter((e=>"纯静态"!==e.name)),f.value=f.value.reverse(),_.value.php_version=(null==(e=f.value)?void 0:e.length)?f.value[0].version:""}catch(a){}})(),(async()=>{try{const e=await Z();b.value=e.data}catch(e){}})()};return j(J),r({init:J,onConfirm:async e=>{await m.value.validate();const a=(e=>{var a;let l={...e,sql_user:e.datauser,sql_pwd:e.datapassword,sql_codeing:e.codeing,install_dependence:e.install_dependence?1:0,open_proxy:e.open_proxy?1:0,webname:{domain:"",domainlist:[],count:0}},t=null==(a=e.domains)?void 0:a.split("\n");return t.forEach(((e,a)=>{0===a?l.webname.domain=e:l.webname.domainlist.push(t[a])})),l.webname.count=l.webname.domainlist.length,l.webname=JSON.stringify(l.webname),delete l.domains,delete l.datauser,delete l.datapassword,delete l.codeing,l})(_.value);(await o({loading:v,request:G(a),message:!0})).status&&(i.value=!0,e())}}),(e,l)=>{const t=n,s=M,o=O,r=ie,u=T,p=E,i=R,y=d;return P(),q("div",null,[x(i,{ref_key:"addUniversalSiteFormRef",ref:m,disabled:U(v),model:U(_),rules:U(we)},{default:S((()=>[x(o,{label:"绑定域名",prop:"domains"},{default:S((()=>[x(s,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:U(w),"onUpdate:visible":l[2]||(l[2]=e=>C(w)?w.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:S((()=>[x(t,{onInput:Q,modelValue:U(_).domains,"onUpdate:modelValue":l[0]||(l[0]=e=>U(_).domains=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:l[1]||(l[1]=e=>w.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])])),default:S((()=>[l[15]||(l[15]=I("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[V(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),I("br"),V(" IP地址格式：192.168.1.199 "),I("br"),V(" 泛解析添加方法 *.domain.com "),I("br"),V(" 如另加端口格式为 www.domain.com:88 ")],-1))])),_:1},8,["visible"])])),_:1}),x(o,{label:"项目目录",prop:"site_path"},{default:S((()=>[x(r,{modelValue:U(_).site_path,"onUpdate:modelValue":l[3]||(l[3]=e=>U(_).site_path=e),placeholder:"请输入项目目录",icon:"el-folder-opened",width:"52rem",onFocus:l[4]||(l[4]=e=>h.value=!0),onIconClick:N},null,8,["modelValue"])])),_:1}),x(o,{label:"PHP版本"},{default:S((()=>[x(p,{class:"!w-[16rem]",modelValue:U(_).php_version,"onUpdate:modelValue":l[5]||(l[5]=e=>U(_).php_version=e)},{default:S((()=>[(P(!0),q(k,null,L(U(f),(e=>(P(),z(u,{key:e.value,label:e.name,value:e.version},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),x(o,{label:"数据库"},{default:S((()=>[I("div",ze,[x(p,{class:"!w-[16rem]",modelValue:U(_).sql,"onUpdate:modelValue":l[6]||(l[6]=e=>U(_).sql=e),disabled:!U(c).database},{default:S((()=>[x(u,{label:"不创建",value:!1}),x(u,{label:"MySQL",value:"MYSQL"})])),_:1},8,["modelValue","disabled"]),U(c).database?H("",!0):(P(),q("span",{key:0,onClick:l[7]||(l[7]=e=>(async e=>{const{data:l}=await a({sName:e});ce({name:l.name,type:"i",pluginInfo:l})})("mysql")),class:"ml-[4px] text-danger cursor-pointer !text-[1.2rem]"},"未安装数据库，点击安装")),U(_).sql?(P(),z(p,{key:1,class:"ml-[8px] !w-[16rem]",modelValue:U(_).codeing,"onUpdate:modelValue":l[8]||(l[8]=e=>U(_).codeing=e)},{default:S((()=>[x(u,{label:"utf8mb4",value:"utf8mb4"}),x(u,{label:"utf8",value:"utf8"}),x(u,{label:"gbk",value:"gbk"}),x(u,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])):H("",!0)])])),_:1}),U(_).sql?(P(),z(o,{key:0,label:"数据库账号"},{default:S((()=>[I("div",Me,[x(o,{prop:"datauser"},{default:S((()=>[x(t,{placeholder:"创建数据库账号",modelValue:U(_).datauser,"onUpdate:modelValue":l[9]||(l[9]=e=>U(_).datauser=e)},null,8,["modelValue"])])),_:1}),x(o,{label:"密码",class:"!mt-0"},{default:S((()=>[x(t,{placeholder:"数据库密码",modelValue:U(_).datapassword,"onUpdate:modelValue":l[10]||(l[10]=e=>U(_).datapassword=e)},null,8,["modelValue"])])),_:1})]),l[16]||(l[16]=I("span",{class:"text-[#999] text-[1.2rem]"},"创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。",-1))])),_:1})):H("",!0),x(o,{label:"运行用户"},{default:S((()=>[x(p,{class:"!w-[16rem]",modelValue:U(_).run_user,"onUpdate:modelValue":l[11]||(l[11]=e=>U(_).run_user=e)},{default:S((()=>[(P(!0),q(k,null,L(U(b),(e=>(P(),z(u,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),l[17]||(l[17]=I("span",{class:"text-[#999] text-[1.2rem] ml-[.4rem]"},"* 无特殊需求请选择www用户",-1))])),_:1}),x(o,{label:"启动命令",prop:"project_cmd"},{default:S((()=>[x(t,{modelValue:U(_).project_cmd,"onUpdate:modelValue":l[12]||(l[12]=e=>U(_).project_cmd=e),width:"52rem",placeholder:"请输入项目的启动命令，例：php serve.php"},null,8,["modelValue"])])),_:1}),x(o,{label:"依赖安装"},{default:S((()=>[x(p,{class:"!w-[16rem]",modelValue:U(_).composer_version,"onUpdate:modelValue":l[13]||(l[13]=e=>U(_).composer_version=e),"empty-values":[null,void 0]},{default:S((()=>[x(u,{label:"不安装",value:""}),x(u,{label:"用2.7.3安装",value:"2.7.3"}),x(u,{label:"用1.10.27安装",value:"1.10.27"})])),_:1},8,["modelValue"])])),_:1}),x(o,{label:"备注"},{default:S((()=>[x(t,{modelValue:U(_).project_ps,"onUpdate:modelValue":l[14]||(l[14]=e=>U(_).project_ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])])),_:1})])),_:1},8,["disabled","model","rules"]),x(y,{class:"mt-2rem pl-1rem",options:F})])}}}),[["__scopeId","data-v-cf1ba41e"]]),Te={class:"pb-0 w-full"},Ee={class:"py-[8px] px-[12px] text-[#666] bg-[#e8f6eb] !w-full block flex items-center"},Re={class:"inline-grid grid-cols-3 text-[1.2rem] gap-x-6 gap-y-2 !w-[60rem] !h-[12.3rem]"},Ne=["onClick"],Ae={class:"!p-[12px] flex flex-col text-[#666]"},Qe={class:"w-full flex items-center"},Je={class:"flex flex-col items-start leading-9 w-full"},$e={class:"truncate font-bold"},We={class:"w-[14rem] truncate"},Be={class:"flex items-center"},Ye={key:0,class:"svgtofont-el-success-filled text-[3.2rem] mr-[8px]"},Xe={class:"flex flex-col items-start leading-9 w-full"},Ge={key:0,class:"truncate font-bold"},Ke={class:"flex flex-col bg-[#f8f8f8] p-[12px] px-[16px] text-[1.2rem] w-full"},Ze={class:"flex items-center justify-between"},ea={class:"text-[#999] flex items-center"},aa={class:"p-[20px]"},la={class:"flex items-center mb-[4px]"},ta=["onClick"],sa=u(h({__name:"index",props:{compData:{default:{}}},setup(a,{expose:l}){const s=a,{panel:o}=e(),{isRefreshList:d}=_e(),u=p(),w=g([]),f=g(0),b=g(!1),h=g(),W=g(!1),B=A("popupClose");let Y="/www/wwwroot/";const X=g({menuType:"addDeployment",path:"/www/wwwroot",ftp:!1,type:"PHP",type_id:0,ps:"",port:"",version:"",need_index:0,need_404:0,sql:!1,codeing:"utf8mb4",webname:"",ftp_username:"",ftp_password:"",datauser:"",datapassword:""}),G=g({ftp:!0,ftpData:{username:"",password:""},sql:!0,databaseStatus:!0,sqlData:{username:"",password:""},siteStatus:!1,site:{name:""}}),K=g({isSetup:!1,versions:[],version:"",code:"utf8mb4"}),Z=g({title:"111",version:"222"}),ae=y({datauser:"",datapassword:"",type:"MySQL",code:"utf8mb4",version:""}),ne=g(null),re=g([]),de=g(!1),ue=g(!1),pe=g([]),ve=()=>{me({type:"dir",path:X.value.path,change:e=>{X.value.path=e}})},fe=e=>{var a,l,s;"string"==typeof e&&(X.value.ps=e.split("\n")[0],X.value.path=(null==Y?void 0:Y.replace(/\/\//g,"/"))+(null==(l=null==(a=e.split("\n")[0])?void 0:a.replace(/:/g,"_"))?void 0:l.trim()),X.value.datapassword=t(),X.value.datauser=null==(s=e.split("\n")[0])?void 0:s.replace(/\W/g,"_").substring(0,16))},be=()=>{i({isAsync:!0,title:"模板",area:84,component:()=>c((()=>import("./other-template.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{templateData:ne.value,templateId:f.value,selectTemplate:xe}})},he=()=>{de.value=!0,ae.datauser=X.value.datauser,ae.datapassword=X.value.datapassword,ae.version=K.value.version},ye=async e=>{const a=null==e?void 0:e.php.split(","),l=K.value.versions.filter((e=>a.includes(e.version))).map((e=>e.version));pe.value=a.map((e=>({name:"PHP-"+e,version:e,status:l.includes(e)}))),K.value.version=l[l.length-1],ae.version=K.value.version,X.value.version=K.value.version},ge=async()=>{de.value=!1,X.value.datauser=ae.datauser,X.value.datapassword=ae.datapassword,X.value.codeing=ae.code,K.value.version=ae.version,K.value.code=ae.code,X.value.version=K.value.version},xe=e=>{f.value=e;const a=re.value.findIndex((a=>a.id===e));a<5?(Z.value={},ye(re.value[a])):(Z.value=re.value.find((a=>a.id===e)),ye(Z.value)),X.value.datauser="sql"+t(6),X.value.datapassword=t(6,"password")};Q((()=>K.value.version),(()=>{X.value.version=K.value.version}));const Ve=async()=>{var e,a,l;try{ue.value=!0,await(async()=>{try{const e=await s.compData.getStatus(),a=await ee();K.value.isSetup=e.mysql,K.value.versions=a.data.filter((e=>"00"!==e.version))}catch(e){}})(),await(async()=>{try{const{data:e}=await se();w.value=e.list,re.value=e.list,ne.value=e}catch(e){}})(),f.value=null==(e=re.value[0])?void 0:e.id,await ye(re.value[0]),xe(null==(a=re.value[0])?void 0:a.id),ue.value=!1,X.value.sql="MySQL",Z.value={};const t=o.value.sitePath;t&&(X.value.path=t,Y=null==(l=t+"/")?void 0:l.replace(/\/\//g,"/"))}catch(t){ue.value=!1}};return j(Ve),l({init:Ve,onConfirm:async e=>{let a=Object.assign({},X.value);a.ftp?(G.value.ftpData.username=a.ftp_username,G.value.ftpData.password=a.ftp_password):(delete a.ftp_username,delete a.ftp_password,G.value.ftp=!1),a.sql?(G.value.sqlData.username=a.user,G.value.sqlData.password=a.password):(delete a.datauser,delete a.datapassword,G.value.sql=!1),-1!==a.webname.split("\n")[0].indexOf(":")?a.port=a.webname.split("\n")[0].split(":")[1]:a.port=80;let l=a.webname.split("\n");l.shift(),a.webname=JSON.stringify({domain:a.webname.split("\n")[0],domainlist:l,count:l.length}),delete a.menuType,await h.value.validate();try{b.value=!0;const e=await le(a);if(!1===e.data.status)return u.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.status?"添加网站成功":e.msg,type:e.status?"success":"error",duration:e.status?3e3:0,showClose:!e.status});e.status&&B();let l=u.load("正在部署中...");const{data:t}=await te({source:1,site_name:JSON.parse(a.webname).domain,php_version:a.version,dname:w.value.find((e=>e.id===f.value)).name});l.close(),e.data.siteStatus&&(G.value.siteStatus=!0,G.value.site.name=JSON.parse(a.webname).domain+t.msg.success_url),a.ftp||a.sql?(G.value.sqlData.username=a.datauser,G.value.sqlData.password=a.datapassword,G.value.databaseStatus=e.data.databaseStatus,i({isAsync:!0,title:"网站添加结果",area:46,component:()=>c((()=>import("./add-result.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:G.value})):u.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.data.status?"添加网站成功":e.data.msg,type:e.data.status?"success":"error",duration:e.data.status?3e3:0,showClose:!e.data.status}),d.value=!0}catch(t){m(t)}finally{b.value=!1}}}),(e,a)=>{const l=r,t=_,s=M,o=O,d=n,u=ie,p=R,i=T,c=E,m=v,w=N;return P(),q("div",Te,[I("span",Ee,[a[12]||(a[12]=V(" 快速的部署网站程序，商城、论坛、博客、框架等程序， ")),x(l,{href:"https://www.bt.cn/bbs/thread-33063-1-1.html"},{default:S((()=>a[11]||(a[11]=[V(" 免费入驻平台 ")]))),_:1})]),x(p,{model:U(X),rules:U(we),class:"pt-[12px]",ref_key:"addDeploySiteFormRef",ref:h},{default:S((()=>[x(o,{label:"模板部署",class:""},{default:S((()=>{var e,o;return[I("div",Re,[(P(!0),q(k,null,L(U(re),((e,a)=>D((P(),q("div",{key:e.id,class:J([{"template-focus":U(f)===e.id},"mb-[4px] w-full flex items-center border border-[#ccc] py-[4px] px-[8px] rounded-[4px] cursor-pointer template-hover"]),onClick:a=>(e=>{f.value=e.id,xe(e.id)})(e)},[x(s,{ref_for:!0,ref:"popover",placement:"top-start",width:"200","popper-class":"white-tips-popover",trigger:"hover"},{reference:S((()=>[I("div",Qe,[x(t,{src:"/site_dep_ico/".concat(e.name.toLowerCase(),".png"),class:"w-[3.6rem] mr-[4px]"},null,8,["src"]),I("div",Je,[I("span",$e,F(e.title)+" "+F(e.version),1),I("span",We,F(e.ps.split("<")[0]),1)])])])),default:S((()=>[I("div",Ae,[I("span",null,"名称："+F(e.title),1),I("span",null,"版本："+F(e.version),1),I("span",null,"简介："+F(e.ps.split("<")[0]),1),I("span",null,"官网："+F(e.official),1),I("span",null,"评价："+F(e.score),1)])])),_:2},1536)],10,Ne)),[[$,a<5]]))),128)),I("div",{onClick:be,class:J([{"justify-center":!U(Z).id,"template-focus":U(Z).id},"mb-[4px] w-full flex items-center border border-[#ccc] py-[4px] px-[12px] rounded-[4px] cursor-pointer template-hover"])},[I("div",Be,[(null==(e=U(Z))?void 0:e.id)?(P(),q("i",Ye)):H("",!0),I("div",Xe,[(null==(o=U(Z))?void 0:o.id)?(P(),q("span",Ge,F(U(Z).title)+" "+F(U(Z).version),1)):H("",!0),x(l,null,{default:S((()=>a[13]||(a[13]=[V("更多模板 >>")]))),_:1})])])],2)])]})),_:1}),x(o,{label:"域名",prop:"webname"},{default:S((()=>[x(s,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:U(W),"onUpdate:visible":a[2]||(a[2]=e=>C(W)?W.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:S((()=>[D(x(d,{onInput:fe,modelValue:U(X).webname,"onUpdate:modelValue":a[0]||(a[0]=e=>U(X).webname=e),type:"textarea",width:"52rem",rows:4,resize:"none",onFocus:a[1]||(a[1]=e=>W.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"]),[[w,void 0,"popover"]])])),default:S((()=>[a[14]||(a[14]=I("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[V(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口 "),I("br"),V(" IP地址格式：192.168.1.199 "),I("br"),V(" 泛解析添加方法 *.domain.com "),I("br"),V(" 如另加端口格式为 www.domain.com:88 ")],-1))])),_:1},8,["visible"])])),_:1}),x(o,{label:"备注"},{default:S((()=>[x(d,{modelValue:U(X).ps,"onUpdate:modelValue":a[3]||(a[3]=e=>U(X).ps=e),placeholder:"请输入备注,可为空",width:"52rem"},null,8,["modelValue"])])),_:1}),x(o,{label:"根目录",prop:"path"},{default:S((()=>[x(u,{modelValue:U(X).path,"onUpdate:modelValue":a[4]||(a[4]=e=>U(X).path=e),placeholder:"请输入根目录",icon:"el-folder-opened",width:"52rem",onIconClick:ve},null,8,["modelValue"])])),_:1}),x(o,{label:"其他配置",prop:"other"},{default:S((()=>[I("div",Ke,[I("div",Ze,[I("span",{class:J({"text-danger":!U(K).isSetup})}," 数据库："+F(U(K).isSetup?"MySQL数据库":"数据库未安装！"),3),I("span",null,"编码："+F(U(K).code),1),I("span",null,"账号："+F(U(X).datauser),1),I("span",null,"密码："+F(U(X).datapassword),1),I("span",null,"PHP版本："+F(U(K).version),1)])]),I("span",ea,[a[16]||(a[16]=V(" 其他配置初始状态为默认选择的配置项，如需修改请点击 ")),x(l,{onClick:he},{default:S((()=>a[15]||(a[15]=[V("编辑配置")]))),_:1})])])),_:1})])),_:1},8,["model","rules"]),x(m,{title:"编辑配置",modelValue:U(de),"onUpdate:modelValue":a[10]||(a[10]=e=>C(de)?de.value=e:null),showFooter:"",area:62,onConfirm:ge},{default:S((()=>[I("div",aa,[x(p,{model:U(ae),rules:U(we),ref:"editFormRef"},{default:S((()=>[x(o,{label:"数据库"},{default:S((()=>[x(c,{class:"!w-[16rem]",modelValue:U(X).sql,"onUpdate:modelValue":a[5]||(a[5]=e=>U(X).sql=e)},{default:S((()=>[x(i,{label:"MySQL",value:"MySQL"})])),_:1},8,["modelValue"]),x(c,{modelValue:U(ae).code,"onUpdate:modelValue":a[6]||(a[6]=e=>U(ae).code=e),class:"ml-[8px] !w-[16rem]"},{default:S((()=>[x(i,{label:"utf8mb4",value:"utf8mb4"}),x(i,{label:"utf8",value:"utf8"}),x(i,{label:"gbk",value:"gbk"}),x(i,{label:"big5",value:"big5"})])),_:1},8,["modelValue"])])),_:1}),x(o,{label:"数据库账号"},{default:S((()=>[I("div",la,[x(o,{prop:"datauser",label:""},{default:S((()=>[x(d,{placeholder:"创建数据库账号",modelValue:U(ae).datauser,"onUpdate:modelValue":a[7]||(a[7]=e=>U(ae).datauser=e),width:"17rem"},null,8,["modelValue"])])),_:1}),x(o,{label:"",class:"!mt-0"},{default:S((()=>[x(d,{class:"ml-[8px]",width:"16rem",placeholder:"数据库密码",modelValue:U(ae).datapassword,"onUpdate:modelValue":a[8]||(a[8]=e=>U(ae).datapassword=e)},null,8,["modelValue"])])),_:1})]),a[17]||(a[17]=I("span",{class:"text-[#999] text-[1.2rem]"}," 创建站点的同时，为站点创建一个对应的数据库帐户，方便不同站点使用不同数据库。 ",-1))])),_:1}),x(o,{label:"PHP版本"},{default:S((()=>[x(c,{class:"!w-[16rem]",modelValue:U(ae).version,"onUpdate:modelValue":a[9]||(a[9]=e=>U(ae).version=e)},{default:S((()=>[(P(!0),q(k,null,L(U(pe),(e=>(P(),z(i,{key:e.value,label:e.name,disabled:!e.status,value:e.version},{default:S((()=>[I("span",null,F(e.name),1),e.status?H("",!0):(P(),q(k,{key:0},[a[18]||(a[18]=V(" [ ")),I("a",{class:"my-4px bt-link",onClick:a=>(async e=>{try{const a="php-"+(Number(e)/10).toFixed(1),{data:l}=await oe({sName:a});ce({name:a,type:"i",pluginInfo:l})}catch(a){}})(e.version)},"未安装",8,ta),a[19]||(a[19]=V(" ] "))],64))])),_:2},1032,["label","disabled","value"])))),128))])),_:1},8,["modelValue"]),a[20]||(a[20]=I("span",{class:"text-[#999] text-[1.2rem] ml-1rem"},"* 仅显示选中模板所支持的PHP版本",-1))])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-b4ba70b5"]]),oa=h({__name:"index",setup(e,{expose:a}){const{isRefreshList:l}=_e(),t=p(),s=g("域名|1|0|0|0\n域名|1|0|0|0\n域名|1|0|0|0"),o=A("popupClose"),r=e=>e.replace(/\s+/g,""),d=[{label:"名称",prop:"name"},{label:"FTP",prop:"db_status",render:e=>"boolean"==typeof e.db_status?W("span",{class:e.db_status?"text-primary":""},e.db_status?"已配置":"未配置"):W("span",e.db_status)},{label:"数据库",prop:"ftp_status",render:e=>"boolean"==typeof e.ftp_status?W("span",{class:e.ftp_status?"text-primary":""},e.ftp_status?"已配置":"未配置"):W("span",e.ftp_status)},{label:"结果",render:e=>W("span",{class:e.status?"text-primary":"text-danger truncate !w-[9.6rem] inline-block"},e.status?"操作成功":e.msg)}];return a({onConfirm:async e=>{let a=s.value.split("\n"),n=[];for(let l=0;l<a.length;l++){let e=a[l],s=e.split("|"),o=[];if(""!==e){for(let e=0;e<s.length;e++){let a=l+1,n=r(s[e]);switch(o.push(n),e){case 0:let e=n.split(",");for(let l=0;l<e.length;l++){let s=e[l].trim().split(":");if(p=s[0],!/^([\w\u4e00-\u9fa5\-\*]{1,100}\.){1,10}([\w\u4e00-\u9fa5\-]{1,24}|[\w\u4e00-\u9fa5\-]{1,24}\.[\w\u4e00-\u9fa5\-]{1,24})$/.test(r(p)))return t.error("第"+a+"行,域名格式错误【"+s[0]+"】"),!1;if(void 0!==s[1]&&(u=s[1],!/^([1-9]|[1-9]\d|[1-9]\d{2}|[1-9]\d{3}|[1-5]\d{4}|6[0-4]\d{3}|65[0-4]\d{2}|655[0-2]\d|6553[0-5])$/.test(u)))return t.error("第"+a+"行,端口格式错误【"+s[1]+"】"),!1}break;case 1:if("1"!==n&&n.indexOf("/")<-1)return t.error("第"+a+"行,站点目录格式错误【"+n+"】"),!1}}n.push(o.join("|").replace(/\r|\n/,""))}}var u,p;let i=t.load("正在批量添加站点,请稍后...");try{const{data:e}=await ne({create_type:"txt",websites_content:JSON.stringify(n)});let a=[];Object.keys(e.success).forEach((l=>{a.push({name:l,status:!0,ftp_status:e.success[l].ftp_status,db_status:e.success[l].db_status})})),Object.keys(e.error).forEach((l=>{a.push({name:l,status:!1,ftp_status:"--",db_status:"--",msg:e.error[l]})})),l.value=!0,o(),fe({resultColumn:d,resultData:a,resultTitle:"添加站点"},46),s.value="域名|1|0|0|0\n域名|1|0|0|0\n域名|1|0|0|0"}catch(c){}finally{i.close()}}}),(e,a)=>{const l=n;return P(),q("div",null,[x(l,{type:"textarea",modelValue:U(s),"onUpdate:modelValue":a[0]||(a[0]=e=>C(s)?s.value=e:null),rows:12,resize:"none",width:"72rem"},null,8,["modelValue"]),a[1]||(a[1]=I("ul",{class:"mt-[8px] text-[#999] leading-10"},[I("li",null,"批量格式：域名|根目录|FTP|数据库|PHP版本"),I("li",null,"域名参数：多个域名用 , 分割"),I("li",null,"根目录参数：填写 1 为自动创建，或输入具体目录"),I("li",null,"FTP参数：填写 1 为自动创建，填写 0 为不创建"),I("li",null,"数据库参数：填写 1 为自动创建，填写 0 为不创建"),I("li",null,"PHP版本参数：填写 0 为静态，或输入PHP具体版本号列如：56、71、74"),I("li",null,"如需添加多个站点，请换行填写"),I("li",null,[V(" 案例： "),I("span",null,"bt.cn,test.cn:8081|/www/wwwroot/bt.cn|1|1|56")])],-1))])}}}),na={class:"h-[58rem]"},ra=h({__name:"index",setup(e,{expose:a}){const l=g(),t=A("popupClose"),n=g([]),r=g(!1),u=[{content:"请选择您的环境包进行网站部署"},{content:"如需导入,请选择本地计算机中后缀为tar.gz格式的应用环境包"}],p=async(e,a,l,t)=>{const{label:s,value:o}=t,n=new Map([["delete","批量删除选中的应用包"]]),r=async(e,a)=>{const l=new Map([["delete",re]]),{app_name:t,app_version:s}=e,n=l.get(o);if("delete"===o)if(n)return await n({app_name:t,app_version:s})};await e({title:"批量".concat(s),content:"".concat(n.get(o),"，是否继续操作？"),column:[{label:"环境包",prop:"app_name"},ge()],onConfirm:async()=>(await a(r),b(),!1)})},m=async e=>{await s({title:"删除环境包【".concat(e.app_name,"】"),content:"您真的要删除环境包【".concat(e.app_name,"】吗？")});(await o({loading:"正在删除环境包，请稍后...",request:re({app_name:e.app_name,app_version:e.app_version}),message:!0})).status&&b()},v=async()=>{i({title:"上传应用环境包",isAsync:!0,component:()=>c((()=>import("./upload-app.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),area:80,btn:["开始上传","取消"],compData:{refreshEvent:b,path:"/www/backup/upload_package/temp",api:"/mod/php/aepg/upload_package",accept:".gz",help:[{text:"只支持.tar.gz文件格式导入"}],useEmptyPlaceholder:!1}})},_=e=>{i({isAsync:!0,title:"部署应用环境包",area:70,btn:"确定",component:()=>c((()=>import("./deploy-package.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{...e,close:t}})},b=async()=>{await o({loading:r,request:de(),data:{data:[Array,n]}})},h=g([he(),{label:"名称",prop:"app_name"},{label:"版本",prop:"app_version"},{label:"时间",width:150,prop:"addtime"},ye([{onClick:_,title:"部署"},{onClick:m,title:"删除"}])]),y=[{label:"删除",value:"delete",event:p}];return j(b),a({init:b}),(e,a)=>{const t=Y,s=w,o=f,p=be,i=d,c=B("bt-loading");return P(),q("div",na,[x(p,null,{"header-left":S((()=>[x(t,{type:"primary",onClick:v},{default:S((()=>a[0]||(a[0]=[V("导入应用包")]))),_:1})])),"header-right":S((()=>a[1]||(a[1]=[]))),content:S((()=>[D(x(s,{ref_key:"appEnvPackRef",ref:l,column:U(h),data:U(n),"max-height":480},null,8,["column","data"]),[[c,U(r)]])])),"footer-left":S((()=>[x(o,{"table-ref":U(l),options:U(y)},null,8,["table-ref","options"])])),_:1}),x(i,{options:u,class:"list-disc mt-[2rem] ml-[2rem]"})])}}}),da={class:"p-[20px]"},ua=h({__name:"index",props:{compData:{default:{}}},setup(a,{expose:l}){const t=a,{plugin:s}=e(),o=p(),n=g("addSiteDefault");g(null);const r=A("popupSetFooter",(e=>{})),d=async()=>{try{const{data:e}=await ue();return{ftp:e.ftp,mysql:e.mysql}}catch(e){m(e)}},{typeList:u,refresh:i}=t.compData,{BtTabs:c,tabsRefs:v}=b({type:"card",value:n,options:[{label:"传统项目",name:"addSiteDefault",lazy:!0,render:x(pe,{compData:{getStatus:d,typeList:u,refresh:i}},null)},{label:"swoole异步项目",name:"addSwoole",lazy:!0,render:x(Ue,{compData:{getStatus:d}},null)},{label:"thinkphp异步项目",name:"addThinkphp",lazy:!0,render:x(He,{compData:{getStatus:d}},null)},{label:"异步项目",name:"addUniversal",lazy:!0,render:x(Oe,{compData:{getStatus:d}},null)},{label:"一键部署",name:"addDeployment",lazy:!0,render:x(sa,{compData:{getStatus:d}},null)},{label:"批量创建",name:"batchAddSite",lazy:!0,render:x(oa,null,null)},{label:"应用环境包",name:"addPack",lazy:!0,render:x(ra,null,null)}]});Q((()=>n.value),(e=>{r("addPack"!==e)}));return j((()=>{"addPack"===n.value&&r(!1)})),l({onConfirm:async e=>{if(("addSwoole"===n.value||"addThinkphp"===n.value||"addUniversal"===n.value)&&"nginx"!==s.value.webserver)return o.error("当前仅支持nginx服务器使用");v()[n.value].onConfirm(e)},getStatus:d}),(e,a)=>(P(),q("div",da,[x(U(c))]))}});export{ua as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
