import{G as a,t as e,k as t,V as n,O as s,o as i,b as o}from"./utils-lib.js?v=1734676359";import{_ as l}from"./index90.js?v=1734676359";import{c as r,r as c,h as m,o as d,B as p,k as u,l as f,e as b,x as _,y,C as w,p as g,A as h}from"./base-lib.js?v=1734676359";import{bd as j,be as C,bf as k}from"./useStore3.js?v=1734676359";import{p as v}from"./useMethods.js?v=1734676359";import{c as x,a as q,u as W}from"./column.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const z={class:"p-[1.6rem]"},A=r({__name:"container-backups-dialog",props:{compData:{default:()=>({})}},setup(r){const A=o(),D=r,O=c(),S=c(D.compData.row),B=m({loading:!1,list:[]}),G=[{label:"删除",value:"delete",event:async(a,e,t,n)=>{const{label:s,value:i}=n,o=async(a,e)=>{const{container_id:t,container_name:n,name:s}=a;if("delete"===i)return await k({data:JSON.stringify({container_id:t,container_name:n,name:s})})};await a({title:"批量".concat(s,"容器备份"),content:"批量".concat(s,"已选的容器备份，删除后备份文件将无法恢复，是否继续操作！"),column:[{label:"文件名",prop:"name"},x()],onConfirm:async()=>(await e(o),M(),!1)})}}],H=async()=>{a({request:j({container_id:S.value.id}),message:!0,success:async a=>{a.status&&(await M(),await v(!0))}})},I=async e=>{try{await i({icon:"warning-filled",title:"删除备份文件",width:"45rem",content:"删除[".concat(e.name,"]备份文件后，该备份文件将永久消失，是否继续操作？")}),a({loading:"正在删除...",request:k({container_id:e.container_id,container_name:e.container_name,name:e.name}),success:async({status:a})=>{a&&(await M(),A.success("删除成功"))},error:a=>{A.request(a)}})}catch(t){}},J=async a=>{window.open("/download?filename="+encodeURIComponent(a.filename))},M=async()=>{B.loading=!0,a({request:C({container_id:S.value.id}),data:Array,success:a=>{B.list=a,B.loading=!1}})},N=[q(),{label:"文件名",prop:"name",minWidth:140},{label:"存储位置",prop:"filename",minWidth:180,isCustom:!0},{label:"文件大小",prop:"size",minWidth:86,isCustom:!0,render:a=>e(a.size)},{label:"备份时间",prop:"addtime",minWidth:120,isCustom:!0},W([{onClick:J,title:"下载"},{onClick:I,title:"删除"}])];return d((()=>{M()})),(a,e)=>{const i=h,o=t,r=n,c=l,m=s,d=p("bt-loading");return u(),f("div",z,[b(c,null,{"header-left":_((()=>[b(i,{type:"primary",onClick:H},{default:_((()=>e[0]||(e[0]=[y("容器备份")]))),_:1})])),content:_((()=>[w(b(o,{ref_key:"backupTable",ref:O,column:g(N),"max-height":"220",data:g(B).list,description:"备份列表为空"},null,8,["column","data"]),[[d,g(B).loading],[d,"正在加载镜像列表，请稍后...","title"]])])),"footer-left":_((()=>[b(r,{"table-ref":g(O),options:G},null,8,["table-ref"])])),_:1}),b(m,{class:"mt-[2rem] ml-[1rem]",options:[{content:"备份任务创建成功后后台进行，可以关闭黑色窗口，备份完成可能需要1分钟以上！"}]})])}}});export{A as default};
