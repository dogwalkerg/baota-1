import{c as a,t as e,s as t,h as s,r as l,o as d,B as i,k as n,l as r,p as o,q as p,e as c,x as m,y as u,z as f,v as x,C as v,I as y,aX as b,J as h,Q as w,O as g,A as M,aN as j}from"./base-lib.js?v=1734676359";import{checkDelData as k,deleteAsync as _,deleteSite as S}from"./site.js?v=1734676359";import{u as D,J as V,aj as z,M as F,ah as P,t as O}from"./utils-lib.js?v=1734676359";import{c as A}from"./useController3.js?v=1734676359";import{u as C}from"./useStore7.js?v=1734676359";import{u as H}from"./useStore9.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";import"./useMethod5.js?v=1734676359";const R={class:""},U={key:0,class:"p-[20px] w-[480px]"},I={class:"flex items-center ml-[48px] mt-[12px]"},J={key:0,class:"!mt-[12px] text-danger ml-[48px]"},L={key:0},T={key:1},q={key:2},N={class:"p-[20px] bg-#f1f1f1 mt-[12px]"},B={class:"mx-[1rem]"},Q={key:1,class:"p-[20px] w-[610px]"},X={class:"border border-[#d6d7d9] min-h-[12rem] overflow-auto mt-[20px] mb-1rem max-h-[40rem]"},E={class:"inline-flex items-center justify-between px-[12px] py-[8px] w-full"},G={class:"truncate w-[28%]"},K={class:"inline-flex items-center justify-between flex-1"},W={class:"flex item-center"},Y=["title"],Z={key:0,class:"text-danger flex items-center"},$={class:"truncate !w-[180px] flex-shrink-0"},aa={key:0,class:"flex items-center justify-between px-[12px] py-[8px] w-full border-t-1 border-[#f1f1f1]"},ea={class:"truncate w-[28%]"},ta={class:"items-center inline-flex justify-between flex-1"},sa={class:"truncate mr-12px"},la={class:"truncate !w-[180px] flex-shrink-0"},da={key:0},ia={class:"text-danger bold"},na={key:1,class:"text-danger"},ra={class:"bg-[#f6f8f8] footer-btn flex items-center justify-end p-[12px] w-full"},oa=a({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(a,{emit:oa}){const pa=a,{panel:ca}=D(),{isFileRecycle:ma,isDbRecycle:ua}=e(ca.value),{isRefreshList:fa}=C(),{isRefreshLocalList:xa}=t(H()),va=oa,ya=s({addend1:Math.round(9*Math.random()+1),addend2:Math.round(9*Math.random()+1),sum:void 0,steps:1,isFtp:!1,isDatabase:!1,isSite:!1,data:{},isMult:!1,fileSize:0,dbSize:0}),ba=()=>{va("close"),ya.steps=1,ya.addend1=Math.round(9*Math.random()+1),ya.addend2=Math.round(9*Math.random()+1),ya.sum=void 0,ya.isFtp=!1,ya.isDatabase=!1,ya.isSite=!1},ha=l(!1),wa=l(5),ga=async()=>{var a,e;if(ya.sum===ya.addend1+ya.addend2){if(ya.isFtp||ya.isDatabase||ya.isSite){try{let t;ya.data.hasOwnProperty("id")?t=[ya.data.id]:(t=null==(a=ya.data)?void 0:a.map((a=>a.id)),ya.isMult=!0);const s=await k({ids:JSON.stringify(t)}),l=null==(e=z(s.data.data,"array",[]))?void 0:e.map((a=>{var e,t,s,l;return"PHPMOD"===(Array.isArray(ya.data)?null==(t=null==(e=ya.data.find((e=>e.id===a.id)))?void 0:e.project_config)?void 0:t.type:(null==(l=null==(s=ya.data)?void 0:s.project_config)?void 0:l.type)||ya.data.project_type)?{...a,project_config:{type:"PHPMOD"}}:a}));ya.data=l,ya.fileSize=s.data.file_size,ya.dbSize=s.data.db_size}catch(t){}ya.steps=2,ya.addend1=Math.round(9*Math.random()+1),ya.addend2=Math.round(9*Math.random()+1),ya.sum=void 0}else Array.isArray(ya.data)||(ya.data=[ya.data]),await ja(),ya.addend1=Math.round(9*Math.random()+1),ya.addend2=Math.round(9*Math.random()+1),ya.sum=void 0;(()=>{ha.value=!0,wa.value=5;const a=setInterval((()=>{wa.value-=1,wa.value<=0&&(clearInterval(a),ha.value=!1)}),1e3)})()}else F.error("计算错误，请重新计算")},Ma=async(a,e,t)=>{var s;const l=ya.data[e],d=(null==(s=l.project_config)?void 0:s.type)||l.project_type;let i={id:l.id,webname:l.name,ftp:ya.isFtp?1:0,database:ya.isDatabase?1:0,path:ya.isSite?1:0};ya.isFtp||delete i.ftp,ya.isDatabase||delete i.database,ya.isSite||delete i.path;const n="PHPMOD"===d?await _({id:l.id,webname:l.name}):await S(i);a.push({name:l.name,status:!0}),e===ya.data.length-1&&(fa.value=!0,xa.value=!0,t?A({resultData:a,resultTitle:"删除结果"}):F.request(n)),e<ya.data.length-1&&Ma(a,e+1,t)},ja=async()=>{let a=F.load("正在删除站点..."),e=[];try{await Ma(e,0,ya.isMult),a.close(),va("close")}catch(t){P(t)}finally{ya.steps=1}},ka=async()=>{1===ya.steps?ya.sum===ya.addend1+ya.addend2?(await ja(),va("close")):F.error("计算错误，请重新计算"):(await ja(),va("close"))};return d((()=>{ya.data=pa.compData,V(pa.compData)&&(ya.isMult=!0)})),(a,e)=>{const t=w,s=g,l=j,d=M,k=i("focus");return n(),r("div",R,[1===o(ya).steps?(n(),r("div",U,[e[11]||(e[11]=p("div",{class:"flex items-center"},[p("i",{class:"text-warning svgtofont-el-warning-filled !text-[4rem]"}),p("span",{class:"text-[1.4rem] ml-[8px] leading-10"},"是否要删除关联的FTP、数据库、站点目录！")],-1)),p("div",I,[c(t,{modelValue:o(ya).isFtp,"onUpdate:modelValue":e[0]||(e[0]=a=>o(ya).isFtp=a)},{default:m((()=>e[4]||(e[4]=[u("FTP")]))),_:1},8,["modelValue"]),c(t,{modelValue:o(ya).isDatabase,"onUpdate:modelValue":e[1]||(e[1]=a=>o(ya).isDatabase=a)},{default:m((()=>e[5]||(e[5]=[u("数据库")]))),_:1},8,["modelValue"]),c(t,{modelValue:o(ya).isSite,"onUpdate:modelValue":e[2]||(e[2]=a=>o(ya).isSite=a)},{default:m((()=>e[6]||(e[6]=[u("站点目录")]))),_:1},8,["modelValue"])]),o(ma)&&o(ua)?f("",!0):(n(),r("div",J,[p("span",null,[e[7]||(e[7]=u(" 当前 ")),o(ma)||o(ua)?f("",!0):(n(),r("span",L,"【文件回收站】【数据库回收站】")),o(ma)&&!o(ua)?(n(),r("span",T,"【数据库回收站】")):f("",!0),!o(ma)&&o(ua)?(n(),r("span",q,"【文件回收站】")):f("",!0),e[8]||(e[8]=u(" 尚未开启，请谨慎操作！ "))])])),p("div",N,[e[9]||(e[9]=p("span",null,"计算结果：",-1)),p("span",B,x(o(ya).addend1)+" + "+x(o(ya).addend2),1),e[10]||(e[10]=p("span",{class:"mr-[1rem]"},"=",-1)),v(c(s,{modelValue:o(ya).sum,"onUpdate:modelValue":e[3]||(e[3]=a=>o(ya).sum=a),autofocus:"true","controls-position":"right",size:"small"},null,8,["modelValue"]),[[k]])])])):f("",!0),2===o(ya).steps?(n(),r("div",Q,[e[20]||(e[20]=p("div",{class:"flex items-center"},[p("i",{class:"text-warning svgtofont-el-warning !text-[4rem]"}),p("span",{class:"text-[2rem] ml-[8px] leading-10 font-bold"},"堡塔温馨提示您，请冷静几秒钟，确认以下要删除的数据。")],-1)),p("div",X,[(n(!0),r(y,null,b(o(ya).data,((a,t)=>(n(),r("div",{key:t,class:"flex items-center flex-col p-[12px] border-b-1 border-[#f1f1f1] hover:bg-[#f1f1f140] last:border-b-0",style:{gap:"0.4rem"}},[p("div",E,[p("span",G,"站点名:"+x(a.name),1),p("div",K,[p("div",W,[p("span",{class:"truncate w-[110px]",title:a.path},"目录:"+x(a.path),9,Y),a.total?(n(),r("span",Z,[u(" ("+x(o(O)(a.total))+") ",1),o(ya).fileSize<=a.total?(n(),h(l,{key:0,class:"item",effect:"dark",placement:"top"},{content:m((()=>[e[12]||(e[12]=u(" 此目录较大，可能为重要数据，请谨慎操作！ ")),e[13]||(e[13]=p("br",null,null,-1)),u(" 目录："+x(a.path),1)])),default:m((()=>[e[14]||(e[14]=p("i",{class:"svgtofont-el-warning cursor-pointer ml-4px"},null,-1))])),_:2},1024)):f("",!0)])):f("",!0)]),p("span",$,"创建时间:"+x(a.addtime),1)])]),a.database?(n(),r("div",aa,[p("span",ea,"数据库:"+x(a.database.name),1),p("div",ta,[p("span",sa,[u(" 大小:"+x(o(O)(a.database.total))+" ",1),o(ya).dbSize<=a.database.total?(n(),h(l,{key:0,class:"item",effect:"dark",placement:"top"},{content:m((()=>[e[15]||(e[15]=u(" 此数据库较大，可能为重要数据，请谨慎操作！ ")),e[16]||(e[16]=p("br",null,null,-1)),u(" 数据库："+x(a.database.name),1)])),default:m((()=>[e[17]||(e[17]=p("i",{class:"svgtofont-el-warning cursor-pointer ml-4px"},null,-1))])),_:2},1024)):f("",!0)]),p("span",la,"创建时间:"+x(a.addtime),1)])])):f("",!0)])))),128))]),o(wa)&&o(ha)?(n(),r("div",da,[e[18]||(e[18]=u(" 请仔细阅读以上要删除信息，防止网站数据被误删，确认删除还有 ")),p("span",ia,x(o(wa)),1),e[19]||(e[19]=u(" 秒可以操作。 "))])):(n(),r("div",na,"注意：请仔细阅读以上要删除信息，防止网站数据被误删"))])):f("",!0),p("div",ra,[c(d,{type:"warning",onClick:ba},{default:m((()=>e[21]||(e[21]=[u("取消")]))),_:1}),1===o(ya).steps?(n(),h(d,{key:0,type:"danger",onClick:ga},{default:m((()=>e[22]||(e[22]=[u("下一步")]))),_:1})):f("",!0),2===o(ya).steps?(n(),h(d,{key:1,type:"danger",disabled:o(ha),onClick:ka},{default:m((()=>[u(x(o(wa)&&o(ha)?"等待".concat(o(wa),"秒"):"确认删除数据"),1)])),_:1},8,["disabled"])):f("",!0)])])}}});export{oa as default};
