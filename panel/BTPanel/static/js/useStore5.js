import{u as t,n as a,bh as s,a7 as e,ak as o,o as c,G as r,b as n,l as p,H as l}from"./utils-lib.js?v=1734676359";import{s as i,g as d,i as u,r as m}from"./base-lib.js?v=1734676359";import{p as g,c as f}from"./validator.js?v=1734676359";import{c as y}from"./column.js?v=1734676359";const h=d("FTP-STORE",(()=>{const{plugin:a,getGlobalInfo:s}=t(),e=u((()=>a.value.ftp.port)),o=m();return{ftpPort:e,pluginInfo:m({}),rowData:o,isRefreshFtpList:m(!1)}})),_=()=>i(h()),T=t=>a.post("ftp/SetStatus",{data:t,check:"msg"}),w=t=>a.post("ftp/DeleteUser",{data:t,check:"msg"}),b=t=>a.post("ftp/AddUser",{data:t,check:"msg"}),F=t=>a.post("ftp/GetFtpUserAccess",{data:t,check:"msg"}),k=t=>a.post("ftp/ModifyFtpUserAccess",{data:t,check:"msg"}),P=t=>a.post("/logs/ftp/set_ftp_log",{customType:"model",data:t,check:"msg"}),v=t=>a.post("ftp/get_cron_config",{data:t,check:"object"}),j=t=>a.post("ftp/set_cron_config",{data:t,check:"msg"}),q=t=>a.post("project/quota/modify_path_quota",{data:t,customType:"model",check:"object"}),A=()=>a.post("logs/ftp/get_analysis_config",{customType:"model",check:"object"}),D=t=>a.post("logs/ftp/set_analysis_config",{data:t,customType:"model",check:"msg"}),E=t=>a.post("logs/ftp/log_analysis",{data:t,customType:"model"}),S=t=>a.post("logs/ftp/set_cron_task",{data:t,customType:"model",check:"msg"}),I=t=>a.post("logs/ftp/set_white_list",{data:t,customType:"model",check:"msg"}),R=()=>a.post("logs/ftp/get_white_list",{customType:"model",check:"object"}),U=t=>a.post("safe/firewall/create_ip_rules",{data:t,customType:"model",check:"msg"}),B=()=>a.post("logs/ftp/ftp_users",{customType:"model",check:"array"}),x=t=>a.post("ftp/BatchSetUserPassword",{data:t}),G=t=>a.post("ftp/add_ftp_types",{check:"object",data:t}),M=t=>a.post("ftp/update_ftp_types",{check:"object",data:t}),N=t=>a.post("ftp/delete_ftp_types",{check:"object",data:t}),L=t=>a.post("ftp/set_ftp_type_by_id",{check:"object",data:t}),O=n(),{payment:C,getGlobalInfo:H}=t(),z=m(!1),J=async(t,s,e)=>{try{return(await r({loading:"正在".concat(s?"修改":"添加","FTP账号，请稍后..."),request:s?(o=t,a.post("ftp/SetUser",{data:o,check:"msg"})):b(t),data:{status:Boolean},message:!0,success:t=>{V.value=!0,e&&e(t)}})).status}catch(c){return!1}var o},K=async t=>{try{const e=await r({loading:"正在修改FTP端口，请稍后...",request:(s={port:t.port},a.post("ftp/setPort",{data:s,check:"msg"})),data:{status:Boolean},message:!0});return e.status&&H(),e.status}catch(e){return!1}var s},{isRefreshFtpList:V,pluginInfo:Q,rowData:W}=_(),X=async()=>{try{const{data:t}=await o({name:"pure-ftpd"});return Q.value=t,t}catch(t){return{}}},Y=async t=>{try{const{data:{data:a,page:o,search_history:c,error:r}}=await s({...t,table:"ftps"});return{data:a,total:e(o),other:{search_history:c,error:r}}}catch(a){return{data:[],total:0,other:{search_history:[]}}}},Z=async t=>{try{await c({icon:"warning-filled",title:"删除FTP用户【".concat(t.name,"】"),content:"删除FTP用户后，该FTP用户将失去访问权限，是否继续操作？"}),await r({loading:"正在删除FTP用户，请稍后...",request:w({id:t.id,username:t.name}),message:!0,success:t=>{V.value=!0}})}catch(a){}},$=async({id:t,status:a,name:s},e)=>{try{const o=Boolean(Number(a));await c({title:"".concat(o?"停用":"启用","FTP用户【").concat(s,"】"),content:"".concat(o?"停用":"启用","选中的FTP用户后，该FTP用户将").concat(o?"失去":"恢复","访问权限，是否继续操作？")}),await r({loading:"正在设置FTP状态，请稍后...",request:T({id:t,username:s,status:Number(!Number(a))}),message:!0,success:t=>{V.value=!0,e&&e(t)}})}catch(o){}},tt=t=>{const a=Math.floor(Date.now()/1e3);let s=new Date(Number(t.end_time)).getTime()<a;const e=Number(t.end_time)-a;let o=Math.floor(e/86400)<7;return"0"===t.end_time&&(s=!1,o=!1),{isEnd:s,isOrange:o}},at=async()=>{try{let t=[];return await r({request:a.post("ftp/view_ftp_types",{check:"object"}),data:{msg:Array},success:({msg:a})=>{t=[{label:"全部分类",value:"all"},...a.map((t=>({label:t.ps,value:String(t.id)})))]}}),t||[]}catch(t){return[]}},st=async(t,a,s,e)=>{await f({name:"Ftp分类",options:s.value,selectList:t.value,request:async(s,e)=>{const o=t.value.map((t=>t.name)).join(",");await r({loading:"正在批量设置FTP分类，请稍后...",request:L({id:s.id,ftp_names:o}),message:!0}),a(),V.value=!0,e()}})},et=async(t,a,s,e)=>{const{label:o,value:c}=e,r=new Map([["start","批量启用已选的FTP用户，启用后恢复访问权限"],["stop","批量停用已选的FTP用户，停用后暂停访问权限"],["delete","批量删除已选的FTP用户，删除后彻底失去访问和操作权限"]]),n=async(t,a)=>{const s=new Map([["start",T],["stop",T],["delete",w]]),{id:e,name:o}=t;switch(c){case"start":case"stop":const t=s.get(c),a="start"===c?1:0;if(t)return await t({id:e,username:o,status:a});case"delete":return await w({id:e,username:o})}};await t({title:"批量".concat(o,"用户"),content:"".concat(r.get(c),"，是否继续操作！"),column:[{label:"用户名",prop:"name"},y()],onConfirm:async()=>(await a(n),V.value=!0,!1)})},ot=async t=>{try{const{data:{data:s,page:o}}=await(t=>a.post("/logs/ftp/get_login_log",{customType:"model",data:t,check:"object"}))(t);return Array.isArray(s)?{data:s,total:e(o)}:{data:[],total:0}}catch(s){return{data:[],total:0}}},ct=async t=>{try{const{data:{data:s,page:o}}=await(t=>a.post("/logs/ftp/get_action_log",{customType:"model",data:t}))(t);return Array.isArray(s)?{data:s,total:e(o)}:{data:[],total:0}}catch(s){return{data:[],total:0}}},rt=t=>{p({title:"查看FTP日志【"+t.name+"】",area:[70,58],compData:t,component:()=>l((()=>import("./index262.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},nt=async t=>{let a;try{if(W.value=t,"free"!==C.value.authType){a=O.load("正在获取日志服务状态，请稍后...");const{status:s,msg:e}=await P({exec_name:"getlog"});if(a.close(),s&&"stop"!==e)rt(t);else{await c({title:"开启FTP日志服务",content:"开启FTP日志服务后，将记录FTP用户的访问日志，是否继续操作？"});const a=await r({loading:"正在开启FTP日志服务，请稍后...",request:P({exec_name:"start"}),data:{status:Boolean},message:!0});(null==a?void 0:a.status)&&rt(t)}}else g({sourceId:57})}catch(s){}finally{a&&a.close()}},pt=d("FTP-ADD-USER-STORE",(()=>{const a=t(),{panel:s}=i(a),e=u((()=>s.value.sitePath)),o=m(),c=m({name:"",password:"",path:e.value||""});return{isEdit:m(!1),addFtpRef:o,ftpForm:c,defaultPath:e}})),lt=()=>i(pt());export{R as A,S as B,D as C,A as D,B as E,h as F,k as G,F as H,x as I,ct as J,ot as K,lt as a,tt as b,at as c,G as d,M as e,N as f,Y as g,$ as h,Z as i,X as j,z as k,et as l,J as m,j as n,nt as o,v as p,q,K as r,st as s,P as t,_ as u,U as v,w,T as x,I as y,E as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
