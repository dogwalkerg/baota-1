import{M as e,G as a,ah as t,j as l,O as s}from"./utils-lib.js?v=1734676359";import{r as u,i as r,h as o,c as n,o as i,B as d,C as m,p,k as f,l as c,e as _,x as g,y as v,J as h,z as j,a7 as x,Q as y,A as V,a4 as b}from"./base-lib.js?v=1734676359";import{getMultipleReferer as w,setSecurity as R,getSecurity as C}from"./site.js?v=1734676359";import{c as U}from"./useController3.js?v=1734676359";import{u as E}from"./useStore7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const{siteInfo:k,isRefreshList:T}=E(),q=u(),A=r((()=>{var e;return Array.isArray(q.value)&&(null==(e=q.value)?void 0:e.length)>1})),D=u(!1),F=o({fix:"jpg,jpeg,gif,png,js,css",domains:"",return_rule:"404",http_status:!1,status:!1}),H=u(null),L=[{content:'【URL后缀】一般填写文件后缀,每个文件后缀使用","分隔,如: png,jpg'},{content:"【许可域名】允许作为来路的域名，每行一个域名,如: www.bt.cn"},{content:"【响应资源】可设置404/403等状态码，也可以设置一个有效资源，如：/security.png"},{content:"【允许空HTTP_REFERER请求】是否允许浏览器直接访问，若您的网站访问异常，可尝试开启此功能"}],S=a=>{if(!F.status)return e.error("请先启用防盗链!")},z=e=>{F.status=e,e||(F.http_status=!1)},J=async e=>{var t;await H.value.validate();let l={...F,domains:null==(t=F.domains)?void 0:t.replace(/\n/g,",")};A.value?l.site_ids=JSON.stringify(q.value.map((e=>e.id))):(l.id=k.value.id,l.name=k.value.name);const s=A.value?w:R,u=await a({loading:"正在设置防盗链，请稍后...",request:s(l),message:!A.value});if(A.value){const a=[...u.data.errors,...u.data.succeed];U({resultData:a.map((e=>({...e,name:q.value.find((a=>a.id===e.id)).name}))),title:"批量设置防盗链"}),T.value=!0,e&&e()}else O(q.value)},O=async e=>{var a,l;if(q.value=e||[],!e){const{id:e,name:u}=k.value;try{D.value=!0;const{data:t}=await C({id:e,name:u});t&&(F.fix=t.fix||"jpg,jpeg,gif,png,js,css",F.domains=(null==(l=null==(a=t.domains)?void 0:a.toString())?void 0:l.replace(/,/g,"\n"))||"",F.return_rule=t.return_rule||"404",F.http_status=t.http_status||!1,F.status=t.status||!1)}catch(s){t(s)}finally{D.value=!1}}},P={fix:[{required:!0,message:"请输入url后缀",trigger:"blur"}],return_rule:[{required:!0,message:"请输入响应资源",trigger:"blur"}]},B={class:"p-[20px]"},G=n({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:a,emit:t}){const u=e,r=()=>{O(u.compData)};return i(r),a({onConfirm:J,init:r}),(e,a)=>{const t=l,u=x,r=y,o=V,n=b,i=s,w=d("bt-loading");return m((f(),c("div",B,[_(n,{ref_key:"hotFormRef",ref:H,model:p(F),rules:p(P)},{default:g((()=>[_(u,{label:"URL后缀",prop:"fix"},{default:g((()=>[_(t,{modelValue:p(F).fix,"onUpdate:modelValue":a[0]||(a[0]=e=>p(F).fix=e),width:"30rem"},null,8,["modelValue"])])),_:1}),_(u,{label:"许可域名"},{default:g((()=>[_(t,{width:"30rem",modelValue:p(F).domains,"onUpdate:modelValue":a[1]||(a[1]=e=>p(F).domains=e),type:"textarea",resize:"none",rows:8,placeholder:"默认添加主域名，可追加其他的允许域名，一行一个，可为空"},null,8,["modelValue"])])),_:1}),_(u,{label:"响应资源",prop:"return_rule"},{default:g((()=>[_(t,{width:"30rem",modelValue:p(F).return_rule,"onUpdate:modelValue":a[2]||(a[2]=e=>p(F).return_rule=e)},null,8,["modelValue"])])),_:1}),_(u,{label:" "},{default:g((()=>[_(r,{modelValue:p(F).status,"onUpdate:modelValue":a[3]||(a[3]=e=>p(F).status=e),onChange:p(z)},{default:g((()=>a[6]||(a[6]=[v("启用防盗链")]))),_:1},8,["modelValue","onChange"]),_(r,{disabled:!p(F).status,title:"".concat(p(F).status?"":"需开启防盗链"),modelValue:p(F).http_status,"onUpdate:modelValue":a[4]||(a[4]=e=>p(F).http_status=e),onChange:p(S)},{default:g((()=>a[7]||(a[7]=[v(" 允许空HTTP_REFERER请求 ")]))),_:1},8,["disabled","title","modelValue","onChange"])])),_:1}),p(A)?j("",!0):(f(),h(u,{key:0,label:" "},{default:g((()=>[_(o,{type:"primary",onClick:a[5]||(a[5]=e=>p(J)())},{default:g((()=>a[8]||(a[8]=[v("保存")]))),_:1})])),_:1}))])),_:1},8,["model","rules"]),p(A)?j("",!0):(f(),h(i,{key:0,options:p(L),class:"ml-[20px] mt-[20px]"},null,8,["options"]))])),[[w,p(D)]])}}});export{G as default};
