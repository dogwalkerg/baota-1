!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */i=function(){return r};var t,r={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",s=u.asyncIterator||"@@asyncIterator",l=u.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var a=t&&t.prototype instanceof b?t:b,i=Object.create(a.prototype),u=new I(n||[]);return o(i,"_invoke",{value:P(e,r,u)}),i}function v(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=f;var h="suspendedStart",m="suspendedYield",d="executing",y="completed",g={};function b(){}function w(){}function x(){}var _={};p(_,c,(function(){return this}));var j=Object.getPrototypeOf,k=j&&j(j(G([])));k&&k!==n&&a.call(k,c)&&(_=k);var L=x.prototype=b.prototype=Object.create(_);function O(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function E(t,r){function n(i,o,u,c){var s=v(t[i],t,o);if("throw"!==s.type){var l=s.arg,p=l.value;return p&&"object"==e(p)&&a.call(p,"__await")?r.resolve(p.__await).then((function(e){n("next",e,u,c)}),(function(e){n("throw",e,u,c)})):r.resolve(p).then((function(e){l.value=e,u(l)}),(function(e){return n("throw",e,u,c)}))}c(s.arg)}var i;o(this,"_invoke",{value:function(e,t){function a(){return new r((function(r,a){n(e,t,r,a)}))}return i=i?i.then(a,a):a()}})}function P(e,r,n){var a=h;return function(i,o){if(a===d)throw Error("Generator is already running");if(a===y){if("throw"===i)throw o;return{value:t,done:!0}}for(n.method=i,n.arg=o;;){var u=n.delegate;if(u){var c=S(u,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===h)throw a=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=d;var s=v(e,r,n);if("normal"===s.type){if(a=n.done?y:m,s.arg===g)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(a=y,n.method="throw",n.arg=s.arg)}}}function S(e,r){var n=r.method,a=e.iterator[n];if(a===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var i=v(a,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,g;var o=i.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function N(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function q(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(N,this),this.reset(!0)}function G(r){if(r||""===r){var n=r[c];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var i=-1,o=function e(){for(;++i<r.length;)if(a.call(r,i))return e.value=r[i],e.done=!1,e;return e.value=t,e.done=!0,e};return o.next=o}}throw new TypeError(e(r)+" is not iterable")}return w.prototype=x,o(L,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:w,configurable:!0}),w.displayName=p(x,l,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,p(e,l,"GeneratorFunction")),e.prototype=Object.create(L),e},r.awrap=function(e){return{__await:e}},O(E.prototype),p(E.prototype,s,(function(){return this})),r.AsyncIterator=E,r.async=function(e,t,n,a,i){void 0===i&&(i=Promise);var o=new E(f(e,t,n,a),i);return r.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},O(L),p(L,l,"Generator"),p(L,c,(function(){return this})),p(L,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=G,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(q),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,a){return u.type="throw",u.arg=e,r.next=n,a&&(r.method="next",r.arg=t),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],u=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),s=a.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),q(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;q(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:G(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},r}function o(t,r,n){return(r=function(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,r||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function u(e,t,r,n,a,i,o){try{var u=e[i](o),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){u(i,n,a,o,c,"next",e)}function c(e){u(i,n,a,o,c,"throw",e)}o(void 0)}))}}System.register(["./site-legacy.js?v=1734676359","./utils-lib-legacy.js?v=1734676359","./base-lib-legacy.js?v=1734676359","./useController-legacy3.js?v=1734676359","./useStore-legacy7.js?v=1734676359","./validator-legacy.js?v=1734676359"],(function(e,r){"use strict";var n,u,s,l,p,f,v,h,m,d,y,g,b,w,x,_,j,k,L,O,E,P,S,N;return{setters:[function(e){n=e.closeLimitNet,u=e.setLimitNet,s=e.setModulesLimitNet,l=e.setMultipleLimitNet,p=e.getLimitNet,f=e.getModulesLimitNet,v=e.setLimitStatus,h=e.setLimitConfig,m=e.getPluginInfo,d=e.removeFlowRule,y=e.createFlowRule,g=e.getGeneratedFlowInfo,b=e.getLimitConfig},function(e){w=e.G,x=e.M,_=e.o,j=e.t,k=e.ah},function(e){L=e.r,O=e.h},function(e){E=e.c},function(e){P=e.u},function(e){S=e.p,N=e.h}],execute:function(){var r=P(),q=r.siteInfo,I=r.siteType,G=r.isBindExtranet,A=r.isRefreshList,T=r.selectedList,F=e("p",L([{label:"论坛/博客",value:0,items:{perserver:300,perip:25,limit_rate:512}},{label:"图片站",value:1,items:{perserver:200,perip:10,limit_rate:1024}},{label:"下载站",value:2,items:{perserver:50,perip:3,limit_rate:2048}},{label:"商城",value:3,items:{perserver:500,perip:10,limit_rate:2048}},{label:"门户",value:4,items:{perserver:400,perip:15,limit_rate:1024}},{label:"企业",value:5,items:{perserver:60,perip:10,limit_rate:512}},{label:"视频",value:6,items:{perserver:150,perip:4,limit_rate:1024}},{label:"自定义",value:7,items:{perserver:"",perip:"",limit_rate:""}}])),D=(e("h",function(){var e=c(i().mark((function e(t,r){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R){e.next=12;break}if(!t){e.next=5;break}D(r),e.next=12;break;case 5:return a=o({},"php"!==I.value?"site_id":"id",q.value.id),e.next=8,w({loading:"正在关闭流量限制，请稍后...",request:n(a,I.value),message:!0});case 8:if(!e.sent.status){e.next=12;break}return e.next=12,M();case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),e("o",function(){var e=c(i().mark((function e(r){var n,c,p,f,v,h,m,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,R){e.next=10;break}return n=["php","proxy","phpasync"].includes(I.value),c=r.perserver,p=r.perip,f=r.limit_rate,v=o({perserver:c,perip:p,limit_rate:f},n?"id":"site_id",q.value.id),e.next=7,w({loading:"正在设置流量，请稍后...",request:n?u(v):s(v,I.value),message:!0});case 7:return e.sent.status&&M(),e.abrupt("return");case 10:if(h=x.load("正在设置，请稍后..."),m=[],d=[],T.value.forEach((function(e){var t;"PHPMOD"===(null==e||null===(t=e.project_config)||void 0===t?void 0:t.type)?m.push({name:e.name,msg:"异步项目不支持",status:!1}):d.push(e.id)})),null==d||!d.length){e.next=16;break}return e.next=16,w({request:l(a(a({},J),{},{close_limit_net:J.value?0:1,site_ids:JSON.stringify(d)})),success:function(e){[].concat(t(e.data.errors),t(e.data.succeed)).forEach((function(e){var t;m.push(a(a({},e),{},{name:(null===(t=T.value)||void 0===t||null===(t=t.find((function(t){return t.id===e.id})))||void 0===t?void 0:t.name)||""}))}))}});case 16:return E({resultData:m}),T.value=[],h.close(),A.value=!0,e.abrupt("return",!0);case 23:return e.prev=23,e.t0=e.catch(0),e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,null,[[0,23]])})));return function(t){return e.apply(this,arguments)}}())),M=function(){var e=c(i().mark((function e(){var t,r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=["php","proxy","phpasync"].includes(I.value),r=o({},t?"id":"site_id",q.value.id),e.next=5,w({loading:U,request:t?p(r):f(r,I.value)});case 5:if((n=e.sent).data.hasOwnProperty("limit_rate")){e.next=12;break}return B.value=!0,x.error("获取流量限制失败"),B.value=!0,H.value=n.data.msg,e.abrupt("return",{status:!1,msg:"获取流量限制失败"});case 12:return B.value=!1,J.limit_rate=n.data.limit_rate,J.perserver=n.data.perserver,J.perip=n.data.perip,Object.values(n.data).every((function(e){return 0===e}))?(J.value=!1,J.type=0,C(0)):(J.type=n.data.value-1,J.value=!0),-1===J.type&&(J.type=7),e.abrupt("return",J);case 21:return e.prev=21,e.t0=e.catch(0),e.abrupt("return",{status:!1,msg:"获取流量限制失败"});case 25:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(){return e.apply(this,arguments)}}(),C=(e("i",c(i().mark((function e(){var t,r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"node"===(r=null===(t=q.value.project_type)||void 0===t?void 0:t.toLowerCase())&&(r="nodejs"),"nodejs"!==r){e.next=10;break}if(G.value=null===(n=q.value.project_config)||void 0===n?void 0:n.bind_extranet,G.value){e.next=8;break}return B.value=!0,e.abrupt("return",J);case 8:e.next=11;break;case 10:G.value=!0;case 11:if(R){e.next=16;break}return e.next=14,M();case 14:e.next=18;break;case 16:return e.next=18,C(0);case 18:return e.abrupt("return",J);case 21:e.prev=21,e.t0=e.catch(0);case 24:case"end":return e.stop()}}),e,null,[[0,21]])})))),function(e){var t=F.value[e].items,r=t.perserver,n=t.perip,a=t.limit_rate;J.perserver=r,J.perip=n,J.limit_rate=a}),R=e("b",Boolean(T.value.length)),B=e("m",L(!1)),Y=e("e",L(!1)),H=e("a",L("")),J=O({value:!0,perserver:300,perip:25,limit_rate:512,type:0}),U=e("v",L(!1)),$=(e("n",function(){var e=c(i().mark((function e(t){var r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=a(a({},t),{},{site_name:q.value.name,module:t.module.join(",")}),"request"===t.type&&(r.limit_unit="frequency"),delete r.type,e.next=6,w({loading:"正在添加流量限额配置，请稍后...",request:y(r),message:!0});case 6:return(n=e.sent).status&&(V.value=!0),e.abrupt("return",n.status);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t){return e.apply(this,arguments)}}()),e("c",function(){var e=c(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!t.limit_status,e.next=3,_({title:(r?"开启":"关闭")+"流量限额配置",icon:"warning-filled",content:(r?"开启":"关闭")+"检测到问题时将"+(r?"会":"不会")+"发送告警通知，是否继续？"});case 3:return e.next=5,w({loading:"正在设置，请稍后...",request:v({id:t.id,limit_status:r,site_name:q.value.name}),message:!0});case 5:V.value=!0;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),function(){var e=c(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U.value=!0,e.prev=1,e.next=4,g({site_name:q.value.name});case 4:t=e.sent,r=t.data,Q.value.length=j(Number(r.length)),Q.value.request=j(Number(r.request)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),k(e.t0);case 13:return e.prev=13,U.value=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,10,13,16]])})));return function(){return e.apply(this,arguments)}}()),z=function(){var e=c(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b({site_name:q.value.name});case 3:return t=e.sent,e.abrupt("return",{data:t.data,total:t.data.length,other:{}});case 7:e.prev=7,e.t0=e.catch(0),k(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),K=(e("r",c(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h({sName:"total"});case 3:t=e.sent,r=t.data,K.value=r,r.nginx_status&&r.total_status||(Y.value=!0),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))),e("g",c(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,m({sName:"total"});case 3:if(t=e.sent,r=t.data,Y.value=!(r.setup&&r.endtime>=0),!(r.setup&&r.endtime>0)){e.next=11;break}return $(),e.next=10,z();case 10:return e.abrupt("return",e.sent);case 11:return e.abrupt("return",{data:[],total:0,other:{}});case 14:return e.prev=14,e.t0=e.catch(0),e.abrupt("return",{data:[],total:0,other:{}});case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))),e("d",function(){var e=c(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_({title:"删除",icon:"warning-filled",content:"是否删除此条流量限额配置？"});case 2:return e.next=4,w({loading:"正在删除，请稍后...",request:d({site_name:q.value.name,id:t.id}),message:!0});case 4:V.value=!0;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e("f",L({nginx_status:!1,total_status:!1,buy_status:!1}))),Q=(e("l",[{label:"1小时",value:"1h"},{label:"1天",value:"1day"},{label:"30天",value:"30day"},{label:"自然月",value:"month"}]),e("k",[{label:"10分钟",value:"10m"},{label:"30分钟",value:"30m"}]),e("t",L({length:"--",request:"--"}))),V=e("q",L(!1));e("j",function(){var e=c(i().mark((function e(t){var r,n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("buy"!==t){e.next=4;break}S({sourceId:142}),e.next=16;break;case 4:return e.prev=4,e.next=7,m({sName:"total"});case 7:return r=e.sent,n=r.data,e.next=11,N({name:n.name,type:"i",pluginInfo:n});case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4);case 16:case"end":return e.stop()}}),e,null,[[4,13]])})));return function(t){return e.apply(this,arguments)}}())}}}))}();
