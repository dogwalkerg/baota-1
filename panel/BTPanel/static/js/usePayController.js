import{o as e,G as a,M as o}from"./utils-lib.js?v=1734676359";import{r as t}from"./base-lib.js?v=1734676359";import{applyCertOrderRenw as s,getPayStatus as u}from"./site.js?v=1734676359";import{u as r}from"./useStore7.js?v=1734676359";import{aj as l,ak as i}from"./useController7.js?v=1734676359";import{u as n,S as m}from"./useStore11.js?v=1734676359";r();const{isRefreshSSL:c,productInfo:v,orderInfo:I,pollingPopup:S}=n();m();const d=t(v.value.totalPrice>5e3),f=t(d.value?"alicode":"wxcode"),w=t(0),p=t(!1),T=(e,a=!1)=>{d.value&&"wxcode"===e&&(e="alicode",o.error("微信支付单笔限额5000元，请使用支付宝支付")),f.value=e,sessionStorage.setItem(a?"PAY-SSL-VIEW-TIME":"PAY-VIEW-SSL-TIME","".concat((new Date).getTime()/1e3))},E=async()=>{(await S.value).unmount()},g=async o=>{o&&sessionStorage.setItem("PAY-VIEW-SSL-TIME","".concat(o));const t=sessionStorage.getItem("PAY-VIEW-SSL-TIME");if(t){if(parseInt("".concat((new Date).getTime()/1e3-Number(t)),10)>600&&S.value)return sessionStorage.removeItem("PAY-VIEW-SSL-TIME"),e({title:"支付超时",icon:"warning",content:"由于您长时间未操作，支付超时，请刷新网页重新购买！",onConfirm:()=>{E(),window.location.reload()},onCancel:()=>{E(),window.location.reload()}});S.value||sessionStorage.removeItem("PAY-VIEW-SSL-TIME")}await P(),p.value?(w.value&&clearTimeout(w.value),w.value=setTimeout((()=>{g()}),3e3)):v.value.isRenew?(await a({request:s({oid:v.value.oid}),message:!0}),c.value=!0):j()},P=async()=>{const e=await a({request:u({oid:I.value.oid}),data:Number});p.value=!e},j=async()=>{l({productInfo:v.value,orderInfo:I.value}),c.value=!0;(await S.value).unmount(),clearTimeout(w.value)},L=()=>{i({productInfo:v.value,orderInfo:I.value})},M=async()=>{await P(),p.value&&(w.value&&clearTimeout(w.value),w.value=setTimeout((()=>{g()}),3e3))},b=()=>{p.value=!1,w.value&&clearTimeout(w.value)};export{g as a,p as b,w as c,T as d,M as e,b as f,P as m,L as p,f as t};
