import{ah as e,G as l,o as a,j as o,c as s,h as t,b as r}from"./utils-lib.js?v=1734676359";import{_ as p}from"./index101.js?v=1734676359";import{c as m,r as n,h as u,w as c,o as i,aB as d,k as v,l as h,p as _,J as f,x as y,y as b,z as V,q as k,e as j,I as w,aX as g,v as x,M as C,ag as P,ah as H,a7 as U,A as I,aY as q,a4 as B}from"./base-lib.js?v=1734676359";import{_ as A}from"./index88.js?v=1734676359";import{_ as M}from"./index116.js?v=1734676359";import{getComposerVersion as O,deleteComposerFile as R,execComposer as z,getComposerLine as G}from"./site.js?v=1734676359";import{u as J}from"./useStore7.js?v=1734676359";import{f as S}from"./validator.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";import"./column.js?v=1734676359";const X={class:"p-1rem"},Y={class:"flex items-center"},D={key:0,class:"text-danger"},E={key:1,class:"text-danger text-[1.2rem]"},F={class:"mt-[8px] leading-8 text-[1.2rem] list-disc ml-[20px]"},K={key:0},L={class:"p-2rem h-50rem flex flex-col"},N={class:"mb-1rem"},Q={class:"flex-1 overflow-auto"},T=m({__name:"index",setup(m){var T;const{siteInfo:W}=J(),Z=null==(T=W.value)?void 0:T.project_type,$=r(),ee=n(!1),le=n(!1),ae=u({path:W.value.path,user:"phpasync"!==Z?"www":"root",php:["静态","其它"].includes(W.value.php_version)?"auto":"PHP-"+W.value.php_version.replace(".",""),otherCommand:"",mirror:"https://mirrors.aliyun.com/composer/",command:"install",composerVersion:"install",version:"2.7.3",help_tips:"",comp_json:"",comp_lock:"",phpVersion:[],commandOptions:[{label:"install",value:"install"},{label:"update",value:"update"},{label:"require",value:"require"},{label:"create-project",value:"create-project"},{label:"自定义",value:""}]}),oe=n("正在执行..."),se=n(!1),te=n(),re=n(!1);c((()=>W.value),(e=>{ae.php=["静态","其它"].includes(e.php_version)?"auto":"PHP-"+e.php_version.replace(".","")}),{immediate:!0});const pe=async l=>{ee.value=!0;try{const e=await O({path:l||W.value.path});e.data.status?(le.value=!1,ae.phpVersion=e.data.php_versions.filter((e=>"00"!==e.version)),ae.phpVersion.unshift({name:"自动选择",version:"auto"}),ae.comp_json=!1,ae.comp_lock=!1,"string"==typeof e.data.comp_json&&(ae.comp_json=e.data.comp_json),"string"==typeof e.data.comp_lock&&(ae.comp_lock=e.data.comp_lock)):(le.value=!0,$.request(e))}catch(a){e(a)}finally{ee.value=!1}},me=()=>{S({type:"dir",path:ae.path,change:e=>{ae.path=e,pe(ae.path)}})},ne=async()=>{l({loading:"正在删除，请稍后...",request:R({path:ae.path+"/composer.lock"}),message:!0,success:e=>{e.status&&pe(ae.path)}})},ue=async()=>{var e;let o={php_version:null==(e=ae.php)?void 0:e.replace("PHP-",""),composer_args:ae.command,composer_cmd:ae.otherCommand,repo:ae.mirror,path:ae.path,user:ae.user,composer_version:ae.version};await a({title:"执行composer命令",content:"即将执行设定的composer命令，继续吗？",icon:"warning-filled"}),l({loading:"正在执行，请稍后...",request:z(o),message:!0,success:e=>{e.status&&(se.value=!0,(async()=>{te.value=setInterval((async()=>{try{ce()}catch(e){clearInterval(te.value)}}),2e3)})())}})},ce=async(l=!1)=>{try{const e=await G({filename:"/tmp/composer.log",num:100});oe.value=e.data.msg,l&&$.success("刷新成功")}catch(a){e(a)}},ie=()=>{re.value=!0,ce()},de=()=>{clearInterval(te.value),se.value=!1,re.value=!1,oe.value=""};return i((()=>{pe()})),d((()=>{clearInterval(te.value)})),(e,l)=>{const a=M,r=P,m=H,n=U,u=o,c=A,i=s,d=I,O=q,R=B,z=p,G=t;return v(),h("div",null,[_(le)?(v(),f(a,{key:0},{content:y((()=>l[11]||(l[11]=[b(" 没有找到可用的composer版本 ")]))),_:1})):V("",!0),k("div",X,[j(R,{model:_(ae)},{default:y((()=>[j(n,{label:"Composer版本"},{default:y((()=>[k("div",Y,[j(m,{modelValue:_(ae).version,"onUpdate:modelValue":l[0]||(l[0]=e=>_(ae).version=e),class:"!w-[24rem]"},{default:y((()=>[j(r,{label:"2.7.3",value:"2.7.3"}),j(r,{label:"1.10.27",value:"1.10.27"})])),_:1},8,["modelValue"])])])),_:1}),j(n,{label:"PHP版本"},{default:y((()=>["phpasync"!==_(Z)?(v(),f(m,{key:0,class:"!w-[24rem]",modelValue:_(ae).php,"onUpdate:modelValue":l[1]||(l[1]=e=>_(ae).php=e)},{default:y((()=>[(v(!0),h(w,null,g(_(ae).phpVersion,((e,l)=>(v(),f(r,{key:l,label:e.name,value:e.version},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])):(v(),f(u,{key:1,modelValue:_(ae).php,"onUpdate:modelValue":l[2]||(l[2]=e=>_(ae).php=e),disabled:"",width:"24rem"},null,8,["modelValue"]))])),_:1}),j(n,{label:"执行参数"},{default:y((()=>[j(m,{class:"!w-[24rem]","empty-values":[null,void 0],modelValue:_(ae).command,"onUpdate:modelValue":l[3]||(l[3]=e=>_(ae).command=e)},{default:y((()=>[(v(!0),h(w,null,g(_(ae).commandOptions,((e,l)=>(v(),f(r,{key:l,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),j(n,{label:"补充命令"},{default:y((()=>[j(u,{modelValue:_(ae).otherCommand,"onUpdate:modelValue":l[4]||(l[4]=e=>_(ae).otherCommand=e),placeholder:"请输入补充命令",width:"24rem"},null,8,["modelValue"])])),_:1}),j(n,{label:"镜像源"},{default:y((()=>[j(m,{modelValue:_(ae).mirror,"onUpdate:modelValue":l[5]||(l[5]=e=>_(ae).mirror=e),filterable:"","allow-create":"","default-first-option":"",class:"!w-[24rem]"},{default:y((()=>[j(r,{label:"阿里云(mirrors.aliyun.com)",value:"https://mirrors.aliyun.com/composer/"}),j(r,{label:"官方源(packagist.org)",value:"repos.packagist"}),j(r,{label:"中国全量镜像(packagist.phpcomposer.com)",value:"https://packagist.phpcomposer.com"}),j(r,{label:"Packagist Mirror(packagist.mirrors.sjtug.sjtu.edu.cn)",value:"https://packagist.mirrors.sjtug.sjtu.edu.cn"}),j(r,{label:"腾讯源(mirrors.tencent.com)",value:"https://mirrors.tencent.com/composer/"}),j(r,{label:"华为云(mirrors.huaweicloud.com)",value:"https://mirrors.huaweicloud.com/repository/php/"})])),_:1},8,["modelValue"])])),_:1}),"phpasync"!==_(Z)?(v(),f(n,{key:0,label:"执行用户",prop:"command"},{default:y((()=>[j(m,{modelValue:_(ae).user,"onUpdate:modelValue":l[6]||(l[6]=e=>_(ae).user=e),class:"!w-24rem"},{default:y((()=>[j(r,{label:"www(推荐)",value:"www"}),j(r,{label:"root(不推荐)",value:"root"})])),_:1},8,["modelValue"])])),_:1})):V("",!0),j(n,{label:"执行目录",prop:"composerVersion"},{default:y((()=>[j(c,{modelValue:_(ae).path,"onUpdate:modelValue":l[7]||(l[7]=e=>_(ae).path=e),icon:"el-folder-opened",onIconClick:me,width:"32rem"},null,8,["modelValue"])])),_:1}),j(n,{label:" ",prop:"composerVersion"},{default:y((()=>[k("div",null,[_(ae).comp_lock?(v(),h("span",D,[b(x(_(ae).comp_lock)+" ",1),j(i,{onClick:ne},{default:y((()=>l[12]||(l[12]=[b("[点击删除]")]))),_:1})])):V("",!0),_(ae).comp_json?(v(),h("span",E,x(_(ae).comp_json),1)):V("",!0)])])),_:1}),j(n,{label:" "},{default:y((()=>[j(d,{type:"primary",disabled:!!("boolean"!=typeof _(ae).comp_json&&_(ae).comp_json||"boolean"!=typeof _(ae).comp_lock&&_(ae).comp_lock),onClick:ue},{default:y((()=>l[13]||(l[13]=[b("执行")]))),_:1},8,["disabled"]),j(O,{direction:"vertical",class:"!h-1rem !mx-2rem"}),j(d,{onClick:ie},{default:y((()=>l[14]||(l[14]=[b("查看日志")]))),_:1})])),_:1})])),_:1},8,["model"]),k("ul",F,[l[15]||(l[15]=k("li",null,"Composer是PHP主流依赖包管理器，若您的项目使用Composer管理依赖包，可在此处对依赖进行升级或安装",-1)),l[16]||(l[16]=k("li",null,"Composer版本：当前安装的Composer版本，可点击右侧的【升级Composer】将Composer升级到最新稳定版",-1)),l[17]||(l[17]=k("li",null,"PHP版本：用于执行composer的PHP版本，无特殊要求，默认即可，如安装出错，可尝试选择其它PHP版本",-1)),l[18]||(l[18]=k("li",null,"执行参数：按需选择执行参数,可配合补充命令使用",-1)),l[19]||(l[19]=k("li",null,"补充命令：若此处为空，则按composer.json中的配置执行，此处支持填写完整composer命令",-1)),l[20]||(l[20]=k("li",null,"镜像源：提供【阿里源】和【官方源】，建议国内服务器使用【阿里源】，海外服务器使用【官方源】",-1)),"phpasync"!==_(Z)?(v(),h("li",K,"执行用户：默认为www用户，除非您的网站以root权限运行，否则不建议使用root用户执行composer")):V("",!0),l[21]||(l[21]=k("li",null,"执行目录：默认为当前网站根目录",-1))])]),j(G,{title:"请执行完毕确认结果无误后关闭此窗口",onCancel:de,modelValue:_(se),"onUpdate:modelValue":l[8]||(l[8]=e=>C(se)?se.value=e:null),area:[50,42]},{default:y((()=>[j(z,{class:"h-full",title:"全屏查看composer执行日志",content:_(oe),isHtml:!0,isRefreshBtn:!1,isAuto:!0},null,8,["content"])])),_:1},8,["modelValue"]),j(G,{title:"composer执行日志",onCancel:de,modelValue:_(re),"onUpdate:modelValue":l[10]||(l[10]=e=>C(re)?re.value=e:null),area:60},{default:y((()=>[k("div",L,[k("div",N,[j(d,{type:"primary",onClick:l[9]||(l[9]=e=>ce(!0))},{default:y((()=>l[22]||(l[22]=[b("刷新日志")]))),_:1})]),k("div",Q,[j(z,{class:"h-full",title:"全屏查看composer执行日志",content:_(oe),isHtml:!0,isRefreshBtn:!1},null,8,["content"])])])])),_:1},8,["modelValue"])])}}});export{T as default};
