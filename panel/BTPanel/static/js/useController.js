import{a7 as e,ah as a,G as t,M as s,o as n,u as i,l,H as o,ak as r}from"./utils-lib.js?v=1734676359";import{g as c,s as u,r as d,e as m,C as p,B as v}from"./base-lib.js?v=1734676359";import{g,d as w,e as f,f as y,h,i as _,j as b,k,l as D,m as E,n as S,o as T,p as C,q as x,t as q,u as I,v as j}from"./useStore3.js?v=1734676359";import{i as L,c as O}from"./validator.js?v=1734676359";import{B as P}from"./column.js?v=1734676359";const R=c("DOCKER-SITE-STORE",(()=>{const i=d({}),{refreshSiteTable:l}=g(),o=d(""),r=d({}),c=d("all"),u=d([]);return{getDockerSiteList:async t=>{try{const{data:a}=await w(t);return{data:a.data,total:e(a.page)}}catch(s){a(s)}},pluginInfo:i,setDockerSiteStatus:async(e,i)=>{try{const a=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<a/1e3)return void s.error("项目已过期，请设置站点到期时间后再操作");await n({title:"提示",content:e.status?"启动站点【".concat(e.site_name,"】后，用户可以正常访问网站内容，是否继续操作？"):"停用站点【".concat(e.site_name,"】后，用户访问会显示当前网站停用后的提示页，是否继续操作？"),icon:"warning-filled"}),await t({loading:"正在".concat(e.status?"开启":"关闭","，请稍后..."),request:b(e),message:!0,success:e=>{l(),i&&i(e)}})}catch(o){a(o)}},setDockerSiteRemark:async(e,s)=>{try{await t({loading:"正在保存备注，请稍后...",request:k(e),message:!0,success:e=>{l(),s&&s(e)}})}catch(n){a(n)}},getEnvList:async t=>{try{const{data:a}=await _(t);return{data:a.data,total:e(a.page)}}catch(s){a(s)}},delDockerSite:async(e,s)=>{try{await n({title:"删除【".concat(e.name,"】项目"),content:"风险操作，此操作不可逆，删除【".concat(e.name,"】项目后您将无法管理该项目，是否继续操作？"),icon:"warning-filled",type:"check",check:{content:"同时删除网站根目录",onConfirm:async a=>{const n={id:e.id,site_name:e.name,remove_path:a?1:0};await t({loading:"正在删除，请稍后...",request:D(n),message:!0,success:e=>{l(),s&&s(e)}})}}})}catch(i){a(i)}},setSiteInfo:async(e,a)=>(e&&(r.value={...e}),o.value=("string"==typeof a?a:"")||"",r.value),siteInfo:r,settingTabActive:o,getClassList:async()=>{try{return await t({request:f(),success:({data:e})=>{u.value=[{label:"全部分类",value:"all"},...e.data.map((e=>({label:e.name,value:String(e.id)})))]}}),{data:u.value,status:!0}}catch(e){return{data:[],status:!1}}},setClass:async(e,a)=>{try{switch(a){case"add":return await t({loading:"正在新增分类，请稍后...",request:h({name:e.name}),message:!0});case"edit":return await t({loading:"正在编辑分类，请稍后...",request:h({name:e.name,id:e.id}),message:!0});case"del":return await t({loading:"正在删除分类，请稍后...",request:y({id:e.id}),message:!0})}}catch(s){}},classList:u,resetData:()=>{o.value="",r.value={},u.value=[]},statusFilterKey:c}})),A=()=>u(R()),V=c("DOCKER-SITE-ENV-STORE",(()=>{const e=d("php"),s=d(!1),i=d(!1),l=d(!1),o=d(!1),r=e=>{switch(e){case"php":s.value=!0;break;case"java":i.value=!0;break;case"python":l.value=!0;break;case"go":o.value=!0}};return{tabActive:e,refreshEnvTable:s,refreshJavaEnvTable:i,refreshPythonEnvTable:l,refreshGoEnvTable:o,setTypeRefreshTable:r,delDockerEnv:async(e,s,i)=>{try{await n({title:"删除【".concat(e.name,"】环境"),content:"风险操作删除【".concat(e.name,"】环境，此操作不可逆，是否继续操作？"),icon:"warning-filled"}),await t({loading:"正在删除，请稍后...",request:E({id:e.id}),message:!0,success:e=>{r(s),i&&i(e)}})}catch(l){a(l)}},useBatchEventHandle:async(a,s,i,l,o)=>{await n({title:"删除环境",content:"风险操作删除选中的".concat(i.value.length,"个环境，此操作不可逆，是否继续操作？"),icon:"warning-filled"});const c={ids:i.value.map((e=>e.id)).join(",")};await t({loading:"正在删除，请稍后...",request:S(c),message:!0,success:()=>{o(),r(e.value)}})},cleanCache:async(e,s)=>{try{await n({title:"清理构建缓存",content:"即将清理构建缓存，是否继续操作？",icon:"warning-filled"}),await t({loading:"正在清理，请稍后...",request:T(),message:!0,success:a=>{r(e),s&&s(a)}})}catch(i){a(i)}},refreshTemplate:async(e,s)=>{try{await t({loading:"正在刷新，请稍后...",request:x(),message:!0,success:a=>{r(e),s&&s(a)}})}catch(n){a(n)}},getVersion:async(e="all")=>{try{const a={runtime_type:e};return await t({loading:"正在获取版本，请稍后...",request:q(a),message:!1})}catch(s){a(s)}},setStatus:async(e,s,n,i)=>{try{await t({loading:"正在设置，请稍后...",request:C({runtime_status:e,compose_file:s.compose}),message:!0,success:e=>{r(n),i&&i(e)}})}catch(l){a(l)}},resetData:()=>{e.value="php",s.value=!1,i.value=!1,l.value=!1,o.value=!1}}})),W=()=>u(V()),{plugin:B}=i(),{refreshSiteTable:F}=g(),{pluginInfo:H}=u(R()),{setSiteInfo:N,getClassList:J,setClass:K}=R(),{resetData:M}=V(),z={get:async()=>{const{data:e}=await J();return e},add:e=>K({...e},"add"),update:e=>{const{id:a,name:t}=e;return K({id:a,name:t},"edit")},delete:e=>{const{id:a}=e;return K({id:a},"del")}},G=e=>({label:"设置分类",value:"setClass",event:async(a,s,n,i,l)=>{await O({name:"分类",options:e.classList.value.filter((e=>"all"!==e.value&&"-2"!==e.value)),selectList:n.value,request:async(e,a)=>{const s=n.value.map((e=>e.id));await t({loading:"正在批量设置分类，请稍后...",request:I({id:JSON.stringify(s),classify:e.id}),message:!0}),l(),F(),a()}})}}),Q=e=>({label:"到期时间",isCustom:!0,render:e=>{const a=(new Date).setHours(0,0,0,0),t=Date.now(),s="0000-00-00"!==e.edate?new Date(e.edate).getTime():null,n=s&&s<a;return m("span",{class:"cursor-pointer "+(n?"bt-danger":s&&s-t<6048e5?"bt-warn":"bt-link"),onClick:()=>U(e)},[n?"已过期":"0000-00-00"===e.edate?"永久":e.edate])}}),U=(e,a=!1)=>{l({title:"【".concat(e.name,"】到期时间设置"),area:48,component:()=>o((()=>import("./index125.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{rowData:e,isMult:a},showFooter:!0})},X=e=>({label:(null==e?void 0:e.label)||"网站名",prop:"name",minWidth:150,showOverflowTooltip:{show:!0,enterable:!1},render:a=>{var t;let s=null==(t=B.value)?void 0:t.web;const n="java"===(null==e?void 0:e.type)&&!(a.is_file_ok||void 0===a.is_file_ok);return m("div",{class:"flex items-center inline-block truncate"},[(null==a?void 0:a.waf)&&((null==a?void 0:a.isWaf)||void 0===(null==a?void 0:a.isWaf))?m("span",{class:"w-[1.6rem] mr-[4px] cursor-pointer flex items-center",onClick:()=>{e.openPlugin&&e.openPlugin(a,"iconWaf")}},[m("i",{class:"svgtofont-left-waf !text-[2rem] ".concat(a.waf.status&&"proxy"===(null==s?void 0:s.type)&&(null==s?void 0:s.status)&&(null==s?void 0:s.setup)?"text-primary":"text-[#999]")},null)]):"",m("span",{class:"!whitespace-pre-line inline-block w-[calc(100%-1.6rem)]",title:null==a?void 0:a.cn_name},[m("span",{onClick:()=>{n||e.onClick(a)},class:"justify-start cursor-pointer ".concat(n?"":"bt-link"," ")},[a.name])])])}}),Y=e=>({label:"状态",prop:"status",minWidth:70,isCustom:!0,sortable:!1,width:80,render:a=>{let t=null==a?void 0:a.run;return(null==e?void 0:e.prop)&&(t="1"===a[e.prop]),void 0===a[e.prop||"status"]?p(m("div",{class:"loading h-[2rem]"},null),[[v("bt-loading"),!0]]):m(P,{modelValue:t?1:0,data:["已停止","运行中"],onClick:()=>e.onClick(a)},null)}}),Z=e=>({label:"SSL证书",isCustom:!0,render:a=>{var t,s,n;return m("span",{class:"cursor-pointer ".concat(-1===a.ssl?"text-[#f0ad4e]":(null==(t=a.ssl)?void 0:t.endtime)<0?"text-danger":"text-[#20a53a]"),onClick:()=>{e.onClick(a)}},[-1===a.ssl?"未部署":(null==(s=a.ssl)?void 0:s.endtime)<0?"已过期":"剩余".concat(null==(n=a.ssl)?void 0:n.endtime,"天")])}}),$=async(e,a,s,i,l)=>{await n({title:"删除项目",content:"风险操作，此操作不可逆，删除选中的".concat(s.value.length,"个项目后您将无法管理这些项目，是否继续操作？"),icon:"warning-filled",type:"check",check:{content:"同时删除网站根目录",onConfirm:async e=>{const a={site_list:JSON.stringify(s.value.map((e=>({site_name:e.name,id:e.id})))),remove_path:e?1:0};await t({loading:"正在删除，请稍后...",request:j(a),message:!0,success:()=>{l(),F()}})}}})},ee=async()=>{try{const{data:e}=await r({name:"nginx"});return H.value=e,e}catch(e){return{}}},ae=(e={readonly:!1,theme:"chrome"})=>({mode:"ace/mode/nginx",theme:"ace/theme/".concat(e.theme),wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:e.readonly,fontSize:"12px"}),te=e=>new Promise(((a,t)=>{l({title:"创建网站",area:70,btn:["确认","取消"],component:()=>o((()=>import("./index126.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e||{}})})),se=e=>new Promise(((a,t)=>{l({title:"运行环境",area:120,component:()=>o((()=>import("./index127.js?v=1734676359").then((e=>e.I))),__vite__mapDeps([]),import.meta.url),onCancel:()=>{M(),e&&e()}})})),ne=(e,a)=>{l({title:(null==e?void 0:e.title)||"批量操作结果",area:42,component:()=>o((()=>import("./index102.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},ie=(e="setDefaultPage")=>l({isAsync:!0,title:"常用设置",area:[96,62],component:()=>o((()=>import("./index128.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e,showFooter:!1}),le=(e,a="")=>{N(e,a),l({title:"Docker项目管理【"+e.name+"】 -- 添加时间【"+e.addtime+"】",area:[84,70],component:()=>o((()=>import("./index129.js?v=1734676359").then((e=>e._))),__vite__mapDeps([]),import.meta.url)})},oe=async(e,a)=>{"monitor-setting"===a&&(a="monitor");const t=(e=>{switch(e){case"monitor":return 47;case"bt_waf":return 48;case"iconWaf":return 49}})(a);"monitor"!==a&&(a="btwaf"),await L({source:t,name:a,isOpen:!1,function:t=>{if(t&&"monitor"!==a){const s=setInterval((()=>{var n;const i=t.document.getElementById("plugin-view");if("btwaf"===a&&t.bt_waf||"btwaf"!==a&&t.site_waf_config){clearInterval(s),i&&(i.style.display="none"),"btwaf"===a?t.bt_waf.set_site_config_view({siteName:e.name}):t.site_waf_config(e.name);const l=t.document.getElementById("layui-layer2");l&&(null==(n=l.querySelector(".layui-layer-close"))||n.addEventListener("click",(()=>{var e;null==(e=i.querySelector(".layui-layer-close"))||e.click()})))}}),50)}}})};export{R as D,Y as a,Q as b,Z as c,te as d,ie as e,z as f,ee as g,oe as h,G as i,$ as j,ne as k,V as l,W as m,A as n,le as o,ae as p,se as s,X as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
