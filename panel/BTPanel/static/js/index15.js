import{_ as a}from"./index90.js?v=1734676359";import{_ as e}from"./index97.js?v=1734676359";import{u as t,R as s,l as r,H as i,o as l,M as n,G as o,S as p,aa as c,F as d,k as m,V as _,e as g}from"./utils-lib.js?v=1734676359";import{g as u,s as b,h as y,r as f,e as h,c as w,o as S,a1 as C,B as v,C as x,p as O,k as T,l as j,x as R,I as k,aX as D,q as A,y as V,A as L,J as P,ay as q}from"./base-lib.js?v=1734676359";import{J as E,K as F,L as I,H as M,M as B,N as H,O as J,p as N}from"./useMethod2.js?v=1734676359";import{a as U,u as $,c as z}from"./column.js?v=1734676359";import{C as G}from"./useStore2.js?v=1734676359";const K=u("CRONTAB-SCRIPT-LIBRARY-STORE",(()=>{const{mainHeight:a}=t(),e=G(),{logCompData:c}=b(e),d=y({p:1,rows:20,search:"",type_id:""}),m=f(),_=f(!1),g=f(0),u=f([]),w=f(!1),S=f([]),C=async()=>{const{name:a,script_id:e,form:t}=R,s={script_id:e,args:t.args};await l({title:"执行脚本",icon:"warning-filled",content:"立即执行【".concat(a,"】脚本任务，执行过程可能等待时间较长，请耐心等待。是否继续？")});const i=n.load("正在执行脚本,请稍后...");try{const{data:a}=await E({data:JSON.stringify(s)});return i.close(),a.status&&q(),r({title:"执行结果",area:[60,40],component:{render:e=>h("pre",{class:"h-full w-full bg-[#333] !overflow-auto whitespace-pre-line text-white break-all p-12px"},[a.msg])}}),a.status}catch(o){return i.close(),!1}},v=async()=>{await o({loading:w,request:B(d),data:{data:[Array,u],page:p(g)}})},x=(a,e)=>{if(q(),V.type_id=d.type_id,a){const{script_id:a,name:t,return_type:s,is_args:r,ps:i,script:l,args_title:n,args_ps:o,type_id:p}=e;Object.assign(V,{name:t,return_type:s,is_args:String(r),ps:i,script:l,type_id:p,script_id:a}),"1"==r&&Object.assign(A,{args_title:n,args_ps:o})}r({title:(a?"编辑":"创建")+"脚本",area:57,component:()=>i((()=>import("./index113.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),onConfirm:()=>P(!!a),showFooter:!0})},O=f([U(),{label:"名称",prop:"name"},{label:"类型",prop:"script_type"},{label:"返回类型",prop:"return_type"},{label:"备注",prop:"ps",showOverflowTooltip:!0},{label:"创建时间",render:a=>s(a.create_time)},{label:"上次执行时间",render:a=>Array.isArray(a.last_exec_time)?"--":s(a.last_exec_time)},$([{onClick:a=>(async a=>{const{is_args:e,args_title:t,name:s,args_ps:l,script_id:n}=a;Object.assign(R,{script_id:n,name:s,form:{args:"",placeholder:"端口检测"===s?"127.0.0.1:433":l},title:t}),e?r({title:"执行脚本参数",component:()=>i((()=>import("./index112.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,area:42,onConfirm:async()=>(await j.value.validate(),C())}):C()})(a),title:"执行"},{onClick:a=>x(!0,a),title:"编辑"},{onClick:a=>{c.value={request:F,data:{script_id:a.script_id}},r({title:"执行日志",area:86,compData:{request:F,data:{script_id:a.script_id}},component:()=>i((()=>import("./index110.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},title:"日志"},{onClick:async a=>{await l({title:"删除脚本",icon:"warning-filled",content:"删除后脚本信息不可恢复,是否继续操作？"}),await o({loading:"正在删除脚本,请稍后...",request:I(a),message:!0,success:v})},title:"删除"}])]),T=f([{label:"删除脚本",value:"delete",event:async(a,e)=>{const t=async a=>await I({script_id:a.script_id});await a({title:"批量删除",content:"即将删除所选中的数据，是否继续操作?",column:[{prop:"name",label:"脚本名称"},z()],onConfirm:async()=>(await e(t),v(),!1)})}}]),j=f(),R=y({title:"脚本参数",form:{args:"",placeholder:"请输入脚本参数"},name:"",script_id:""}),k=y({args:[{required:!0,message:"请输入脚本参数",trigger:"blur"},{validator:(a,e,t)=>{if("端口检测"===R.name){/^(\d{1,3}\.){3}\d{1,3}:\d{1,5}$/.test(e)?t():t(new Error("请输入正确的IP:端口格式"))}else t()}}]}),D=f(),A=y({args_title:"",args_ps:""}),V=y({name:"",return_type:"string",is_args:"0",ps:"",script:"",type_id:"",script_id:""}),L=y({name:[{required:!0,message:"请输入脚本名称",trigger:"blur"}],script:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]}),P=async a=>{await D.value.validate();let e={...V};"1"==V.is_args&&(e={...V,...A}),a||delete e.type_id,e={data:JSON.stringify(e)};const t=a?H:J;return(await o({loading:"正在".concat(a?"编辑":"创建","脚本，请稍后..."),request:t(e),message:!0,success:a=>{a.status&&q(),v()}})).status},q=()=>{Object.assign(V,{name:"",return_type:"string",is_args:"0",ps:"",script:"",type_id:"",script_id:""}),Object.assign(A,{args_title:"",args_ps:""}),Object.assign(R,{title:"脚本参数",form:{args:"",placeholder:"请输入脚本参数"},name:"",script_id:""})};return{mainHeight:a,tableParam:d,scriptTableRef:m,tabLoading:_,total:g,tableData:u,tableLoad:w,scriptMenuData:S,TableBatchOptions:T,tableColumns:O,getScriptTabData:async()=>{const a=await M();S.value=a,S.value.length&&(d.type_id=String(S.value[0].type_id))},getScriptData:v,openAddScriptView:x,handleChangeTab:a=>{d.type_id=a.props.name,v()},$reset:()=>{u.value=[],S.value=[]},argsFormRef:j,argsForm:R,rules:k,addScriptFormRef:D,addArgsForm:A,addScriptForm:V,helpList:[{content:"当前仅支持Python和Shell脚本"},{content:"请根据返回类型在脚本执行结束时输出符合预期的值"},{content:"如果选择需要脚本参数，使用当前脚本时需传递一个参数，在脚本中的第一个参数中接收"},{content:"Python 脚本需指定编码（如 #coding: utf-8）；Shell 脚本可以用 #!/bin/bash 或 #!/bin/sh 开头，未指定类型时默认按 Shell 脚本执行。"}],addScriptRules:L}})),X={class:"flex items-center"},Y={class:"flex items-center"},Q=g(w({__name:"index",setup(t){const s=K(),{mainHeight:r,tableParam:i,scriptTableRef:l,tabLoading:n,total:o,tableData:p,tableLoad:g,scriptMenuData:u,TableBatchOptions:y,tableColumns:f}=b(s),{getScriptTabData:w,getScriptData:E,openAddScriptView:F,handleChangeTab:I}=s;return S((async()=>{await w(),E()})),C((()=>{s.$reset()})),(t,s)=>{const b=q,w=c,S=L,C=d,M=m,B=_,H=e,J=a,U=v("bt-loading");return x((T(),j("div",null,[h(w,{modelValue:O(i).type_id,"onUpdate:modelValue":s[0]||(s[0]=a=>O(i).type_id=a),type:"card",onTabClick:O(I)},{default:R((()=>[(T(!0),j(k,null,D(O(u),((a,e)=>(T(),P(b,{class:"h-0",key:e,label:a.name,name:String(a.type_id)},null,8,["label","name"])))),128))])),_:1},8,["modelValue","onTabClick"]),h(J,null,{"header-left":R((()=>[A("div",X,[h(S,{onClick:s[1]||(s[1]=a=>O(F)()),type:"primary"},{default:R((()=>s[6]||(s[6]=[V("创建脚本")]))),_:1}),A("div",{class:"flex items-center ml-4px",onClick:s[2]||(s[2]=a=>O(N)())},s[7]||(s[7]=[A("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),A("span",{class:"bt-link"},"需求反馈",-1)]))])])),"header-right":R((()=>[A("div",Y,[h(C,{modelValue:O(i).search,"onUpdate:modelValue":s[3]||(s[3]=a=>O(i).search=a),class:"ml-12px !w-[32rem]",placeholder:"请输入搜索关键字",onSearch:O(E)},null,8,["modelValue","onSearch"])])])),content:R((()=>[x(h(M,{ref_key:"scriptTableRef",ref:l,"max-height":O(r)-300,column:O(f),data:O(p)},null,8,["max-height","column","data"]),[[U,O(g)],[U,"正在加载中，请稍后...","title"]])])),"footer-left":R((()=>[h(B,{"table-ref":O(l),options:O(y)},null,8,["table-ref","options"])])),"footer-right":R((()=>[h(H,{total:O(o),page:O(i).p,"onUpdate:page":s[4]||(s[4]=a=>O(i).p=a),row:O(i).rows,"onUpdate:row":s[5]||(s[5]=a=>O(i).rows=a),onChange:O(E)},null,8,["total","page","row","onChange"])])),_:1})])),[[U,O(n)]])}}}),[["__scopeId","data-v-d95e0058"]]),W=Object.freeze(Object.defineProperty({__proto__:null,default:Q},Symbol.toStringTag,{value:"Module"}));export{K as C,W as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
