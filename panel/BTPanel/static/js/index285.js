import{G as e,O as a,b as s}from"./utils-lib.js?v=1734676359";import{c as l,r as t,h as o,o as r,k as u,l as i,e as n,x as c,p as m,I as p,aX as d,J as f,ag as h,ah as v,a7 as _,a4 as j}from"./base-lib.js?v=1734676359";import{c as g}from"./useController3.js?v=1734676359";import{setSitePhpVersionMultiple as V,modifyProjectAsync as y,getPhpVersion as P}from"./site.js?v=1734676359";import{u as b}from"./useStore7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const w={class:"p-2rem"},x=l({__name:"index",props:{compData:{default:()=>{}}},setup(l,{expose:x}){const D=s(),H=l,{isRefreshList:k}=b(),E=t(),O=o({selectValue:""}),q=o({selectValue:[{required:!0,message:"请选择PHP版本",trigger:"change"}]}),C=t([]);return x({onConfirm:async e=>{let a;try{await E.value.validate(),a=D.load("正在调整php版本，请稍后...");let s=[],l=[];H.compData.forEach((e=>{var a;"PHPMOD"!==(null==(a=null==e?void 0:e.project_config)?void 0:a.type)&&s.push(e.id)}));const t=await V({sites_id:s,version:O.selectValue}),o=H.compData.filter((e=>{var a;return"PHPMOD"===(null==(a=null==e?void 0:e.project_config)?void 0:a.type)}));if(o.length)if("00"==O.selectValue)o.forEach((e=>{l.push({name:e.name,status:!1,msg:"异步项目不支持"})}));else{const e=o.map((async e=>{const a=await y({site_name:e.name,...e.project_config,php_version:O.selectValue});return{name:e.name,status:a.status,msg:a.msg}})),a=await Promise.all(e);l.push(...a)}Object.keys(t.error).forEach((e=>{l.push({name:e,status:!1})})),t.success.forEach((e=>{l.push({name:e,status:!0})})),g({title:"批量设置php版本",resultTitle:"设置php版本",resultData:l}),e(),k.value=!0}catch(s){}finally{null==a||a.close()}}}),r((()=>{(async()=>{var a;await e({request:P(),data:[Array,C]}),O.selectValue=(null==(a=C.value[0])?void 0:a.version)||""})()})),(e,s)=>{const l=h,t=v,o=_,r=j,g=a;return u(),i("div",w,[n(r,{ref_key:"formRef",ref:E,model:m(O),"label-width":"80px",rules:m(q)},{default:c((()=>[n(o,{label:"PHP版本",prop:"selectValue"},{default:c((()=>[n(t,{modelValue:m(O).selectValue,"onUpdate:modelValue":s[0]||(s[0]=e=>m(O).selectValue=e),placeholder:"请选择PHP版本",class:"!w-24rem"},{default:c((()=>[(u(!0),i(p,null,d(m(C),(e=>(u(),f(l,{key:e.version,label:e.name,value:e.version},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),n(g,{options:[{content:"请根据您的程序需求选择版本"}],class:"pl-4rem"})])}}});export{x as default};
