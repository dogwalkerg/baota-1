import{u as e,bX as l,an as a,D as t,a4 as s,aO as r,j as u,l as o,_ as i,c as n,aa as m}from"./utils-lib.js?v=1734676359";import{c as p,t as d,az as c,B as v,k as _,l as y,p as f,J as x,x as b,q as g,e as h,y as w,z as j,C as V,v as k,i as q,ad as B,ae as C,aT as U,aY as F,A as z,r as A,o as M,M as T,ay as E}from"./base-lib.js?v=1734676359";import{u as G}from"./useStore7.js?v=1734676359";import{_ as I}from"./index.vue_vue_type_script_setup_true_lang12.js?v=1734676359";import{_ as L}from"./index90.js?v=1734676359";import{_ as N}from"./index261.js?v=1734676359";import{_ as O}from"./index116.js?v=1734676359";import{b as D,u as H}from"./column.js?v=1734676359";import{aB as J}from"./validator.js?v=1734676359";import{g as Q,c as S,d as X,e as Y,f as K,j as P,v as R,t as W,k as Z,l as $,n as ee,q as le,r as ae}from"./useController8.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./site.js?v=1734676359";import"./index91.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";import"./useController3.js?v=1734676359";const te={class:"flex items-center"},se={class:"whitespace-normal leading-1.8rem ml-[4px]"},re={key:0,class:"flex items-center"},ue={key:1},oe={key:2,class:"flex items-center"},ie={class:"bg-[#FAFAFA] my-[20px] flex items-center border border-[#ddd] justify-evenly p-[8px] py-[12px]"},ne={class:"flex flex-col justify-center items-center"},me={class:"flex flex-col justify-center items-center"},pe=p({__name:"index",setup(m){const{payment:p}=e(),{authType:A}=d(p.value),{BtTable:M}=l({request:Q,columns:[{label:"类型",prop:"rule_type",width:80},{label:"限额阈值",render:e=>c("span",[e.limit_value.replace("frequency","次")])},{label:"周期",prop:"time_period"},{label:"策略",prop:"rule",width:240,showOverflowTooltip:!0},D({prop:"limit_status",event:S}),H([{title:"删除",onClick:X}])],extension:[a(le)]}),T=()=>{const e=q((()=>{let e=i.value.time_period;return"moment"===i.value.rule_type?Z.forEach((l=>{l.value===e&&(e=l.label)})):$.forEach((l=>{l.value===e&&(e=l.label)})),e})),{BtForm:l,submit:a,param:i}=t({data:{rule_type:"moment",time_period:"10m",limit_unit:"MB",limit_value:100,threshold_percentage:60,limit_action:"alert",module:[],cycle:3,type:"total"},options:l=>q((()=>[{type:"custom",render:()=>h(r,{label:"限额"},{default:()=>[h("div",{class:"flex items-center"},[h(s,{class:"!w-[10rem]",modelValue:l.value.type,"onUpdate:modelValue":e=>l.value.type=e,options:[{value:"total",label:"流量"},{value:"request",label:"请求数"}]},null),h(r,{prop:"limit_value",label:""},{default:()=>[h(u,{type:"number",width:"10rem",class:"mx-[12px]",modelValue:l.value.limit_value,"onUpdate:modelValue":e=>l.value.limit_value=e},null)]}),"request"===l.value.type?h("span",{class:"text-[#666] text-[1.2rem]"},[w("次数")]):h(s,{class:"unit-select !w-[8rem]",modelValue:l.value.limit_unit,"onUpdate:modelValue":e=>l.value.limit_unit=e,options:[{value:"GB",label:"GB"},{value:"MB",label:"MB"}]},null)])]}),rules:{limit_value:[{required:!0,message:"请输入限额阈值",trigger:"blur"}]}},{type:"custom",render:()=>h(r,{label:"类型"},{default:()=>[h("div",{class:"flex flex-col"},[h("div",{class:"flex items-center"},[h(B,{modelValue:l.value.rule_type,"onUpdate:modelValue":e=>l.value.rule_type=e},{default:()=>[h(C,{value:"moment"},{default:()=>[w("实时"),"total"===l.value.type?"流量":"请求数"]}),h(C,{value:"total"},{default:()=>[w("累计"),"total"===l.value.type?"流量":"请求数"]})]})]),h("span",{class:"text-[1.2rem] text-[#666]"},[w("当前网站运行"),"moment"===l.value.rule_type?"实时":"累计","total"===l.value.type?"流量":"请求数"])])]})},{type:"custom",render:()=>h(r,{label:"周期"},{default:()=>[h("div",{class:"flex items-center"},[h(s,{class:"!w-[12rem] mr-[12px]",modelValue:l.value.time_period,"onUpdate:modelValue":e=>l.value.time_period=e,options:"moment"===l.value.rule_type?Z:$},null),h("span",{class:"text-[1.2rem] text-[#666]"},[w("检测"),e.value,w("内的"),"moment"===l.value.rule_type?"实时":"累计","total"===l.value.type?"流量":"请求情况"])])]})},{type:"custom",render:()=>h(r,{label:"策略"},{default:()=>[h("div",{class:"flex items-center"},[h(r,{label:"",prop:"threshold_percentage"},{default:()=>[h(u,{modelValue:l.value.threshold_percentage,"onUpdate:modelValue":e=>l.value.threshold_percentage=e,type:"number",width:"12rem",class:"mr-[12px]"},{append:"%"})]}),h(s,{class:"!w-[15rem]",modelValue:l.value.limit_action,"onUpdate:modelValue":e=>l.value.limit_action=e,options:[{label:"告警",value:"alert"},{label:"告警并停止网站",value:"alert_stop"}]},null)]),h("span",{class:"text-[1.2rem] text-[#666]"},[w("当访问【"),"total"===l.value.type?"流量":"请求次数",w("】超过限额阈值【"),l.value.threshold_percentage,w("%】时【"),"alert"===l.value.limit_action?"告警":"告警并停止网站",w("】")])]}),rules:{threshold_percentage:[{required:!0,message:"请输入阈值百分比",trigger:"blur"},{validator:(e,l,a)=>{l<1||!Number.isInteger(parseFloat(l))?a(new Error("阈值百分比不能小于1")):a()},trigger:["blur","change"]}]}},{type:"custom",render:()=>h(r,{label:"发送次数",prop:"cycle"},{default:()=>[h("div",{class:"flex items-center"},[h(u,{width:"12rem",type:"number",min:"1",modelValue:l.value.cycle,"onUpdate:modelValue":e=>l.value.cycle=e},{append:"次"}),h("span",{class:"text-[1.2rem] text-[#666] ml-[12px]"},[w("后将不再发送告警信息，如需发送多次请填写2次以上")])])]}),rules:{cycle:[{required:!0,message:"请输入发送次数",trigger:"blur"}]}},J("告警方式","module",{rules:{module:[{required:!0,message:"请选择告警方式",trigger:"blur"}]}})])),submit:async(e,l)=>(await l(),await ee(e.value))});o({title:"添加流量限额配置",area:60,component:()=>h("div",{class:"p-[2rem]"},[h(U,{title:"通过设置流量限额，可以限制在特定时间段内允许网络传输的数据量",type:"warning",closable:!1,"show-icon":!0},null),h(l,{class:"!mt-[12px]"},null)]),showFooter:!0,onConfirm:a})};return(e,l)=>{const a=i,t=n,s=O,r=N,u=F,o=z,m=L,p=v("bt-loading");return _(),y("div",null,[f(Y)||!f(K).buy_status&&"ltd"!==f(A)?(_(),x(s,{key:0,showConfig:{width:"44rem"}},{content:b((()=>[g("div",te,[h(a,{icon:"el-warning",color:"#fc6d26",size:18}),g("div",se,["ltd"===f(A)||f(K).buy_status?j("",!0):(_(),y("span",re,[l[3]||(l[3]=w(" 当前为企业版专享功能， ")),h(t,{onClick:l[0]||(l[0]=e=>f(P)("buy"))},{default:b((()=>l[2]||(l[2]=[w("点击购买")]))),_:1})])),f(K).nginx_status?j("",!0):(_(),y("span",ue,"nginx版本小于1.18，请升级版本")),f(K).total_status?j("",!0):(_(),y("span",oe,[l[5]||(l[5]=w(" 当前尚未安装监控报表插件或版本小于7.6.0， ")),h(t,{onClick:l[1]||(l[1]=e=>f(P)("install")),class:"!text-[1.4rem]"},{default:b((()=>l[4]||(l[4]=[w("点击安装")]))),_:1})]))])])])),_:1})):j("",!0),g("div",null,[h(r,{title:"流量限额可设置多条规则，统计周期产生的流量/请求超过限额会告警",type:"warning",closable:!1,"show-icon":""}),V((_(),y("div",ie,[g("div",ne,[l[6]||(l[6]=g("span",null,"当前流量",-1)),g("span",null,k(f(W).length),1)]),h(u,{direction:"vertical"}),g("div",me,[l[7]||(l[7]=g("span",null,"当前请求数",-1)),g("span",null,k(f(W).request),1)])])),[[p,f(R)]]),h(m,null,{"header-left":b((()=>[h(o,{type:"primary",onClick:T},{default:b((()=>l[8]||(l[8]=[w("添加流量限额配置")]))),_:1})])),content:b((()=>[h(f(M))])),_:1})])])}}}),de=p({__name:"index",setup(e){var l;const{siteInfo:a}=G(),t=A((null==(l=a.value)?void 0:l.tabName)||"flowLimit");return M((()=>{ae()})),(e,l)=>{const a=E,s=m;return _(),x(s,{type:"card",modelValue:f(t),"onUpdate:modelValue":l[0]||(l[0]=e=>T(t)?t.value=e:null)},{default:b((()=>[h(a,{label:"流量限制",name:"flowLimit"},{default:b((()=>[h(I)])),_:1}),f(K).total_status?(_(),x(a,{key:0,label:"流量限额",name:"flowQuota",lazy:!0},{default:b((()=>[h(pe)])),_:1})):j("",!0)])),_:1},8,["modelValue"])}}});export{de as default};
