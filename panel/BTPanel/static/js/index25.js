import{c as e,r as a,h as t,i as l,o as s,n,a1 as r,B as c,k as o,l as i,q as m,y as d,e as u,x as f,v as p,p as g,F as _,C as v,D as x,G as b,I as y,aX as h,A as j,b7 as w,au as k}from"./base-lib.js?v=1734676359";import{_ as C}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1734676359";import{u as M,a5 as U,aj as P,R,t as B,e as N}from"./utils-lib.js?v=1734676359";import{C as A,o as F}from"./useMethods.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./useStore3.js?v=1734676359";const H={class:"flex flex-wrap"},I={class:"manger-con"},S={class:"pb-[1rem] text-[2rem] flex justify-between items-center"},q={class:"use-box"},D={class:"flex-col flex justify-center flex-1 h-full"},G={class:"font-bold text-[1.4rem] mb-[1rem]"},J={class:"text-[1.2rem] text-[#ccc]"},O={class:"text-[1.2rem] mb-[1rem]"},T={class:"description"},X={class:"use-box"},z={class:"flex-col flex justify-center flex-1 h-full"},E={class:"font-bold text-[1.4rem] mb-[1rem]"},K={class:"text-[1.2rem] text-[#ccc]"},L={class:"text-[1.2rem] mb-[1rem]"},Q={class:"description"},V={class:"description"},W={class:"h-[8rem] p-[1rem] relative pl-[5rem] border-b border-[#ccc] flex flex-col justify-between"},Y=["onClick"],Z=["onClick"],$={class:"w-full truncate leading-[1.3]"},ee={class:"w-full h-[11rem] p-[1rem] flex items-center"},ae={class:"chart bg-[#f5f5f5]"},te={class:"chart bg-[#f5f5f5] ml-[2rem]"},le={class:"h-full w-[12rem] flex flex-col justify-end ml-[3rem] pb-[.3rem]"},se={class:"flex items-center justify-between cpu-before mb-[1rem]"},ne={class:"flex items-center justify-between ram-before"},re=N(e({__name:"index",setup(e,{expose:N}){const re=a(!1),{mainHeight:ce}=M(),oe=a([]),ie=a(!1),me=a(null),de=t({cpu:{percentage:0,load:!0},memory:{percentage:0,userd:0,all:0,load:!0},total:0,p:1,row:50,loading:!1,errmsg:""});let ue=null;const fe=l((()=>0===oe.value.length&&!de.loading)),pe=l((()=>{const e=(de.p-1)*de.row,a=de.p*de.row;return oe.value.slice(e,a)})),ge=[{color:"#f7b851",percentage:90},{color:"#ef0808",percentage:100}],_e=[{color:"#52a9ff",percentage:90},{color:"#ef0808",percentage:100}],ve=async(e,a)=>{try{const e=JSON.parse(a.data);e.data.cpu_info.length&&ye(e.data),e.data.mem_info&&he(e.data),e.data.container_stats_data.length&&je(e.data),de.total=e.data.container_count||0,e.end&&(P(e.data,"object",{},(()=>{je({container_stats_data:[]}),de.errmsg=e.msg}),!0),null==ue||ue.send({model_index:"btdocker",mod_name:"container",def_name:"get_all_stats",ws_callback:1002}))}catch(t){}},xe=async()=>{de.loading=!0,null==ue||ue.close(),ue=U({route:"/ws_model",onMessage:ve});null==ue||ue.send({model_index:"btdocker",mod_name:"container",def_name:"get_all_stats",ws_callback:111})},be=e=>{me.value&&(ie.value=e,me.value.style.height=ie.value?"0":"10rem")},ye=e=>{if(!e.cpu_info)return;const a=e.cpu_info;de.cpu.percentage=parseFloat(a[0]),de.cpu.load=!1},he=e=>{if(!e.mem_info)return;const a=e.mem_info,t=Number(a.memRealUsed),l=Number(a.memTotal);de.memory.userd=t,de.memory.all=l,de.memory.percentage=Math.round(t/l*1e3)/10,de.memory.load=!1},je=e=>{if(!e.container_stats_data.length)return;const a=e.container_stats_data;oe.value=a,de.loading&&(de.loading=!1)},we=async()=>{try{re.value=!0,xe()}catch(e){}finally{re.value=!1}};return s((()=>{we(),n((()=>{ce.value<=700?be(!0):be(!1)}))})),N({init:we,destroy:()=>{null==ue||ue.close(),ue=null}}),r((()=>{})),(e,a)=>{const t=j,l=w,s=C,n=k,r=c("bt-loading");return o(),i("div",{class:"w-full p-[1.6rem]",style:b("min-height:".concat(g(ce)-140,"px;"))},[m("div",H,[m("div",I,[m("div",null,[m("div",S,[a[2]||(a[2]=d(" 运行容器 ")),m("div",null,[u(t,{onClick:xe},{default:f((()=>a[1]||(a[1]=[d("刷新容器列表")]))),_:1}),u(t,{onClick:a[0]||(a[0]=e=>be(!g(ie)))},{default:f((()=>[d(p(g(ie)?"展开CPU、内存总览":"隐藏CPU、内存总览"),1)])),_:1})])]),m("div",{class:_(["use-menu",g(ie)?"":"pb-[1.6rem]"]),ref_key:"useMenuRef",ref:me},[m("div",q,[m("div",D,[m("div",G,[a[4]||(a[4]=d(" CPU使用率 ")),v(m("span",J,a[3]||(a[3]=[d("正在计算中"),m("span",{class:"svgtofont-el-loading"},null,-1)]),512),[[x,g(de).cpu.load]])]),m("div",O,[m("span",T,p(g(de).cpu.percentage),1),a[5]||(a[5]=d("% "))]),u(l,{percentage:g(de).cpu.percentage,color:ge},null,8,["percentage"])])]),m("div",X,[m("div",z,[m("div",E,[a[7]||(a[7]=d(" 内存使用率 ")),v(m("span",K,a[6]||(a[6]=[d("正在计算中"),m("span",{class:"svgtofont-el-loading"},null,-1)]),512),[[x,g(de).memory.load]])]),m("div",L,[m("span",Q,p(g(de).memory.userd),1),a[8]||(a[8]=d(" MB ")),m("span",V,"/"+p(g(de).memory.all),1),a[9]||(a[9]=d("MB "))]),u(l,{percentage:g(de).memory.percentage,color:_e},null,8,["percentage"])])])],2),v((o(),i("div",{class:_(g(fe)?"flex pt-[1.6rem] justify-center items-center":"con-grid"),ref:"scrollContainer",style:b(["height:".concat(g(ie)?g(ce)-190:g(ce)-280,"px;"),{transition:"height 0.5s"}])},[(o(!0),i(y,null,h(g(pe),(e=>{var t;return o(),i("div",{key:e.id,class:"w-full h-[19rem] border border-[#ccc] rounded-[.2rem] text-[1.2rem] text-[#999]"},[m("div",W,[m("span",{class:"monitor svgtofont-el-monitor",onClick:a=>g(A)(e)},null,8,Y),m("div",{class:"text-[1.4rem] leading-[1.3] w-full truncate cursor-pointer font-bold text-primary",onClick:a=>g(F)(e)},[u(s,{text:e.name},null,8,["text"])],8,Z),m("div",$,[u(s,{text:e.image},null,8,["text"])]),m("div",null,"创建时间："+p(g(R)(e.create_time)),1)]),m("div",ee,[m("div",ae,[m("div",{class:"chart-use bg-[#f7b851]",style:b({height:"".concat(e.cpu_usage,"%")})},null,4)]),m("div",te,[m("div",{class:"chart-use bg-[#52a9ff]",style:b({height:"".concat(e.mem_percent,"%")})},null,4)]),m("div",le,[m("div",se,[a[10]||(a[10]=d(" CPU ")),m("span",null,p(e.cpu_usage)+"%",1)]),m("div",ne,[a[11]||(a[11]=d(" RAM ")),m("span",null,p(g(B)(null==(t=e.mem_usage)?void 0:t.mem_usage)),1)])])])])})),128)),v(u(n,{description:g(de).errmsg},null,8,["description"]),[[x,g(fe)]])],6)),[[r,g(de).loading],[r,"正在加载运行中的容器列表，请稍候...","title"]])])])])],4)}}}),[["__scopeId","data-v-8ba19fd5"]]);export{re as default};
