import{c as e,r as a,h as l,o as t,k as o,J as r,x as s,e as u,p as m,q as n,l as d,I as i,aX as p,z as h,y as w,a7 as c,ag as y,ah as f,Q as v,aw as b,a4 as _}from"./base-lib.js?v=1734676359";import{G as k,j as V}from"./utils-lib.js?v=1734676359";import{modifyCrontab as g,addCrontab as x}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const D={class:"flex items-center"},H={class:"flex items-center"},M=e({__name:"add-crontab",props:{compData:{default:{}}},setup(e,{expose:M}){const U=e,j=a(!!U.compData.row),q=a(),B=a(!1),N=l({cron_name:"",type:"week",week:"1",where1:"3",hour:"1",minute:"30",flock:!1,sBody:""}),z=l({cron_name:[{required:!0,message:"请输入计划任务名称",trigger:"blur"}],hour:[{required:!0,message:"请输入执行时间",trigger:"blur"}],minute:[{required:!0,message:"请输入执行时间",trigger:"blur"}],sBody:[{required:!0,message:"请输入脚本内容",trigger:"blur"}]}),C=a(5);let I=a([{type:"day",text:"每天",showDay:!1,showHour:!0,showMinute:!0},{type:"day-n",text:"N天",showDay:!0,showHour:!0,showMinute:!0},{type:"hour",text:"每小时",showDay:!1,showHour:!1,showMinute:!0},{type:"hour-n",text:"N小时",showDay:!1,showHour:!0,showMinute:!0},{type:"minute-n",text:"N分钟",showDay:!1,showHour:!1,showMinute:!0},{type:"week",text:"每周",showDay:!1,showHour:!0,showMinute:!0},{type:"month",text:"每月",showDay:!0,showHour:!0,showMinute:!0}]);const E=(e,a=!1)=>{N.type=e,C.value=I.value.findIndex((a=>a.type===e)),"minute-n"===N.type&&(N.where1=N.minute),"hour-n"===N.type&&(N.where1=N.hour),q.value&&q.value.clearValidate()};return t((()=>{j.value=!!U.compData.row;const{type:e,where1:a,where_hour:l,where_minute:t,flock:o,sBody:r,rname:s,name:u}=U.compData.row;Object.assign(N,{cron_name:s||u||"",type:e||"week",week:"week"===e?a:"1",where1:a||"3",hour:l||"1",minute:t||"30",flock:!!o,sBody:r||""}),E(N.type)})),M({onConfirm:e=>{q.value.validate((a=>{if(!a)return;B.value=!0;let l={sitename:U.compData.sitename,...N,flock:N.flock?1:0};j.value&&(l.id=U.compData.row.id);const t=j.value?g:x;k({loading:"正在".concat(j.value?"修改":"添加","计划任务，请稍候..."),request:t(l),message:!0,success:a=>{B.value=!1,a.status&&(e(),U.compData.refreshEvent())}})}))}}),(e,a)=>{const l=V,t=c,k=y,g=f,x=v,M=b,U=_;return o(),r(U,{ref_key:"crontabFormRef",ref:q,model:m(N),rules:m(z),disabled:m(B),"label-width":"80px",class:"p-2rem"},{default:s((()=>[u(t,{label:"任务名称",prop:"cron_name"},{default:s((()=>[u(l,{modelValue:m(N).cron_name,"onUpdate:modelValue":a[0]||(a[0]=e=>m(N).cron_name=e),placeholder:"请输入计划任务名称",width:"36rem"},null,8,["modelValue"])])),_:1}),u(t,{label:"执行周期"},{default:s((()=>{var e,c,y;return[n("div",D,[u(g,{onChange:a[1]||(a[1]=e=>E(m(N).type,!0)),class:"!w-[8rem] mr-1rem",modelValue:m(N).type,"onUpdate:modelValue":a[2]||(a[2]=e=>m(N).type=e)},{default:s((()=>[(o(!0),d(i,null,p(m(I),((e,a)=>(o(),r(k,{key:a,label:e.text,value:e.type},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),"week"==m(N).type?(o(),r(t,{key:0,class:"el-form-item-item mr-1rem"},{default:s((()=>[u(g,{class:"!w-[8rem]",modelValue:m(N).week,"onUpdate:modelValue":a[3]||(a[3]=e=>m(N).week=e)},{default:s((()=>[u(k,{label:"周一",value:"1"}),u(k,{label:"周二",value:"2"}),u(k,{label:"周三",value:"3"}),u(k,{label:"周四",value:"4"}),u(k,{label:"周五",value:"5"}),u(k,{label:"周六",value:"6"}),u(k,{label:"周日",value:"7"})])),_:1},8,["modelValue"])])),_:1})):h("",!0),(null==(e=m(I)[m(C)])?void 0:e.showDay)?(o(),r(t,{key:1,class:"el-form-item-item mr-1rem",prop:"where1"},{default:s((()=>[u(l,{modelValue:m(N).where1,"onUpdate:modelValue":a[4]||(a[4]=e=>m(N).where1=e),min:1,width:"12rem",type:"number"},{append:s((()=>a[9]||(a[9]=[w("天")]))),_:1},8,["modelValue"])])),_:1})):h("",!0),(null==(c=m(I)[m(C)])?void 0:c.showHour)?(o(),r(t,{key:2,class:"el-form-item-item mr-1rem",prop:"hour"},{default:s((()=>{var e;return[(null==(e=m(I)[m(C)])?void 0:e.showHour)?(o(),r(l,{key:0,modelValue:m(N).hour,"onUpdate:modelValue":a[5]||(a[5]=e=>m(N).hour=e),width:"12rem",max:"23",min:"0",type:"number"},{append:s((()=>a[10]||(a[10]=[w("小时")]))),_:1},8,["modelValue"])):h("",!0)]})),_:1})):h("",!0),(null==(y=m(I)[m(C)])?void 0:y.showMinute)?(o(),r(t,{key:3,class:"el-form-item-item",prop:"minute"},{default:s((()=>{var e;return[(null==(e=m(I)[m(C)])?void 0:e.showMinute)?(o(),r(l,{key:0,modelValue:m(N).minute,"onUpdate:modelValue":a[6]||(a[6]=e=>m(N).minute=e),width:"12rem",max:"59",min:"0",type:"number"},{append:s((()=>a[11]||(a[11]=[w("分钟")]))),_:1},8,["modelValue"])):h("",!0)]})),_:1})):h("",!0)])]})),_:1}),u(t,{label:" ","label-width":"0rem"},{default:s((()=>[n("div",H,[u(x,{modelValue:m(N).flock,"onUpdate:modelValue":a[7]||(a[7]=e=>m(N).flock=e),disabled:m(j)},{default:s((()=>a[12]||(a[12]=[w("开启进程锁")]))),_:1},8,["modelValue","disabled"]),u(M,{placement:"right-start",width:"440","popper-class":"white-tips-popover",trigger:"hover",content:""},{reference:s((()=>a[13]||(a[13]=[n("i",{class:"svgtofont-el-question-filled text-warning ml-[12px]"},null,-1)]))),default:s((()=>[a[14]||(a[14]=n("div",{class:"p-[12px]"},[n("span",{class:"text-[#666]"},"在同一时间内只用一个进程在执行，若上一个进程未执行结束，下一次不执行")],-1))])),_:1})])])),_:1}),u(t,{label:"脚本内容",prop:"sBody"},{default:s((()=>[u(l,{width:"58rem",placeholder:"请输入脚本内容",type:"textarea",modelValue:m(N).sBody,"onUpdate:modelValue":a[8]||(a[8]=e=>m(N).sBody=e),resize:"both",rows:10},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules","disabled"])}}});export{M as default};
