import{c as e,t as a,h as l,r as t,o as s,k as r,J as o,x as u,e as n,y as i,v as m,p as d,N as p,a7 as g,P as c,Q as f,A as _,a4 as w}from"./base-lib.js?v=1734676359";import{g as v,Z as b}from"./useStore3.js?v=1734676359";import{M as y,o as V,G as h}from"./utils-lib.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const j=e({__name:"container-upgrade",props:{compData:{default:()=>({})}},emits:["close"],setup(e,{emit:j}){const{refs:{currentConDetail:C}}=v(),I=e,k=j,{row:x}=a(I.compData),D=l({new_image:"latest",upgrade:!1,pull:!1}),S=t(),U={new_image:[{required:!0,message:"请输入目标镜像版本",trigger:["blur"]}]},q=async()=>{await S.value.validate(),!(()=>{const e=C.value.Config.Image.split(":")[1],a=D.new_image;if("latest"==e||"latest"==a)return!1;const l=e.split("."),t=a.split(".");for(let s=0;s<Math.max(l.length,t.length);s++){const e=parseInt(l[s])||0,a=parseInt(t[s])||0;if(e<a)return!1;if(e>a)return!0}})()||D.upgrade?(await V({title:"升级",content:"升级操作需要重建容器，任何未持久化的数据将会丢失，是否继续？"}),h({request:b({data:JSON.stringify({new_image:D.new_image,upgrade:"1",id:x.value.id,force_pull:D.pull?"1":"0"})}),message:!0,success:async e=>{e.status&&(k("close"),setTimeout((()=>{window.location.reload()}),1e3))}})):y.error("检测到当前目标版本低于原镜像版本，请重新输入或点击强制升级！")};return s((async()=>{})),(e,a)=>{const l=g,t=c,s=f,v=_,b=w;return r(),o(b,{ref_key:"cmdFormRef",ref:S,model:d(D),rules:U,onSubmit:a[3]||(a[3]=p((()=>{}),["prevent"]))},{default:u((()=>[n(l,{label:"当前镜像"},{default:u((()=>{var e;return[i(m((null==(e=d(C).Config)?void 0:e.Image)||""),1)]})),_:1}),n(l,{prop:"new_image",label:"目标镜像"},{default:u((()=>[n(t,{modelValue:d(D).new_image,"onUpdate:modelValue":a[0]||(a[0]=e=>d(D).new_image=e),style:{width:"40rem"},placeholder:"请输入版本号"},{prepend:u((()=>{var e;return[i(m((null==(e=d(C).Config)?void 0:e.Image.split(":")[0])||""),1)]})),_:1},8,["modelValue"])])),_:1}),n(l,{label:" "},{default:u((()=>[n(s,{modelValue:d(D).upgrade,"onUpdate:modelValue":a[1]||(a[1]=e=>d(D).upgrade=e)},{default:u((()=>a[4]||(a[4]=[i("强制升级")]))),_:1},8,["modelValue"])])),_:1}),n(l,{label:" "},{default:u((()=>[n(s,{modelValue:d(D).pull,"onUpdate:modelValue":a[2]||(a[2]=e=>d(D).pull=e)},{default:u((()=>a[5]||(a[5]=[i("强制拉取镜像")]))),_:1},8,["modelValue"])])),_:1}),n(v,{class:"ml-[10rem]",type:"primary",onClick:q},{default:u((()=>a[6]||(a[6]=[i("保存配置")]))),_:1})])),_:1},8,["model"])}}});export{j as default};
