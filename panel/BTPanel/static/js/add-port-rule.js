import{c as e,r as a,R as l,h as t,o,k as s,J as d,x as r,e as i,p,l as u,aX as n,I as m,z as c,M as f,a7 as b,ah as h,P as y,a4 as w,ag as g}from"./base-lib.js?v=1734676359";import{u as _,dB as V,G as v,a4 as P,j as k,O as D,h as U,e as j}from"./utils-lib.js?v=1734676359";import{_ as I}from"./index100.js?v=1734676359";import{p as S,o as x}from"./firewall.js?v=1734676359";import{a as A,g as T}from"./useMethod4.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./useStore4.js?v=1734676359";const N=j(e({__name:"add-port-rule",props:{compData:{default:()=>{}}},setup(e,{expose:j}){const N=e,{payment:C}=_(),{authType:O}=C.value,q=a(!1),J=a(),R=l(N.compData.isEdit),E={title:"指定域名-功能介绍",ps:"系统防火墙将会放行/阻止设置域名所解析的A/AAAA记录",source:106,desc:["放行/阻止域名解析记录"],tabImgs:[{title:"防火墙禁止端口",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/firewall/specify_domain_1.png"},{title:"域名解析已生效",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/firewall/specify_domain_2.png"},{title:"设置效果",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/firewall/specify_domain_3.png"}]},M=t({protocol:"tcp",port:"",choose:"all",types:"accept",brief:"",address:"",domain:"",chain:"INPUT"}),z=[{content:"支持添加多个端口，如：80,88"},{content:"支持添加多个端口范围，如：80,88,90-99,110-120"}],B=[{title:"入站(默认)",key:"INPUT"},{title:"出站",key:"OUTPUT"}],F="请输入指定IP，多个IP请用,隔开或换行。例如192.168.1.1,192.168.1.2",G="请输入指定域名。例如www.bt.cn",H=[{label:"TCP",value:"tcp"},{label:"UDP",value:"udp"},{label:"TCP/UDP",value:"all"}],X=[{title:"所有IP",key:"all"},{title:"指定IP",key:"point"},{title:"指定域名 -- 企业版专享",key:"domain"}],K=[{title:"放行",key:"accept"},{title:"禁止",key:"drop"}],L={port:[{validator:V,trigger:["blur"],required:!0}],address:[{trigger:["blur","change"],required:!0,message:"请输入指定IP"}],domain:[{trigger:["blur","change"],required:!0,message:"请输入指定域名"}]},Q=e=>{try{const a=/[^0-9,-]/g;M.port=e.replace(a,"")}catch(a){}},W=e=>{if(J.value.clearValidate(),"ltd"!==O&&"domain"===e)return M.choose="all",void(q.value=!0);M.choose=e};return o((()=>{var e,a;if(M.port=(null==(e=N.compData)?void 0:e.port)||"",N.compData.isEdit){const e="all"===(null==(a=N.compData)?void 0:a.Address);Object.assign(M,{protocol:N.compData.Protocol,port:N.compData.Port,types:N.compData.Strategy,brief:N.compData.brief,chain:N.compData.Chain,address:e?"":N.compData.Address,domain:N.compData.domain}),M.choose=e?"all":""===N.compData.domain?"point":"domain"}})),j({onConfirm:async e=>{await J.value.validate();const a=await(()=>{const e={...M,operation:"add",strategy:M.types};if("all"===e.choose&&delete e.address,e.brief||(e.brief=""),R.value&&(e.id=N.compData.id),R.value){const a={...N.compData};return a.noNps&&delete a.noNps,{old_data:JSON.stringify(a),new_data:JSON.stringify(e)}}return e})(),l="domain"===M.choose;await v({loading:"正在提交，请稍后...",message:!0,request:R.value?S(a,l):x(a,l)}),e(),N.compData.refreshFn(),await A(),T(),R.value}}),(e,a)=>{const l=P,t=b,o=k,_=g,V=h,v=y,j=D,S=I,x=U,A=w;return s(),d(A,{ref_key:"editPortRulesRef",ref:J,rules:L,model:p(M),class:"p-[2rem] addfrom"},{default:r((()=>[i(t,{label:"协议"},{default:r((()=>[i(l,{modelValue:p(M).protocol,"onUpdate:modelValue":a[0]||(a[0]=e=>p(M).protocol=e),class:"!w-[24rem]",options:H},null,8,["modelValue"])])),_:1}),i(t,{label:"端口",prop:"port"},{default:r((()=>[i(o,{modelValue:p(M).port,"onUpdate:modelValue":a[1]||(a[1]=e=>p(M).port=e),width:"24rem",placeholder:"请输入端口",disabled:p(R),onInput:Q},null,8,["modelValue","disabled"])])),_:1}),i(t,{label:"来源"},{default:r((()=>[i(V,{modelValue:p(M).choose,"onUpdate:modelValue":a[2]||(a[2]=e=>p(M).choose=e),onChange:W,class:"!w-[24rem]"},{default:r((()=>[(s(),u(m,null,n(X,((e,a)=>i(_,{key:a,label:e.title,value:e.key},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),"point"===p(M).choose?(s(),d(t,{key:0,label:"指定IP",prop:"address"},{default:r((()=>[i(o,{type:"textarea",rows:3,width:"24rem",modelValue:p(M).address,"onUpdate:modelValue":a[3]||(a[3]=e=>p(M).address=e),placeholder:F,clearable:""},null,8,["modelValue","placeholder"])])),_:1})):c("",!0),"ltd"===p(O)&&"domain"===p(M).choose?(s(),d(t,{key:1,label:"指定域名",prop:"domain"},{default:r((()=>[i(o,{type:"textarea",rows:3,modelValue:p(M).domain,"onUpdate:modelValue":a[4]||(a[4]=e=>p(M).domain=e),width:"24rem",placeholder:G,clearable:""},null,8,["modelValue","placeholder"])])),_:1})):c("",!0),i(t,{label:"策略"},{default:r((()=>[i(V,{modelValue:p(M).types,"onUpdate:modelValue":a[5]||(a[5]=e=>p(M).types=e),class:"!w-[24rem]"},{default:r((()=>[(s(),u(m,null,n(K,((e,a)=>i(_,{key:a,label:e.title,value:e.key},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),i(t,{label:"方向"},{default:r((()=>[i(V,{modelValue:p(M).chain,"onUpdate:modelValue":a[6]||(a[6]=e=>p(M).chain=e),class:"!w-[24rem]"},{default:r((()=>[(s(),u(m,null,n(B,(e=>i(_,{key:e.key,label:e.title,value:e.key},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),i(t,{label:"备注"},{default:r((()=>[i(v,{modelValue:p(M).brief,"onUpdate:modelValue":a[7]||(a[7]=e=>p(M).brief=e),class:"!w-[24rem] special-input",clearable:"",placeholder:"请填写备注，可为空"},null,8,["modelValue"])])),_:1}),i(j,{options:z,listStyle:"disc",class:"pl-[6rem] pt-[1.2rem]"}),i(x,{title:"指定域名-功能介绍",area:60,modelValue:p(q),"onUpdate:modelValue":a[8]||(a[8]=e=>f(q)?q.value=e:null)},{default:r((()=>[i(S,{data:E,class:"p-4rem"})])),_:1},8,["modelValue"])])),_:1},8,["model"])}}}),[["__scopeId","data-v-880473fb"]]);export{N as default};
