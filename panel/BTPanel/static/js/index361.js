import{G as a,k as e,j as l,h as s}from"./utils-lib.js?v=1734676359";import{c as d,r as t,o as u,B as o,k as n,l as i,C as r,p as m,e as p,x as c,q as v,M as b,I as _,aX as f,J as V,y as h,a7 as q,ag as y,ah as g,a4 as j}from"./base-lib.js?v=1734676359";import{getSiteInfo as w,getMysqlInfo as x,modifyMysqlLink as k}from"./database.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const U={class:"p-[20px]"},C=d({__name:"index",setup(d,{expose:C}){const A=t(!1),B=t(!1),G=t([]),H=t([]),I=t({sql_id:"",pid:"",database:""}),J=[{prop:"name",label:"数据库"},{label:"站点名称",render:function(a){return p("div",null,[a.rname||"--"," ",p("span",{class:"cursor-pointer bt-link",onClick:()=>M(a)},[h("切换")])])}}],M=async a=>{var e;try{const l=await w();G.value=l.data,I.value.database=a.name,I.value.sql_id=a.id,I.value.pid=a.pid?a.pid:null==(e=G.value[0])?void 0:e.id,A.value=!0}catch(l){}},X=async()=>{await a({request:x(),loading:B,data:[Array,H]})},z=async()=>{const e={pid:I.value.pid,sql_id:I.value.sql_id};await a({request:k(e),loading:"正在切换中...",message:!0,success:()=>{A.value=!1,X()}})};return u(X),C({init:X}),(a,d)=>{const t=e,u=l,h=q,w=y,x=g,k=j,C=s,M=o("bt-loading");return n(),i("div",null,[r(p(t,{"max-height":"560",column:J,data:m(H)},null,8,["data"]),[[M,m(B)]]),p(C,{title:"切换网站",modelValue:m(A),"onUpdate:modelValue":d[3]||(d[3]=a=>b(A)?A.value=a:null),area:42,"show-footer":"",onConfirm:z},{default:c((()=>[v("div",U,[p(k,{modelValue:m(I),"onUpdate:modelValue":d[2]||(d[2]=a=>b(I)?I.value=a:null)},{default:c((()=>[p(h,{label:"数据库"},{default:c((()=>[p(u,{disabled:"",modelValue:m(I).database,"onUpdate:modelValue":d[0]||(d[0]=a=>m(I).database=a),width:"24rem"},null,8,["modelValue"])])),_:1}),p(h,{label:"站点名称"},{default:c((()=>[p(x,{modelValue:m(I).pid,"onUpdate:modelValue":d[1]||(d[1]=a=>m(I).pid=a),class:"!w-[24rem]"},{default:c((()=>[(n(!0),i(_,null,f(m(G),((a,e)=>(n(),V(w,{key:e,label:a.rname,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"])])}}});export{C as default};
