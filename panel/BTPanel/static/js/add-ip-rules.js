import{c as e,r as a,o as l,k as s,J as t,x as d,e as o,p as r,z as i,q as m,l as u,a7 as p,ag as c,ah as n,a4 as f}from"./base-lib.js?v=1734676359";import{G as b,j as _}from"./utils-lib.js?v=1734676359";import{getFirewallStore as y}from"./useStore4.js?v=1734676359";import{g,a as h}from"./useMethod4.js?v=1734676359";import{u as v,v as D}from"./firewall.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const V={class:"pl-[4.4rem] pt-[2.4rem] leading-8 text-[1.2rem] list-disc"},I={key:0},w=e({__name:"add-ip-rules",props:{compData:{default:()=>{}}},setup(e,{expose:w}){const P=e,{refs:{firewallInfo:j}}=y(),U=a({types:"accept",brief:"",address:"",id:"",chain:"INPUT",family:"ipv4",zone:"public"}),x=a(),z={address:[{trigger:["blur","change"],required:!0,message:"请输入指定IP"}]},N=e=>{"INPUT"===e&&(U.value.zone="public")};return l((()=>{P.compData.isEdit&&Object.assign(U.value,{types:P.compData.Strategy,brief:P.compData.brief,chain:P.compData.Chain,address:P.compData.Address,domain:P.compData.domain,id:P.compData.id||"",zone:P.compData.Zone||"public"})})),w({onConfirm:async e=>{await x.value.validate();const a={...U.value,operation:"add",strategy:U.value.types};P.compData.isEdit||delete a.id,await b({loading:"正在设置IP规则，请稍后...",request:P.compData.isEdit?v({new_data:JSON.stringify(a),old_data:JSON.stringify(P.compData)}):D(a),message:!0,success:()=>{P.compData.refreshFn(),g(),h(),e()}})}}),(e,a)=>{const l=_,b=p,y=c,g=n,h=f;return s(),t(h,{ref_key:"editIpRulesRef",ref:x,rules:z,disabled:e.formDisabled,model:r(U),class:"p-[2rem] addfrom"},{default:d((()=>[o(b,{label:"IP",prop:"address"},{default:d((()=>[o(l,{type:"textarea",modelValue:r(U).address,"onUpdate:modelValue":a[0]||(a[0]=e=>r(U).address=e),width:"24rem",resize:"none",rows:4,placeholder:"请输入IP地址",disabled:!!P.compData.selectOptions,clearable:""},null,8,["modelValue","disabled"])])),_:1}),o(b,{label:"策略"},{default:d((()=>[o(g,{modelValue:r(U).types,"onUpdate:modelValue":a[1]||(a[1]=e=>r(U).types=e),class:"!w-[24rem]"},{default:d((()=>[o(y,{label:"放行",value:"accept"}),o(y,{label:"禁止",value:"drop"})])),_:1},8,["modelValue"])])),_:1}),o(b,{label:"方向"},{default:d((()=>[o(g,{modelValue:r(U).chain,"onUpdate:modelValue":a[2]||(a[2]=e=>r(U).chain=e),class:"!w-[24rem]",onChange:N},{default:d((()=>[o(y,{label:"入站(默认)",value:"INPUT"}),o(y,{label:"出站",value:"OUTPUT"})])),_:1},8,["modelValue"])])),_:1}),"firewalld"===r(j).type&&"INPUT"===r(U).chain?(s(),t(b,{key:0,label:"区域"},{default:d((()=>[o(g,{modelValue:r(U).zone,"onUpdate:modelValue":a[3]||(a[3]=e=>r(U).zone=e),class:"!w-[24rem]"},{default:d((()=>[o(y,{label:"public(默认)",value:"public"}),o(y,{label:"trusted",value:"trusted"})])),_:1},8,["modelValue"])])),_:1})):i("",!0),o(b,{label:"备注"},{default:d((()=>[o(l,{modelValue:r(U).brief,"onUpdate:modelValue":a[4]||(a[4]=e=>r(U).brief=e),width:"24rem",placeholder:"可为空",clearable:""},null,8,["modelValue"])])),_:1}),m("ul",V,[a[5]||(a[5]=m("li",null,'支持添加IP：如果添加多个IP请用","隔开',-1)),a[6]||(a[6]=m("li",null,"支持添加IP段,如：192.168.0.0/24",-1)),a[7]||(a[7]=m("li",null,"支持添加IP范围,格式如：192.168.1.xx-192.168.1.xx，暂不支持跨网段范围",-1)),"firewalld"===r(j).type?(s(),u("li",I,"区域：非专业人士请勿修改，建议使用public")):i("",!0)])])),_:1},8,["disabled","model"])}}});export{w as default};
