import{c as e,r as a,h as s,w as t,a1 as l,k as r,l as n,q as u,e as i,x as c,p as m,J as o,v,z as p,C as d,y as f,D as x,b7 as w,A as b,aj as h,aw as y}from"./base-lib.js?v=1734676359";import{j as I,b as g,e as _}from"./utils-lib.js?v=1734676359";const k={class:"mr-[10px]"},C={class:"flex items-center"},F={class:"flex items-center"},V={class:"text-primary"},j={class:"flex flex-col text-[#666] p-12px"},N={class:"flex items-center"},U={class:"flex items-center mt-[8px] w-full"},q=_(e({__name:"index",props:{refreshFn:{type:Function,default:()=>({})},sessionConfig:{default:()=>{}}},emits:["save"],setup(e,{expose:_,emit:q}){const z=e,A=g(),D=q,H=a(!1),J=a(),S=a(!0),B=a(0),E=a(100),G=a(5),K=a(5),L=s({status:!1,time:5,timer:0});let M=!1;const O=async e=>{L.status=e,L.time=K.value,(!L.time||L.time<1)&&(L.time=5,K.value=5),e?(L.timer=setInterval((()=>{M||z.refreshFn()}),1e3*K.value),B.value=setInterval((()=>{M||(G.value--,0===G.value&&(G.value=K.value),E.value=G.value/K.value*100)}),1e3)):(clearInterval(L.timer),clearInterval(B.value),G.value=K.value,E.value=100,S.value||A.success("关闭成功")),D("save",L)},P=async()=>{L.time<1||!Number.isInteger(parseFloat(L.time.toString()))||L.time>99?A.error("时间间隔须在范围1~99秒内的整数"):(G.value=L.time,K.value=L.time,A.success("保存成功"),clearInterval(L.timer),clearInterval(B.value),O(!0),D("save",L))},Q=async()=>{await z.refreshFn(),A.success("刷新成功")},R=()=>{H.value=!1,L.time=K.value};t((()=>z.sessionConfig),(e=>{J.value=e,(null==e?void 0:e.time)&&S.value&&(K.value=e.time,G.value=e.time,O(e.status),S.value=!1)}),{deep:!0});const T=()=>{clearInterval(L.timer),clearInterval(B.value)};return l((()=>{M=!0,T()})),_({clearIntervalFn:T}),(e,a)=>{const s=w,t=b,l=h,g=I,_=y;return r(),n("div",k,[u("div",C,[i(t,{class:"h-[3.2rem] refresh-btn",onClick:Q},{default:c((()=>[u("div",F,[m(L).status?(r(),o(s,{key:0,class:"mr-8px",width:22,"show-text":!0,"stroke-width":1,type:"circle",color:"#20a53a","text-color":"#20a53a",percentage:m(E)},{default:c((()=>[u("span",V,v(Number(m(G))),1)])),_:1},8,["percentage"])):p("",!0),a[3]||(a[3]=u("span",null,"刷新日志",-1))])])),_:1}),i(_,{placement:"bottom-start",width:"280",trigger:"click","popper-class":"el-tooltip-white",onHide:R},{reference:c((()=>[i(t,{class:"down-button !ml-0",onClick:a[2]||(a[2]=e=>H.value=!m(H))},{default:c((()=>a[7]||(a[7]=[u("i",{class:"svgtofont-el-arrow-down"},null,-1)]))),_:1})])),default:c((()=>[u("div",j,[u("div",N,[a[4]||(a[4]=u("span",{class:"mr-4px"},"定时刷新",-1)),i(l,{modelValue:m(L).status,"onUpdate:modelValue":a[0]||(a[0]=e=>m(L).status=e),onChange:O},null,8,["modelValue"])]),d(u("div",U,[a[6]||(a[6]=u("span",{class:"mr-4px flex-nowrap"},"时间间隔",-1)),i(g,{modelValue:m(L).time,"onUpdate:modelValue":a[1]||(a[1]=e=>m(L).time=e),"text-type":"秒",min:1,type:"number",class:"!w-[10rem]"},null,8,["modelValue"]),i(t,{class:"!ml-4px",type:"primary",onClick:P},{default:c((()=>a[5]||(a[5]=[f("保存")]))),_:1})],512),[[x,m(L).status]])])])),_:1})])])}}}),[["__scopeId","data-v-6bb700d0"]]);export{q as _};
