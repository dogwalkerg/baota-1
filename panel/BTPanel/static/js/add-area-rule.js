import{c as a,r as e,o as l,B as t,k as o,J as s,x as r,e as u,p as i,l as d,aX as p,I as m,z as n,C as c,y as f,q as y,ag as b,ah as _,a7 as g,Q as v,a4 as V}from"./base-lib.js?v=1734676359";import{Q as h,G as j,j as D}from"./utils-lib.js?v=1734676359";import{aJ as k,aK as w,aL as x}from"./firewall.js?v=1734676359";import{a as C,g as I}from"./useMethod4.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./useStore4.js?v=1734676359";import"./validator.js?v=1734676359";const U={class:"mt-20px leading-8 text-[1.2rem] list-disc ml-24px"},q={key:0},E=a({__name:"add-area-rule",props:{compData:{default:()=>{}}},setup(a,{expose:E}){const H=a,P=e(),J=e(!1),A=e([]),O=e({country:["美国"],brief:"",types:"drop",ports:"",choose:"all",is_update:!1}),Q=[{title:"所有端口",key:"all"},{title:"指定端口",key:"point"}],R={country:[{required:!0,message:"请选择国家或地区",trigger:"change"}],ports:[{validator:(a,e,l)=>{e.length>0&&(h(e)||l(new Error("端口格式错误，可用范围：1-65535")),l()),l(new Error("请输入源端口"))},trigger:["input"]}]};return l((()=>{if((async()=>{await j({loading:J,request:x(),data:[Array,A]})})(),H.compData.isEdit){const a=H.compData;Object.assign(O.value,{country:a.country,brief:a.brief,types:a.types,ports:a.ports,choose:a.ports?"point":"all"})}})),E({onConfirm:async a=>{await P.value.validate();let e={...O.value};const l=H.compData.isEdit;l&&(e.id=H.compData.id,e.addtime=H.compData.addtime,e.country=O.value.country,e.brief=A.value.find((a=>a.CH===O.value.country)).brief),"all"===O.value.choose&&(e.ports=""),e={data:JSON.stringify(e)},await j({loading:"正在设置规则，请稍后...",request:l?k(e):w(e),message:!0}),a(),H.compData.refreshFn(),C(),I()}}),(a,e)=>{const l=b,h=_,j=g,k=D,w=v,x=V,C=t("bt-loading");return o(),s(x,{ref_key:"editAreaRulesRef",ref:P,model:i(O),rules:R,class:"p-[2rem] addfrom"},{default:r((()=>[u(j,{label:"策略"},{default:r((()=>[u(h,{modelValue:i(O).types,"onUpdate:modelValue":e[0]||(e[0]=a=>i(O).types=a),class:"!w-[24rem]"},{default:r((()=>[u(l,{label:"屏蔽",value:"drop"})])),_:1},8,["modelValue"])])),_:1}),u(j,{label:"端口"},{default:r((()=>[u(h,{modelValue:i(O).choose,"onUpdate:modelValue":e[1]||(e[1]=a=>i(O).choose=a),class:"!w-[24rem]"},{default:r((()=>[(o(),d(m,null,p(Q,(a=>u(l,{key:a.key,label:a.title,value:a.key},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),"point"===i(O).choose?(o(),s(j,{key:0,label:"指定端口",prop:"ports"},{default:r((()=>[u(k,{modelValue:i(O).ports,"onUpdate:modelValue":e[2]||(e[2]=a=>i(O).ports=a),type:"number",min:"1",max:"65535",width:"24rem",placeholder:"请输入指定端口"},null,8,["modelValue"])])),_:1})):n("",!0),u(j,{label:"地区",prop:"country"},{default:r((()=>[c((o(),s(h,{modelValue:i(O).country,"onUpdate:modelValue":e[3]||(e[3]=a=>i(O).country=a),class:"!w-[24rem]",multiple:!a.compData.id,filterable:!a.compData.id,"collapse-tags":!a.compData.id},{default:r((()=>[(o(!0),d(m,null,p(i(A),(a=>(o(),s(l,{key:a.brief,label:a.CH,value:a.CH},null,8,["label","value"])))),128))])),_:1},8,["modelValue","multiple","filterable","collapse-tags"])),[[C,i(J)]])])),_:1}),a.compData.id?n("",!0):(o(),s(j,{key:1,label:" "},{default:r((()=>[u(w,{modelValue:i(O).is_update,"onUpdate:modelValue":e[4]||(e[4]=a=>i(O).is_update=a)},{default:r((()=>e[5]||(e[5]=[f("更新IP池")]))),_:1},8,["modelValue"])])),_:1})),y("ul",U,[e[6]||(e[6]=y("li",null,"地区规则中IP数量较多，添加时可能耗时较长",-1)),a.compData.id?n("",!0):(o(),d("li",q,"勾选【更新IP池】会从云端获取指定地区近1个月最新的IP池")),e[7]||(e[7]=y("li",null,"添加【除中国之外】或多个地区时，可能会导致系统防火墙占用高，添加完成后会恢复",-1))])])),_:1},8,["model"])}}});export{E as default};
