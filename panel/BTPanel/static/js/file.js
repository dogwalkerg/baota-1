import{u as a,bX as t,R as e,l as s,o as l,M as o,aa as n,O as r}from"./utils-lib.js?v=1734676359";import{c as u,i,o as c,B as p,k as m,l as d,p as v,J as y,M as f,z as h,q as w,C as b,e as g,x as C,y as j,A as x,aY as k}from"./base-lib.js?v=1734676359";import{aE as V}from"./validator.js?v=1734676359";import{S as _,d as F,c as E,t as S,a as q,b as B,e as H,h as U,g as D,f as M,j as N}from"./useController10.js?v=1734676359";import{B as O}from"./index185.js?v=1734676359";import{u as z,S as A}from"./useStore7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./site.js?v=1734676359";import"./ace.js?v=1734676359";const I={class:"h-full"},J={class:"w-full"},R={class:"my-[12px]"},T=u({__name:"file",setup(u){const{viewFileHistoryEvent:T,recoverFileEvent:X}=_(),{siteInfo:Y}=z(),{plugin:G}=a(),{saveFileEvent:K}=A(),L=()=>{const{BtTable:a}=t({request:()=>({data:U.value,total:U.value.length}),columns:[{label:"文件名",render:a=>e(Number(a))},{label:"操作",align:"right",render:a=>{let t=Number(a);return g("div",null,[g("span",{class:"cursor-pointer bt-link",onClick:()=>{Q(a)}},[j("查看")]),g(k,{direction:"vertical"},null),g("span",{class:"cursor-pointer bt-link",onClick:()=>{P(t)}},[j("恢复")])])}}]});s({title:"配置文件历史版本",area:42,showFooter:!0,component:()=>g("div",{class:"p-[20px]"},[g(a,null,null)])})},P=async a=>{try{await l({title:"恢复历史文件",content:"是否恢复历史文件 ".concat(e(a))});const t=await X({row:a,path:W.value});return o.request({status:t.status,msg:t.status?"恢复成功":"恢复失败"}),t.status&&D({path:W.value}),t.status}catch(t){}},Q=async a=>{await(async a=>{try{const t=await T({row:a,path:W.value});return M.value=t.status?t.data:"文件不存在",t}catch(t){return{status:!1,msg:"获取文件历史失败"}}})(a),s({title:"查看文件历史版本",area:64,showFooter:!1,component:()=>g("div",{class:"p-[20px]"},[g(x,{type:"primary",onClick:()=>P(a)},{default:()=>[j("恢复文件")]}),g(O,{class:"!h-[54rem] !w-full my-[12px]",modelValue:M.value,"onUpdate:modelValue":a=>M.value=a,editorOption:V({readonly:!0})},null)])})},W=i((()=>{const a="/www/server/panel/vhost/".concat(G.value.webserver,"/").concat(Y.value.name,".conf");return"config"===F.value?a.replace(/\/+/g,"/"):E.value})),Z=async(a={data:H.value,encoding:"utf-8",path:W.value})=>{try{(await K(a)).status&&D({path:a.path})}catch(t){return{status:!1,msg:"保存文件失败"}}};return c((async()=>{N(),await D({path:W.value})})),(a,t)=>{const e=n,s=r,l=p("bt-loading");return m(),d("div",I,[v(E)?(m(),y(e,{key:0,type:"card",modelValue:v(F),"onUpdate:modelValue":t[0]||(t[0]=a=>f(F)?F.value=a:null),options:v(S),onChange:v(q)},null,8,["modelValue","options","onChange"])):h("",!0),w("div",J,[t[6]||(t[6]=w("span",{class:"my-[4px] text-[#666]"},"提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换",-1)),w("div",R,[b(g(v(O),{class:"!h-[54rem] border border-[#DCDFE6] rounded-[4px]",modelValue:v(H),"onUpdate:modelValue":t[1]||(t[1]=a=>f(H)?H.value=a:null),request:!1,onSave:t[2]||(t[2]=a=>Z()),id:"configContent"},null,8,["modelValue"]),[[l,v(B)]])]),w("div",null,[g(v(x),{type:"primary",onClick:t[3]||(t[3]=a=>Z())},{default:C((()=>t[4]||(t[4]=[j("保存")]))),_:1}),g(v(x),{onClick:L,type:"default"},{default:C((()=>t[5]||(t[5]=[j("历史文件")]))),_:1})]),g(s,{options:[{content:"此处为站点主配置文件，若您不了解配置规则，请勿随意修改."}],"list-style":"none",class:"ml-[20px] mt-[20px]"})])])}}});export{T as default};
