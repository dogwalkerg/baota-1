import{c as e,r as a,R as l,i as s,o as d,k as r,l as o,e as t,x as i,p as u,J as p,z as m,I as n,aX as _,y as c,N as v,a7 as b,ag as f,ah as h,a4 as g}from"./base-lib.js?v=1734676359";import{v as w,G as V,M as j,j as x,c as y,e as k}from"./utils-lib.js?v=1734676359";import{_ as U}from"./index88.js?v=1734676359";import{addModulesDatabase as q}from"./database.js?v=1734676359";import{g as C,b as I,p as A}from"./useMethod3.js?v=1734676359";import{_ as M}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const D={class:"p-[24px]"},R=k(e({__name:"index",props:{compData:{default:()=>({options:[]})}},setup(e,{expose:k}){const{refs:{tabActive:R},refreshTableList:S}=C(),z=e,E=a(),F=l(!1),G=a([]),H=a({name:"",db_user:"",password:w(16),ps:"",sid:0,listen_ip:"0.0.0.0/0",host:""}),J={name:[{required:!0,message:"请输入数据库名",trigger:["blur","change"]}],db_user:[{required:!0,message:"请输入用户名",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]}]},L=s((()=>{var e;return(null==(e=G.value.find((e=>e.id===H.value.sid)))?void 0:e.db_host)||""})),N=e=>{H.value.db_user=H.value.name,H.value.ps=H.value.name},T=async()=>{try{F.value=!0;const{status:e,msg:a,err_msg:l}=await A(H.value.sid);if(!e)throw j.error(l||a),new Error(l||a);F.value=!1}catch(e){}};return d((async()=>{var e,a;G.value=await(null==(e=z.compData)?void 0:e.refresh()),H.value.sid=null==(a=G.value[0])?void 0:a.id})),k({onConfirm:async e=>{await E.value.validate(),F.value=!0,await T();let a={...H.value,sid:String(H.value.sid)};a.listen_ip="ip"===a.listen_ip?a.host:a.listen_ip,await V({loading:"正在添加数据库,请稍后...",request:q(a,R.value),message:!0}),S(),e()}}),(e,a)=>{const l=x,s=b,d=U,V=f,j=h,k=y,q=g;return r(),o("div",D,[t(q,{disabled:u(F),model:u(H),ref_key:"addFormRef",ref:E,rules:J,onSubmit:a[7]||(a[7]=v((()=>{}),["prevent"]))},{default:i((()=>[t(s,{label:"数据库名",prop:"name"},{default:i((()=>[t(l,{width:"38rem",ref:"data_name",placeholder:"新的数据库名称",modelValue:u(H).name,"onUpdate:modelValue":a[0]||(a[0]=e=>u(H).name=e),onInput:N},null,8,["modelValue"])])),_:1}),t(s,{label:"用户名",prop:"db_user"},{default:i((()=>[t(l,{width:"38rem",placeholder:"数据库用户",modelValue:u(H).db_user,"onUpdate:modelValue":a[1]||(a[1]=e=>u(H).db_user=e)},null,8,["modelValue"])])),_:1}),t(s,{label:"密码",prop:"password"},{default:i((()=>[t(d,{width:"38rem",icon:"el-refresh",modelValue:u(H).password,"onUpdate:modelValue":a[2]||(a[2]=e=>u(H).password=e),modelModifiers:{sync:!0},onIconClick:a[3]||(a[3]=()=>u(H).password=u(w)(16)),isActive:!0},null,8,["modelValue"])])),_:1}),t(s,{label:"访问权限",prop:"dataAccess"},{default:i((()=>[t(j,{class:"!w-[38rem]",modelValue:u(H).listen_ip,"onUpdate:modelValue":a[4]||(a[4]=e=>u(H).listen_ip=e)},{default:i((()=>[t(V,{label:"所有人",value:"0.0.0.0/0"}),t(V,{label:"本地服务器",value:"127.0.0.1/32"}),t(V,{label:"指定ip",value:"ip"})])),_:1},8,["modelValue"]),t(s,{prop:"host"},{default:i((()=>["ip"===u(H).listen_ip?(r(),p(l,{key:0,placeholder:"填写格式如：192.168.69.11/24",modelValue:u(H).host,"onUpdate:modelValue":a[5]||(a[5]=e=>u(H).host=e),width:"38rem",class:"mt-8px w-full"},null,8,["modelValue"])):m("",!0)])),_:1})])),_:1}),t(s,{label:"添加至",prop:"sid",class:"!mb-0"},{default:i((()=>[t(j,{class:"!w-[24rem]",modelValue:u(H).sid,"onUpdate:modelValue":a[6]||(a[6]=e=>u(H).sid=e)},{default:i((()=>[(r(!0),o(n,null,_(u(G),((e,a)=>(r(),p(V,{key:a,label:e.ps+(e.db_host?"（"+e.db_host+"）":""),value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),t(k,{class:"ml-[8px]",onClick:u(I)},{default:i((()=>a[8]||(a[8]=[c(" 管理远程数据库 ")]))),_:1},8,["onClick"])])),_:1}),t(s,{label:" ",class:"!mb-0"},{default:i((()=>[t(M,{server:{sid:u(H).sid,ip:u(L)}},null,8,["server"])])),_:1})])),_:1},8,["disabled","model"])])}}}),[["__scopeId","data-v-64aa815e"]]);export{R as default};
