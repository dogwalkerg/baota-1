import{G as e,D as a,j as t,H as r,aR as o,X as l}from"./utils-lib.js?v=1734676359";import{g as s,R as n,r as p,s as i,n as u,c as m,ax as v,i as c,e as d,y as g,C as w,bv as h,aw as b,o as y,a1 as O,k as f,J as _,p as E,az as x,l as k}from"./base-lib.js?v=1734676359";import{h as C,d as P,i as S,b as j,F as q,a as D}from"./form-item.js?v=1734676359";import{f as T}from"./validator.js?v=1734676359";import{g as N,al as A,am as F}from"./useStore3.js?v=1734676359";import{D as I,s as R}from"./useController.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const J=s("DOCKERSITE-CREATE-SITE-BY-ENV-STORE",(()=>{const e=n([]),a=n([]),t=p(!1);return{envOptions:e,portOptions:a,popoverFocus:t,getEnvOptions:async(e,a)=>{const{getEnvList:t}=I(),r=await t({runtime_type:e,p:1,row:100});Array.isArray(null==r?void 0:r.data)&&(a.value=r.data.map((e=>{const a=e.ports?JSON.parse(e.ports):{},t=Object.values(a).map((e=>({label:e[0].HostPort,value:e[0].HostPort})));return{label:e.name,value:"".concat(e.name,":").concat(e.version),path:e.path,portList:t}})))},getPortOptions:async(a,t)=>{const r=e.value.find((e=>e.value===a));return r?(t.value=JSON.parse(JSON.stringify(r.portList)),JSON.parse(JSON.stringify(r.portList))):(t.value=[],[])},$reset:()=>{e.value=[],a.value=[],t.value=!1}}})),{getEnvOptions:L,getPortOptions:V}=J(),{envOptions:B,portOptions:H}=i(J()),$=()=>({domain:"",type:"php",port:"9000",env:"",remark:"",path:""}),z=async(e,a)=>{a.value.port="php"===e?"9000":"",await L(e,B),u((()=>{var t,r;B.value.length>0?(a.value.env=B.value[0].value,a.value.path="php"===e?"/www/dk_project/wwwroot/".concat((null==(r=null==(t=a.value.domain)?void 0:t.split("\n")[0])?void 0:r.split(":")[0])||""):B.value[0].path||""):(a.value.env="",a.value.path=""),V(a.value.env,H),u((()=>{H.value.length>0&&(a.value.port=H.value[0].value)}))}))},U=m({__name:"index",props:{compData:{default:!1}},setup(r,{expose:o}){const l=r,{getEnvOptions:s,getPortOptions:n,$reset:p}=J(),{envOptions:m,portOptions:k,popoverFocus:F}=i(J()),I=v("popupClose",(()=>{})),{BtForm:L,submit:U,param:Y}=a({data:$,options:e=>(s("php",m),c((()=>[C("域名",(()=>d(b,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:F.value,"onUpdate:visible":e=>F.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>d("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[g("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),d("br",null,null),g("IP地址格式：192.168.1.199"),d("br",null,null),g("泛解析添加方法 *.domain.com"),d("br",null,null),g("如另加端口格式为 www.domain.com:88")]),reference:()=>w(d(t,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{F.value=!0},onInput:()=>{var a;"php"===e.value.type&&(e.value.path="/www/dk_project/wwwroot/".concat((null==(a=e.value.domain.split("\n")[0])?void 0:a.split(":")[0])||""))},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[h,"popover"]])})),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),P([S("类型","type",[{label:"PHP",value:"php"},{label:"Java",value:"java"},{label:"Go",value:"go"},{label:"Python",value:"python"}],{attrs:{class:"!w-[17rem]",onChange:async a=>{z(a,e)}},rules:[{required:!0,message:"请选择容器",trigger:"change"}]}),..."php"===e.value.type?[j("PHP-FPM端口","port",{attrs:{class:"!w-[17rem]",placeholder:"请输入端口"},labelAttrs:{class:"ml-[2rem]"},rules:[{required:!0,message:"请输入端口",trigger:"blur"},{validator:(e,a,t)=>{/^\d+$/.test(a)?Number(a)<1||Number(a)>65535?t(new Error("请输入正确的端口号")):t():t(new Error("端口号必须为数字"))},trigger:"blur"}]})]:[S("端口","port",k.value,{attrs:{class:"!w-[22rem]",placeholder:"环境端口"},rules:[{required:!0,message:"请选择端口",filterable:!0}]})]]),P([S("环境","env",m.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择环境",onChange:a=>{(async(e,a)=>{V(e,H),u((()=>{var t,r,o;H.value.length>0&&(a.value.port=H.value[0].value),a.value.path="php"===a.value.type?"/www/dk_project/wwwroot/".concat((null==(r=null==(t=a.value.domain)?void 0:t.split("\n")[0])?void 0:r.split(":")[0])||""):(null==(o=B.value.find((a=>a.value===e)))?void 0:o.path)||""}))})(a,e)}},rules:[{required:!0,message:"请选择环境",trigger:"change",filterable:!0}]}),q((()=>x("span",{class:"cursor-pointer text-primary h-[3.2rem] leading-[3.2rem] ml-[1.5rem] inline-block",onClick:()=>{R((()=>{s(e.value.type,m)}))}},"创建环境")),{key:"jump",rules:{}})]),D("运行目录","path",{attrs:{class:"!w-[320px]",placeholder:"请选择运行目录"},rules:[{required:!0,message:"请选择运行目录",trigger:"change"}],icon:"icon-file_mode",iconClick:()=>{var a;T({type:"dir",path:(a=e).value.path||"/www/dk_project/wwwroot",change:(e,t)=>{a.value.path=e}})}}),j("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})]))),submit:async(a,t,r)=>(await t(),await(async(a,t)=>{const{refreshSiteTable:r}=N(),o={domains:a.domain,type:a.type,name:a.env,..."php"===a.type?{port:Number(a.port)}:{},site_path:a.path,remark:a.remark,port:Number(a.port)};await e({loading:"正在创建，请稍后...",request:A(o),message:!0,success:e=>{r(),t&&t(e)}})})(a.value,(e=>{e.status&&(p(),I())})))});return y((()=>{l.compData&&u((()=>{Y.value.type=l.compData.type,Y.value.env=l.compData.env,z(l.compData.type,Y)}))})),O((()=>{})),o({onConfirm:U}),(e,a)=>(f(),_(E(L)))}}),Y=s("DOCKERSITE-CREATE-SITE-BY-PROXY-STORE",(()=>{const e=n([]),a=n([]),t=p(!1);return{conOptions:e,portOptions:a,popoverFocus:t,getConOptions:async e=>{const{data:a}=await F({type:"container"});Array.isArray(null==a?void 0:a.data)&&(e.value=a.data.map((e=>{const a=e.ports.map((e=>({label:e,value:e})));return{label:e.name,value:e.id,portList:a}})))},getPortOptions:async(a,t)=>{const r=e.value.find((e=>e.value===a));t.value=r?JSON.parse(JSON.stringify(r.portList)):[]},$reset:()=>{e.value=[],t.value=!1}}})),K=()=>({domain:"",name:"",container_id:"",port:"",remark:""}),G=m({__name:"index",setup(r,{expose:o}){const l=Y(),{popoverFocus:s,conOptions:n,portOptions:p}=i(l),{getConOptions:m,$reset:O}=l,x=v("popupClose",(()=>{})),{BtForm:k,submit:P}=a({data:K,options:e=>c((()=>[C("域名",(()=>d(b,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:s.value,"onUpdate:visible":e=>s.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>d("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[g("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),d("br",null,null),g("IP地址格式：192.168.1.199"),d("br",null,null),g("泛解析添加方法 *.domain.com"),d("br",null,null),g("如另加端口格式为 www.domain.com:88")]),reference:()=>w(d(t,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{s.value=!0},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[h,"popover"]])})),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),S("容器","container_id",n.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择容器",onChange:a=>((e,a)=>{var t;const r=Y(),{conOptions:o,portOptions:l}=i(r),{getPortOptions:s}=r;a.value.port="",a.value.name=(null==(t=o.value.find((a=>a.value===e)))?void 0:t.label)||"",s(e,l),u((()=>{l.value.length>0&&(a.value.port=l.value[0].value)}))})(a,e)},rules:[{required:!0,message:"请选择容器",trigger:"change"}]}),S("端口","port",p.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择端口"},rules:[{required:!0,message:"请选择端口"}]}),j("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})])),submit:async(a,t,r)=>(await t(),(async(a,t)=>{const{refreshSiteTable:r}=N(),o={domains:a.domain,type:"proxy",name:a.name,container_id:a.container_id,port:Number(a.port),remark:a.remark};await e({loading:"正在创建，请稍后...",request:A(o),message:!0,success:e=>{r(),t&&t(e)}})})(a.value,(e=>{e.status&&(O(),x())})))});return y((()=>{m(n)})),o({onConfirm:P}),(e,a)=>(f(),_(E(k)))}}),M=s("DOCKERSITE-CREATE-SITE-BY-APP-STORE",(()=>{const e=n([]),a=n([]),t=p(!1);return{appOptions:e,portOptions:a,popoverFocus:t,getAppOptions:async e=>{const{data:a}=await F({type:"app"});Array.isArray(null==a?void 0:a.data)&&(e.value=a.data.map((e=>{const a=e.port.map((e=>({label:e,value:e})));return{label:"".concat(e.service_name,"(").concat(e.apptitle,")"),value:e.service_name,portList:a}})))},getPortOptions:async(a,t)=>{const r=e.value.find((e=>e.value===a));t.value=r?JSON.parse(JSON.stringify(r.portList)):[]},$reset:()=>{e.value=[],a.value=[],t.value=!1}}})),X=()=>({domain:"",app:"",remark:""}),Q=m({__name:"index",setup(l,{expose:s}){const{refs:{deployMenuData:n}}=N(),p=M(),{popoverFocus:m,appOptions:O,portOptions:k}=i(p),{getAppOptions:D,$reset:T}=p,F=v("popupClose",(()=>{})),{BtForm:I,submit:R}=a({data:X,options:e=>c((()=>[C("域名",(()=>d(b,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:m.value,"onUpdate:visible":e=>m.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>d("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[g("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),d("br",null,null),g("IP地址格式：192.168.1.199"),d("br",null,null),g("泛解析添加方法 *.domain.com"),d("br",null,null),g("如另加端口格式为 www.domain.com:88")]),reference:()=>w(d(t,{modelValue:e.value.domain,"onUpdate:modelValue":a=>e.value.domain=a,type:"textarea",width:"52rem",rows:7,resize:"none",onFocus:()=>{m.value=!0},placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null),[[h,"popover"]])})),"domain",{rules:[{required:!0,message:"请输入域名",trigger:"blur"}]}),P([S("应用","app",O.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择应用",onChange:a=>((e,a)=>{var t;const r=M(),{appOptions:o,portOptions:l}=i(r),{getPortOptions:s}=r;a.value.port="",a.value.app=(null==(t=o.value.find((a=>a.value===e)))?void 0:t.value)||"",s(e,l),u((()=>{l.value.length>0&&(a.value.port=l.value[0].value)}))})(a,e)},rules:[{required:!0,message:"请选择应用",trigger:"change"}]}),q((()=>x("span",{class:"cursor-pointer text-primary h-[3.2rem] leading-[3.2rem] ml-[1.5rem] inline-block",onClick:async()=>{const{router:e}=await r((()=>import("./utils-lib.js?v=1734676359").then((e=>e.dH))),__vite__mapDeps([]),import.meta.url);o(),n.value.app_type="all",e.push({name:"appstore"})}},"安装新应用")),{key:"jump",rules:{}})]),S("端口","port",k.value,{attrs:{class:"!w-[22rem]",placeholder:"请选择端口"},rules:[{required:!0,message:"请选择端口"}]}),j("备注","remark",{attrs:{class:"!w-[320px]",placeholder:"请输入备注"},rules:[{required:!1,message:"请输入备注",trigger:"blur"}]})])),submit:async(a,t,r)=>{await t(),(async(a,t)=>{const{refreshSiteTable:r}=N(),o={domains:a.domain,type:"app",name:a.app,port:Number(a.port),remark:a.remark};await e({loading:"正在创建，请稍后...",request:A(o),message:!0,success:e=>{r(),t&&t(e)}})})(a.value,(e=>{e.status&&(T(),F())}))}});return y((()=>{D(O)})),s({onConfirm:R}),(e,a)=>(f(),_(E(I)))}}),W={class:"p-[20px]"},Z=m({__name:"index",props:{compData:{default:{}}},setup(e,{expose:a}){const t=e,r=p(t.compData.type||"runEnv"),{BtTabs:o,tabsRefs:s}=l({type:"card",value:r,options:[{label:"运行环境",name:"runEnv",render:()=>d(U,{compData:"runEnv"===t.compData.type&&t.compData.formData},null)},{label:"反代容器",name:"proxyContainer",lazy:!0,render:()=>d(G,null,null)},{label:"从应用创建",name:"addPack",lazy:!0,render:()=>d(Q,null,null)}]});return a({onConfirm:async e=>{s()[r.value].onConfirm(e)}}),(e,a)=>(f(),k("div",W,[d(E(o))]))}});export{Z as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
