import{u as e,l as a,H as s,M as t,G as l,S as i,c as r,aa as n,F as o,k as d,V as m,o as c}from"./utils-lib.js?v=1734676359";import{_ as u}from"./index90.js?v=1734676359";import{_ as p}from"./index97.js?v=1734676359";import{c as _,r as f,i as y,h as v,e as x,w as b,o as g,B as h,k as w,l as k,p as L,J as j,x as C,z as V,q as N,y as S,M as O,I as A,aX as D,F as R,G as q,v as E,C as I,A as J,ah as T,ag as U,ay as F}from"./base-lib.js?v=1734676359";import{_ as H}from"./index116.js?v=1734676359";import{g as M,a as P,b as z,p as B}from"./useMethod3.js?v=1734676359";import{getRedisKey as G,getRedisKeyValue as K,delRedisValue as X,getModulesCloudServer as Q}from"./database.js?v=1734676359";import{a as W,u as Y,c as Z}from"./column.js?v=1734676359";import{B as $}from"./index117.js?v=1734676359";import{_ as ee}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1734676359";import{e as ae}from"./validator.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";const se={class:"flex items-center"},te={class:"flex items-center mx-4px inline-flex"},le={class:"flex items-center"},ie={class:"mr-[1.6rem] text-[1.2rem]"},re={class:"!float-right mb-8px !w-[24rem]"},ne=_({__name:"index",setup(_){const{mainHeight:ne}=e(),{refs:{isRefreshTable:oe,envStatus:de,isHaveServer:me,softData:ce},resetRefresh:ue,refreshTableList:pe}=M(),_e=f("0"),fe=f(),ye=f(!1),ve=f(0),xe=y((()=>!de.value.setup&&!me.value)),be=v({serverList:[],keyList:[],valueList:[]}),ge=f(0),he=v({search:"",sid:0,limit:10,db_idx:0,p:1}),we=f({db_status:!0,msg:"加载中"}),ke=y((()=>we.value.db_status?"check":"close")),Le=()=>{a({title:"数据库备份",area:78,compData:{sid:he.sid,keyList:be.keyList},component:()=>s((()=>import("./index119.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},je=()=>{a({title:"清理数据库",area:42,compData:{sid:he.sid,keyList:be.keyList},showFooter:!0,component:()=>s((()=>import("./index120.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},Ce=async e=>{const a=t.load("正在切换服务器,请稍后...");he.sid=Number(e),await De(),a.close()},Ve=(e,a)=>{he.db_idx=Number(e),Se()},Ne=async e=>{const a=await l({request:G({data:JSON.stringify({sid:e})}),data:Array});return be.keyList=a,a},Se=async()=>{const e=await l({request:K({data:JSON.stringify({...he})}),data:{data:Array,page:i(ge)}});be.valueList=e.data||[]},Oe=[W(),{label:"键",prop:"name"},{label:"值",prop:"val",width:320,render:e=>x("span",{class:"truncate !w-[30rem]",title:e.val},[e.val])},{label:"数据类型",prop:"type"},{label:"数据长度",prop:"len"},{label:"有效期",prop:"showtime"},Y([{onClick:e=>{a({title:"编辑redis数据库",area:44,compData:{refresh:()=>Ne(he.sid),row:{...e,db_idx:Number(_e.value)}},showFooter:!0,component:()=>s((()=>import("./index121.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},title:"编辑"},{onClick:async e=>{await c({icon:"warning-filled",title:"提示",content:"此操作将删除选中的数据【".concat(e.name,"】, 是否继续?")}),await l({request:X({data:JSON.stringify({sid:he.sid,db_idx:Number(_e.value),key:e.name})}),message:!0}),pe()},title:"删除"}])],Ae=[{label:"删除",value:"delete",event:async(e,a,s,t)=>{const{label:l,value:i}=t;await e({title:"批量".concat(l,"键"),content:"即将批量".concat(l,"键，是否继续操作！"),column:[{label:"键名",prop:"name"},Z()],onConfirm:async()=>(await a((e=>X({data:JSON.stringify({sid:he.sid,db_idx:Number(_e),key:e.name})}))),pe(),!1)})}}],De=async()=>{try{const e=await B(he.sid);if(we.value=e,!e.db_status)return be.valueList=[],be.keyList=[],me.value=!1,!1;(async()=>{const e=await l({request:Q({data:JSON.stringify({type:"redis"})},"redis"),data:Array});be.serverList=e,be.serverList.length&&(me.value=!0)})(),Ne(he.sid),Se()}catch(e){}};return b((()=>oe.value),(async e=>{e&&(await Ne(he.sid),await Se()),ue()})),g(De),(e,a)=>{const s=H,t=J,l=r,i=U,c=T,_=F,f=n,y=o,v=d,b=m,g=p,M=u,B=h("bt-loading");return w(),k("div",null,[L(xe)?(w(),j(s,{key:0},{content:C((()=>[x(ee,{type:"Redis"})])),_:1})):V("",!0),x(M,null,{"header-left":C((()=>[N("div",se,[x(t,{type:"primary",onClick:a[0]||(a[0]=e=>L(P)((()=>Ne(L(he).sid)),L(he).sid,L(_e)))},{default:C((()=>a[7]||(a[7]=[S("添加Key")]))),_:1}),x(t,{onClick:L(z)},{default:C((()=>a[8]||(a[8]=[S("远程数据库")]))),_:1},8,["onClick"]),x(t,{onClick:Le},{default:C((()=>a[9]||(a[9]=[S("备份列表")]))),_:1}),x(t,{onClick:je},{default:C((()=>a[10]||(a[10]=[S("清空数据库")]))),_:1}),x($,{"plugin-name":"redis",pluginInfo:L(ce),class:"ml-8px","is-request":!1},null,8,["pluginInfo"]),x(l,{onClick:a[1]||(a[1]=e=>L(ae)({name:"数据库",type:12,id:17})),class:"ml-[12px] <2xl:hidden"},{default:C((()=>a[11]||(a[11]=[S(" 需求反馈 ")]))),_:1})])])),"header-right":C((()=>[N("div",te,[a[12]||(a[12]=N("span",{class:"text-warning inline-block whitespace-nowrap flex items-center"},[N("i",{class:"svgtofont-el-info-filled mt-2px mr-4px"}),S("当前所有操作都关联至 ")],-1)),x(c,{modelValue:L(ve),"onUpdate:modelValue":a[2]||(a[2]=e=>O(ve)?ve.value=e:null),class:"!w-[16rem] mx-4px",onChange:Ce},{default:C((()=>[(w(!0),k(A,null,D(L(be).serverList,(e=>(w(),j(i,{key:e.ps,label:e.ps,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),N("div",le,[N("i",{class:R("text-[1.4rem] mt-4px mr-2px svgtofont-el-circle-".concat(L(ke),"-filled text-").concat("close"===L(ke)?"danger":"primary"))},null,2),N("div",ie,[a[13]||(a[13]=N("span",null,"状态：",-1)),N("span",{style:q("color:".concat(L(we).db_status?"#20a53a":"#ef0808"))},E(L(we).msg),5)])])])),content:C((()=>[x(f,{modelValue:L(_e),"onUpdate:modelValue":a[3]||(a[3]=e=>O(_e)?_e.value=e:null),type:"card",onChange:Ve,class:"tab-switch"},{default:C((()=>[(w(!0),k(A,null,D(L(be).keyList,((e,a)=>(w(),j(_,{class:"h-0 !p-0",key:a,label:e.name+"【"+e.keynum+"】",name:String(e.id),lazy:!0},null,8,["label","name"])))),128))])),_:1},8,["modelValue"]),N("div",re,[x(y,{modelValue:L(he).search,"onUpdate:modelValue":a[4]||(a[4]=e=>L(he).search=e),onSearch:Se,placeholder:"请输入键名称"},null,8,["modelValue"])]),I(x(v,{ref_key:"redisTableRef",ref:fe,"max-height":L(ne)-346,column:Oe,data:L(be).valueList},null,8,["max-height","data"]),[[B,L(ye)]])])),"footer-left":C((()=>[x(b,{"table-ref":L(fe),options:Ae},null,8,["table-ref"])])),"footer-right":C((()=>[x(g,{page:L(he).p,"onUpdate:page":a[5]||(a[5]=e=>L(he).p=e),row:L(he).limit,"onUpdate:row":a[6]||(a[6]=e=>L(he).limit=e),total:L(ge),onChange:Se},null,8,["page","row","total"])])),_:1})])}}});export{ne as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
