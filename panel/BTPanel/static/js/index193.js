import{M as e,a5 as l,j as s,a4 as t,c as a,O as i,t as n,R as o,e as r}from"./utils-lib.js?v=1734676359";import{g as c,s as m,h as u,r as d,c as p,i as f,a1 as v,k as h,l as x,p as y,e as g,x as w,q as T,y as _,z as b,C as z,bm as C,L,F as S,v as k,I as V,aX as D,D as M,J as j,ag as I,ah as O,A as U,Q as F,b0 as H,N as B,b5 as E}from"./base-lib.js?v=1734676359";import{_ as N}from"./index88.js?v=1734676359";import{_ as R}from"./index91.js?v=1734676359";import{_ as A}from"./index116.js?v=1734676359";import{f as J,p as P}from"./validator.js?v=1734676359";import{F as K,W as $}from"./store.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";import"./column.js?v=1734676359";import"./store2.js?v=1734676359";const q=c("FILES-CONTENT-SEARCH-STORE",(()=>{var s;const t=K(),{fileTabActiveData:a,authType:i}=m(t),n=u({load:!1,searchType:"routine",searchContentType:"file",regular:!1,case:!1,word:!1,searchContent:"",path:(null==(s=a.value)?void 0:s.param.path)||"",isDir:!0,suffix:"",time:"",customTime:[],size:"10",minSize:0,maxSize:10485760}),o=d(!0),r=d(""),c=u({fileList:[],activeIndex:0,type:"file"}),p=u({disabledDate:e=>{const l=new Date;l.setHours(23,59,59,999);const s=l.getTime();return e.getTime()>s},defaultTime:[new Date((new Date).setHours(0,0,0,0)),new Date((new Date).setHours(23,59,59,0))]}),f=u({show:!1,extList:[{title:"全部",value:"*"},{title:"无后缀文件",value:"no_ext"},{title:"PHP文件",value:"php"},{title:"Python文件",value:"py"},{title:"HTML文件",value:"html"},{title:"JS文件",value:"js"},{title:"JSON文件",value:"json"},{title:"Conf配置文件",value:"conf"},{title:"LOG日志",value:"log"}],selectList:[]});let v=null;const h=()=>{v=l({route:"routine"===n.searchType?"/ws_panel":"/ws_model",onMessage:x})},x=async(l,s)=>{if("token error"===s.data)return e.error("token error"),n.load=!1,void(null==v||v.close());const t=JSON.parse(s.data);t.name&&c.fileList.push(t),!0===t.result&&(null==v||v.close(),n.load=!1,e.success("搜索完成"))};return{authType:i,searchData:n,searchResult:c,suffix:f,timeList:[{label:"不限时间",value:""},{label:"最近3小时",value:"3"},{label:"最近1天",value:"1"},{label:"最近7天",value:"7"},{label:"最近30天",value:"30"},{label:"自定义",value:"custom"}],pickerOptions:p,sizeList:[{label:"不限大小",value:""},{label:"0 ~ 100KB",value:"100"},{label:"0 ~ 1MB",value:"1"},{label:"0 ~ 10MB",value:"10"},{label:"自定义",value:"custom"}],isfirst:o,searchCon:r,helpList:[{content:"常规搜索仅支持查询20MB以下文件内容"}],setSizeMode:e=>{switch(n.size=e,e){case"custom":default:n.minSize="",n.maxSize="";break;case"100":n.minSize=0,n.maxSize=102400;break;case"1":n.minSize=0,n.maxSize=1048576;break;case"10":n.minSize=0,n.maxSize=10485760}},editFind:e=>{$(e,(e=>{e&&e.execCommand("find"),e.find(n.searchContent)}))},search:()=>{if(n.load)return n.load=!1,null==v||v.close(),!1;if(""===n.searchContent)return void e.error("请输入搜索内容");if(""===n.path)return void e.error("请选择目录");const l={search_content:n.searchContent,exts:""===n.suffix?"*":n.suffix,path:n.path,is_subdir:n.isDir,is_regular:n.regular,is_case:n.case,is_word:n.word,ws_callback:"111",model_index:"files",mod_name:"routine"===n.searchType?"panelSearch":"search",def_name:"get_search"};if("file"===n.searchContentType?l.search_content=n.searchContent:l.search_name=n.searchContent,""!==n.size&&"expert"===n.searchType)if("custom"===n.size){if(""===n.minSize||""===n.maxSize||n.minSize>n.maxSize||n.minSize<0||n.maxSize<0)return void e.error("请输入正确文件大小");l.min_size=(1024*n.minSize*1024).toString(),l.max_size=(1024*n.maxSize*1024).toString()}else l.min_size=n.minSize.toString(),l.max_size=n.maxSize.toString();if(""!==n.time&&"expert"===n.searchType){if("custom"===n.time&&0===n.customTime.length)return void e.error("请选择时间");l.start_time=n.customTime[0]/1e3,l.end_time=n.customTime[1]/1e3}n.load=!0,c.fileList=[],c.type=n.searchContentType,c.activeIndex=0,o.value=!1,r.value=n.searchContent,h(),null==v||v.send(l)},openFile:()=>{J({type:"dir",path:n.path,change:e=>{n.path=e}})},selectExt:e=>{0===e?f.selectList.includes(0)?(f.selectList=[],n.suffix=""):(f.selectList=[0],n.suffix="*"):(f.selectList=f.selectList.filter((e=>0!==e)),f.selectList.includes(e)?f.selectList.splice(f.selectList.indexOf(e),1):f.selectList.push(e),n.suffix=f.selectList.map((e=>f.extList[e].value)).join(","))},setTimeMode:e=>{switch(n.time=e,e){case"custom":default:n.customTime=[];break;case"3":n.customTime=[(new Date).getTime()-108e5,(new Date).getTime()];break;case"1":n.customTime=[(new Date).getTime()-864e5,(new Date).getTime()];break;case"7":n.customTime=[(new Date).getTime()-6048e5,(new Date).getTime()];break;case"30":n.customTime=[(new Date).getTime()-2592e6,(new Date).getTime()]}},toggleSelectMode:e=>{o.value=!0,c.fileList=[],c.activeIndex=0,n.load=!1,null==v||v.close(),"type"===e&&"name"===n.searchContentType&&(n.searchType="expert")},$reset:()=>{var e;null==v||v.close(),o.value=!0,r.value="",Object.assign(c,{fileList:[],activeIndex:0,type:"file"}),Object.assign(n,{load:!1,searchType:"routine",searchContentType:"file",regular:!1,case:!1,word:!1,searchContent:"",path:(null==(e=a.value)?void 0:e.param.path)||"",isDir:!0,suffix:"",time:"",customTime:[],size:"10",minSize:0,maxSize:10485760})}}})),G={class:"flex flex-col p-[2rem] relative"},Q={key:0,class:"absolute top-0 right-0 w-[94rem] h-full"},W={class:"content-mask"},X={class:"menu"},Y={class:"flex items-center h-[3.5rem]"},Z={class:"flex items-center border border-[#DCDFE6] rounded-2px"},ee={class:"search-input"},le={class:"inputOption"},se={class:"flex items-center h-[3.5rem] mt-[1rem]"},te={class:"flex items-center relative mr-[2.5rem]"},ae={class:"flex items-center relative"},ie={key:0,class:"ext-list"},ne={class:"mt5"},oe=["onMousedown"],re={class:"flex items-center h-[3.5rem] mt-[1rem]"},ce={class:"flex items-center relative mr-[1.5rem]"},me={class:"flex items-center relative"},ue={class:"size flex items-center"},de={class:"content"},pe={key:0,class:"empty"},fe={class:"flex flex-col items-center"},ve={key:1,class:"flex w-full"},he={class:"result-list"},xe={class:"search-num"},ye={class:"list"},ge=["onClick"],we=["title"],Te={class:"log"},_e={class:"name flex justify-between"},be=["title"],ze={class:"con"},Ce=["innerHTML"],Le={key:2,class:"flex w-full"},Se={class:"log"},ke={class:"result"},Ve={class:"file-table"},De={class:"name"},Me={class:"msg"},je={class:"text-right w-[8rem]"},Ie=r(p({__name:"index",setup(e){const l=q(),{authType:r,searchData:c,searchResult:u,suffix:d,pickerOptions:p,isfirst:J,searchCon:K}=m(l),{helpList:Ie,timeList:Oe,sizeList:Ue,setSizeMode:Fe,editFind:He,search:Be,openFile:Ee,selectExt:Ne,setTimeMode:Re,toggleSelectMode:Ae,$reset:Je}=l,Pe=f((()=>u.value.fileList.reduce(((e,l)=>e+l.search_num),0)));return v((()=>{Je()})),(e,l)=>{const m=A,f=I,v=O,q=R,Je=U,Ke=N,$e=F,qe=s,Ge=t,Qe=H,We=E,Xe=a,Ye=i;return h(),x("div",G,["ltd"!==y(r)&&"expert"===y(c).searchType?(h(),x("div",Q,[g(m,{visible:"ltd"!==y(r)&&"expert"===y(c).searchType,width:"36rem"},{content:w((()=>[T("div",W,[l[21]||(l[21]=T("i",{class:"svgtofont-el-warning text-orange mr-[4px] !text-[2rem]"},null,-1)),l[22]||(l[22]=T("span",null,"此功能为企业版独享",-1)),l[23]||(l[23]=_("，")),T("span",{class:"bt-link",onClick:l[0]||(l[0]=e=>y(P)({sourceId:79}))},"立即升级")])])),_:1},8,["visible"])])):b("",!0),T("div",X,[T("div",Y,[g(v,{class:"file_select text-[1.4rem] !w-[9.2rem]",modelValue:y(c).searchType,"onUpdate:modelValue":l[1]||(l[1]=e=>y(c).searchType=e),onChange:l[2]||(l[2]=e=>y(Ae)("mode"))},{default:w((()=>[g(f,{label:"常规搜索",value:"routine"}),g(f,{label:"高级搜索",value:"expert"})])),_:1},8,["modelValue"]),T("div",Z,[T("div",null,[g(v,{class:"file_select !w-[8rem]",modelValue:y(c).searchContentType,"onUpdate:modelValue":l[3]||(l[3]=e=>y(c).searchContentType=e),onChange:l[4]||(l[4]=e=>y(Ae)("type"))},{default:w((()=>[g(f,{label:"文件",value:"file"}),g(f,{label:"文件名",value:"name"})])),_:1},8,["modelValue"])]),T("div",ee,[z(T("input",{type:"text",class:"w-[59rem] h-[3rem] border-none outline-none shadow-none",placeholder:"请输入搜索内容","onUpdate:modelValue":l[5]||(l[5]=e=>y(c).searchContent=e),onKeydown:l[6]||(l[6]=L(((...e)=>y(Be)&&y(Be)(...e)),["enter"]))},null,544),[[C,y(c).searchContent]]),g(q),T("div",le,[T("span",{class:S(y(c).case?"active":""),title:"区分大小写",onClick:l[7]||(l[7]=e=>y(c).case=!y(c).case)},"Aa",2),T("span",{class:S(y(c).word?"active":""),title:"全词匹配",onClick:l[8]||(l[8]=e=>y(c).word=!y(c).word)},"[ab]",2),T("span",{class:S(y(c).regular?"active":""),title:"正则表达式",onClick:l[9]||(l[9]=e=>y(c).regular=!y(c).regular)},".*",2)])])]),g(Je,{class:"!ml-[2rem] w-[8.5rem] h-[3rem] !rounded-[2px]",onClick:y(Be),type:y(c).load?"info":"primary"},{default:w((()=>[_(k(y(c).load?"取消搜索":"搜索"),1)])),_:1},8,["onClick","type"])]),T("div",se,[l[26]||(l[26]=T("span",{class:"title"},"目录",-1)),T("div",te,[g(Ke,{modelValue:y(c).path,"onUpdate:modelValue":l[10]||(l[10]=e=>y(c).path=e),width:"48rem",class:"file-input",icon:"icon-file_mode",onIconClick:y(Ee),placeholder:"请选择目录"},null,8,["modelValue","onIconClick"]),g($e,{class:"!absolute top-0 left-[33rem]",modelValue:y(c).isDir,"onUpdate:modelValue":l[11]||(l[11]=e=>y(c).isDir=e)},{default:w((()=>l[24]||(l[24]=[_("包含子目录")]))),_:1},8,["modelValue"])]),T("div",ae,[l[25]||(l[25]=T("span",{class:"title"},"文件后缀",-1)),g(qe,{modelValue:y(c).suffix,"onUpdate:modelValue":l[12]||(l[12]=e=>y(c).suffix=e),width:"32rem",spellcheck:"false",onFocus:l[13]||(l[13]=e=>y(d).show=!0),onBlur:l[14]||(l[14]=e=>y(d).show=!1),placeholder:"选择或填写后缀类型，使用逗号分隔"},null,8,["modelValue"]),y(d).show?(h(),x("div",ie,[T("div",ne,[T("ul",null,[(h(!0),x(V,null,D(y(d).extList,((e,l)=>(h(),x("li",{key:e.value,class:S(y(d).selectList.indexOf(l)>-1?"active":""),onMousedown:B((e=>y(Ne)(l)),["stop","prevent"])},k(e.title),43,oe)))),128))])])])):b("",!0)])]),z(T("div",re,[l[30]||(l[30]=T("span",{class:"title"},"修改时间",-1)),T("div",ce,[g(Ge,{modelValue:y(c).time,"onUpdate:modelValue":l[15]||(l[15]=e=>y(c).time=e),options:y(Oe),onChange:y(Re),class:S(["mr-[1rem]","custom"===y(c).time?"!w-[9rem]":"!w-[20rem]"]),"empty-values":[null,void 0]},null,8,["modelValue","options","onChange","class"]),"custom"===y(c).time?(h(),j(Qe,{key:0,class:"!w-[26rem]",align:"right",type:"daterange",modelValue:y(c).customTime,"onUpdate:modelValue":l[16]||(l[16]=e=>y(c).customTime=e),"range-separator":"","start-placeholder":"开始日期","end-placeholder":"结束日期",ref:"player","default-time":y(p).defaultTime,"value-format":"x","disabled-date":y(p).disabledDate},null,8,["modelValue","default-time","disabled-date"])):b("",!0)]),T("div",me,[l[29]||(l[29]=T("span",{class:"title"},"文件大小",-1)),g(Ge,{modelValue:y(c).size,"onUpdate:modelValue":l[17]||(l[17]=e=>y(c).size=e),onChange:y(Fe),options:y(Ue),class:S(["mr-[1rem]","custom"===y(c).size?"w-[9rem]":"!w-[20rem]"]),"empty-values":[null,void 0]},null,8,["modelValue","onChange","options","class"]),z(T("div",ue,[l[27]||(l[27]=T("div",{class:"title !w-[4rem]"},"大于",-1)),g(qe,{modelValue:y(c).minSize,"onUpdate:modelValue":l[18]||(l[18]=e=>y(c).minSize=e),modelModifiers:{number:!0},type:"number",class:"w-[10rem] num-input","text-type":"MB"},null,8,["modelValue"]),l[28]||(l[28]=T("div",{class:"title !w-[4rem]"},"小于",-1)),g(qe,{modelValue:y(c).maxSize,"onUpdate:modelValue":l[19]||(l[19]=e=>y(c).maxSize=e),modelModifiers:{number:!0},type:"number",class:"w-[10rem] num-input","text-type":"MB"},null,8,["modelValue"])],512),[[M,"custom"===y(c).size]])])],512),[[M,"expert"===y(c).searchType]])]),T("div",de,[0==y(u).fileList.length?(h(),x("div",pe,[z(T("div",null,"正在搜索中...",512),[[M,y(c).load]]),z(T("div",fe,l[31]||(l[31]=[T("div",null,"键入查找内容以在文件中查询",-1),T("div",{class:"text-[1.4rem]"},"细致的选项可以有效地缩短检索时间",-1)]),512),[[M,!y(c).load&&y(J)]]),z(T("div",null,"抱歉没有找到“"+k(y(K))+"”相关的结果",513),[[M,!y(c).load&&!y(J)]])])):b("",!0),y(u).fileList.length>0&&"file"===y(u).type?(h(),x("div",ve,[T("div",he,[T("div",xe,[z(T("div",null,l[32]||(l[32]=[_("文件搜索中"),T("span",{class:"svgtofont-el-loading"},null,-1)]),512),[[M,y(c).load]]),z(T("div",null,"搜索完成:",512),[[M,!y(c).load]]),T("div",null,"在"+k(y(u).fileList.length)+"个文件中有"+k(y(Pe))+"个匹配项",1)]),T("div",ye,[(h(!0),x(V,null,D(y(u).fileList,((e,l)=>(h(),x("div",{class:S(["file-item",y(u).activeIndex===l?"active":""]),key:l,onClick:e=>y(u).activeIndex=l},[T("span",{class:"ellipsis w-[16rem]",title:e.name},k(e.name),9,we),g(We,{type:"info"},{default:w((()=>[_(k(e.search_num),1)])),_:2},1024)],10,ge)))),128))])]),T("div",Te,[T("div",_e,[T("span",{class:"ellipsis w-[65rem]",title:y(u).fileList[y(u).activeIndex].path},k(y(u).fileList[y(u).activeIndex].path),9,be),g(Xe,{class:"ml-[1rem]",onClick:l[20]||(l[20]=e=>y(He)(y(u).fileList[y(u).activeIndex]))},{default:w((()=>l[33]||(l[33]=[_("编辑")]))),_:1})]),T("div",ze,[(h(!0),x(V,null,D(y(u).fileList[y(u).activeIndex].search_result,((e,l)=>(h(),x("span",{key:l,innerHTML:"行".concat(e.row_num,"：").concat(e.line)},null,8,Ce)))),128))])])])):b("",!0),y(u).fileList.length>0&&"name"===y(u).type?(h(),x("div",Le,[T("div",Se,[T("div",ke,[z(T("div",null,l[34]||(l[34]=[_("文件搜索中"),T("span",{class:"svgtofont-el-loading"},null,-1)]),512),[[M,y(c).load]]),z(T("div",null,k("搜索结果，共".concat(y(u).fileList.length,"个文件")),513),[[M,!y(c).load]])]),T("div",Ve,[(h(!0),x(V,null,D(y(u).fileList,((e,s)=>(h(),x("div",{class:"file",key:s},[T("div",De,k(e.path),1),T("div",Me,[T("span",je,k(y(n)(e.size)),1),T("span",null,k(y(o)(e.mtime)),1),g(Xe,{onClick:l=>y($)(e)},{default:w((()=>l[35]||(l[35]=[_("编辑")]))),_:2},1032,["onClick"])])])))),128))])])])):b("",!0)]),z(g(Ye,{options:y(Ie),class:"pl-2rem list-disc"},null,8,["options"]),[[M,"routine"===y(c).searchType]])])}}}),[["__scopeId","data-v-3efe9ce9"]]);export{Ie as default};
