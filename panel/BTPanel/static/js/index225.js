import{u as e,l as a,H as t,G as s,S as r,F as o,k as l,V as n,h as i,b as d,o as p,e as c}from"./utils-lib.js?v=1734676359";import{_ as u}from"./index90.js?v=1734676359";import{c as m,r as f,h as _,e as b,y as h,o as w,n as g,B as v,k as y,J as P,x as j,q as V,p as x,M as A,C as I,l as T,aX as k,I as C,A as S,af as E,ad as U,bM as q,v as L,bL as O}from"./base-lib.js?v=1734676359";import{_ as F}from"./index97.js?v=1734676359";import{l as H,m as N,n as D,o as R,p as J}from"./firewall.js?v=1734676359";import{a as M,u as B}from"./column.js?v=1734676359";import{r as G,p as X,u as $,d as z,c as K,e as Q}from"./useMethod4.js?v=1734676359";import{h as W}from"./validator.js?v=1734676359";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang11.js?v=1734676359";import{getFirewallStore as Z}from"./useStore4.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const ee={class:"p-2rem"},ae={class:"!w-[6rem] inline-block"},te={class:"max-w-[26rem]"},se=c(m({__name:"index",setup(c){const m=d(),{mainHeight:se}=e(),{refs:{systemTabActive:re}}=Z(),oe=f(),le=f(!1),ne=f([]),ie=_({p:1,row:20,chain:"ALL"}),de=f(""),pe=f(0),ce=f({}),ue=f(!1),me=_({processName:["进程名",""],processId:["进程pid",""],processTip:["启动命令",""]}),fe=async()=>{const e=await K("fail2ban");e.setup?a({title:"端口防扫描",area:60,compData:{type:"AntiScan",requestFn:()=>H()},component:()=>t((()=>import("./index371.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)}):(W({name:e.name,type:"i",pluginInfo:e}),m.warn("请先安装防暴破插件"))},_e=e=>{a({title:e?"修改端口规则":"添加端口规则",area:44,component:()=>t((()=>import("./add-port-rule.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{...ce.value,isEdit:e,refreshFn:be},showFooter:!0})},be=async()=>{"port"===re.value&&await s({loading:le,request:N({...ie,query:de.value}),data:{data:[Array,ne],page:r(pe)}})},he=(e,a)=>({operation:a,protocol:e.Protocol,address:e.Address,port:e.Port,strategy:e.Strategy,chain:e.Chain,brief:e.brief}),we=[{label:"删除",value:"delete",event:async(e,a)=>{await Q(e,a,(async(e,a)=>{const t={...he(e,"remove"),domain:e.domain};return await R(t,!1)}),{label:"端口",prop:"Port"},be)}}],ge=f([M(),{label:"协议",width:80,prop:"Protocol"},{label:"端口",width:120,renderHeader:()=>G("端口","防火墙会加载系统所有端口信息，IPV6端口无法与IPV4分开管理，非必要勿删除IPV6端口"),render:(e,a)=>(e.brief=e.brief||X[e.Port],b("span",{class:"mr-[1rem]"},[e.Port+("ipv6"===e.Family?"（ipv6）":"")]))},{label:"状态",width:100,renderHeader:()=>G("状态","link","https://www.bt.cn/bbs/thread-4708-1-1.html"),render:(e,a)=>{var t,r;return b("div",null,[b("span",null,[0===e.status?"未使用":1!==e.status||(null==(t=e.Port)?void 0:t.includes("-"))?"正常":"外网不通"]),b("span",{class:2!==e.status||(null==(r=e.Port)?void 0:r.includes("-"))||"udp"===e.Protocol?"!hidden":"bt-link",onClick:()=>(async e=>{ce.value=e,await s({loading:"正在获取数据,请稍后...",request:D({port:e.Port}),success:({data:e})=>{me.processName[1]=e.process_name,me.processId[1]=e.process_pid,me.processTip[1]=e.process_cmd}}),ue.value=!0})(e)},[h("（详情）")])])}},...$({changePolicy:async e=>{const a="accept"!==e.Strategy;await p({icon:"warning-filled",title:"修改端口规则策略【"+e.Port+"】",content:"修改端口策略为“".concat(a?"放行":"禁止","”，设置后该端口将").concat(a?"恢复正常访问":"禁止访问服务器","，是否继续操作？")});const t={old_data:JSON.stringify({...e}),new_data:JSON.stringify({...he({...e,Strategy:a?"accept":"drop"},"add")})};await s({loading:"正在修改端口规则策略...",request:J(t,!1),message:!0,success:be})}}),{label:"来源",render:(e,a)=>b("div",null,[e.sid>0?b("span",{title:e.domain},[e.domain]):"all"===e.Address?b("span",null,[h("所有IP")]):b("span",{title:e.Address},[e.Address])])},{label:"备注",showOverflowTooltip:!0,render:e=>b("span",null,[e.brief||X[e.Port]||""])},{label:"时间",prop:"addtime",width:160,renderHeader:()=>G("时间","-- : 表示面板数据库中未记录创建时间，规则从系统中直接读取，忽略即可")},z({editEvent:e=>{ce.value=e,_e(!0)},deleteEvent:async(e,a)=>{await p({icon:"warning-filled",title:"删除端口规则【"+e.Port+"】",content:"删除当前端口规则，是否继续操作？"});const t={...he(e,"remove"),domain:e.domain};await s({loading:"正在删除端口规则，请稍后...",request:R(t,!1),message:!0,success:be})}})]);return w((()=>{g((async()=>{try{const e=await window.$extension();if(!e)return be();if(e.extensionElement({custom:{useOperate:B,portsPs:X,setPortConfig:e=>{ge.value[2]=e,be()}}}).every((e=>!1===e)))return be()}catch(e){return be()}}))})),(e,a)=>{const t=S,s=E,r=U,d=o,p=l,c=n,m=F,f=O,_=q,w=i,g=u,H=v("bt-loading");return y(),P(g,null,{"header-left":j((()=>[b(t,{type:"primary",onClick:a[0]||(a[0]=e=>_e(!1))},{default:j((()=>a[9]||(a[9]=[h(" 添加端口规则 ")]))),_:1}),b(Y,{type:"port",refreshFn:be}),b(t,{onClick:fe},{default:j((()=>a[10]||(a[10]=[h("端口防扫描")]))),_:1})])),"header-right":j((()=>[a[14]||(a[14]=V("div",{id:"extension-rulesTable"},null,-1)),b(r,{class:"mr-[1rem]",modelValue:x(ie).chain,"onUpdate:modelValue":a[1]||(a[1]=e=>x(ie).chain=e),onChange:a[2]||(a[2]=e=>be())},{default:j((()=>[b(s,{label:"ALL"},{default:j((()=>a[11]||(a[11]=[h("所有方向")]))),_:1}),b(s,{label:"INPUT"},{default:j((()=>a[12]||(a[12]=[h("入站")]))),_:1}),b(s,{label:"OUTPUT"},{default:j((()=>a[13]||(a[13]=[h("出站")]))),_:1})])),_:1},8,["modelValue"]),b(d,{modelValue:x(de),"onUpdate:modelValue":a[3]||(a[3]=e=>A(de)?de.value=e:null),onSearch:a[4]||(a[4]=e=>be()),onClear:be,placeholder:"请输入端口/来源",class:"!w-24rem"},null,8,["modelValue"])])),content:j((()=>[I(b(p,{ref_key:"portTableRef",ref:oe,column:x(ge),data:x(ne),"max-height":x(se)-340,description:"端口列表为空"},null,8,["column","data","max-height"]),[[H,x(le)],[H,"正在加载端口列表，请稍后...","title"]])])),"footer-left":j((()=>[b(c,{"table-ref":x(oe),options:we},null,8,["table-ref"])])),"footer-right":j((()=>[b(m,{ref:"portRulesPager",total:x(pe),page:x(ie).p,"onUpdate:page":a[5]||(a[5]=e=>x(ie).p=e),row:x(ie).row,"onUpdate:row":a[6]||(a[6]=e=>x(ie).row=e),onChange:a[7]||(a[7]=e=>be()),name:"port"},null,8,["total","page","row"])])),popup:j((()=>[b(w,{title:x(ce).Port+"-端口使用进程详情",modelValue:x(ue),"onUpdate:modelValue":a[8]||(a[8]=e=>A(ue)?ue.value=e:null),area:42},{default:j((()=>[V("div",ee,[b(_,{class:"margin-top",border:"",column:1},{default:j((()=>[(y(!0),T(C,null,k(x(me),((e,a)=>(y(),P(f,{key:a},{label:j((()=>[V("span",ae,L(e[0]),1)])),default:j((()=>[V("span",te,L(e[1]),1)])),_:2},1024)))),128))])),_:1})])])),_:1},8,["title","modelValue"])])),_:1})}}}),[["__scopeId","data-v-84433d9d"]]);export{se as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
