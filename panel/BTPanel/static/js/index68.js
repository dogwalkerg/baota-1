import{G as e,l,H as t,d as a,b as s,e as r,bZ as i,c as n,O as o,u as c,x as u,a6 as d,a4 as m,F as p,k as v,h as f,aa as y}from"./utils-lib.js?v=1734676359";import{c as g,r as h,i as b,o as _,B as w,C as x,p as C,k,l as L,q as S,e as A,x as V,F as T,bm as P,v as N,D,I,aX as j,z as q,y as B,aT as O,A as E,J as U,a7 as M,ag as F,ah as H,P as R,aw as J,a4 as G,h as W,w as z,M as X,ae as Q,ad as Z,Q as K,at as Y,av as $,n as ee,R as le}from"./base-lib.js?v=1734676359";import{getBusSslProductList as te,applyCertOrderPay as ae,applyTrustAsiaCert as se,verifyTrustAsiaCret as re,getDomainList as ie,validateDomain as ne,authDomainApi as oe,setCertToSite as ce}from"./site.js?v=1734676359";import{u as ue}from"./useStore11.js?v=1734676359";import{C as de,l as me,s as pe,u as ve}from"./useController7.js?v=1734676359";import{u as fe}from"./useStore7.js?v=1734676359";import{_ as ye}from"./index90.js?v=1734676359";import{k as ge,s as he,l as be,m as _e}from"./ssl.js?v=1734676359";import{g as we}from"./useStore10.js?v=1734676359";import{d as xe,r as Ce}from"./useMethod6.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./useController3.js?v=1734676359";import"./validator.js?v=1734676359";import"./useStore9.js?v=1734676359";import"./useMethod5.js?v=1734676359";const ke={class:"ssl-container w-[90%] py-[2rem] mx-[auto] overflow-y-auto"},Le={class:"ssl-bus-pay-form"},Se={class:"ssl-line"},Ae={class:"ssl-content"},Ve={class:"ssl-box mb-[.4rem]"},Te={class:"ssl-number-select"},Pe={class:"ssl-service"},Ne={class:"flex items-center"},De={class:"ssl-line h-[20rem]"},Ie={class:"ssl-content"},je={class:"ssl-option-list w-full"},qe=["onClick"],Be={class:"ssl-type-title"},Oe={class:"ssl-type-tips"},Ee={key:0,class:"ssl-subscript-tips"},Ue={class:"ssl-tips-list mb-[.4rem]"},Me={class:"mt-[.4rem]"},Fe={class:"ssl-line"},He={class:"ssl-content"},Re={class:"ssl-option-list"},Je=["onClick"],Ge={class:"ssl-type-title !font-normal border-none"},We={key:0,class:"ssl-subscript-tips"},ze={class:"ssl-tips-list mb-[.4rem]"},Xe={class:"mt-[.4rem]"},Qe={class:"ssl-line"},Ze={class:"ssl-content"},Ke={class:"ssl-option-list"},Ye=["onClick"],$e={class:"ssl-type-title !font-normal border-none"},el={key:0,class:"ssl-subscript-tips"},ll={class:"ssl-tips-list mb-[.4rem]"},tl={class:"mt-[.4rem]"},al={class:"ssl-line"},sl={class:"ssl-content"},rl={class:"ssl-option-list"},il=["onClick"],nl={class:"ssl-type-title !font-normal border-none"},ol={key:0,class:"ssl-subscript-tips"},cl={class:"ssl-tips-list mb-[.4rem]"},ul={class:"mt-[.4rem]"},dl={class:"ssl-line"},ml={class:"ssl-content"},pl={class:"ssl-option-list"},vl=["onClick"],fl={class:"ssl-type-title !font-normal border-none"},yl={key:0,class:"ssl-subscript-tips"},gl={class:"ssl-tips-list mb-[.4rem]"},hl={class:"mt-[.4rem]"},bl={class:"flex justify-between w-full w-[90%] mx-[auto]"},_l={class:"flex flex-col"},wl={class:"mb-[4px]"},xl={class:"mr-[1rem]"},Cl={class:"flex flex-col"},kl={class:"flex h-[2.2rem] items-end mb-[4px]"},Ll={class:"text-[#FC6D26] text-[1.2rem]"},Sl={class:"text-[2rem] font-bold"},Al={class:"pl-[6rem] text-[1.2rem] text-[#aaa] line-through"},Vl={class:"flex items-center"},Tl=r(g({__name:"index",emits:["close"],setup(r,{emit:i}){const n=s(),{sslApplicationInfo:o,productInfo:c,orderInfo:u}=ue(),d=h(!1);h(0);const m=h(0),p=h(null),v=h(null),f={single:["仅支持绑定一个二级域名或者子域名，例如 bt.com、cloud.bt.com、dnspod.cloud.bt.com的其中之一 。","如需要绑定同级的所有子域名，例如*.bt.com，请购买泛域名证书。"],wildcard:["带通配符的域名，例如：*.bt.com、*.cloud.bt.com均为泛域名，包含同一级的全部子域名。","注意泛域名不支持跨级，例如*.bt.com 不包含 *.cloud.bt.com的支持"]},y={0:[],1:["宝塔提供9:00 - 24:00的人工部署证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"],2:["宝塔提供9:00 - 24:00的人工部署国密算法证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"]},g=h({num:1,certClassAcitve:"OV",certClass:[{name:"OV证书",title:"推荐企业使用",value:"OV",tips:[],data:[]},{name:"DV证书",title:"推荐个人，测试使用",value:"DV",subscript:"热销",tips:[]},{name:"EV证书",title:"推荐大型政企使用，高安全性",value:"EV",tips:[]}],certBrandAcitve:"",certBrand:[{name:"Positive",title:"Positive",value:"Positive",tips:[]},{name:"锐安信",title:"锐安信",value:"锐安信",tips:[]},{name:"CFCA",title:"CFCA",value:"CFCA",tips:[]},{name:"Digicert",title:"Digicert",value:"Digicert",tips:[]},{name:"GeoTrust",title:"GeoTrust",value:"GeoTrust",tips:[]},{name:"Sectigo",title:"Sectigo",value:"Sectigo",tips:[]}],certTypeAcitve:"single",certType:[{name:"single",title:"单域名",value:"single",tips:[]},{name:"multiple",title:"多域名",value:"multiple",tips:[]},{name:"wildcard",title:"泛域名",value:"wildcard",tips:[]}],certLifeAcitve:1,certLife:[{name:"1年",title:"1年",value:1,tips:[]},{name:"2年",title:"2年",value:2,tips:[]},{name:"3年",title:"3年",value:3,tips:[]},{name:"4年",title:"4年",value:4,tips:[]},{name:"5年",title:"5年",value:5,tips:[]}],certDeployAcitve:1,certDeploy:[{name:"不需要",title:"不需要",value:0,tips:[]},{name:"部署服务",title:"部署服务",value:1,tips:[]},{name:"部署服务（国密）",title:"部署服务（国密）",value:2,tips:[]}]}),U=h({}),M=h({addPrice:0,productName:"",price:0,totalPrice:0,originalPrice:0,deploymentPrice:0,pid:0,years:1,yearsPrice:0,number:1,extraNumber:0,extraPrice:0,install:1}),F=h({oid:0,wxcode:"",alicode:"",qq:"",orderInfo:{}}),H={defalutList:[],domianNumList:[],classList:[],brandList:[],typeList:[]},R=b((()=>{const e=g.value.certClass.filter((e=>e.value===g.value.certClassAcitve));return e&&e.length>0?e[0].tips:[]})),J=b((()=>{const e=g.value.certBrand.filter((e=>e.value===g.value.certBrandAcitve));return e&&e.length>0?e[0].tips:[]})),G=b((()=>{const e=g.value.certType.filter((e=>e.value===g.value.certTypeAcitve));return e&&e.length>0?e[0].tips:[]})),W=b((()=>{const e=g.value.certLife.filter((e=>e.value===parseInt(g.value.certLifeAcitve)));return e&&e.length>0?e[0].tips:[]})),z=b((()=>{const e=g.value.certDeploy.filter((e=>e.value===parseInt(g.value.certDeployAcitve)));return e&&e.length>0?e[0].tips:[]})),X=({type:e,brand:l,times:t})=>{g.value.certClass=pe(g.value.certClass,e,((e,l)=>l["".concat(e.value).toLowerCase()])),f.multiple=f.single,g.value.certType=pe(g.value.certType,f),g.value.certDeploy=pe(g.value.certDeploy,y),g.value.certBrand=pe(g.value.certBrand,l,((e,l)=>l["Positive"!==e.value?"".concat(e.value).toLowerCase():"Positive"])),g.value.certLife=pe(g.value.certLife,t,((e,l)=>l[e.value+"_year"]))},Q=e=>{const l=[];e.forEach((e=>{var t;const a=null==(t=e.type.match(/(OV|DV|EV)/))?void 0:t[0],s=-1!==e.code.indexOf("wildcard"),r=e.add_price>0;let i=s?"wildcard":r?"multiple":"single";"Digicert"===e.brand&&(i=s?"wildcard":"single"),l.push({...e,type:a,certType:i,isMulti:r})})),H.defalutList=l},Z=(e={})=>{let{num:l,classify:t,brand:a,type:s,life:r,deploy:i}=e;const n=g.value;return l||(l=n.num),t||(t=n.certClassAcitve),a||(a=n.certBrandAcitve),s||(s=n.certTypeAcitve),r||(r=n.certLifeAcitve),i||(i=n.certDeployAcitve),{num:l,classify:t,brand:a,type:s,life:r,deploy:i}},K=()=>{g.value.certClassAcitve="OV",g.value.certBrandAcitve=$(),g.value.certTypeAcitve="single",g.value.certLifeAcitve=1,g.value.certDeployAcitve=1},Y=()=>{le(H.defalutList),ee(),ce()},$=()=>{var e;return U.value[null==(e=g.value.certClassAcitve)?void 0:e.toLowerCase()]},ee=()=>{const{domianNumList:e,classList:l,brandList:t,typeList:a}=H;g.value.certClass.forEach((l=>{let t=e.some((e=>e.type===l.value));"EV"==l.value&&"wildcard"===g.value.certTypeAcitve&&(t=!1),l.disable=!t})),g.value.certBrand.forEach((e=>{var t;const a=!l.some((l=>l.brand===e.value));if(e.hidden=a,e.subscript=e.value===$()?"推荐":"",e.value===g.value.certBrandAcitve&&e.hidden){g.value.certBrandAcitve=$();const e=null==(t=null==H?void 0:H.classList)?void 0:t.filter((e=>e.brand===g.value.certBrandAcitve));e.length>0&&(H.brandList=e,ie(e))}})),g.value.certType.forEach((e=>{let l=!t.some((l=>l.certType===e.value));"single"===e.value&&g.value.num>1&&(l=!0),"multiple"===e.value&&1===g.value.num&&(l=!0),"multiple"===e.value&&g.value.num>1&&(l=!1),e.hidden=l}))},le=e=>{let{num:l}=Z();const t=e.filter((e=>!(l>1)||e.isMulti));t.length>0&&(H.domianNumList=t,se(t))},se=e=>{const{classify:l}=Z(),t=e.filter((e=>e.type===l));t.length>0&&(H.classList=t,re(t))},re=e=>{const{brand:l}=Z(),t=e.filter((e=>e.brand===l));t.length>0&&(H.brandList=t,ie(t))},ie=e=>{const{type:l}=Z();1===e.length&&(g.value.certTypeAcitve=e[0].certType);const t=e.filter((e=>{const t="multiple"===g.value.certTypeAcitve&&"wildcard"!==e.certType&&e.isMulti,a="wildcard"===g.value.certTypeAcitve&&"wildcard"===e.certType&&e.isMulti;return e.certType===l||t||a}));t.length>0&&(H.typeList=t)},ne=(e=g.value.num)=>{let l=e;if("number"!=typeof e?(e=Number(e.data),l=Number(g.value.num)||1):l=Number(g.value.num+e)||1,l&&(l<1||l>99))return g.value.num=l<1?1:99,n.error("域名数量范围为1-99");g.value.num=l,"wildcard"!==g.value.certTypeAcitve&&(g.value.certTypeAcitve=g.value.num>1?"multiple":"single"),Y()},oe=(e,l,t)=>{t||(t=g.value[l].filter((l=>l.value===e))),t.disable||("".concat(l,"Acitve")in g.value&&(g.value["".concat(l,"Acitve")]=e),Y())},ce=()=>{const e=H.typeList[0]||null;if(m.value=(null==e?void 0:e.num)||0,e){const{num:l,life:t,deploy:a}=Z(),{price:s,other_price:r,add_price:i,pid:n,num:o,install_price:c,install_price_v2:u}=e,d=l-o<0?0:l-o,m=[0,c,u][a],p=i*d,v=(p+s)*t+m,f=r+p+m;M.value={addPrice:i||0,productName:e.title,price:s,totalPrice:v,originalPrice:f,deploymentPrice:m,pid:n,years:t,yearsPrice:s*t,number:o,extraNumber:d,extraPrice:p,install:Number(a)}}},me=async()=>{try{const{pid:l,install:t,years:a,extraNumber:s}=M.value,r={pdata:JSON.stringify({pid:l,install:t,years:a,num:s})},i=await e({loading:"正在创建商业证书订单，请稍后...",request:ae(r),data:{status:Boolean,"msg.oid":[Number,"oid"],"msg.wxcode":[String,"wxcode"],"msg.alicode":[String,"alicode"],"msg.qq":[String,"qq"],"msg.order_info":[Object,"orderInfo"],msg:[String,e=>e]}}),{oid:o,wxcode:c,alicode:u,qq:d,orderInfo:m,status:p,msg:v}=i;if(!p)return n.error(v);F.value={oid:o,wxcode:c,alicode:u,qq:d,orderInfo:m},ve({...F.value,productInfo:M.value})}catch(l){}},pe=(e,l,t)=>e.map(((e,a)=>{const s=t?t(e,l):l[e.value];return{...e,tips:s}})),ve=e=>{c.value=e.productInfo,u.value=e.orderInfo,l({title:"支付商业证书订单",area:[60],component:()=>t((()=>import("./pay-bus-ssl2.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})};return _((()=>{(async()=>{try{d.value=!0;const{data:{info:e,data:l,administrator:t}}=await te();U.value=e.recommend,K(),X(e),Q(l),Y(),o.value={...t}}catch(e){}finally{d.value=!1}})()})),(e,l)=>{const t=O,s=a,r=E,i=w("bt-loading");return x((k(),L("div",{class:"",ref_key:"sslContainer",ref:p},[S("div",ke,[A(t,{type:"error",closable:!1,class:"!p-[1.2rem]"},{title:V((()=>l[3]||(l[3]=[S("span",{class:"text-[1.3rem] flex items-center"},[S("span",{class:"svgtofont-hint-confirm-icon !text-[2rem]"}),S("span",null," 禁止含有诈骗、赌博、色情、木马、病毒等违法违规业务信息的站点申请SSL证书，如有违反，撤销申请，停用账号。 ")],-1)]))),_:1}),S("div",Le,[S("div",Se,[l[6]||(l[6]=S("div",{class:"ssl-label"},"域名数量",-1)),S("div",Ae,[S("div",Ve,[S("div",Te,[S("div",{class:T(["del-number",{"is-disable":1===C(g).num}]),onClick:l[0]||(l[0]=e=>ne(-1))},null,2),x(S("input",{type:"number",class:"input-number",min:"1",max:"99","onUpdate:modelValue":l[1]||(l[1]=e=>C(g).num=e),onInput:ne},null,544),[[P,C(g).num]]),S("div",{class:T(["add-number",{"is-disable":99===C(g).num}]),onClick:l[2]||(l[2]=e=>ne(1))},null,2)]),S("div",Pe,[A(de,{placement:"right"},{default:V((()=>[S("div",Ne,[A(s,{src:"../icons/service-icon.svg",class:"mx-[.4rem] w-1.6rem h-1.6rem"}),l[4]||(l[4]=S("span",{class:"ml5"},"教我选择？",-1))])])),_:1})]),x(S("div",{class:"ssl-tips"},"默认包含"+N(C(m))+"个域名，超出数量每个域名"+N(C(M).addPrice)+"元/个/年",513),[[D,0!==C(M).addPrice]])]),l[5]||(l[5]=S("div",{class:"ssl-tips"},"请选择当前证书包含的域名数量",-1))])]),S("div",De,[l[7]||(l[7]=S("div",{class:"ssl-label"},"证书分类",-1)),S("div",Ie,[S("div",je,[(k(!0),L(I,null,j(C(g).certClass,(e=>(k(),L("div",{class:T(["ssl-option-item w-[29rem] flex-col justify-center items-center mr-[1rem]",{"is-active":e.value===C(g).certClassAcitve,"is-disabled":e.disable,"!hidden":e.hidden}]),key:e.value,onClick:l=>oe(e.value,"certClass",e)},[S("div",Be,N(e.name),1),S("div",Oe,N(e.title),1),e.subscript?(k(),L("em",Ee,N(e.subscript),1)):q("",!0)],10,qe)))),128))]),S("div",Ue,[(k(!0),L(I,null,j(C(R),(e=>(k(),L("p",Me,N(e),1)))),256))])])]),S("div",Fe,[l[8]||(l[8]=S("div",{class:"ssl-label"},"证书品牌",-1)),S("div",He,[S("div",Re,[(k(!0),L(I,null,j(C(g).certBrand,(e=>(k(),L("div",{class:T(["ssl-option-item min-w-[9rem]",{"is-active":e.value===C(g).certBrandAcitve,"is-disabled":e.disable,"!hidden":e.hidden}]),key:e.value,onClick:l=>oe(e.value,"certBrand",e)},[S("div",Ge,N(e.title),1),e.subscript?(k(),L("em",We,N(e.subscript),1)):q("",!0)],10,Je)))),128))]),S("div",ze,[(k(!0),L(I,null,j(C(J),(e=>(k(),L("p",Xe,N(e),1)))),256))])])]),S("div",Qe,[l[9]||(l[9]=S("div",{class:"ssl-label"},"证书类型",-1)),S("div",Ze,[S("div",Ke,[(k(!0),L(I,null,j(C(g).certType,(e=>(k(),L("div",{class:T(["ssl-option-item min-w-[9rem]",{"is-active":e.value===C(g).certTypeAcitve,"is-disabled":e.disable,"!hidden":e.hidden}]),key:e.value,onClick:l=>oe(e.value,"certType",e)},[S("div",$e,N(e.title),1),e.subscript?(k(),L("em",el,N(e.subscript),1)):q("",!0)],10,Ye)))),128))]),S("div",ll,[(k(!0),L(I,null,j(C(G),(e=>(k(),L("p",tl,N(e),1)))),256))])])]),S("div",al,[l[10]||(l[10]=S("div",{class:"ssl-label"},"购买年限",-1)),S("div",sl,[S("div",rl,[(k(!0),L(I,null,j(C(g).certLife,(e=>(k(),L("div",{class:T(["ssl-option-item min-w-[9rem]",{"is-active":e.value===C(g).certLifeAcitve}]),key:e.value,onClick:l=>oe(e.value,"certLife",e)},[S("div",nl,N(e.title),1),e.subscript?(k(),L("em",ol,N(e.subscript),1)):q("",!0)],10,il)))),128))]),S("div",cl,[(k(!0),L(I,null,j(C(W),(e=>(k(),L("p",ul,N(e),1)))),256))])])]),S("div",dl,[l[11]||(l[11]=S("div",{class:"ssl-label"},"部署服务",-1)),S("div",ml,[S("div",pl,[(k(!0),L(I,null,j(C(g).certDeploy,(e=>(k(),L("div",{class:T(["ssl-option-item min-w-[9rem]",{"is-active":e.value===C(g).certDeployAcitve}]),key:e.value,onClick:l=>oe(e.value,"certDeploy",e)},[S("div",fl,N(e.title),1),e.subscript?(k(),L("em",yl,N(e.subscript),1)):q("",!0)],10,vl)))),128))]),S("div",gl,[(k(!0),L(I,null,j(C(z),(e=>(k(),L("p",hl,N(e),1)))),256))])])])])]),S("div",{class:"ssl-info-view rounded-sm sticky bottom-0",ref_key:"sslApplyInfo",ref:v},[S("div",bl,[S("div",_l,[S("div",wl,[l[12]||(l[12]=B(" 商品包含：")),S("span",xl,N("".concat(C(M).productName," - 默认包含").concat(C(M).number,"个域名 ").concat(C(M).yearsPrice,"元/").concat(C(M).years,"年"))+N(C(M).extraNumber>0?"，额外超出".concat(C(M).extraNumber,"个域名").concat(C(M).extraPrice.toFixed(2),"元/").concat(C(M).years,"年"):""),1)]),S("div",Cl,[S("div",kl,[l[13]||(l[13]=S("span",null,"总计费用：",-1)),S("div",Ll,[S("span",Sl,N(C(M).totalPrice.toFixed(2)),1),S("span",null,"元/"+N(C(M).years)+"年",1),x(S("span",null,"（包含部署服务）",512),[[D,C(M).install]])])]),S("div",Al,"原价"+N(C(M).originalPrice.toFixed(2))+"元/"+N(C(M).years)+"年",1)])]),S("div",Vl,[A(r,{size:"large",type:"primary",onClick:me},{default:V((()=>l[14]||(l[14]=[B("立即购买")]))),_:1})])])],512)])),[[i,C(d)],[i,"正在获取商业证书信息，请稍后...","title"]])}}}),[["__scopeId","data-v-9d519852"]]),Pl={class:"relative p-[1.6rem] w-[90%] mx-[auto]"},Nl={class:"text-[1.2rem] flex items-center"},Dl={class:"leading-7 mt-[.2rem] flex items-center"},Il={class:"flex flex-row"},jl=g({__name:"index",emits:["close"],setup(l,{emit:t}){const a=s(),r=t;fe();const c=[{content:"注意：请勿将SSL证书用于非法网站，一经发现，吊销证书。",class:"text-danger"},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)。"},{content:"宝塔SSL申请的是免费版TrustAsia DV SSL CA - G5证书，仅支持单个域名申请。"},{content:"建议使用二级域名为www的域名申请证书,此时系统会默认赠送顶级域名为可选名称"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:'测试SSL申请注意事项及教程<a href="https://www.bt.cn/bbs/thread-33113-1-1.html" target="_blank" class="btlink"> 使用帮助</a>',isHtml:!0}],u=h(),d=h(),m=h({domain:"",orgName:"",orgRegion:"",orgCity:"",orgAddress:"",orgPhone:"",orgPostalCode:"",orgDivision:"总务"}),p=h({orgName:[{required:!0,message:"请输入个人/公司名称",trigger:["blur","change"]}],orgRegion:[{required:!0,message:"请输入所在省份",trigger:["blur","change"]}],orgCity:[{required:!0,message:"请输入所在市/县",trigger:["blur","change"]}],orgAddress:[{required:!0,message:"请输入个人/公司地址",trigger:["blur","change"]}],orgPhone:[{required:!0,message:"请输入手机号码",validator:(e,l,t)=>{i(l)?t():t(new Error("请输入正确的手机号码"))},trigger:["blur","change"]}],orgPostalCode:[{required:!0,message:"请输入邮政编码",validator:(e,l,t)=>{6===l.length?t():t(new Error("请输入正确的邮政编码"))},trigger:["blur","change"]}]}),v=async()=>{if(await d.value.validate())try{const{status:l,data:t,msg:s}=await e({loading:"正在提交证书申请资料，请稍后...",request:se({...m.value})});if(l){r("close"),a.success(t.msg||s||"申请成功");const{status:l,data:i,msg:n}=await e({loading:"正在验证证书申请状态，请稍后...",request:re({partnerOrderId:t.partnerOrderId,siteName:m.value.domain})});l?"COMPLETED"==i.stateCode?a.success("验证成功！"):a.success("等待CA验证中，若长时间未能成功验证，请登录官网使用DNS方式重新申请..."):a.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:n,type:"error",duration:0,showClose:!0})}else a.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:(null==t?void 0:t.msg)||s,type:"error",duration:0,showClose:!0})}catch(l){}};return _((()=>{(async()=>{var e,l;let t=null;try{t=a.load("正在获取所有域名列表，请稍后...");const{data:s}=await ie();u.value=s,(null==(l=null==(e=u.value)?void 0:e.data)?void 0:l.length)&&(m.value.domain=u.value.data[0].name)}catch(s){}finally{t&&t.close()}})()})),(e,l)=>{const t=n,a=O,s=M,r=F,i=H,f=R,y=J,g=E,h=G,b=o;return k(),L("div",Pl,[A(a,{type:"error",closable:!1},{title:V((()=>[S("span",Nl,[l[9]||(l[9]=S("span",{class:"svgtofont-hint-confirm-icon !text-[2rem]"},null,-1)),S("div",Dl,[l[8]||(l[8]=B(" 提示：尊敬的用户您好，感谢您对宝塔免费证书的支持，由于证书签发机制的调整，原一年的免费证书，将缩短至90天。本调整将于2024年4月25日生效。请注意及时续签。 ")),A(t,{href:"https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/",target:"_blank"},{default:V((()=>l[7]||(l[7]=[B(" 查看详情 ")]))),_:1})])])])),_:1}),A(h,{class:"mt-[1rem]",rules:C(p),ref_key:"applySslInfoForm",ref:d,model:C(m),"label-width":"100px"},{default:V((()=>[A(s,{label:"证书信息"},{default:V((()=>l[10]||(l[10]=[S("span",{class:"text-primary"}," TrustAsia TLS RSA CA(免费版)",-1)]))),_:1}),A(s,{label:"域名",prop:"domain"},{default:V((()=>[A(i,{modelValue:C(m).domain,"onUpdate:modelValue":l[0]||(l[0]=e=>C(m).domain=e),class:"!w-[36rem]",filterable:"",placeholder:"请选择"},{default:V((()=>{var e;return[(k(!0),L(I,null,j(null==(e=C(u))?void 0:e.data,(e=>(k(),U(r,{key:e.id,label:e.name,value:e.name},null,8,["label","value"])))),128))]})),_:1},8,["modelValue"])])),_:1}),A(s,{label:"个人/公司名称",prop:"orgName"},{default:V((()=>[A(y,{placement:"top-start",effect:"dark",width:200,trigger:"hover",content:"请输入个人/公司名称，必填项"},{reference:V((()=>[A(f,{modelValue:C(m).orgName,"onUpdate:modelValue":l[1]||(l[1]=e=>C(m).orgName=e),placeholder:"请输入个人/公司名称，必填项",class:"!w-[36rem]"},null,8,["modelValue"])])),_:1})])),_:1}),A(s,{label:"所在地区",prop:"orgRegion"},{default:V((()=>[S("div",Il,[A(y,{placement:"top-start",effect:"dark",width:200,trigger:"hover",content:"请输入所在省份，必填项"},{reference:V((()=>[A(f,{modelValue:C(m).orgRegion,"onUpdate:modelValue":l[2]||(l[2]=e=>C(m).orgRegion=e),placeholder:"请输入所在省份，必填项",class:"mr-[1.6rem] !w-[17rem]"},null,8,["modelValue"])])),_:1}),A(y,{placement:"top-start",effect:"dark",width:200,trigger:"hover",content:"请输入所在市/县，必填项"},{reference:V((()=>[A(f,{modelValue:C(m).orgCity,"onUpdate:modelValue":l[3]||(l[3]=e=>C(m).orgCity=e),placeholder:"请输入所在市/县，必填项",class:"!w-[17.4rem]"},null,8,["modelValue"])])),_:1})])])),_:1}),A(s,{label:"地址",prop:"orgAddress"},{default:V((()=>[A(y,{placement:"top-start",effect:"dark",width:200,trigger:"hover",content:"请输入个人/公司地址，必填项"},{reference:V((()=>[A(f,{modelValue:C(m).orgAddress,"onUpdate:modelValue":l[4]||(l[4]=e=>C(m).orgAddress=e),placeholder:"请输入个人/公司地址，必填项",class:"!w-[36rem]"},null,8,["modelValue"])])),_:1})])),_:1}),A(s,{label:"手机",prop:"orgPhone"},{default:V((()=>[A(y,{placement:"top-start",effect:"dark",width:200,trigger:"hover",content:"请输入手机号码，必填项"},{reference:V((()=>[A(f,{modelValue:C(m).orgPhone,"onUpdate:modelValue":l[5]||(l[5]=e=>C(m).orgPhone=e),placeholder:"请输入手机号码，必填项",class:"!w-[36rem]"},null,8,["modelValue"])])),_:1})])),_:1}),A(s,{label:"邮政编码",prop:"orgPostalCode"},{default:V((()=>[A(y,{placement:"top-start",effect:"dark",width:200,trigger:"hover",content:"请输入邮政编码，必填项"},{reference:V((()=>[A(f,{modelValue:C(m).orgPostalCode,"onUpdate:modelValue":l[6]||(l[6]=e=>C(m).orgPostalCode=e),placeholder:"请输入邮政编码，必填项",class:"!w-[36rem]"},null,8,["modelValue"])])),_:1})])),_:1}),A(s,{label:" "},{default:V((()=>[A(g,{type:"primary",onClick:v},{default:V((()=>l[11]||(l[11]=[B("申请证书")]))),_:1})])),_:1})])),_:1},8,["rules","model"]),A(b,{options:c,listStyle:"disc",class:"ml-[2rem] bottom-0"})])}}}),ql={class:"py-[1.6rem] relative w-[90%] mx-[auto]"},Bl={key:0},Ol={class:"!max-h-[20rem] overflow-auto"},El=["title"],Ul={key:1},Ml={class:"!max-h-[20rem] overflow-auto"},Fl=["title"],Hl={class:"p-[1.5rem]"},Rl={class:"ml-[.4rem] text-danger"},Jl={class:"max-h-[38rem] overflow-auto"},Gl={key:0,class:"flex justify-end"},Wl=g({__name:"index",emits:["close"],setup(l,{emit:t}){const{mainHeight:a}=c(),r=s(),{siteInfo:i}=fe(),{setApplyInfo:n,letApplyInfo:y}=ue(),{refs:{isRefreshDomainConfigList:g}}=we(),b=W({resource:"0",autoWildcard:!1,auth_to:!1,checkAll:!1,domain:[],checkList:[]}),P=h(!1);h([]);const D=h([]),O=W({}),R=h(!1),le=[{content:"注意：请勿将SSL证书用于非法网站",class:"text-danger"},{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"},{content:"在DNS验证中，我们提供了多种自动化DNS-API，并提供了手动模式"},{content:"使用DNS接口申请证书可自动续期，手动模式下证书到期后需重新申请"}],te=h([{label:"解析域名",prop:"domain"},{label:"记录值",prop:"auth_value",render(e,l){const t="dns"===O.auth_type?e.auth_value:e.file_path;return A("div",{class:"flex items-center"},[A("div",{class:"truncate w-[15rem]"},[t]),A("span",{class:"svgtofont-icon-copy ml-[4px] text-[#666] text-[1.6rem] w-[1.6rem] cursor-pointer",onClick:()=>u({value:t})},null)])}},{label:"类型",prop:"type",render:(e,l)=>"dns"===O.auth_type?A("span",null,[e.type]):A("div",{class:"flex items-center"},[A("div",{class:"truncate w-[15rem]"},[e.content]),A("span",{class:"svgtofont-icon-copy ml-[4px] text-[#666] text-[1.6rem] w-[1.6rem] cursor-pointer",onClick:()=>u({value:e.content})},null)])},{label:"必需",prop:"must",width:100}]),ae=h([]),se=h(!1),re=h(""),ie=h([{text:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{text:""},{text:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}]),de=async()=>{const l=await me(),t=await e({request:ne({index:O.index}),message:!1});l._props.onCancel(),!0===t.status?(R.value=!1,ke(t,!0)):pe(t,D.value,O)},ke=async({index:l},t=!1,a=i.value.name)=>{const s=await e({loading:"正在部署证书，请稍候...",request:ce({index:l,siteName:a}),message:!1,data:{status:Boolean,msg:String}});ve(s,t)},Le=h([]),Se=h(""),Ae=h([]),Ve=h(null),Te=h([]),Pe=h(!0),Ne=h(""),De=h(!1),Ie=async(e=!1)=>{let l;try{let e={site_id:"1"===b.resource?Le.value.join(","):Se.value};P.value=!0,l=r.load("正在获取域名列表，请稍后...");const{data:t}=await be(e);if(b.domain=t.map((e=>e.name)),Ae.value=t,"1"===b.resource){const e=b.checkList.filter((e=>Le.value.includes(e.site_id)));await ee(),e.forEach((e=>{const l=Ae.value.find((l=>l.name===e.name));l&&Ve.value.toggleRowSelection(l,!0)}))}}catch(t){}finally{l&&l.close(),P.value=!1}},je=({row:e})=>{if(!e.name.includes(Ne.value)&&De.value)return"!hidden"},qe=e=>{b.checkList=e},Be=e=>{b.checkList=e},Oe=async()=>{await Ie()},Ee=async e=>{"1"===b.resource?Le.value=e:Se.value=e,await Ie()},Ue=e=>{De.value=!0,Ne.value=e},Me=()=>{De.value=!0},Fe=()=>{Ne.value="",De.value=!1},He=e=>e.map((e=>e.name)),Re=async()=>{if(0===b.checkList.length)return void r.error("请选择一个域名");if("1"===b.resource&&b.checkList.some((e=>0===e.status))&&!b.auth_to)return void r.error("选中的域名存在未设置DNS接口配置");if("1"===b.resource&&b.autoWildcard&&b.checkList.some((e=>-1!==e.name.indexOf("*"))))return void r.error("开启自动组合泛域名时不能选择泛域名");let e={domains:JSON.stringify(He(b.checkList)),auth_type:"1"==b.resource?"dns":"http",auth_to:JSON.stringify(He(b.checkList)),auto_wildcard:b.autoWildcard?"1":"0"};"1"==b.resource&&(e.auth_to=b.auth_to?"dns":JSON.stringify(He(b.checkList)));try{const l=await me(),t=await ge(e);l._props.onCancel(),Je(t.data,e),ie.value[1].text="可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(He(b.checkList)[0].replace("*.",""))}catch(l){}},Je=(e,l)=>{if(!1===e.status&&e.hasOwnProperty("msg")&&d(e.msg))r.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg,type:"error",showClose:!0,duration:0});else if(!0!==e.status&&"pending"!==e.status&&void 0===(null==e?void 0:e.save_path))pe(e,y.value.dnsTable,y.value.info);else{if("pending"===e.status&&"dns"===l.auth_type){ae.value=[];for(let l=0;l<e.auths.length;l++){let t=[];const a=e.auths[l].domain.replace("*.","");t.push({domain:"_acme-challenge.".concat(a),type:"TXT",auth_value:e.auths[l].auth_value,must:"是",force:"是"}),t.push({domain:a,type:"CAA",auth_value:'0 issue "letsencrypt.org"',must:"否",force:"否"}),ae.value.push({domain:e.auths[l].domain,data:t})}return e.hasOwnProperty("error")?se.value=e.error:se.value=!1,n(e,l),void(R.value=!0)}Ge(e)}},Ge=async l=>{let t;try{t=r.load("正在部署证书，请稍后...");let a=[];a="1"===b.resource?Le.value.map((e=>Te.value.find((l=>l.id===e)))).filter((e=>e)).map((e=>({siteName:e.name}))):[{siteName:Te.value.find((e=>e.id===Se.value)).name}];const s=await e({request:he({BatchInfo:JSON.stringify(a),privkey:l.private_key,fullchain:l.cert+l.root})});let i={resultData:[...s.data.faildList,...s.data.successList],resultTitle:"批量部署结果",resultColumn:[{label:"站点名称",prop:"siteName"},{label:"操作结果",render:e=>A("div",{class:e.status?"text-primary":"text-danger"},[e.status?"操作成功":A("span",{class:"flex items-center"},[B("操作失败，"),A(J,{popperClass:"el-popover-shadow el-light-popover",trigger:"hover",placement:"top-start",enterable:!1,"open-delay":400,"close-delay":0},{default:()=>[A("span",{class:"inline-block",innerHTML:e.error_msg||"暂无详情"},null)],reference:()=>A("span",{class:"text-primary cursor-pointer"},[B("详情")])})])])}]};await Ce(i)}catch(a){}finally{t&&t.close()}};return z(g,(e=>{e&&((async()=>{let e;try{e=r.load("正在获取站点列表，请稍后...");const{data:l}=await _e();l.length&&(Te.value=l,Pe.value&&(Le.value[0]=l[0].id,Se.value=l[0].id,Pe.value=!1),await Ie())}catch(l){}finally{e&&e.close()}})(),g.value=!1)}),{immediate:!0}),_((()=>{g.value=!0})),(e,l)=>{const t=Q,s=Z,i=M,n=K,c=F,u=m,d=H,y=p,g=Y,h=E,_=$,D=ye,W=G,z=o,ee=v,ne=f,ce=w("bt-loading");return k(),L("div",ql,[A(W,{class:"mb-[2rem]"},{default:V((()=>[A(i,{label:"验证方法"},{default:V((()=>[A(s,{modelValue:C(b).resource,"onUpdate:modelValue":l[0]||(l[0]=e=>C(b).resource=e),onChange:Oe},{default:V((()=>[A(t,{label:"0",value:"0"},{default:V((()=>l[5]||(l[5]=[B("文件验证")]))),_:1}),A(t,{label:"1",value:"1"},{default:V((()=>l[6]||(l[6]=[B("DNS验证(支持通配符)")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),"1"==C(b).resource?(k(),L(I,{key:0},[A(i,{label:" ",class:"!mt-[-.3rem]"},{default:V((()=>[A(n,{modelValue:C(b).auth_to,"onUpdate:modelValue":l[1]||(l[1]=e=>C(b).auth_to=e)},{default:V((()=>l[7]||(l[7]=[B(" 手动解析")]))),_:1},8,["modelValue"])])),_:1}),A(i,{label:" ",class:"!mt-[-.3rem] !mb-[2rem]"},{default:V((()=>[A(n,{modelValue:C(b).autoWildcard,"onUpdate:modelValue":l[2]||(l[2]=e=>C(b).autoWildcard=e)},{default:V((()=>l[8]||(l[8]=[B(" 自动组合泛域名")]))),_:1},8,["modelValue"]),l[9]||(l[9]=S("div",{class:"text-[1.2rem]"},"* 如需申请通配符域名请勾选此项，且不要在下方域名列表中选中泛域名",-1))])),_:1})],64)):q("",!0),A(i,{label:"网站"},{default:V((()=>[S("div",null,["1"==C(b).resource?(k(),L("div",Bl,[(k(),U(u,{multiple:!0,filterable:"","model-value":C(Le),class:"mr-[.8rem] !w-[22rem]",key:C(b).resource,onChange:Ee},{default:V((()=>[S("div",Ol,[(k(!0),L(I,null,j(C(Te),((e,l)=>(k(),U(c,{key:l,label:e.name,value:e.id},{default:V((()=>[S("span",{class:"!w-[22rem] truncate",title:e.name,style:{float:"left"}},N(e.name),9,El)])),_:2},1032,["label","value"])))),128))])])),_:1},8,["model-value"]))])):(k(),L("div",Ul,[(k(),U(d,{filterable:"","model-value":C(Se),class:"mr-[.8rem] !w-[22rem]",key:C(b).resource,onChange:Ee},{default:V((()=>[S("div",Ml,[(k(!0),L(I,null,j(C(Te),((e,l)=>(k(),U(c,{key:l,label:e.name,value:e.id},{default:V((()=>[S("span",{class:"!w-[22rem] truncate",title:e.name,style:{float:"left"}},N(e.name),9,Fl)])),_:2},1032,["label","value"])))),128))])])),_:1},8,["model-value"]))])),l[10]||(l[10]=S("div",{class:"text-[1.2rem] mt-[.5rem]"},"* 根据网站筛选下方域名",-1))])])),_:1}),A(i,{label:"域名"},{default:V((()=>[S("div",{class:T(["w-[60rem] !relative border-[1px] border-[#ececec]",C(a)>1e3?"h-[52rem]":"h-[31rem]"])},[A(y,{class:"!absolute right-[1rem] top-[.7rem] z-99 !w-[200px]",modelValue:C(Ne),"onUpdate:modelValue":l[3]||(l[3]=e=>X(Ne)?Ne.value=e:null),onSearch:Ue,onClear:Fe,onBlur:Me,placeholder:"搜索域名"},null,8,["modelValue"]),A(D,null,{content:V((()=>[x((k(),U(_,{ref_key:"domainTable",ref:Ve,class:"!mb-[1rem] mt-[-1.2rem]","row-class-name":je,onSelectionChange:qe,onSelectAll:Be,data:C(Ae),"max-height":C(a)<1e3?290:500,description:"列表为空"},{default:V((()=>[A(g,{type:"selection",width:"35"}),A(g,{prop:"name",label:"域名"},{default:V((e=>[e.row.apply_ssl?(k(),U(C(J),{key:0,placement:"top-start",trigger:"hover",offset:-100},{reference:V((()=>[S("span",null,N(e.row.name),1)])),default:V((()=>[l[11]||(l[11]=S("div",{class:"flex flex-col"},[S("span",null,"Let's Encrypt证书不支持申请IP证书"),S("span",null,"请选择【商用证书】的多域名SSL证书申请")],-1))])),_:2},1024)):q("",!0)])),_:1}),A(g,{align:"right"},{default:V((e=>["1"!==C(b).resource||0!==e.row.status||C(b).auth_to?q("",!0):(k(),U(h,{key:0,size:"small",type:"primary",class:"ml-auto",onClick:l=>C(xe)(e.row)},{default:V((()=>l[12]||(l[12]=[B("配置DNS")]))),_:2},1032,["onClick"]))])),_:1})])),_:1},8,["data","max-height"])),[[ce,C(P)],[ce,"正在加载域名列表，请稍后...","title"]])])),_:1})],2)])),_:1}),A(i,{label:" "},{default:V((()=>[A(h,{type:"primary",onClick:Re},{default:V((()=>l[13]||(l[13]=[B("申请证书")]))),_:1})])),_:1})])),_:1}),A(z,{options:le,class:"pl-2rem"}),A(ne,{modelValue:C(R),"onUpdate:modelValue":l[4]||(l[4]=e=>X(R)?R.value=e:null),area:70,title:"手动".concat("dns"===C(O).auth_type?"解析TXT记录":"创建验证文件")},{default:V((()=>[S("div",Hl,[l[16]||(l[16]=B(" 请按以下列表做TXT解析: ")),S("span",Rl,N(C(re)),1),A(D,null,{content:V((()=>[S("div",Jl,[(k(!0),L(I,null,j(C(ae),((e,t)=>(k(),L(I,null,[e.data.length?(k(),L("div",{key:t},[S("span",null,"验证域名："+N(e.domain),1),A(ee,{class:"my-[1rem]",column:C(te),data:e.data},null,8,["column","data"]),C(se)?(k(),L("div",Gl,[A(h,{type:"default",onClick:l=>(async e=>{const l=await me(),{data:t}=await oe({index:O.index,domain:e.domain});l._props.onCancel(),"valid"===t.status?r.success("验证成功"):!0===t.status?(R.value=!1,ke(t,!0)):pe(t,e.data,O)})(e)},{default:V((()=>l[14]||(l[14]=[B("验证")]))),_:2},1032,["onClick"])])):q("",!0)])):q("",!0)],64)))),256))])])),"footer-right":V((()=>[C(se)?q("",!0):(k(),U(h,{key:0,type:"default",onClick:de},{default:V((()=>l[15]||(l[15]=[B("验证")]))),_:1}))])),_:1}),A(z,{list:C(ie),listStyle:"disc",class:"ml-[20px]"},null,8,["list"])])])),_:1},8,["modelValue","title"])])}}}),zl={class:"p-[16px]"},Xl=g({__name:"index",setup(e){const l=le("sslCertificate"),t=h([{label:"商用SSL证书",name:"sslCertificate",render:()=>A(Tl,null,null)},{label:"宝塔证书",name:"testCertificate",render:()=>A(jl,null,null)},{label:"Let's Encrypt",name:"EncryptCertificate",render:()=>A(Wl,null,null)}]);return(e,a)=>{const s=y;return k(),L("div",zl,[A(s,{type:"card",modelValue:C(l),"onUpdate:modelValue":a[0]||(a[0]=e=>X(l)?l.value=e:null),options:C(t)},null,8,["modelValue","options"])])}}});export{Xl as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
