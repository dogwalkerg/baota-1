import{_ as e}from"./index101.js?v=1734676359";import{b as a}from"./utils-lib.js?v=1734676359";import{c as s,w as t,r as o,o as c,aB as l,k as m,l as n,e as r,p as i}from"./base-lib.js?v=1734676359";import{getLines as u}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const p={class:"flex-wrap"},g=s({__name:"log",props:{compData:{default:()=>({type:"scan",endMsg:"扫描结束",logPath:"",successMsg:"修复成功",isClear:!1,completeEvent:null,failMsg:""})}},emits:["close"],setup(s,{expose:g,emit:v}){const d=s,f=a();t((()=>d.compData),(e=>{x.value=!0,_()}));const D=v,M=o("获取中..."),x=o(!0),y=o(null),_=async()=>{try{const e=await u({num:20,filename:d.compData.logPath});if(M.value!==e.msg&&(M.value=e.msg),""!==d.compData.failMsg&&-1!==e.msg.indexOf(d.compData.failMsg))return x.value=!1,d.compData.completeEvent?(j(),void d.compData.completeEvent(!1,(()=>{D("close")}))):(f.error("失败"),void j());if(-1!==e.msg.indexOf(d.compData.endMsg))return x.value=!1,d.compData.completeEvent?(d.compData.completeEvent(!0,(()=>{D("close")})),void j()):("repair"===d.compData.type?(D("close"),f.msg({dangerouslyUseHTMLString:!0,message:"修复完成，请按 Ctrl+F5 刷新缓存，或等待2s自动刷新！",type:"success",duration:2e3}),setTimeout((()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()}),2e3)):"scan"===d.compData.type?f.success("扫描已结束"):(f.success(d.compData.successMsg),D("close")),void j());-1===e.msg.indexOf(d.compData.endMsg)&&x.value&&(y.value=setTimeout((function(){_()}),1500)),e.status||(f.request(e),x.value=!1)}catch(e){x.value&&_()}},j=()=>{y.value&&clearTimeout(y.value)};return c((()=>{_()})),l((()=>{j()})),g({onCancel:()=>{d.compData.isClear&&clearTimeout(y.value)}}),(a,s)=>{const t=e;return m(),n("div",p,[r(t,{class:"h-[40rem] !rounded-none",content:i(M)},null,8,["content"])])}}});export{g as default};
