import{c as e,r as a,R as l,w as t,o as r,k as u,J as o,x as m,e as n,q as s,p as d,z as p,y as i,v,h as y,a7 as h,a4 as w}from"./base-lib.js?v=1734676359";import{M as c,a4 as b,j as f}from"./utils-lib.js?v=1734676359";import{bb as V}from"./firewall.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const k={class:"flex"},_=e({__name:"repair-crontab",props:{compData:{default:()=>{}}},setup(e,{expose:_}){const x=e,j=a(null),g=a({type:"day",week:1,where1:1,hour:1,minute:19}),M=l([{label:"每天",value:"day"},{label:"N天",value:"day-n"},{label:"每星期",value:"week"},{label:"每月",value:"month"}]),U=l([{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:7}]);t((()=>x.compData),(e=>{E("day")}));const D={type:[{validator:(e,a,l)=>"day-n"!==a&&"month"!==a||!(g.value.where1<0||g.value.where1>31)?g.value.hour<0||g.value.hour>23?l(new Error("请输入正确小时范围[0-23]")):g.value.minute<0||g.value.minute>59?l(new Error("请输入正确分钟范围[0-59]")):void l():l(new Error("请输入正确天数范围[0-31]")),trigger:["blur","change"]}]},E=e=>{g.value.type=e;let a=Math.round(5*Math.random()),l=Math.round(59*Math.random());g.value.hour=a,g.value.minute=l,"day-n"===e?g.value.where1=3:"week"===e?g.value.week=1:g.value.where1=3},C=()=>{j.value.resetFields(),x.compData.refreshEvent()};return r((()=>{})),_({onConfirm:async e=>{await j.value.validate();let a=c.load("正在处理中，请稍后...");try{var l=y({id:x.compData.id,type:g.value.type,hour:g.value.hour,minute:g.value.minute});"day-n"!==g.value.type&&"month"!==g.value.type||(l.where1=g.value.where1),"week"===g.value.type&&(l.week=g.value.week);const a=await V({data:JSON.stringify(l)});c.request(a),C(),e()}catch(t){}finally{a.close()}},onCancel:C}),(e,a)=>{const l=b,t=f,r=h,y=w;return u(),o(y,{ref_key:"repairCronRef",ref:j,model:d(g),rules:D,class:"p-[2rem] addfrom","label-width":"5rem"},{default:m((()=>[n(r,{label:"检测频率",prop:"type"},{default:m((()=>[s("div",k,[n(l,{class:"!w-[8rem] mr-4",modelValue:d(g).type,"onUpdate:modelValue":a[0]||(a[0]=e=>d(g).type=e),options:d(M),change:E},null,8,["modelValue","options"]),"week"===d(g).type?(u(),o(l,{key:0,class:"!w-[8rem] mr-4",modelValue:d(g).week,"onUpdate:modelValue":a[1]||(a[1]=e=>d(g).week=e),options:d(U)},null,8,["modelValue","options"])):p("",!0),"day-n"===d(g).type||"month"===d(g).type?(u(),o(t,{key:1,type:"number",class:"mr-4",width:"12rem",min:"0",max:"31",modelValue:d(g).where1,"onUpdate:modelValue":a[2]||(a[2]=e=>d(g).where1=e)},{append:m((()=>[i(v("day-n"===d(g).type?"天":"日"),1)])),_:1},8,["modelValue"])):p("",!0),n(t,{type:"number",width:"12rem",class:"mr-4",min:"0",max:"23",modelValue:d(g).hour,"onUpdate:modelValue":a[3]||(a[3]=e=>d(g).hour=e)},{append:m((()=>a[5]||(a[5]=[i("小时")]))),_:1},8,["modelValue"]),n(t,{type:"number",width:"12rem",min:"0",max:"59",modelValue:d(g).minute,"onUpdate:modelValue":a[4]||(a[4]=e=>d(g).minute=e)},{append:m((()=>a[6]||(a[6]=[i("分")]))),_:1},8,["modelValue"])])])),_:1})])),_:1},8,["model"])}}});export{_ as default};
