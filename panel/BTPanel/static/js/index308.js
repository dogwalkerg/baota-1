import{_ as e}from"./index101.js?v=1734676359";import{aH as a,b as s}from"./utils-lib.js?v=1734676359";import{c as t,w as o,r as c,o as l,aB as n,k as m,l as r,e as i,p as u}from"./base-lib.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const p={class:"flex-wrap"},v=t({__name:"index",props:{compData:{default:()=>({type:"scan",endMsg:"扫描结束",logPath:"",successMsg:"修复成功",isClear:!1,completeEvent:null,failMsg:""})}},emits:["close","onCancel"],setup(t,{expose:v,emit:d}){const g=t,f=s();o((()=>g.compData),(e=>{x.value=!0,_()}));const D=d,M=c("获取中..."),x=c(!0),y=c(null),_=async()=>{try{const e=await a({num:20,filename:g.compData.logPath});if(M.value!==e.msg&&(M.value=e.msg),""!==g.compData.failMsg&&-1!==e.msg.indexOf(g.compData.failMsg))return x.value=!1,g.compData.completeEvent?(C(),void g.compData.completeEvent(!1,(()=>{D("close")}))):(f.error("失败"),void C());if(-1!==e.msg.indexOf(g.compData.endMsg))return x.value=!1,g.compData.completeEvent?(g.compData.completeEvent(!0,(()=>{D("close")})),void C()):("repair"===g.compData.type?(D("close"),f.msg({dangerouslyUseHTMLString:!0,message:"修复完成，请按 Ctrl+F5 刷新缓存，或等待2s自动刷新！",type:"success",duration:2e3}),setTimeout((()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()}),2e3)):"scan"===g.compData.type?f.success("扫描已结束"):(f.success(g.compData.successMsg),D("close")),void C());-1===e.msg.indexOf(g.compData.endMsg)&&x.value&&(y.value=setTimeout((function(){_()}),1500)),e.status||(f.request(e),x.value=!1)}catch(e){x.value&&_()}},C=()=>{y.value&&clearTimeout(y.value)},j=()=>{g.compData.isClear&&clearTimeout(y.value)};return D("onCancel",j),l((()=>{_()})),n((()=>{C()})),v({onCancel:j}),(a,s)=>{const t=e;return m(),r("div",p,[i(t,{class:"h-[40rem] !rounded-none",content:u(M)},null,8,["content"])])}}});export{v as default};
