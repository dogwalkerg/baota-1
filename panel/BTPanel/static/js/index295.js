import{c as e,h as a,r as t,ax as l,w as o,i as r,o as s,k as n,l as u,e as p,x as c,q as d,p as i,J as m,y as _,z as j,I as v,aX as f,M as h,C as w,D as b,A as g,a7 as y,aN as k,Q as V,ah as x,ae as D,ad as C,aw as U,a4 as E,ag as I,X as S,W as T,B as J,G as O}from"./base-lib.js?v=1734676359";import{bR as B,D as P,l as M,H as F,ah as X,o as K,j as R,_ as L,E as A,c as q,h as z,b as H,G as N,bS as W,U as G,M as Q}from"./utils-lib.js?v=1734676359";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang13.js?v=1734676359";import{_ as Z}from"./index88.js?v=1734676359";import{addLocalJdk as $,getCommand as ee,jarRestartJavaProject as ae,checkJavaParams as te,modifyJavaProject as le,addJavaProject as oe,advanceCheckPort as re,getJavaInfo as se}from"./site.js?v=1734676359";import{f as ne}from"./validator.js?v=1734676359";import{u as ue,S as pe}from"./useStore7.js?v=1734676359";import{i as ce,b as de,d as ie}from"./useController5.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const me={class:"flex items-center justify-between gap-1rem"},_e={class:"flex items-center justify-between"},je={class:"flex items-center"},ve={class:"flex items-center"},fe={class:"flex items-center custom-refresh-select"},he={class:"el-input-group__append !h-3rem !flex items-center"},we={class:"flex items-center"},be={class:"py-[1.6rem]"},ge=e({__name:"spring-boot",props:{projectData:{default:{}}},setup(e,{expose:S}){var T,J,O;const W=e,{siteInfo:G,isRefreshList:Q}=ue(),re=a(W.projectData),se=H(),pe=t({project_type:3,project_jar:"",project_name:"",port:"",project_jdk:(null==(T=W.projectData.jdk_info[0])?void 0:T.path)||"",project_cmd:"",nohup_log:!0,jmx_status:!1,run_user:"www",use_project_watch:!1,auth:!1,project_ps:"",domains:"",jmx_port:"",debug:!1,is_separation:!1,release_firewall:!1,host_url:"http://127.0.0.1",env:"",envPath:"/www",by_process:0,daemon_status:!1}),ie=t(0),ge=t(!1),ye=t(""),ke=t(!1),Ve=t(),xe=t(!1),De=a({project_jar:(null==(O=null==(J=G.value)?void 0:J.project_config)?void 0:O.project_jar)||""}),Ce=a({project_jar:[B({message:"请输入项目jar路径"})]}),Ue=l("getSystemInfoEvent",(e=>{}));o((()=>W.projectData.jdk_info.length),(()=>{var e;pe&&!ce.value&&(pe.value.project_jdk=null==(e=W.projectData.jdk_info[0])?void 0:e.path,pe.value.project_jdk&&pe.value.project_cmd&&Je(pe.value.project_jdk))}),{immediate:!0,deep:!0});const{BtForm:Ee,validate:Ie}=P({data:pe.value,options:e=>r((()=>[{type:"slots",key:"custom",rules:{project_jar:[B({message:"请输入项目jar路径"})],project_name:[B({message:"请输入项目名称"})],project_cmd:[B({message:"请输入项目执行命令"})]}}]))}),Se=()=>{M({isAsync:!0,title:"接管已启动项目",area:76,component:()=>F((()=>import("./take-over-started-project.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{setProject:Be}})},Te=e=>{pe.value.project_ps=e},Je=e=>{var a;if(pe.value.project_jdk=e,ce.value)-1===ye.value.indexOf("/bin/java")&&(ye.value=ye.value+"/bin/java"),pe.value.project_cmd=null==(a=pe.value.project_cmd)?void 0:a.replace(ye.value,e),ye.value=e;else if(pe.value.project_cmd){let e=pe.value.project_cmd.split("-Xmx1024M -Xms256M");pe.value.project_cmd=pe.value.project_jdk+" -jar -Xmx1024M -Xms256M "+e[1]}else pe.value.project_cmd=pe.value.project_jdk+" -jar  -Xmx1024M -Xms256M "+pe.value.project_jar},Oe=r((()=>ce.value&&""===pe.value.port?"未设置":"选择项目文件，自动获取端口")),Be=async e=>{if(!e.java_bin&&!e.jar_path)return se.error("未能解析到项目信息");if(pe.value.project_jar=e.jar_path,pe.value.port=e.port,pe.value.project_cmd=e.cmdline,pe.value.project_name=e.project_name,pe.value.run_user=e.user,!re.jdk_info.some((a=>a.path===e.java_bin))&&""!==e.java_bin){const a=e.java_bin.split("/");re.jdk_info.push({name:a[a.length-3],path:e.java_bin}),await $({data:JSON.stringify({jdk:e.java_bin})})}pe.value.project_jdk=e.java_bin||"",pe.value.by_process=e.pid,Me(e.env)},Pe=e=>{let a=e.split("\n").filter((e=>""!==e)),t=[];return a.forEach((e=>{let a=e.split("=");t.push({k:a[0],v:a[1]})})),t},Me=e=>{if(pe&&0!==e.length)switch(ie.value){case 0:pe.value.env=e.map((e=>e.k+"="+e.v)).join("\n"),ie.value=1;break;case 1:let a=Pe(pe.value.env);const t=new Map,l=[...a,...e].reduce(((e,a)=>{const l=a.k;return t.has(l)||(t.set(l,!0),e.push(a)),e}),[]);pe.value.env=null==l?void 0:l.map((e=>e.k+"="+e.v)).join("\n")}},Fe=()=>{ne({type:"file",path:pe.value.envPath,change:e=>{pe.value.envPath=e}})},Xe=()=>{if(!pe)return;if(ce.value)return;let e=pe.value.project_cmd.match(/--server.port=(\d+)/);e&&(pe.value.port=e[1])},Ke=async e=>{if(pe&&(1!==e||"/www/wwwroot"!==pe.value.project_jar))try{let a={type:e,project_name:pe.value.project_name,project_cmd:pe.value.project_cmd,project_jar:pe.value.project_jar,project_jdk:pe.value.project_jdk,jmx_status:pe.value.jmx_status?1:0,port:pe.value.port};const{data:t}=await ee(a);if(!t.status)return se.request(t);pe.value.project_cmd=t.data,pe.value.port=t.data.msg.match(/--server.port=(\d+)/)[1],pe.value.host_url="http://127.0.0.1:".concat(pe.value.port);let l="Dcom.sun.management.jmxremote.port";pe.value.jmx_port=t.data.msg.substr(t.data.msg.indexOf(l)+l.length+1,4)}catch(a){X(a)}},Re=()=>{pe&&ne({type:"file",path:pe.value.project_jar,change:e=>{var a;if(pe.value.project_jar=e,ce.value)pe.value.project_cmd&&(pe.value.project_cmd=null==(a=pe.value.project_cmd)?void 0:a.replace(pe.value.project_jar,e));else{let a=e.substring(e.lastIndexOf("/")+1).replace(/\W/g,"_");pe.value.project_name=a,pe.value.project_ps=a,pe.value.project_cmd=pe.value.project_jdk+" -jar  -Xmx1024M -Xms256M "+e}}})},Le=()=>{pe&&ne({type:"file",path:De.project_jar,change:e=>{De.project_jar=e}})},Ae=async()=>{await Ve.value.validate();const{name:e}=G.value;await K({title:"更新项目",content:"将要重启项目【".concat(e,"】，是否继续？")});const a={project_name:e,project_jar:De.project_jar};try{const e=await ae(a);se.msg({dangerouslyUseHTMLString:!0,message:e.msg,type:e.status?"success":"error",duration:e.status?2e3:0,showClose:!e.status}),e.status&&(Q.value=!0,ge.value=!1)}catch(t){X(t)}};let qe=null;const ze=async()=>(await Ie(),(async e=>{try{let a=pe.value.env;1===ie.value&&(a=Pe(a));let t={project_jar:pe.value.project_jar,project_cmd:pe.value.project_cmd,by_process:pe.value.by_process,env_file:2===ie.value?pe.value.envPath:"",env_list:JSON.stringify(1===ie.value?a:[])};const l=await te(t);if(!(l.status&&l.data.length>0))return e();qe=await M({isAsync:!0,title:"项目帮助",area:76,component:()=>F((()=>import("./springboot-check-list.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{data:l.data,params:t,confirmEvent:e},btn:"继续创建",onConfirm:e,cancel:()=>{qe=null}})}catch(a){X(a)}})((async()=>{if(qe){const e=await qe;null==e||e.unmount(),qe=null}return(async(e,a)=>{await a();let t=e.env;1===ie.value&&(t=Pe(t));let l={project_type:0,domains:e.domains.split("\n"),project_jar:e.project_jar,project_jdk:e.project_jdk,project_name:e.project_name,project_cmd:e.project_cmd,project_ps:e.project_ps,run_user:e.run_user,env_file:2===ie.value?e.envPath:"",env_list:1===ie.value?t:[],jmx_status:e.jmx_status,watch_file:e.use_project_watch,ps:e.project_ps,port:e.port};ce.value?(l.daemon_status=e.daemon_status,l.project_id=G.value.id):(l.by_process=e.by_process,l.release_firewall=e.release_firewall);const o=ce.value?le:oe,r=await N({loading:"正在操作，请稍后...",request:o({data:JSON.stringify(l)}),message:!0});return r.status&&(Q.value=!0),r.status})(pe.value,Ie)})));return s((()=>{if(ce.value){const{ps:e,project_config:a}=G.value,{project_jar:t,project_jdk:l,run_user:o,project_cmd:r,jmx_status:s,java_type:n,watch_file:u,env_file:p,env_list:c}=a;ye.value=l,ie.value=(null==c?void 0:c.length)?1:p?2:0;const d="springboot"===n&&(e=>{try{const a=/--server\.port=(\d+)/,t=e.match(a);return!!t&&t[1]}catch(a){}})(r);Object.assign(pe.value,{project_ps:e,use_project_watch:u,project_jar:t,project_jdk:-1===(null==l?void 0:l.indexOf("/bin/java"))?l+"/bin/java":l,project_name:a.project_name,project_cmd:r,run_user:o,env_file:p,env_list:c,proxy_path:a.proxy_path,jmx_status:s,watch_file:u,domains:a.domains.join("\n"),daemon_status:a.daemon_status,envPath:p,env:null==c?void 0:c.map((e=>e.k+"="+e.v)).join("\n"),port:(null==a?void 0:a.port)||d||""})}})),S({onConfirm:ze}),(e,a)=>{const t=Z,l=g,o=y,r=R,s=k,S=V,T=I,J=x,O=L,B=A,P=q,M=D,F=C,X=U,K=Y,H=E,N=z;return n(),u("div",null,[p(i(Ee),{class:"mt-2rem","label-width":"100px"},{custom:c((()=>[p(o,{label:"jar路径",prop:"project_jar"},{default:c((()=>[d("div",me,[p(t,{modelValue:i(pe).project_jar,"onUpdate:modelValue":a[0]||(a[0]=e=>i(pe).project_jar=e),icon:"el-folder-opened",onIconClick:Re,width:"32rem"},null,8,["modelValue"]),i(ce)?(n(),m(l,{key:1,type:"default",onClick:a[1]||(a[1]=e=>ge.value=!0)},{default:c((()=>a[25]||(a[25]=[_("项目更新")]))),_:1})):(n(),m(l,{key:0,type:"default",onClick:Se},{default:c((()=>a[24]||(a[24]=[_("从已启动项目中接管")]))),_:1}))])])),_:1}),i(ce)?j("",!0):(n(),m(o,{key:0,label:"项目名称",prop:"project_name"},{default:c((()=>[d("div",_e,[p(r,{onChange:Te,width:"32rem",modelValue:i(pe).project_name,"onUpdate:modelValue":a[2]||(a[2]=e=>i(pe).project_name=e),placeholder:"选择项目文件，自动获取名称"},null,8,["modelValue"])])])),_:1})),p(o,{label:"项目端口",prop:"port"},{default:c((()=>[d("div",je,[p(r,{onChange:a[3]||(a[3]=e=>Ke(1)),width:"20rem",class:"mr-[1rem]",modelValue:i(pe).port,"onUpdate:modelValue":a[4]||(a[4]=e=>i(pe).port=e),placeholder:i(Oe)},null,8,["modelValue","placeholder"]),i(ce)?j("",!0):(n(),m(S,{key:0,modelValue:i(pe).release_firewall,"onUpdate:modelValue":a[5]||(a[5]=e=>i(pe).release_firewall=e)},{default:c((()=>[a[27]||(a[27]=_(" 放行端口 ")),p(s,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:c((()=>a[26]||(a[26]=[d("i",{class:"svgtofont-el-question text-warning"},null,-1)]))),_:1})])),_:1},8,["modelValue"]))])])),_:1}),p(o,{label:"项目JDK",prop:"project_jdk"},{default:c((()=>[d("div",ve,[d("div",fe,[p(J,{modelValue:i(pe).project_jdk,"onUpdate:modelValue":a[6]||(a[6]=e=>i(pe).project_jdk=e),onChange:Je,class:"!w-[32rem]",disabled:!i(re).jdk_info},{default:c((()=>[(n(!0),u(v,null,f(i(re).jdk_info,((e,a)=>(n(),m(T,{key:a,value:e.path,label:e.name+"["+e.path+"]"},null,8,["value","label"])))),128))])),_:1},8,["modelValue","disabled"]),d("div",he,[p(B,{title:"刷新项目JDK",class:"!flex",onClick:a[7]||(a[7]=e=>i(Ue)("项目JDK"))},{default:c((()=>[p(O,{icon:"el-refresh",class:"!text-[14px]"})])),_:1})])]),p(P,{class:"ml-8px",onClick:a[8]||(a[8]=e=>i(de)())},{default:c((()=>a[28]||(a[28]=[_("添加JDK信息")]))),_:1})])])),_:1}),p(o,{label:"项目启动命令",prop:"project_cmd"},{default:c((()=>[p(r,{onBlur:Xe,width:"40rem",type:"textarea",rows:4,resize:"none",modelValue:i(pe).project_cmd,"onUpdate:modelValue":a[9]||(a[9]=e=>i(pe).project_cmd=e),placeholder:"选择项目jar文件，自动获取项目执行命令"},null,8,["modelValue"])])),_:1}),p(o,{label:"启动用户"},{default:c((()=>[d("div",we,[p(J,{modelValue:i(pe).run_user,"onUpdate:modelValue":a[10]||(a[10]=e=>i(pe).run_user=e),class:"mr-8px !w-[16rem]"},{default:c((()=>[(n(!0),u(v,null,f(i(re).userList,(e=>(n(),m(T,{key:e,value:e,label:e},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),a[29]||(a[29]=d("span",{class:"text-[1.2rem] text-[#666]"},"* 无特殊需求请选择www用户",-1))])])),_:1}),p(o,{label:"环境变量"},{default:c((()=>[p(F,{modelValue:i(ie),"onUpdate:modelValue":a[11]||(a[11]=e=>h(ie)?ie.value=e:null)},{default:c((()=>[p(M,{label:0},{default:c((()=>a[30]||(a[30]=[_("无")]))),_:1}),p(M,{label:1},{default:c((()=>a[31]||(a[31]=[_("指定变量")]))),_:1}),p(M,{label:2},{default:c((()=>a[32]||(a[32]=[_("从文件加载")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),w(p(o,{label:" "},{default:c((()=>[w(p(r,{width:"40rem",type:"textarea",rows:4,resize:"none",modelValue:i(pe).env,"onUpdate:modelValue":a[12]||(a[12]=e=>i(pe).env=e),placeholder:"环境变量，1行1个，例如： JAVA_HOME=/usr/local/btjdk/jdk8"},null,8,["modelValue"]),[[b,1===i(ie)]]),w(p(t,{width:"40rem",modelValue:i(pe).envPath,"onUpdate:modelValue":a[13]||(a[13]=e=>i(pe).envPath=e),placeholder:"请选择环境变量文件",icon:"el-folder-opened",onIconClick:Fe},null,8,["modelValue"]),[[b,2===i(ie)]])])),_:1},512),[[b,0!==i(ie)]]),i(ce)?j("",!0):(n(),m(o,{key:1,label:"项目备注"},{default:c((()=>[p(r,{width:"32rem",modelValue:i(pe).project_ps,"onUpdate:modelValue":a[14]||(a[14]=e=>i(pe).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])])),_:1})),p(o,{label:"守护进程"},{default:c((()=>[p(S,{modelValue:i(pe).daemon_status,"onUpdate:modelValue":a[15]||(a[15]=e=>i(pe).daemon_status=e)},{default:c((()=>a[33]||(a[33]=[_(" 项目意外停止时自动重启 ")]))),_:1},8,["modelValue"])])),_:1}),p(K,{isShowDivider:!i(ce)},{config:c((()=>[i(ce)?j("",!0):(n(),m(o,{key:0,label:"绑定域名"},{default:c((()=>[p(X,{placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:i(ke),"onUpdate:visible":a[18]||(a[18]=e=>h(ke)?ke.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:c((()=>[p(r,{rows:4,resize:"none",width:"40rem",modelValue:i(pe).domains,"onUpdate:modelValue":a[16]||(a[16]=e=>i(pe).domains=e),type:"textarea",onFocus:a[17]||(a[17]=e=>ke.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])])),default:c((()=>[a[34]||(a[34]=d("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[_("如果需要绑定外网，请输入需要绑定的域名，该选项可为空"),d("br"),_("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),d("br"),_("泛解析添加方法 *.domain.com"),d("br"),_("如另加端口格式为 www.domain.com:88")],-1))])),_:1},8,["visible"])])),_:1})),p(o,{label:"监听重启"},{default:c((()=>[p(S,{modelValue:i(pe).use_project_watch,"onUpdate:modelValue":a[19]||(a[19]=e=>i(pe).use_project_watch=e)},{default:c((()=>a[35]||(a[35]=[_("是否设置监听文件发生变化时重启")]))),_:1},8,["modelValue"])])),_:1}),p(o,{label:"jmx监控"},{default:c((()=>[p(S,{modelValue:i(pe).jmx_status,"onUpdate:modelValue":a[20]||(a[20]=e=>i(pe).jmx_status=e),onChange:a[21]||(a[21]=e=>Ke(4)),disabled:!i(pe).project_cmd},{default:c((()=>a[36]||(a[36]=[_(" 设置jmx后可在性能监控中查询项目性能信息 ")]))),_:1},8,["modelValue","disabled"])])),_:1})])),_:1},8,["isShowDivider"]),i(ce)?(n(),m(o,{key:2,label:" "},{default:c((()=>[p(l,{type:"primary",onClick:ze},{default:c((()=>a[37]||(a[37]=[_("保存当前配置")]))),_:1})])),_:1})):j("",!0)])),_:1}),p(N,{modelValue:i(ge),"onUpdate:modelValue":a[23]||(a[23]=e=>h(ge)?ge.value=e:null),area:50,showFooter:"",onConfirm:Ae,title:"项目更新"},{default:c((()=>[d("div",be,[p(H,{ref_key:"javaFormRef",ref:Ve,model:i(De),disabled:i(xe),"label-width":"9rem",rules:i(Ce)},{default:c((()=>[p(o,{label:"jar包路径",prop:"project_jar"},{default:c((()=>[p(t,{modelValue:i(De).project_jar,"onUpdate:modelValue":a[22]||(a[22]=e=>i(De).project_jar=e),icon:"el-folder-opened",onIconClick:Le,width:"32rem"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","disabled","rules"])])])),_:1},8,["modelValue"])])}}}),ye={class:"flex items-center"},ke=e({__name:"builtin-project",props:{projectData:{default:{}},editForm:{}},setup(e,{expose:a}){var l,r;const h=e,{siteInfo:w}=ue(),b=t({project_type:1,project_path:"/www/wwwroot/",tomcat_version:(null==(r=null==(l=null==h?void 0:h.projectData)?void 0:l.tomcat_list[0])?void 0:r.version)||"",project_ps:"",domain:"",use_project_watch:!1,run_user:"www"}),k=e=>{b.value.project_ps=e,b.value.project_path="/www/wwwroot/".concat(e)},V=()=>{ne({type:"all",path:b.value.project_path,change:e=>{b.value.project_path=e;let a=e.substring(e.lastIndexOf("/")+1).replace(/\W/g,"_");b.value.domain||(b.value.domain=a),b.value.project_ps=a}})};o((()=>h.projectData.tomcat_list.length),(()=>{var e;b&&!ce.value&&(b.value.tomcat_version=null==(e=h.projectData.tomcat_list[0])?void 0:e.version)}),{immediate:!0,deep:!0});const{BtForm:D,submit:C}=P({data:b.value,options:[{type:"slots",key:"custom",rules:{domain:[B({message:"请输入项目域名"})],project_path:[B({message:"请输入项目路径"})],tomcat_version:[B({message:"请选择tomcat版本",trigger:"change"})]}}],submit:async(e,a)=>{await a();let t={...e.value};return ce.value&&(t.project_jar="",t.project_cmd="",t.project_jdk="",delete t.jmx_info,t.log_conf,delete t.logs,t.scripts),ie(t)}});return s((()=>{if(ce.value){const{project_config:e,ps:a,use_project_watch:t,path:l}=w.value;Object.assign(b.value,{...e,domain:e.project_name,project_path:l,is_separation:1===e.is_separation,project_ps:a,debug:0,use_project_watch:t,run_user:"www",release_firewall:!1,project_type:1,jmx_status:!1})}})),a({onConfirm:C}),(e,a)=>{const t=R,l=y,o=Z,r=I,s=x,h=q,w=g;return n(),u("div",null,[p(i(D),{"label-width":"100px",class:"mt-2rem"},{custom:c((()=>[p(l,{label:"项目域名",prop:"domain"},{default:c((()=>[p(t,{disabled:i(ce),onInput:k,width:"32rem",modelValue:i(b).domain,"onUpdate:modelValue":a[0]||(a[0]=e=>i(b).domain=e),placeholder:"请输入项目域名"},null,8,["disabled","modelValue"])])),_:1}),p(l,{label:"项目路径",prop:"project_path"},{default:c((()=>[p(o,{modelValue:i(b).project_path,"onUpdate:modelValue":a[1]||(a[1]=e=>i(b).project_path=e),icon:"el-folder-opened",onIconClick:V,width:"32rem"},null,8,["modelValue"])])),_:1}),p(l,{label:"Tomcat版本",prop:"tomcat_version"},{default:c((()=>[d("div",ye,[p(s,{modelValue:i(b).tomcat_version,"onUpdate:modelValue":a[2]||(a[2]=e=>i(b).tomcat_version=e),class:"mr-8px !w-[16rem]",disabled:!e.projectData.tomcat_list.length||i(ce)},{default:c((()=>[(n(!0),u(v,null,f(e.projectData.tomcat_list,((e,a)=>(n(),m(r,{key:a,value:e.version,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","disabled"]),i(ce)?j("",!0):(n(),m(h,{key:0,onClick:a[3]||(a[3]=e=>i(de)("tomcatSettings"))},{default:c((()=>a[5]||(a[5]=[_("安装Tomcat其他版本")]))),_:1}))])])),_:1}),p(l,{label:"项目备注"},{default:c((()=>[p(t,{width:"32rem",modelValue:i(b).project_ps,"onUpdate:modelValue":a[4]||(a[4]=e=>i(b).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])])),_:1}),i(ce)?(n(),m(l,{key:0,label:" "},{default:c((()=>[p(w,{type:"primary",onClick:i(C)},{default:c((()=>a[6]||(a[6]=[_("保存当前配置")]))),_:1},8,["onClick"])])),_:1})):j("",!0)])),_:1})])}}}),Ve={class:"flex items-center"},xe={class:"flex items-center"},De={class:"flex items-center"},Ce={class:"flex items-center custom-refresh-select"},Ue={class:"el-input-group__append !h-3rem !flex items-center"},Ee=e({__name:"independent-project",props:{projectData:{default:{}},editForm:{}},setup(e,{expose:a}){var h,w,b,D;const C=e,U=H(),{siteInfo:E}=ue();let T=!1;const J=t({project_path:"/www/wwwroot",project_jdk:(null==(w=null==(h=null==C?void 0:C.projectData)?void 0:h.jdk_info[0])?void 0:w.path)||"",use_project_watch:!1,project_ps:"",domain:"",release_firewall:!1,tomcat_version:(null==(D=null==(b=null==C?void 0:C.projectData)?void 0:b.tomcat_list[0])?void 0:D.version)||"",port:"",run_user:"www",auth:!1}),O=l("getSystemInfoEvent",(e=>{})),M=e=>{ce.value||(J.value.project_ps=e,J.value.project_path="/www/wwwroot/".concat(e))},F=()=>{ne({type:"dir",path:J.value.project_path,change:e=>{var a;J.value.project_path=e;let t=null==(a=e.substring(e.lastIndexOf("/")+1))?void 0:a.replace(/\./g,"_");J.value.domain||(J.value.domain=t),J.value.project_ps=t}})},X=()=>{T=!0},z=async()=>{if(J.value.port)try{const e=await re({port:J.value.port},"java");e.status||(U.request(e),J.value.port="")}catch(e){}};o((()=>C.projectData.tomcat_list.length),(()=>{var e;J&&!ce.value&&(J.value.tomcat_version=null==(e=C.projectData.tomcat_list[0])?void 0:e.version)}),{immediate:!0,deep:!0}),o((()=>C.projectData.jdk_info.length),(()=>{var e;J&&!ce.value&&(J.value.project_jdk=null==(e=C.projectData.jdk_info[0])?void 0:e.path)}),{immediate:!0,deep:!0});const{BtForm:N,submit:G}=P({data:J.value,options:()=>r((()=>[{type:"slots",key:"custom",rules:{domain:[B({message:"请输入项目域名"})],project_path:[B({message:"请输入项目路径"})],tomcat_version:[B({message:"请选择tomcat版本",trigger:"change"})],port:[B({message:"请输入端口号",trigger:"blur"}),W()],project_jdk:[B({message:"请输入项目JDK"})]}}])),submit:async(e,a)=>{await a();let t={...e.value,project_type:2};return ce.value&&(T&&await K({title:"提示",width:"35rem",icon:"warning-filled",content:"更改后会重启Tomcat，是否继续？"}),T=!1,t.project_jar="",t.debug=e.value.debug?1:0,delete t.jmx_info,t.log_conf,delete t.logs,t.scripts),ie(t)}});return s((()=>{if(ce.value){const{project_config:e,ps:a,use_project_watch:t,path:l}=E.value;Object.assign(J.value,{...e,domain:e.project_name,project_path:l,project_jdk:e.project_jdk+"/bin/java",run_user:e.run_user,is_separation:1===e.is_separation,debug:0,use_project_watch:t,release_firewall:!1,project_ps:a,host_url:"http://127.0.0.1:"+e.port,jmx_status:!1})}})),a({onConfirm:G}),(e,a)=>{const t=R,l=y,o=L,r=A,s=I,h=x,w=q,b=k,D=V,C=g;return n(),u("div",null,[p(i(N),{"label-width":"100px",class:"mt-[2rem]"},{custom:c((()=>[p(l,{label:"项目域名",prop:"domain"},{default:c((()=>[p(t,{disabled:i(ce),width:"36rem",onInput:M,modelValue:i(J).domain,"onUpdate:modelValue":a[0]||(a[0]=e=>i(J).domain=e),placeholder:"请输入项目域名"},null,8,["disabled","modelValue"])])),_:1}),p(l,{label:"项目路径",prop:"project_path"},{default:c((()=>[p(t,{width:"36rem",disabled:i(ce),modelValue:i(J).project_path,"onUpdate:modelValue":a[1]||(a[1]=e=>i(J).project_path=e)},S({_:2},[i(ce)?void 0:{name:"append",fn:c((()=>[p(r,{onClick:F},{default:c((()=>[p(o,{icon:"el-folder-opened",class:"cursor-pointer"})])),_:1})])),key:"0"}]),1032,["disabled","modelValue"])])),_:1}),p(l,{label:"Tomcat版本",prop:"tomcat_version"},{default:c((()=>[d("div",Ve,[p(h,{modelValue:i(J).tomcat_version,"onUpdate:modelValue":a[2]||(a[2]=e=>i(J).tomcat_version=e),class:"mr-[8px] !w-[20rem]",disabled:i(ce)},{default:c((()=>[(n(!0),u(v,null,f(e.projectData.tomcat_list,((e,a)=>(n(),m(s,{key:a,value:e.version,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue","disabled"]),i(ce)?j("",!0):(n(),m(w,{key:0,onClick:a[3]||(a[3]=e=>i(de)("tomcatSettings"))},{default:c((()=>a[12]||(a[12]=[_("安装Tomcat其他版本")]))),_:1}))])])),_:1}),p(l,{label:"项目端口",prop:"port"},{default:c((()=>[d("div",xe,[p(t,{width:"20rem",type:"number",onBlur:z,onChange:X,class:"mr-[12px]",modelValue:i(J).port,"onUpdate:modelValue":a[4]||(a[4]=e=>i(J).port=e),placeholder:"选择项目文件，自动获取端口"},null,8,["modelValue"]),i(ce)?j("",!0):(n(),m(D,{key:0,modelValue:i(J).release_firewall,"onUpdate:modelValue":a[5]||(a[5]=e=>i(J).release_firewall=e)},{default:c((()=>[a[14]||(a[14]=_(" 放行端口 ")),p(b,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:c((()=>a[13]||(a[13]=[d("i",{class:"svgtofont-el-question-filled text-warning"},null,-1)]))),_:1})])),_:1},8,["modelValue"]))])])),_:1}),p(l,{label:"项目用户"},{default:c((()=>[d("div",De,[p(h,{modelValue:i(J).run_user,"onUpdate:modelValue":a[6]||(a[6]=e=>i(J).run_user=e),class:"mr-[8px] !w-[20rem]",onChange:X},{default:c((()=>[(n(!0),u(v,null,f(e.projectData.userList,(e=>(n(),m(s,{key:e,value:e,label:e},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),a[15]||(a[15]=d("span",{class:"text-[1.2rem] text-[#666]"},"* 无特殊需求请选择www用户",-1))])])),_:1}),p(l,{label:"项目JDK",prop:"project_jdk"},{default:c((()=>[d("div",Ce,[p(h,{modelValue:i(J).project_jdk,"onUpdate:modelValue":a[7]||(a[7]=e=>i(J).project_jdk=e),class:"!w-[36rem]",onChange:X},{default:c((()=>[(n(!0),u(v,null,f(e.projectData.jdk_info,((e,a)=>(n(),m(s,{key:a,value:e.path,label:e.name+"["+e.path+"]"},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),d("div",Ue,[p(r,{title:"刷新项目JDK",class:"!flex",onClick:a[8]||(a[8]=e=>i(O)("项目JDK"))},{default:c((()=>[p(o,{icon:"el-refresh",class:"!text-[14px]"})])),_:1})])]),p(w,{class:"ml-8px",onClick:a[9]||(a[9]=e=>i(de)())},{default:c((()=>a[16]||(a[16]=[_("添加JDK信息")]))),_:1})])),_:1}),p(l,{label:"开机启动"},{default:c((()=>[p(D,{modelValue:i(J).auth,"onUpdate:modelValue":a[10]||(a[10]=e=>i(J).auth=e)},{default:c((()=>a[17]||(a[17]=[_("是否设置开机自动启动（默认自带守护进程每120秒检测一次）")]))),_:1},8,["modelValue"])])),_:1}),p(l,{label:"项目备注"},{default:c((()=>[p(t,{width:"36rem",modelValue:i(J).project_ps,"onUpdate:modelValue":a[11]||(a[11]=e=>i(J).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])])),_:1}),i(ce)?(n(),m(l,{key:0,label:" "},{default:c((()=>[p(C,{type:"primary",onClick:i(G)},{default:c((()=>a[18]||(a[18]=[_("保存当前配置")]))),_:1},8,["onClick"])])),_:1})):j("",!0)])),_:1})])}}}),Ie={class:"flex items-center"},Se={class:"flex items-center ml-[12px]"},Te=e({__name:"index",props:{compData:{default:()=>({isEdit:!1})}},setup(e,{expose:l}){const{siteInfo:o}=ue(),{getRootUser:r}=pe(),j=t(),v=t(),f=t(),h=a({userList:[],jdk_info:[],tomcat_list:[]}),g=a({radioType:"SpringBoot"}),k=t(!1),V=async(e="")=>{var a,t;try{const l=await se();h.jdk_info=null==(a=l.data.jdk_info)?void 0:a.filter((e=>0!==e.operation)),h.tomcat_list=[],null==(t=l.data.tomcat_status)||t.forEach((e=>{e.status&&h.tomcat_list.push({name:"tomcat"+e.version,version:e.version,...e})})),e&&Q.success("".concat(e,"，刷新成功"))}catch(l){}};T("getSystemInfoEvent",V);const x=async()=>{var e,a;k.value=!0;const{data:t}=await r();h.userList=t,await V(),k.value=!1,ce.value&&(g.radioType="springboot"===(null==(e=o.value.project_config)?void 0:e.java_type)?"SpringBoot":"duli"===(null==(a=o.value.project_config)?void 0:a.java_type)?"独立项目":"内置项目")};return s(x),l({init:x,onConfirm:async e=>{let a="SpringBoot"===g.radioType?j.value:"内置项目"===g.radioType?v.value:f.value;await a.onConfirm(e)&&e&&e()}}),(e,a)=>{const t=G,l=q,o=y,r=E,s=J("bt-loading");return n(),u("div",{class:"overflow-auto p-2rem",style:O("".concat(i(ce)?"":"max-height: 63rem;"))},[w((n(),m(r,{model:i(g),"label-width":"100px"},{default:c((()=>[p(o,{label:"项目类型"},{default:c((()=>[d("div",Ie,[p(t,{modelValue:i(g).radioType,"onUpdate:modelValue":a[0]||(a[0]=e=>i(g).radioType=e),type:"button",options:[{label:"SpringBoot",value:"SpringBoot"},{label:"内置项目",value:"内置项目"},{label:"独立项目",value:"独立项目"}],disabled:i(ce)},null,8,["modelValue","disabled"]),d("div",Se,[p(l,{href:"https://www.bt.cn/bbs/thread-76217-1-1.html"},{default:c((()=>a[1]||(a[1]=[_("Java项目教程")]))),_:1}),a[2]||(a[2]=d("i",{class:"svgtofont-el-link text-primary text-[1.6rem] ml-[4px]"},null,-1))])])])),_:1}),w(p(ge,{ref_key:"SpringBootFormRef",ref:j,isEdit:e.compData.isEdit,onCloseEvent:e.compData.closeEvent,projectData:i(h)},null,8,["isEdit","onCloseEvent","projectData"]),[[b,"SpringBoot"==i(g).radioType]]),w(p(ke,{ref_key:"BuiltinProjectFormRef",ref:v,isEdit:e.compData.isEdit,projectData:i(h)},null,8,["isEdit","projectData"]),[[b,"内置项目"==i(g).radioType]]),w(p(Ee,{ref_key:"IndependentProjectRef",ref:f,isEdit:e.compData.isEdit,projectData:i(h)},null,8,["isEdit","projectData"]),[[b,"独立项目"==i(g).radioType]])])),_:1},8,["model"])),[[s,i(k)]])],4)}}});export{Te as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
