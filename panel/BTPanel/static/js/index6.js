import{u as e,T as a,l as t,H as l,G as s,K as n,o,U as i,F as r,k as c,V as u,c as d,e as m,W as p,M as w,S as v,X as f}from"./utils-lib.js?v=1734676359";import{c as h,r as _,h as y,az as b,aN as g,e as k,o as x,B as j,k as C,l as V,x as A,y as L,p as I,q as S,C as T,A as q,F as H,v as M,t as R,z as U,i as z,I as D,w as E,J as W,a2 as F}from"./base-lib.js?v=1734676359";import{_ as O}from"./index90.js?v=1734676359";import{a as P,b as B,u as N,c as G}from"./column.js?v=1734676359";import{p as J,T as K,U as X}from"./config.js?v=1734676359";import{s as Q}from"./validator.js?v=1734676359";import{g as Y}from"./useStore.js?v=1734676359";import{a as Z}from"./useMethod.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const $={style:{"overflow-y":"hidden"}},ee=h({__name:"index",setup(d,{expose:m}){const{mainHeight:p,push:w,getSenderAlarmListInfo:v}=e(),f=_(),h=_(!1),H=_([]),M=y({p:1,rows:10,status:"",keyword:""}),R=new Map([["wx_account","微信公众号"],["feishu","飞书"],["mail","邮箱"],["sms","短信通知"],["dingding","钉钉"],["weixin","企业微信"],["webhook","自定义消息通道"]]),U=e=>{const s=!a(e);t({title:"".concat(s?"编辑":"添加","告警任务"),component:()=>l((()=>import("./index98.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),area:80,showFooter:!0,compData:{isEdit:s,row:e,onRefresh:z}})},z=async()=>{await s({loading:h,request:n({...M}),success:({data:e})=>{D(e.data)}})},D=e=>{H.value=null==e?void 0:e.map((e=>{const{sender:a}=e;return{...e,alarmAccounts:a.map((e=>{const a=w.value.config.find((a=>a.id===e));return a?"sms"===a.sender_type?{id:e,type:a.sender_type,title:"短信"}:{id:e,type:a.sender_type,title:R.get(a.sender_type)||"",account:a.data.title}:null}))}}))},E=async(e,a,t,l)=>{const s=async(e,a)=>{const{id:t,status:l}=e,s=new Map([["delete",K],["start",J],["stop",J]]).get(o);switch(o){case"start":if(s)return await s({task_id:t,status:1});break;case"stop":if(s)return await s({task_id:t,status:0});break;case"delete":if(s)return await s({task_id:t})}},{label:n,value:o}=l;await e({title:"批量".concat(n,"告警"),content:"即将批量".concat(n,"告警，是否继续操作?"),column:[{label:"告警名称",prop:"title"},G()],onConfirm:async()=>(await a(s),z(),!1)})},W=[P(),{prop:"title",label:"标题",minWidth:140},B({minWidth:100,event:async e=>{await o({title:"".concat(e.status?"禁用":"启用","【").concat(e.title,"】任务"),content:"您真的要".concat(e.status?"禁用":"启用","【").concat(e.title,"】这个任务吗？")}),await s({loading:"正在修改告警任务状态，请稍候...",request:J({task_id:e.id,status:Number(!e.status)}),message:!0,success:z})},data:["停用","正常"]}),{label:"告警方式",width:140,render:e=>b(g,{content:e.alarmAccounts.filter((e=>null!==e)).map((e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat((null==e?void 0:e.account)||"","(").concat((null==e?void 0:e.title)||"",")"))).join(","),placement:"top",openDelay:500},[b("span",[e.alarmAccounts.filter((e=>null!==e)).map((e=>"sms"===(null==e?void 0:e.type)?"短信通知":"".concat(null==e?void 0:e.account,"(").concat(e.title,")"))).join(",")])])},{label:"告警条件",minWidth:180,render:e=>k("span",{innerHTML:e.view_msg},null)},N([{title:"告警记录",width:70,onClick:e=>{t({title:"【".concat(e.title,"】告警记录"),component:()=>l((()=>import("./record.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),area:80,compData:e})}},{title:"编辑",onClick:e=>U(e)},{title:"删除",onClick:async e=>{await o({icon:"warning-filled",title:"删除告警任务",content:"删除后将不再告警此条任务，是否继续？"}),await s({loading:"正在删除告警任务，请稍候...",request:K({task_id:e.id}),message:!0,success:z})}}])],F=[{label:"启动",value:"start",event:E},{label:"停止",value:"stop",event:E},{label:"删除",value:"delete",event:E}],X=async()=>{await v(),await z()};return x(X),m({init:X}),(e,a)=>{const t=q,l=i,s=r,n=c,o=u,d=O,m=j("bt-loading");return C(),V("div",$,[k(d,null,{"header-left":A((()=>[k(t,{type:"primary",onClick:a[0]||(a[0]=e=>U(!1))},{default:A((()=>a[3]||(a[3]=[L("添加任务")]))),_:1})])),"header-right":A((()=>[k(l,{type:"button",modelValue:I(M).status,"onUpdate:modelValue":a[1]||(a[1]=e=>I(M).status=e),options:[{label:"全部",value:""},{label:"运行中",value:!0},{label:"已停止",value:!1}],onChange:z,class:"mr-[1rem]"},null,8,["modelValue"]),S("div",null,[k(s,{modelValue:I(M).keyword,"onUpdate:modelValue":a[2]||(a[2]=e=>I(M).keyword=e),onSearch:z,placeholder:"请输入搜索关键词",class:"!w-24rem"},null,8,["modelValue"])])])),content:A((()=>[T(k(n,{ref_key:"alarmListRef",ref:f,data:I(H),column:W,"max-height":I(p)-540,description:"告警列表为空"},null,8,["data","max-height"]),[[m,I(h)],[m,"正在加载告警列表，请稍后...","title"]])])),"footer-left":A((()=>[k(o,{"table-ref":I(f),options:F},null,8,["table-ref"])])),_:1})])}}}),ae={class:"flex items-center"},te={class:"flex-1 leading-[1.5]"},le={class:"flex"},se=m(h({__name:"module-name",props:{row:{}},setup:e=>(e,a)=>{const t=d;return C(),V("div",ae,[S("div",{class:H(["icon",e.row.ps.indexOf("API")>-1?"webhook":e.row.name])},null,2),S("div",te,[S("span",{class:"text-14px font-bold cursor-pointer",onClick:a[0]||(a[0]=a=>{e.row})},M(e.row.title),1),S("div",le,[S("span",null,M(e.row.ps),1),k(t,{href:e.row.help,target:"_blank"},{default:A((()=>a[1]||(a[1]=[L(">>帮助文档")]))),_:1},8,["href"])])])])}}),[["__scopeId","data-v-559d10f9"]]),ne={key:1,class:"c7"},oe={key:1},ie=h({__name:"module-content",props:{row:{}},setup(a){const{getSenderAlarmListInfo:t}=e(),l=a,{row:s}=R(l);return(e,a)=>{return C(),V("div",null,[0===I(s).list.length?(C(),V("span",{key:0,class:"text-danger cursor-pointer",onClick:a[0]||(a[0]=e=>I(Q)(I(s)))},"未配置")):I(s).list.length>0?(C(),V("span",ne,["sms"!==I(s).name?(C(),V("span",{key:0,class:"cursor-pointer",onClick:a[1]||(a[1]=e=>I(Q)(I(s)))},"已绑定【"+M((l=I(s).list,l.map((e=>e.data.title)).join("、")))+"】,可继续配置绑定更多账号",1)):U("",!0),"sms"===I(s).name?(C(),V("span",oe,[L("今日剩余发送次数："+M(I(s).list.at(0).data.count)+"( ",1),S("span",{class:"bt-link",onClick:a[2]||(a[2]=e=>I(t)(!0))},"刷新次数"),a[3]||(a[3]=L(")"))])):U("",!0)])):U("",!0)]);var l}}}),re=h({__name:"module-action",props:{row:{}},setup(a){const{getSenderAlarmListInfo:t}=e(),{refs:{isRefreshList:l}}=Y(),s=a,{row:n}=R(s),i=z((()=>n.value.list.at(0).used)),r=async()=>{var e;try{await o({title:"".concat(i.value?"禁用":"开启","短信通知"),content:"您真的要".concat(i.value?"禁用":"开启","短信通知吗？")});const a=null==(e=n.value.list)?void 0:e.at(0).id,l=await p({sender_id:a});w.request(l),n.value.list.at(0).used=!i.value,t()}catch(a){}};return(e,a)=>(C(),V("div",null,["sms"!==I(n).name?(C(),V("span",{key:0,class:"bt-link",onClick:a[0]||(a[0]=e=>Q({...n.value,callback:()=>{l.value=!0}}))},"配置")):(C(),V(D,{key:1},[I(i)?U("",!0):(C(),V("span",{key:0,class:"bt-link",onClick:r},"开启")),I(i)?(C(),V("span",{key:1,class:"bt-link",onClick:r},"禁用")):U("",!0)],64))]))}}),ce=h({__name:"index",setup(a,{expose:t}){const{push:l,getSenderAlarmListInfo:s}=e(),{refs:{isRefreshList:n}}=Y(),o=_(!1),i=_([]),r=[{label:"告警模块",width:400,render:e=>k(se,{row:e},null)},{label:"配置情况",render:e=>k(ie,{row:e},null)},{label:"操作",align:"right",width:100,render:e=>k(re,{row:e},null)}],u=async(e=!0)=>{e&&(o.value=!0),await s(),i.value=Z(l.value.config),o.value=!1};return E((()=>n.value),(e=>{n.value&&(u(!1),n.value=!1)}),{immediate:!0}),x(u),t({init:u}),(e,a)=>{const t=c,l=O,s=j("bt-loading");return C(),W(l,null,{content:A((()=>[T(k(t,{data:I(i),column:r,description:"告警设置列表为空"},null,8,["data"]),[[s,I(o)],[s,"正在加载告警设置列表，请稍后...","title"]])])),_:1})}}}),ue=h({__name:"index",setup(a,{expose:t}){const{mainHeight:l}=e(),n=_([]),o=_(!1),u=_(0),d=y({p:1,limit:20,keyword:"",status:""}),m=async()=>{await s({loading:o,request:X(F(d)),data:{data:[Array,n],page:v(u)}})},p=[{label:"标题",render:e=>k("span",{innerHTML:e.log},null)},{prop:"addtime",label:"时间",width:150}];return x(m),t({init:m}),(e,a)=>{const t=i,s=r,u=c,w=O,v=j("bt-loading");return C(),W(w,null,{"header-right":A((()=>[k(t,{type:"button",modelValue:I(d).status,"onUpdate:modelValue":a[0]||(a[0]=e=>I(d).status=e),options:[{label:"全部",value:""},{label:"发送成功",value:!0},{label:"发送失败",value:!1}],onChange:m,class:"mr-[1rem]"},null,8,["modelValue"]),S("div",null,[k(s,{modelValue:I(d).keyword,"onUpdate:modelValue":a[1]||(a[1]=e=>I(d).keyword=e),onSearch:m,placeholder:"请输入搜索关键词",class:"!w-24rem"},null,8,["modelValue"])])])),content:A((()=>[T(k(u,{data:I(n),column:p,"max-height":I(l)-248,description:"告警日志列表为空"},null,8,["data","max-height"]),[[v,I(o)],[v,"正在加载告警日志列表，请稍后...","title"]])])),"footer-right":A((()=>a[2]||(a[2]=[]))),_:1})}}}),de=h({__name:"index",setup(e){const{BtTabs:a}=f({type:"card",options:[{label:"告警列表",name:"list",lazy:!0,render:ee},{label:"告警设置",name:"set",lazy:!0,render:ce},{label:"告警日志",name:"log",lazy:!0,render:ue}]});return(e,t)=>(C(),W(I(a)))}});export{de as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
