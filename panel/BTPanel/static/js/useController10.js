import{ah as a,G as t,b7 as s,u as e,J as r,o as n,R as u,M as o}from"./utils-lib.js?v=1734676359";import{g as c,r as i,i as l}from"./base-lib.js?v=1734676359";import{u as v,S as p}from"./useStore7.js?v=1734676359";import{getRewriteTel as h,getComposerVersion as m}from"./site.js?v=1734676359";const y=c("SITE-CONFIG-FILE-STORE",(()=>({viewFileHistoryEvent:async t=>{try{const a=await h({filename:t.path,history:t.row});return{status:a.data.status,data:a.data.data}}catch(s){return a(s),{status:!1,msg:"获取文件历史失败"}}},recoverFileEvent:async a=>{try{const e=await t({loading:"正在恢复，请稍后...",request:s({filename:a.path,history:a.row}),data:{status:Boolean}});return{msg:e.status?"恢复成功":"恢复失败",status:e.status}}catch(e){}},getComposerPathEvent:async a=>{try{const s=await t({request:m({path:a}),data:{file_path:String}});return{data:s.data.file_path,status:s.status}}catch(s){return{status:!1,msg:"获取composer路径失败"}}}}))),{activeType:d,siteInfo:g,isBindExtranet:w,siteType:f}=v(),{getFileEvent:E,saveFileEvent:b}=p(),{viewFileHistoryEvent:j,recoverFileEvent:F,getComposerPathEvent:x}=y(),{plugin:S}=e(),_=i("config"),C=i([{label:"配置文件",name:"config",render:()=>{}},{label:"Composer配置文件",name:"composer",render:()=>{}}]),I=i(""),T=i(),q=i(""),B=l((()=>{const a="nodejs"===d.value?"node":d.value,t="php"!==d.value&&"proxy"!==d.value&&"proxy"!==d.value?"".concat(a,"_"):"",s="/www/server/panel/vhost/".concat(S.value.webserver,"/").concat(t).concat(g.value.name,".conf");return"config"===_.value?s.replace(/\/+/g,"/"):G.value})),G=i("");i(!1);const H=i(!1),O=async a=>{try{H.value=!0;const{data:t}=await E(a);I.value=t.data,r(t.historys)&&(T.value=t.historys),H.value=!1}catch(t){return{status:!1,msg:"获取配置文件失败"}}},P=(a,t)=>{_.value=t,O({path:B.value})},R=async(a={data:I.value,encoding:"utf-8",path:B.value})=>{try{(await b(a)).status&&O({path:a.path})}catch(t){return{status:!1,msg:"保存文件失败"}}},J=async a=>{try{const t=await j({row:a,path:B.value});return q.value=t.status?t.data:"文件不存在",t}catch(t){return{status:!1,msg:"获取文件历史失败"}}},L=async a=>{try{await n({title:"恢复历史文件",content:"是否恢复历史文件 ".concat(u(a))});const t=await F({row:a,path:B.value});return o.request({status:t.status,msg:t.status?"恢复成功":"恢复失败"}),t.status&&O({path:B.value}),t.status}catch(t){}},M=()=>{const{project_type:a,project_config:t,name:s}=g.value;w.value=!!(null==t?void 0:t.bind_extranet);["php","html","proxy"].includes(a)&&(w.value=!0),"php"===a&&N()},N=async()=>{try{const a=await x(g.value.path);return a.status&&(G.value=a.data),a}catch(a){return{status:!1,msg:"获取composer路径失败"}}},k=async()=>{M(),w.value&&await O({path:B.value})};export{y as S,P as a,H as b,G as c,_ as d,I as e,q as f,O as g,T as h,k as i,M as j,L as r,R as s,C as t,J as v};
