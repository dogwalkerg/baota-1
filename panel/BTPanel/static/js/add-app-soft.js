import{c as e,ax as a,h as l,R as o,r as p,w as n,o as t,k as s,J as r,x as m,e as u,p as d,l as c,aX as i,I as v,z as f,a7 as _,ah as y,a4 as h,q as b,y as V,v as D,ag as k,Q as x}from"./base-lib.js?v=1734676359";import{_ as w}from"./index88.js?v=1734676359";import{v as g,G as U,j,bV as C,b as E,a6 as I,e as O}from"./utils-lib.js?v=1734676359";import{g as N,aa as z,ab as q}from"./useStore3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const J={class:"flex flex-col items-start justify-center w-full"},S={class:"unit"},A={key:0,class:"mt-2rem"},B={class:"unit"},G={key:1},H=["onClick"],M=O(e({__name:"add-app-soft",props:{compData:{default:()=>({})}},setup(e,{expose:O}){var M,Q;const{refs:{deployMenuData:R}}=N(),T=e,X=a("popupClose"),F=E(),{appname:K}=T.compData.appData,L=l({service_name:"".concat(K,"_").concat(g(4)),version:""}),P=o(null==(Q=null==(M=T.compData)?void 0:M.appData)?void 0:Q.field),W=o([]),Y=p({}),Z=({appname:e})=>I(e)?e:e[0],$=e=>Y.value.form[e.apptype],ee=(e,a)=>{"domain"===e.attr&&""!==a&&(L.allow_access=!1)},ae=e=>{},le=e=>"cpus"===e.attr?" * ".concat(e.suffix).concat(R.value.maximum_cpu):"memory_limit"===e.attr?" * ".concat(e.suffix).concat(R.value.maximum_memory):e.suffix,oe=e=>{if(!(e.indexOf(".")>-1))return!1;const a=e.split(".");return 3===a.length?{x:a[0],yz:"".concat(a[1],".").concat(a[2])}:2===a.length&&{x:a[0],yz:a[1]}};return n((()=>T.compData),(e=>{var a;e&&(null==(a=T.compData.appData.field)||a.forEach((e=>{L[e.attr]=e.default,"checkbox"===e.type&&(L[e.attr]=Boolean(e.default))})))}),{immediate:!0}),t((async()=>{var e,a,l;await(async()=>{var e,a;let l=[];Y.value.form={},null==(e=T.compData.appData.depend)||e.forEach((e=>Y.value.form[e.apptype]="")),null==(a=T.compData.appData.depend)||a.forEach((e=>{e.appname.forEach(((a,o)=>{!o&&(Y.value.form[e.apptype]=a),Y.value[a]={appname:a,apptype:e.apptype,version:"",service_name:"",option:[]},l.push({app_name:a,app_type:e.apptype})}))})),U({request:q({depend_app:JSON.stringify(l)}),data:{data:Array},success:e=>{var a;null==(a=e.data)||a.forEach(((e,a)=>{var l;Y.value[e.appname].service_name=null==(l=e.installed[0])?void 0:l.service_name,Y.value[e.appname].option=e.installed||[]}))}})})(),W.value=[],null==(a=null==(e=T.compData.appData)?void 0:e.appversion)||a.forEach((e=>{e.s_version.length?e.s_version.forEach((a=>{W.value.push({label:e.m_version+"."+a,value:e.m_version+"."+a})})):W.value.push({label:e.m_version,value:e.m_version})})),L.version=null==(l=W.value[0])?void 0:l.value})),O({onConfirm:async e=>{const a=await(()=>{try{if(L.domain&&!C(L.domain))return void F.error("域名格式不正确");let e={...L,app_name:K,disable_domain:Number(!L.domain),allow_access:Number(L.allow_access)};return oe(L.version)?(e.m_version=oe(L.version).x,e.s_version=oe(L.version).yz):(e.m_version=L.version,e.s_version=""),T.compData.appData.depend&&(e.depend_app=[],Object.keys(Y.value.form).forEach((a=>{const l=Y.value.form[a];Object.keys(Y.value).forEach((a=>{if(l===a){if(!Y.value[a].service_name)throw F.error("未选择必须依赖项"),new Error("未选择必须依赖项");e.depend_app.push({appname:Y.value[a].appname,service_name:Y.value[a].service_name})}}))})),e.depend_app=JSON.stringify(e.depend_app)),e}catch(e){}})();a&&U({loading:"正在安装...",request:z(a),message:!0,success:a=>{a.status&&(R.value.app_type="installed",e())}})}}),(e,a)=>{const l=j,o=_,p=k,n=y,t=w,U=x,C=h;return s(),r(C,{model:d(L),class:"p-2rem","label-width":"110px"},{default:m((()=>[u(o,{label:"名称"},{default:m((()=>[u(l,{width:"24rem",modelValue:d(L).service_name,"onUpdate:modelValue":a[0]||(a[0]=e=>d(L).service_name=e),placeholder:"请输入服务名称"},null,8,["modelValue"])])),_:1}),u(o,{label:"版本选择"},{default:m((()=>[u(n,{modelValue:d(L).version,"onUpdate:modelValue":a[1]||(a[1]=e=>d(L).version=e),filterable:"",class:"!w-[24rem]"},{default:m((()=>[(s(!0),c(v,null,i(d(W),(e=>(s(),r(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(s(!0),c(v,null,i(d(P),((e,a)=>(s(),r(o,{key:a,label:e.name},{default:m((()=>[b("div",J,["password"===e.type?(s(),r(t,{key:0,placeholder:"请输入".concat(e.name),width:"24rem","is-active":!0,modelValue:d(L)[e.attr],"onUpdate:modelValue":a=>d(L)[e.attr]=a,icon:"el-refresh",onInput:a=>ee(e,a),onIconClick:()=>d(L)[e.attr]=d(g)(16)},null,8,["placeholder","modelValue","onUpdate:modelValue","onInput","onIconClick"])):f("",!0),"checkbox"!==e.type&&"password"!==e.type?(s(),r(l,{key:1,modelValue:d(L)[e.attr],"onUpdate:modelValue":a=>d(L)[e.attr]=a,placeholder:"请输入".concat(e.name),type:e.type,width:"24rem",onInput:a=>ee(e,a),rows:1},{unit:m((()=>[V(D(le(e)),1)])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","type","onInput"])):f("",!0),"checkbox"===e.type?(s(),r(U,{key:2,modelValue:d(L)[e.attr],"onUpdate:modelValue":a=>d(L)[e.attr]=a,label:e.name,onChange:e=>{},class:"!my-0"},{default:m((()=>[b("span",S," * "+D(e.suffix),1)])),_:2},1032,["modelValue","onUpdate:modelValue","label","onChange"])):f("",!0)])])),_:2},1032,["label"])))),128)),e.compData.appData.depend&&Object.keys(d(Y)).length?(s(),c("div",A,[(s(!0),c(v,null,i(e.compData.appData.depend,((e,a)=>(s(),r(o,{key:e.apptype+a,label:e.appTypeCN},{default:m((()=>{var a;return[(null==(a=d(Y)[Z(e)])?void 0:a.appname)?(s(),r(n,{key:0,class:"!w-[12rem]",modelValue:d(Y).form[e.apptype],"onUpdate:modelValue":a=>d(Y).form[e.apptype]=a},{default:m((()=>[(s(!0),c(v,null,i(e.appname,(e=>(s(),r(p,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue"])):f("",!0),u(n,{onChange:ae,modelValue:d(Y)[$(e)].service_name,"onUpdate:modelValue":a=>d(Y)[$(e)].service_name=a,placeholder:0==d(Y)[$(e)].option.length?"未安装":"请选择",disabled:0==d(Y)[$(e)].option.length,class:"ml-[0.8rem] !w-[16rem]"},{default:m((()=>[(s(!0),c(v,null,i(d(Y)[$(e)].option,(e=>(s(),r(p,{key:e.service_name,label:e.service_name+" "+e.version,value:e.service_name},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","disabled"]),b("span",B,D(e.appDesc),1),0==d(Y)[$(e)].option.length?(s(),c("div",G,[b("span",{class:"leading-[1] bt-link !text-[1.2rem]",onClick:a=>{return l={name:$(e),type:e.apptype},T.compData.openDependInstall(l),void X();var l}},"点击安装",8,H)])):f("",!0)]})),_:2},1032,["label"])))),128))])):f("",!0)])),_:1},8,["model"])}}}),[["__scopeId","data-v-d4a28c98"]]);export{M as default};
