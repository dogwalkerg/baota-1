import{u as e,o as a,ah as l,G as s,O as t,b as o,e as n}from"./utils-lib.js?v=1734676359";import{c as i,r as p,h as d,az as m,o as c,B as r,C as g,p as u,k as _,l as x,q as f,e as h,x as b,y as v,I as y,z as V,aj as j,a7 as C,A as k,a4 as w,aY as q}from"./base-lib.js?v=1734676359";import{_ as U}from"./index88.js?v=1734676359";import{f as I}from"./validator.js?v=1734676359";import{c as P}from"./useController3.js?v=1734676359";import{getGloalSetting as z,setSitesLogPath as H,setSitesLogStatus as S,openCdnIp as A}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./useStore7.js?v=1734676359";const B={class:"flex flex-col site-globa-setting-module"},D={class:"flex items-center"},G={class:"flex items-center"},O={class:"flex items-center"},R={class:"flex items-center"},T={class:"flex items-center"},Y=n(i({__name:"global-setting",setup(n){const i=o(),{plugin:Y}=e(),{webserver:E}=Y.value,F=p(!1),J=p(),K=d({log_split:!1,log_path:""}),L=d({page_index:!1,page_404:!1}),M=d({cdn_ip:""}),N=d({log_path:[{required:!0,message:"请选择日志路径",trigger:"change"}]}),Q=p([{label:"名称",prop:"site_name"},{label:"结果",render:e=>m("span",{class:e.status?"text-primary":"text-danger"},e.status?"操作成功":"操作失败")}]),W=async()=>{F.value=!0;try{const{data:e}=await z();K.log_path=e.log_path,K.log_split=e.log_split,L.page_index=e.page_index,L.page_404=e.page_404}catch(e){}finally{F.value=!1}},X=async()=>{await J.value.validate(),await a({title:"修改日志路径",content:"是否修改日志预设路径,继续执行?",type:"check",icon:"warning-filled",check:{content:"更改已有网站日志",onConfirm:async e=>{try{const a=await H({mv_log:"1",change_sites:e?"1":"0",log_path:K.log_path});e?P({resultColumn:Q.value,resultData:a.data,resultTitle:"修改日志路径",title:"修改日志路径结果"}):i.request(a)}catch(a){l(a)}}}})},Z=()=>{I({type:"dir",path:K.log_path,change:e=>{K.log_path=e}})},$=async()=>{s({loading:"正在设置，请稍后...",request:S({log_split:K.log_split,page_index:L.page_index,page_404:L.page_404}),message:!0})},ee=async e=>{s({loading:"正在设置，请稍后...",request:A({cdn_ip:e}),message:!0,success:W})};return c((()=>{W()})),(e,a)=>{const l=j,s=C,o=U,n=k,i=w,p=q,d=t,m=r("bt-loading");return g((_(),x("div",B,[f("div",null,[h(i,{ref_key:"globalSettingRef",ref:J,model:u(K),rules:u(N)},{default:b((()=>[h(s,{label:"日志切割"},{default:b((()=>[f("div",D,[h(l,{onChange:$,modelValue:u(K).log_split,"onUpdate:modelValue":a[0]||(a[0]=e=>u(K).log_split=e)},null,8,["modelValue"]),a[5]||(a[5]=f("span",{class:"text-[#999] ml-[4px]"},"*提示：开启该选项将自动创建网站日志切割任务，当存在所有网站日志切割任务时不会新建",-1))])])),_:1}),h(s,{label:"预设日志路径",prop:"log_path"},{default:b((()=>[f("div",G,[h(o,{modelValue:u(K).log_path,"onUpdate:modelValue":a[1]||(a[1]=e=>u(K).log_path=e),icon:"icon-file_mode",onIconClick:Z},null,8,["modelValue"]),h(n,{type:"primary",class:"!ml-1rem",onClick:X},{default:b((()=>a[6]||(a[6]=[v("保存")]))),_:1})])])),_:1})])),_:1},8,["model","rules"])]),h(p),h(i,{model:u(L)},{default:b((()=>[h(s,{label:"默认页面设置"},{default:b((()=>[f("div",O,[h(l,{onChange:$,modelValue:u(L).page_index,"onUpdate:modelValue":a[2]||(a[2]=e=>u(L).page_index=e)},null,8,["modelValue"]),a[7]||(a[7]=f("span",{class:"ml-[4px] mb-[2px]"},"自动生成index.html(默认首页)",-1))])])),_:1}),h(s,{label:" "},{default:b((()=>[f("div",R,[h(l,{onChange:$,modelValue:u(L).page_404,"onUpdate:modelValue":a[3]||(a[3]=e=>u(L).page_404=e)},null,8,["modelValue"]),a[8]||(a[8]=f("span",{class:"ml-[4px] mb-[2px]"},"自动生成404.html(默认404页面)",-1))])])),_:1})])),_:1},8,["model"]),h(d,{options:[{content:"请注意，仅对后续创建的PHP网站生效。"}],class:"ml-[20px] mt-[20px]"}),"nginx"===u(E)?(_(),x(y,{key:0},[h(p),h(i,{model:u(M)},{default:b((()=>[h(s,{label:"cdn来源IP解析"},{default:b((()=>[f("div",T,[h(l,{onChange:ee,modelValue:u(M).cdn_ip,"onUpdate:modelValue":a[4]||(a[4]=e=>u(M).cdn_ip=e)},null,8,["modelValue"]),a[9]||(a[9]=f("span",{class:"ml-[4px] mb-[2px]"},[v(" * 请确保使用 "),f("span",{class:"text-danger"},"安全可靠"),v(" 的cdn ")],-1))])])),_:1})])),_:1},8,["model"])],64)):V("",!0)])),[[m,u(F)]])}}}),[["__scopeId","data-v-c8416dab"]]);export{Y as default};
