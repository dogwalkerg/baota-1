import{b6 as e,x as t,M as a,u as n,_ as s,l as o,H as l,o as i,G as r}from"./utils-lib.js?v=1734676359";import{siteRname as c,getNpsQuestion as u,addSiteTypes as p,modifySiteTypes as m,removeSiteType as d,setSiteTypes as v,removeProject as _}from"./site.js?v=1734676359";import{b as f,B as y,c as w}from"./column.js?v=1734676359";import{_ as g}from"./index91.js?v=1734676359";import{c as h,r as b,t as j,o as k,a1 as C,e as x,aw as D,y as E,C as O,B as S}from"./base-lib.js?v=1734676359";import{c as T}from"./validator.js?v=1734676359";import{u as P,S as L}from"./useStore7.js?v=1734676359";const I=new EventTarget,A=h({props:{onClick:{type:Function,default:()=>{}},row:{type:Object,default:()=>({})},refresh:{type:Function,default:()=>{}}},setup(n,s){const o=b(!1),l=b(!1),i=b(!1),{row:r}=j(n),u=b("site-name-".concat(e(5),"-").concat(r.value.id)),p=()=>{o.value=!1},m=()=>{l.value=!0,o.value=!0;const e=document.getElementById(u.value);e&&setTimeout((()=>{e.focus()}),100)},d=e=>{"Enter"!==e.key&&13!==e.keyCode||v(e)},v=async e=>{try{if(r.value.rname===e.target.value)return l.value=!1,void(o.value=!1);const t=await c({id:r.value.id,rname:e.target.value});a.request(t),o.value=!1,l.value=!1,t.status&&n.refresh()}catch(t){o.value=!1}};return k((()=>{I.addEventListener("hide-all-popovers",p)})),C((()=>{I.removeEventListener("hide-all-popovers",p)})),()=>x("div",null,[x(D,{placement:"right",width:"220","popper-class":"myPopover",visible:o.value},{default:()=>x("div",{class:"web_name_hover",onMouseenter:()=>{i.value=!0},onMouseleave:()=>{i.value=!1,l.value||(o.value=!1)}},[x("div",{class:"web_name_title"},[E("网站名："),x("span",{class:"web_name_text"},[l.value?"":r.value.rname,x("input",{id:u.value,class:"bt-input ".concat(l.value?"":"hide"),onKeyup:d,onBlur:v,size:"mini",value:r.value.rname,placeholder:"点击编辑内容，按回车或失去焦点自动保存",style:"width: 140px;"},null)])]),x("div",{class:"web_name_setting"},[x("span",{class:"web_name_copy bt-link",onClick:()=>{t({value:r.value.rname})}},[x("i",{class:"svgtofont-icon-copy mr-4x text-[#666] text-[1.6rem]"},null),E("复制网站名")]),x("span",{onClick:m,class:"web_name_rename bt-link"},[x("i",{class:"svgtofont-icon-memo-active mr-4x text-[#666] text-[1.6rem]"},null),E("重命名")])])]),reference:()=>x("span",{onMouseenter:()=>{I.dispatchEvent(new CustomEvent("hide-all-popovers")),o.value=!0},onMouseleave:()=>{setTimeout((()=>{l.value||i.value||(o.value=!1)}),500)},onClick:()=>{n.onClick(r)},class:"justify-start bt-link cursor-pointer"},[r.value.rname])})])}}),{plugin:M}=n(),{isRefreshList:F,activeType:R,siteInfo:V}=P(),{delGeneralProjectEvent:W,getClassList:q,setProjectStatusEvent:J}=L(),N=b(),G=b([]),z=e=>({label:(null==e?void 0:e.label)||"项目名称",prop:"name",minWidth:120,sortable:!0,render:t=>{const a=M.value.web,n="java"===(null==e?void 0:e.type)&&!(t.is_file_ok||void 0===t.is_file_ok);return x("div",{class:"flex items-center inline-block truncate"},[(null==t?void 0:t.waf)&&((null==t?void 0:t.isWaf)||void 0===(null==t?void 0:t.isWaf))?x("span",{class:"w-[1.6rem] mr-[4px] cursor-pointer flex items-center",onClick:()=>{e.openPlugin&&e.openPlugin(t,"iconWaf")}},[x(s,{icon:"left-waf",class:"!text-[2rem] ".concat(t.waf.status&&"nginx"===(null==a?void 0:a.type)&&(null==a?void 0:a.status)&&(null==a?void 0:a.setup)?"!text-primary":"!text-[#999]"),size:20},null)]):"",x("span",{class:"!w-full !whitespace-pre-line flex ml-[4px]",title:(null==t?void 0:t.cn_name)&&t.name!==(null==t?void 0:t.cn_name)?null==t?void 0:t.cn_name:""},["php"===(null==e?void 0:e.type)?x(A,{row:t,onClick:()=>e.onClick(t),refresh:()=>{F.value=!0}},null):x("span",{onClick:()=>{n||e.onClick(t)},class:"justify-start cursor-pointer ".concat(n?"":"bt-link"," ")},[t.name])])])}}),B=e=>{const t=null==e?void 0:e.type;return f({prop:"run",event:e.onClick,data:["未启动","运行中"],width:80,function:a=>{let n=null==a?void 0:a.run;return(null==e?void 0:e.prop)&&(n=null!==a[e.prop]),"nodejs"===t&&"pm2"===a.project_config.project_type&&void 0===a.run?O(x("div",{class:"loading h-[2rem]"},null),[[S("bt-loading"),!0]]):x(D,{placement:"right",width:"160","popper-class":"detail-popover",trigger:"hover"},{default:()=>x("div",{class:"flex items-center"},[x("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a)},[n?"停止":"启动"]),x(g,null,null),x("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a,"restart")},[E("重启")]),x(g,null,null),x("span",{class:"bt-link cursor-pointer",onClick:()=>e.onClick(a,"setting")},[E("告警设置")])]),reference:()=>x(y,{modelValue:n?1:0,data:["未启动","运行中"],onClick:()=>e.onClick(a)},null)})}})},H=e=>({label:"到期时间",isCustom:!0,sortable:!0,prop:"edate",minWidth:100,width:100,render:e=>{const t=(new Date).setHours(0,0,0,0),a=Date.now(),n="0000-00-00"!==e.edate?new Date(e.edate).getTime():null,s=n&&n<t;return x("span",{class:"cursor-pointer "+(s?"bt-danger":n&&n-a<6048e5?"bt-warn":"bt-link"),onClick:()=>K(e)},[s?"已过期":"0000-00-00"===e.edate?"永久":e.edate])}}),K=(e,t=!1)=>{o({title:"【".concat(e.name,"】到期时间设置"),area:48,component:()=>l((()=>import("./index281.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{rowData:e,isMult:t},showFooter:!0})},Q=e=>({label:"SSL证书",prop:"site_ssl",isCustom:!0,sortable:!0,minWidth:100,width:100,render:t=>{var a,n,s;return x("span",{class:"cursor-pointer ".concat(-1===t.ssl?"text-[#f0ad4e]":(null==(a=t.ssl)?void 0:a.endtime)<0?"text-danger":"text-[#20a53a]"),onClick:()=>{e.onClick(t)}},[-1===t.ssl?"未部署":(null==(n=t.ssl)?void 0:n.endtime)<0?"已过期":"剩余".concat(null==(s=t.ssl)?void 0:s.endtime,"天")])}}),U=()=>({label:"端口",prop:"port",width:120}),X=()=>({label:"部署证书",value:"deploy",event:async(e,t,a,n,s)=>{pe(a.value,s)}}),Y=e=>({label:"设置分类",value:"setClass",event:async(t,a,n,s,o)=>{await T({name:"分类",options:e.classList.value.filter((e=>"all"!==e.value&&"-2"!==e.value)),selectList:n.value,request:async(t,a)=>{const s=n.value.map((e=>e.id));await r({loading:"正在批量设置FTP分类，请稍后...",request:v({site_ids:JSON.stringify(s),["php"!==R.value?"type_id":"id"]:t.id},R.value),message:!0}),o(),F.value=!0,a(),e.callback&&e.callback()}})}}),Z=(e,t)=>{o({title:(null==e?void 0:e.title)||"批量操作结果",area:t||42,component:()=>l((()=>import("./index102.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},$=()=>{o({isAsync:!0,title:"设置项目启动时间",area:42,showFooter:!0,component:()=>l((()=>import("./index282.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},ee=(e,t)=>{const a="go"===e;o({title:"".concat(a?"Go":"Python","-").concat(a?"SDK":"","版本管理"),area:50,component:()=>l((()=>import("./index283.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{type:e,refresh:t}})},te=async(e,t=R.value)=>{try{await i({title:"".concat("删除".concat(t,"项目-").concat(e.name)),content:"".concat("风险操作，此操作不可逆，删除".concat(e.name,"项目后您将无法管理该项目，是否继续操作？")),type:"input",input:{content:"删除项目"}});const a={python:{data:JSON.stringify({name:e.name})},default:{data:JSON.stringify({project_name:e.name})}},n=a[t]||a.default;(await W(n)).status&&(F.value=!0)}catch(n){return a.error("删除失败"),{status:!1,msg:"删除失败"}}},ae={get:async()=>{const{data:e}=await q();return G.value=e,e},add:e=>p({...e,ps:""},R.value),update:e=>{const{id:t,...a}=e;return m({type_id:t,...a,ps:""},R.value)},delete:e=>{const{id:t}=e;return d({type_id:t},R.value)}},ne=async(e,t,n=R.value)=>{try{const s=(new Date).setHours(0,0,0,0);if("0000-00-00"!==e.edate&&new Date(e.edate).getTime()/1e3<s/1e3)return void a.error("项目已过期，请设置站点到期时间后再操作");const o={start:"即将启动项目".concat(e.name,"，确定要启动项目吗？"),stop:"停用项目".concat(e.name,"后，项目将无法访问，确定要停用项目吗？"),restart:"即将重启项目".concat(e.name,"，确定要重启项目吗？")};await i({icon:"warning-filled",title:"设置项目状态",content:o[t]});const l={python:{data:JSON.stringify({name:e.name})},nodejs:{project_name:e.name,project_type:e.project_config.project_type||"nodejs",status:t},java:{project_name:e.name},phpasync:{sitename:e.name,project_action:t},default:{data:JSON.stringify({project_name:e.name})}};let r=l[n]||l.default;"nodejs"===n&&"pm2"===e.project_config.project_type&&(r.pm2_name=e.pm2_name);const c=await J(r,t,n);return F.value=!0,c}catch(s){return{status:!1,msg:"操作失败"}}},se=e=>o({title:"到期提醒配置",area:50,showFooter:!0,confirmText:"保存配置",component:()=>l((()=>import("./ssl-expire-configure.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:!!e,onCancel:(null==e?void 0:e.onCancel)||(()=>{})}),oe=async()=>{var e,t;const{data:n}=await r({request:u({version:-1,product_type:14})});if(!n.status)return a.error("请求失败，请稍候重试");o({component:()=>l((()=>import("./index143.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),area:52,compData:{name:"网站",type:14,id:null==(e=n.msg[0])?void 0:e.id,description:null==(t=n.msg[0])?void 0:t.question}})},le=(e={readonly:!1,theme:"chrome"})=>({mode:"ace/mode/nginx",theme:"ace/theme/".concat(e.theme),wrap:!0,showInvisibles:!1,showFoldWidgets:!1,useSoftTabs:!0,tabSize:2,showPrintMargin:!1,readOnly:e.readonly,fontSize:"12px"}),ie=e=>o({title:e.title,area:68,component:()=>l((()=>import("./log-details.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e}),re=async(e,t,a,n)=>{const{label:s,value:o}=n,l=new Map([["delete","批量删除选中的项目后，项目将无法恢复"]]),i=async(e,t)=>{const a=new Map([["delete",_]]),{name:n}=e,s=a.get(o);if("delete"===o)if(s){const t=await s({data:JSON.stringify({project_name:n})},R.value);return{...e,batchStatus:t.status?1:2,message:t.status?t.data.msg:t.data.data}}};await e({title:"批量".concat(s),content:"".concat(l.get(o),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},w()],onConfirm:async()=>(await t(i),F.value=!0,!1)})},ce={create:"创建文件",modify:"编辑文件",unlink:"删除文件",mkdir:"新建文件夹",rmdir:"删除文件夹",rename:"文件重命名",link:"创建软链",chmod:"修改文件权限",chown:"修改所有者"},ue={localhost:"服务器磁盘",alioss:"阿里云OSS",ftp:"FTP",sftp:"SFTP",msonedrive:"微软OneDrive",qiniu:"七牛云",txcos:"腾讯COS",upyun:"又拍云",tianyiyun:"天翼云",jdcloud:"京东云",aws_s3:"亚马逊存储","Google Cloud":"谷歌云","Google Drive":"谷歌网盘",bos:"百度云",obs:"华为云",webdav:"WebDav",minio:"MinIO",dogecloud:"多吉云COS"},pe=(e,t)=>o({isAsync:!0,title:"批量设置证书",area:68,component:()=>l((()=>import("./index284.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e,onCancel:()=>{t&&t()}});export{H as a,Q as b,Z as c,X as d,N as e,Y as f,B as g,$ as h,ae as i,te as j,G as k,ee as l,re as m,se as n,oe as o,U as p,le as q,ue as r,ne as s,ce as t,z as u,ie as v};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
