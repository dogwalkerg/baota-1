import{_ as a}from"./index90.js?v=1734676359";import{c as e,D as t,G as s,cD as l,Z as r,cE as c,e as n,u as i,bX as o,l as u,E as d,o as p,cF as m,cG as v,cH as w,cI as h,cJ as b}from"./utils-lib.js?v=1734676359";import{c as g,t as _,r as y,i as f,e as x,y as q,o as k,k as S,l as T,p as D,h as j,B as C,x as P,q as R,bH as L,C as M,J as z}from"./base-lib.js?v=1734676359";import{u as O}from"./column.js?v=1734676359";import{g as J}from"./useStore.js?v=1734676359";import{_ as U}from"./index91.js?v=1734676359";import{b as A,c as H,f as F,d as N,i as B}from"./form-item.js?v=1734676359";import{_ as E}from"./index349.js?v=1734676359";import{_ as I}from"./index261.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./config.js?v=1734676359";const W={class:"w-[460px] px-16px py-24px"},G=g({__name:"mail",props:{compData:{default:()=>({title:"",type:"",data:{},callback:()=>{}})}},setup(a,{expose:r}){const c=a,{type:n,data:i}=_(c.compData),o="https://www.bt.cn/bbs/thread-108097-1-1.html",u=y({title:"",qq_mail:"",qq_stmp_pwd:"",hosts:"",port:"465",receiveMail:""}),d=f((()=>{const a="w-[320px]";return[A("名称","title",{attrs:{placeholder:"请输入邮箱名称",class:a},rules:[{required:!0,message:"请输入名称",trigger:["blur","change"]},{max:15,message:"名称不能超过15个字符",trigger:["blur","change"]}]}),A("发送人邮箱","qq_mail",{attrs:{placeholder:"请输入发送人邮箱",class:a,autocomplete:"new-password"},rules:[{required:!0,message:"请输入发送人邮箱",trigger:["blur","change"]}]}),A("SMTP密码","qq_stmp_pwd",{attrs:{placeholder:"请输入SMTP密码",showPassword:!0,class:a},rules:[{required:!0,message:"请输入SMTP密码",trigger:["blur","change"]}]}),A("SMTP服务器","hosts",{attrs:{placeholder:"请输入SMTP服务器",class:a},rules:[{required:!0,message:"请输入SMTP服务器",trigger:["blur","change"]}]}),A("端口","port",{attrs:{placeholder:"请输入端口",class:a},rules:[{required:!0,message:"请输入端口",trigger:["blur","change"]}]}),H("邮箱","receiveMail",{attrs:{placeholder:"接收者邮箱，每行1个",rows:6,class:a},rules:[{required:!0,message:"请输入接收者邮箱",trigger:["blur","change"]}]}),F(" ",[{content:"推荐使用465端口，协议为SSL/TLS"},{content:"25端口为SMTP协议，587端口为STARTTLS协议"},{content:x(e,{href:o,target:"_blank"},{default:()=>[q("配置教程")]})}])]})),{BtForm:p,submit:m}=t({data:()=>u.value,options:d,submit:async(a,e)=>(await e(),v())}),v=async a=>{try{const a=(()=>{const a={qq_mail:u.value.qq_mail,qq_stmp_pwd:u.value.qq_stmp_pwd,hosts:u.value.hosts,port:u.value.port},e=u.value.receiveMail.split("\n").filter((a=>""!==a&&" "!==a)),t={sender_type:n.value,sender_data:JSON.stringify({send:a,receive:e,title:u.value.title})};return"id"in i.value||(t.sender_id=i.value.id),t})();return(await s({loading:"正在设置,请稍候...",request:l(a),message:!0,success:a=>{a.status&&c.compData.callback(!0)}})).status}catch(e){}};return k((()=>{if(!("id"in i.value))return;const{send:a,receive:e=[],title:t=""}=i.value.data||{},{hosts:s,port:l,qq_mail:r,qq_stmp_pwd:c}=a||{};u.value.hosts=s,u.value.port=l,u.value.qq_mail=r,u.value.qq_stmp_pwd=c,u.value.receiveMail=Array.isArray(e)?e.join("\n"):"",u.value.title=t})),r({onConfirm:async a=>await m()&&a()}),(a,e)=>(S(),T("div",W,[x(D(p),{size:"small"})]))}}),X={class:"w-[90%] px-16px py-24px"},Z=g({__name:"web-hook",props:{compData:{default:()=>({title:"",type:"",data:{},callback:()=>{}})}},setup(a,{expose:c}){const n=a,{title:i,type:o,data:u}=_(n.compData),d="自定义webhook",p="https://www.bt.cn/bbs/thread-121791-1-1.html",m=y({title:"",url:"",atall:"True",method:"POST",body_type:"json",custom_parameter:"",headers:""}),v=[{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"PATCH",value:"PATCH"}],w=[{label:"application/json",value:"json"},{label:"x-www-form-urlencoded",value:"form_data"}],h={class:"!w-[140px]"},b=a=>({placeholder:"非必填，可输入JSON格式的字符串，例如：{aa:bb}",autosize:{minRows:a,maxRows:a},resize:"none"}),g=f((()=>[A("名称","title",{attrs:{placeholder:"机器人名称或备注",class:"w-[320px]"},rules:[{required:!0,message:"请输入机器人名称或备注",trigger:["blur","change"]}]}),H("URL","url",{attrs:{placeholder:"请输入".concat(d,"机器人URL"),autosize:{minRows:5,maxRows:5},resize:"none",class:"w-[320px]"},rules:[{required:!0,message:"请输入".concat(d,"机器人URL"),trigger:["blur","change"]}]}),N([B("请求方式","method",v,{attrs:h}),B("参数格式","body_type",w,{attrs:h,labelAttrs:{labelWidth:"w-[120px]"}})]),H("自定义参数","custom_parameter",{attrs:{...b(4),class:"w-[320px]"}}),H("请求头","headers",{attrs:{...b(2),class:"w-[320px]"}}),F(" ",[{content:x(e,{href:p},{default:()=>["如何创建".concat(d,"机器人")]})}])])),{BtForm:q,submit:j}=t({data:()=>m.value,options:g,submit:async(a,e)=>(await e(),C())}),C=async a=>{try{const a=(()=>{var a;const e=r(m.value);["custom_parameter","query","headers"].forEach((a=>{e[a]=""===e[a]?{}:new Function("return ".concat(e[a]))()}));const{data:t}=u.value,s={sender_type:o.value,sender_data:JSON.stringify({...t,...e})};return(null==(a=u.value)?void 0:a.id)&&(s.sender_id=u.value.id),s})();return(await s({loading:"正在设置,请稍候...",request:l(a),message:!0,success:a=>{a.status&&n.compData.callback(!0)}})).status}catch(e){}};return k((()=>{if(!("id"in u.value))return;const{title:a,url:e,method:t,body_type:s,custom_parameter:l,headers:r}=u.value.data;m.value.title=a,m.value.url=e,m.value.method=t,m.value.body_type=s,m.value.custom_parameter=l?JSON.stringify(l):"",m.value.headers=r?JSON.stringify(r):"",m.value.atall="True"})),c({onConfirm:async a=>await j()&&a()}),(a,e)=>(S(),T("div",X,[x(D(q))]))}}),K={class:"p-[16px]"},Q={class:"flex items-center justify-around mt-[1.6rem]"},V={class:"bind"},Y={class:"code p-[1rem]"},$=n(g({__name:"wx-account",props:{compData:{default:()=>({title:"",type:"",data:{},callback:()=>{}})}},setup(a,{expose:e}){const t=a,l=y(!1),r=j({bindCode:"www.bt.cn"});return k((async()=>{try{await s({loading:l,request:c(),success:a=>{a.status?r.bindCode=a.data.res:r.bindCode="二维码失效，请重新获取"}})}catch(a){}})),e({onCancel:()=>t.compData.callback(!0)}),(a,e)=>{const t=I,s=E,c=C("bt-loading");return S(),T("div",K,[x(t,{closable:!1,"show-icon":!0,type:"warning"},{title:P((()=>e[0]||(e[0]=[R("div",null,"没有绑定微信公众号无法接收面板告警信息",-1),R("div",null,"当前为体验版，限制每个宝塔账号发送频率100条/天",-1)]))),_:1}),R("div",Q,[e[2]||(e[2]=L('<div class="bind" data-v-324e6539><div class="title" data-v-324e6539><span class="steps" data-v-324e6539>1</span>关注堡塔公众号</div><div class="code" data-v-324e6539><img src="https://www.bt.cn/Public/img/bt_wx.jpg" alt="堡塔公众号" class="w-[160px]" data-v-324e6539></div></div>',1)),R("div",V,[e[1]||(e[1]=R("div",{class:"title"},[R("span",{class:"steps"},"2"),q("绑定微信账号")],-1)),M((S(),T("div",Y,[x(s,{value:D(r).bindCode,logo:"/static/images/config/wx_logo.png",level:"L",size:140},null,8,["value"])])),[[c,D(l)],[c,"正在获取二维码，请稍候...","title"]])])])])}}}),[["__scopeId","data-v-324e6539"]]),aa={class:"w-[470px] px-16px py-24px"},ea=g({__name:"common",props:{compData:{default:()=>({title:"",type:"",data:{},callback:()=>{}})}},setup(a,{expose:r}){const c=a,{title:n,type:i,data:o}=_(c.compData),u=y({title:"",url:""}),d=f((()=>[{name:"dingding",ps:"如何创建钉钉机器人",help:"https://www.bt.cn/bbs/thread-108081-1-1.html"},{name:"feishu",ps:"如何创建飞书机器人",help:"https://www.bt.cn/bbs/thread-108274-1-1.html"},{name:"weixin",ps:"如何创建企业微信机器人",help:"https://www.bt.cn/bbs/thread-108116-1-1.html"}].find((a=>a.name===i.value)))),p=f((()=>{var a;return[A("名称","title",{attrs:{placeholder:"机器人名称或备注",class:"w-[320px]"},rules:[{required:!0,message:"请输入机器人名称或备注",trigger:["change","blur"]}]}),H("URL","url",{attrs:{placeholder:"请输入".concat(n.value,"机器人URL"),autosize:{minRows:5,maxRows:5},resize:"none",class:"w-[320px]"},rules:[{required:!0,message:"请输入".concat(n.value,"机器人URL"),trigger:["change","blur"]}]}),F(" ",[{content:x(e,{href:null==(a=d.value)?void 0:a.help},{default:()=>{var a;return[null==(a=d.value)?void 0:a.ps]}})}])]})),{BtForm:m,submit:v}=t({data:()=>u.value,options:p,submit:async(a,e)=>{try{return await e(),w(a)}catch(t){}}}),w=async a=>{try{const e={sender_type:i.value,sender_data:JSON.stringify({...a.value,atall:"True"})};"id"in o.value&&(e.sender_id=o.value.id);return(await s({loading:"正在设置,请稍候...",request:l(e),message:!0,success:a=>{a.status&&c.compData.callback(!0)}})).status}catch(e){}};return k((()=>{if(!("id"in o.value))return;const{data:{title:a,url:e}}=o.value;u.value.title=a,u.value.url=e})),r({onConfirm:async a=>await v()&&a()}),(a,e)=>(S(),T("div",aa,[x(D(m),{size:"small"})]))}}),ta=g({__name:"index",props:{compData:{default:()=>({type:"",title:"",callback:()=>{}})}},setup(e,{expose:t}){const{refs:{isRefreshList:l}}=J(),r=e,{compData:c}=_(r),{getSenderAlarmListInfo:n,push:g}=i(),y=async a=>{const e=(a=>{switch(a){case"mail":return G;case"webhook":return Z;case"wx_account":return $;default:return ea}})(c.value.type);await u({title:"".concat(r.compData.title,"配置"),area:"webhook"===r.compData.type?60:50,compData:{data:a||{},...c.value,callback:()=>{T(),l.value=!0}},showFooter:"wx_account"!==r.compData.type,component:e})},f=async a=>{try{await p({title:"设置默认配置",content:"设置【".concat(a.data.title,"】为默认配置后，将会覆盖原有默认配置，是否继续操作？")}),await s({loading:"正在设置，请稍后...",message:!0,request:m({sender_id:a.id,sender_type:a.sender_type}),success:a=>{a.status&&T()}})}catch(e){}},{BtTable:k,refresh:T}=o({request:async()=>{const a=await(async(a=!1)=>{try{await n(a)}catch(e){}return g.value.config})(),e=a.filter((a=>a.sender_type===c.value.type))||[];return{data:e,total:e.length,other:a}},columns:(()=>{var a;const e=(null==(a=[{label:"邮箱",name:"mail"},{label:"公众号",name:"wx_account"},{label:"钉钉机器人",name:"dingding"},{label:"飞书机器人",name:"feishu"},{label:"企业微信机器人",name:"weixin"},{label:"自定义Webhook",name:"webhook"}].find((a=>a.name===c.value.type)))?void 0:a.label)||"自定义Webhook";return[{label:e,prop:"data.title",render:a=>{var e;return x("div",null,[null==(e=a.data)?void 0:e.title,a.original?"【默认配置】":""])}},{label:"状态",width:65,render:a=>x("span",{class:"".concat(a.used?"bt-link":"bt-link !text-danger"),onClick:()=>(async(a,e)=>{try{await p({title:"".concat(a.used?"禁用":"启用").concat(e,"【").concat(a.data.title,"】"),content:"您真的要".concat(a.used?"禁用":"启用").concat(e,"【").concat(a.data.title,"】吗？")}),await s({loading:"正在设置，请稍后...",message:!0,request:v({sender_id:a.id}),success:a=>{a.status&&T()}})}catch(t){}})(a,e)},[a.used?"已启用":"未启用"])},O([{onClick:f,isHide:a=>a.original,title:"设置默认",width:60},{onClick:a=>y(a),isHide:a=>"wx_account"===a.sender_type,title:"编辑"},{title:"测试",render:a=>x("div",{class:"item-center inline-flex"},[x("span",{class:"bt-link",onClick:async()=>{a.load||(a.load=!0,await(async a=>{try{await s({loading:"正在测试，请稍后...",message:!0,request:w({sender_id:a.id})})}catch(e){}})(a),a.load=!1)}},[a.load?"测试中":"测试"]),x(U,{class:"mt-[4px]"},null)])},{onClick:a=>(async(a,e)=>{try{await p({title:"解绑【".concat(a.data.title,"】").concat(e),content:"您真的要解绑".concat(e,"【").concat(a.data.title,"】吗？")});const t={sender_id:a.id},r="wx_account"===a.sender_type;await s({loading:"正在解绑，请稍后...",message:!0,request:r?h(t):b(t),success:a=>{a.status&&(T(),l.value=!0)}})}catch(t){}})(a,e),title:"解绑"}])]})()});return t({onCancel:r.compData.callback}),(e,t)=>{const s=d,l=a;return S(),z(l,{class:"p-[2rem]"},{"header-left":P((()=>[x(s,{type:"primary",onClick:t[0]||(t[0]=a=>y())},{default:P((()=>t[1]||(t[1]=[q("添加")]))),_:1})])),content:P((()=>[x(D(k),{"max-height":350})])),_:1})}}});export{ta as default};
