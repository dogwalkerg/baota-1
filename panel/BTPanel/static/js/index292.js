import{u as e,a5 as s,o as a,_ as t,d as n,c as l,k as i,h as r,b as c,e as o}from"./utils-lib.js?v=1734676359";import{c as d,r as p,h as u,o as m,B as b,C as f,p as g,k as v,l as y,q as x,e as k,J as w,v as h,x as _,y as S,z as j,F as T,D as C,I as L,aX as F,M as O,n as M,A as E,b7 as H,aY as z,bt as D,bu as I}from"./base-lib.js?v=1734676359";import{a as A}from"./column.js?v=1734676359";import{aD as P,p as V}from"./validator.js?v=1734676359";import{scanSiteRepairReq as J}from"./site.js?v=1734676359";import{g as q}from"./useController4.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./useStore7.js?v=1734676359";import"./useStore8.js?v=1734676359";import"./useController3.js?v=1734676359";import"./useStore9.js?v=1734676359";import"./useMethod5.js?v=1734676359";const B={id:"safeDetectList",class:"p-[2rem]"},G={class:"progress-header"},N={class:"progress-header-cot"},R={class:"flex items-center"},U={key:0,class:"scan-icon relative h-[8rem] w-[8rem] flex"},X={key:1},Y={class:"progress-header-cot h-[8rem]"},K=["innerHTML"],Q={class:"scanning-progress-cont"},W={class:"progress-header-cot"},Z={class:"progress-cont-list"},$={key:0},ee={class:"inline-grid grid-cols-4 w-full mt-20px"},se=["onClick"],ae={class:"progress_type"},te={class:"flex-1"},ne={key:0},le={key:1},ie={key:2,class:"text-danger mr-[4px]"},re={key:3,class:"text-primary"},ce={class:"progress_fold text-[1.2rem] flex items-center"},oe={class:"mr-4px"},de={class:"progress_item_body"},pe={class:"flex items-center justify-between w-full"},ue={class:"flex items-center ml-12px"},me=["innerHTML"],be={class:"flex flex-col py-[1rem] px-[1.6rem] text-[1.2rem] progress_item_info"},fe={class:"flex"},ge=["innerHTML"],ve={class:"flex"},ye=["innerHTML"],xe={class:"p-[2rem]"},ke=o(d({__name:"index",setup(o){const d=c(),{payment:ke}=e(),{authType:we}=ke.value,he=p(),_e=p(!1),Se=p([{name:"vulscan",title:"漏洞扫描"},{name:"webscan",title:"网站配置安全性"},{name:"filescan",title:"文件泄露"},{name:"backup",title:"备份文件"},{name:"index",title:"首页内容风险"},{name:"webhorse",title:"挂马排查"},{name:"deadchain",title:"坏链扫描"},{name:"database",title:"数据库安全"},{name:"ftps",title:"网站FTP风险"},{name:"backend",title:"网站后台安全"}]),je=p(""),Te=u({title:"定期扫描网站，提升网站安全性",msg:"当前安全风险未知，请立即扫描",isFirst:!0,error:0,scanStatus:!1,isEnd:!1,siteList:[],time:0,scanTypeStatus:{vulscan:!0,webscan:!0,filescan:!0,backup:!0,index:!0,webhorse:!0,deadchain:!0,database:!0,ftps:!0,backend:!0},btnObj:{text:"立即扫描",type:"primary"},progress:0,progressColor:"#20a53a",progressConfig:{},statusTotal:{},active:{vulscan:!1,webscan:!1,filescan:!1,backup:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1}});let Ce=null;const Le=p(),Fe=p(!1),Oe=p(!1),Me=p([]),Ee=p([A(),{label:"网站名",prop:"name"}]),He=()=>{Ce=s({route:"/ws_project",onMessage:Ae})},ze=()=>{if("ltd"!==we)return d.error("抱歉，该功能为企业版专享功能！");Fe.value=!0,Oe.value||M((()=>{}))},De=e=>{Oe.value=!0,Te.siteList=e},Ie=()=>{if(0==Te.siteList.length)return d.error("请选择扫描站点");Fe.value=!1,Pe()},Ae=(e,s)=>{const a=JSON.parse(s.data);if(a.hasOwnProperty("site_list"))return Me.value=a.site_list,void(Te.siteList=a.site_list);if(a.hasOwnProperty("end")){if(Te.progress=a.bar,Te.msg=a.info,a.dangerous&&(Te.progressConfig[a.type]||(Te.progressConfig[a.type]=[]),Te.progressConfig[a.type].push(a),Te.statusTotal[a.type]?Te.statusTotal[a.type]++:Te.statusTotal[a.type]=1,Te.error++),a.end)return Te.isEnd=!0,Te.scanStatus=!1,null==Ce||Ce.close(),q(),void Je("end");a.type!=je.value&&(je.value&&!Te.statusTotal[je.value]&&(Te.scanTypeStatus[je.value]=!1),je.value=a.type)}},Pe=async()=>{if(Te.time=0,Te.error=0,setInterval((()=>{Te.time++}),1e3),"ltd"!==we)return d.error("抱歉，该功能为企业版专享功能！");if(Te.isFirst){if(0==Te.siteList.length)return d.error("未扫描到网站，请选择");Ve(),Te.scanStatus=!0,Te.isFirst=!1,Je("scan")}else Te.scanStatus?(await a({title:"取消扫描",content:"确定取消扫描吗?"}),null==Ce||Ce.close(),Te.isFirst=!0,Je("scan"),Ge()):(Ge(),Ve(),Te.scanStatus=!0,Je("scan"))},Ve=async()=>{await He(),await(null==Ce?void 0:Ce.send({mod_name:"webscanning",def_name:"ScanAllSite",site_list:Te.siteList.map((e=>e.name)),ws_callback:"123"}))},Je=e=>{switch(e){case"scan":Te.title="正在扫描",Te.isEnd=!1,Te.btnObj.text="取消扫描",Te.btnObj.type="warning";break;case"end":let e="";e=0==Te.error?"当前安全风险未知，请立即扫描":'共发现<span class="text-danger">'.concat(Te.error,"</span>项风险"),Te.title="检测完成,"+e,Te.msg="扫描完成，共耗时"+Te.time+"秒",Te.btnObj.text="重新扫描",Te.btnObj.type="primary"}},qe=async()=>{J(),P()},Be=e=>{"free"==we&&V({sourceId:65})},Ge=()=>{je.value="",Te.scanStatus=!1,Te.isEnd=!1,Te.error=0,Te.time=0,Te.progress=0,Te.progressConfig={vulscan:[],webscan:[],filescan:[],backup:[],index:[],webhorse:[],deadchain:[],database:[],ftps:[],backend:[]},Te.statusTotal={},Te.active={vulscan:!1,webscan:!1,filescan:!1,backup:!1,index:!1,webhorse:!1,deadchain:!1,database:!1,ftps:!1,backend:!1},Te.scanTypeStatus={vulscan:!0,webscan:!0,filescan:!0,backup:!0,index:!0,webhorse:!0,deadchain:!0,database:!0,ftps:!0,backend:!0},Te.btnObj.text="立即扫描",Te.btnObj.type="primary",Te.title="定期扫描网站，提升网站安全性",Te.msg="当前安全风险未知，请立即扫描"};return m((()=>{He(),null==Ce||Ce.send({mod_name:"webscanning",def_name:"GetAllSite",ws_callback:""})})),(e,s)=>{const a=t,c=E,o=H,d=z,p=n,u=l,m=D,M=I,A=i,P=r,V=b("bt-loading");return f((v(),y("div",B,[x("div",G,[x("div",N,[x("div",R,[g(Te).scanStatus?(v(),y("div",U,[s[1]||(s[1]=x("div",{class:"animate-spin absolute top-0 border-primary border-b-2 rounded-full h-full w-full bg-#cccccc00"},null,-1)),k(a,{icon:"scanning-danger",size:60,color:"#F39C12",class:"m-auto"})])):(v(),y("div",X,[g(Te).warn||g(Te).error?(v(),w(a,{key:0,icon:"scanning-danger",size:70,color:"#ef0808"})):(v(),w(a,{key:1,icon:"scanning-"+(g(Te).isEnd?"success":"danger"),size:72,color:g(Te).isEnd?"#20a53a":"#F39C12"},null,8,["icon","color"]))]))])]),x("div",Y,[x("div",{class:"scanning-progress-title",innerHTML:g(Te).title},null,8,K),x("div",Q,h(g(Te).msg.length>35?g(Te).msg.substring(0,35)+"...":g(Te).msg),1)]),x("div",W,[g(Te).isFirst||g(Te).isEnd?(v(),w(c,{key:0,type:"text",onClick:ze},{default:_((()=>s[2]||(s[2]=[S(" 选择网站 ")]))),_:1})):j("",!0),k(c,{class:T({"warning-hover":g(Te).scanStatus}),plain:!!g(Te).scanStatus,type:g(Te).btnObj.type,onClick:Pe},{default:_((()=>[S(h(g(Te).btnObj.text),1)])),_:1},8,["class","plain","type"]),g(Te).isEnd?(v(),w(c,{key:1,type:"default",onClick:qe},{default:_((()=>s[3]||(s[3]=[S(" 联系客服 ")]))),_:1})):j("",!0)])]),f(k(o,{class:"!w-full",color:g(Te).progressColor,"show-text":!1,"stroke-width":2,percentage:g(Te).progress},null,8,["color","percentage"]),[[C,g(Te).scanStatus]]),f(k(d,{class:"!mt-0 !mb-20px !bg-[#F1F1F1]"},null,512),[[C,!g(Te).scanStatus]]),x("div",Z,[g(Te).scanStatus||g(Te).isEnd?j("",!0):(v(),y("div",$,[s[4]||(s[4]=x("div",{class:"font-bold text-[1.6rem] text-[#666] my-[4rem]"},"支持网站以下安全扫描项:",-1)),x("div",ee,[(v(!0),y(L,null,F(g(Se),((e,s)=>(v(),y("div",{key:s,class:"flex flex-col inline-block items-center mb-20px"},[k(p,{class:"w-[4rem] inline-block mb-8px opacity-90",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),S(" "+h(e.title),1)])))),128))])])),g(Te).scanStatus||g(Te).isEnd?(v(!0),y(L,{key:1},F(g(Se),((e,a)=>(v(),y("div",{key:a,class:T([e.name+"_item "+(g(Te).active[e.name]?"active":""),"progress_item"])},[x("div",{class:"progress_item_header",onClick:s=>(e=>{Te.active[e]||(Te.active[e]=!1),Te.active[e]=!Te.active[e]})(e.name)},[x("div",ae,[k(p,{class:"mr-12px w-[2rem]",src:"/scan/scanning-"+e.name+"-ico.svg"},null,8,["src"]),x("span",null,h(e.title),1)]),x("div",te,[g(Te).scanStatus&&g(je)==e.name?(v(),y("span",ne," 正在扫描... ")):g(Te).scanStatus&&g(je)!=e.name&&!g(Te).statusTotal[e.name]&&g(Te).scanTypeStatus[e.name]?(v(),y("span",le," 等待扫描 ")):g(Te).statusTotal[e.name]?(v(),y("span",ie," 发现"+h(g(Te).statusTotal[e.name])+"项危险 ",1)):(v(),y("span",re,"无风险项"))]),x("div",ce,[x("span",oe,h(g(Te).active[e.name]?"收起":"展开"),1),x("i",{class:T(g(Te).active[e.name]?"svgtofont-el-arrow-up":"svgtofont-el-arrow-down")},null,2)])],8,se),f(x("div",de,[k(M,{accordion:""},{default:_((()=>[(v(!0),y(L,null,F(g(Te).progressConfig[e.name],((e,a)=>(v(),w(m,{key:a,disabled:"free"==g(we)},{title:_((()=>[x("div",pe,[x("div",ue,[x("span",{innerHTML:e.info},null,8,me)]),k(u,{class:"mb-2px mr-4px",onClick:Be},{default:_((()=>s[5]||(s[5]=[S(" 详情 ")]))),_:1})])])),default:_((()=>[x("div",be,[x("div",fe,[s[6]||(s[6]=x("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 详情： ",-1)),x("span",{class:"leading-[1.6rem]",innerHTML:e.detail},null,8,ge)]),k(d,{class:"!my-8px"}),x("div",ve,[s[7]||(s[7]=x("span",{class:"w-[6rem] flex-shrink-0 inline-block"}," 修复方案： ",-1)),x("span",{innerHTML:e.repair},null,8,ye)])])])),_:2},1032,["disabled"])))),128))])),_:2},1024)],512),[[C,g(Te).active[e.name]]])],2)))),128)):j("",!0)]),k(P,{title:"选择扫描网站",modelValue:g(Fe),"onUpdate:modelValue":s[0]||(s[0]=e=>O(Fe)?Fe.value=e:null),ref_key:"scanSiteListDialog",ref:Le,area:[45,33],onConfirm:Ie,showFooter:""},{default:_((()=>[x("div",xe,[k(A,{ref_key:"scanSiteTableRef",ref:he,data:g(Me),column:g(Ee),"max-height":296,onSelectionChange:De,description:"网站列表为空"},null,8,["data","column"])])])),_:1},8,["modelValue"])])),[[V,g(_e)]])}}}),[["__scopeId","data-v-0294aa7b"]]);export{ke as default};
