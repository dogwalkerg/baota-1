import{_ as a}from"./index90.js?v=1734676359";import{R as e,t as s,G as t,o as l,dh as i,k as o,h as n}from"./utils-lib.js?v=1734676359";import{c as r,r as d,bS as m,az as p,o as u,B as c,k as f,l as g,e as h,x as y,y as b,C as v,p as w,M as _,q as x,I as j,aX as k,A as q,ah as C,J as V,ag as O}from"./base-lib.js?v=1734676359";import{g as S}from"./useMethod3.js?v=1734676359";import{getRedisBackupList as J,restoreModuleBack as D,backModuleDatabase as L}from"./database.js?v=1734676359";import{u as N}from"./column.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";const T={class:"p-20px"},z={class:"flex items-center p-20px"},A=r({__name:"index",props:{compData:{default:()=>({sid:0,keyList:[]})}},setup(r){const A=r,{refreshTableList:B}=S(),M=d(!1),U=d([]),G=d(0),H=d(!1),I=m(A.compData,"keyList"),R=m(A.compData,"sid"),X=async()=>{await t({loading:M,request:J({data:JSON.stringify({sort:"desc"})}),data:[Array,U]})},E=async()=>{await t({loading:"正在备份数据库,请稍后...",request:L({},"redis"),message:!0}),X()},F=async()=>{await t({loading:"正在备份数据库,请稍后...",request:L({data:JSON.stringify({db_idx:String(G.value),sid:R.value})},"redis"),message:!0}),X(),H.value=!1},K=[{label:"名称",prop:"name",showOverflowTooltip:!0},{label:"路径",prop:"filepath",showOverflowTooltip:!0},{label:"备份时间",prop:"mtime",render:a=>p("span",e(a.mtime))},{label:"大小",render:a=>p("span",s(a.size))},N([{onClick:async a=>{await l({title:"覆盖数据",icon:"warning-filled",type:"input",input:{content:"覆盖数据"},content:"即将使用【"+a.name+"】对数据进行覆盖，是否继续?"}),await t({loading:"正在恢复备份中，请稍后...",request:D({data:JSON.stringify({file:a.filepath,sid:R.value})},"redis"),message:!0}),B()},title:"恢复"},{onClick:async a=>{await l({title:"删除备份【"+a.name+"】",content:"是否删除【"+a.name+"】备份?"}),await t({loading:"正在备份数据库,请稍后...",request:i({path:a.filepath}),message:!0}),X()},title:"删除"}])];return u((()=>X())),(e,s)=>{const t=q,l=o,i=O,r=C,d=n,m=a,p=c("bt-loading");return f(),g("div",T,[h(m,null,{"header-left":y((()=>[h(t,{type:"primary",onClick:E},{default:y((()=>s[3]||(s[3]=[b("立即备份")]))),_:1}),h(t,{onClick:s[0]||(s[0]=a=>H.value=!0)},{default:y((()=>s[4]||(s[4]=[b("指定备份")]))),_:1})])),content:y((()=>[v(h(l,{"max-height":"400",ref:"routeBackup",data:w(U),class:"h-full",column:K},null,8,["data"]),[[p,w(M)],[p,"正在加载备份列表，请稍后...","title"]])])),popup:y((()=>[h(d,{area:36,title:"指定备份数据库",onConfirm:F,"show-footer":"",modelValue:w(H),"onUpdate:modelValue":s[2]||(s[2]=a=>_(H)?H.value=a:null)},{default:y((()=>[x("div",z,[s[5]||(s[5]=b(" 数据库 ")),h(r,{modelValue:w(G),"onUpdate:modelValue":s[1]||(s[1]=a=>_(G)?G.value=a:null),class:"ml-20px !w-[24rem]"},{default:y((()=>[(f(!0),g(j,null,k(w(I),((a,e)=>(f(),V(i,{key:e,value:a.id,label:a.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])])),_:1},8,["modelValue"])])),_:1})])}}});export{A as default};
