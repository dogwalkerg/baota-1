import{dg as a,k as e,aa as l,h as t,b as n,o as s,G as o,j as i,e as r}from"./utils-lib.js?v=1734676359";import{c,r as u,o as d,aB as p,B as m,k as v,l as f,e as k,x as y,q as h,p as x,M as _,y as b,I as g,aX as j,z as w,C as V,A as C,aw as T,ag as J,ah as U,ay as D,J as q,v as I}from"./base-lib.js?v=1734676359";import{_ as S}from"./index90.js?v=1734676359";import{_ as K}from"./index99.js?v=1734676359";import{_ as O}from"./index88.js?v=1734676359";import{o as z,B as F}from"./column.js?v=1734676359";import{addLocalJdk as H,setJdkEnvironment as N,installNewTomcat as B,getJavaInfo as E,installNewJdk as M,delLocalJdk as L,setTomcatStatus as A,setTomcatPort as G,installTomcat as P,changeTomcatJdk as R}from"./site.js?v=1734676359";import{f as X,m as Q}from"./validator.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const W={class:"flex items-center"},Y={class:"flex items-center"},Z={key:0,class:"flex items-center mx-[12px]"},$={class:"overflow-auto h-[510px]"},aa={class:"flex items-center bg-[#F9F9F9] h-[3.6rem] px-[8px]"},ea={key:0,class:"flex flex-col p-[16px]"},la={class:"inline-block flex items-center justify-between"},ta={class:"flex items-center"},na={class:"flex items-center"},sa={class:"flex items-center"},oa=["onClick"],ia={class:"ml-[8px]"},ra={class:"flex items-center mt-[16px]"},ca={key:1,class:"flex flex-col p-[16px]"},ua={key:2,class:"flex flex-col p-[16px]"},da={class:"p-[20px] flex flex-col"},pa={class:"flex items-center ml-[40px]"},ma={class:"bg-[#333] p-[12px] h-full text-white overflow-auto logMsg"},va=["innerHTML"],fa=r(c({__name:"index",props:{compData:{default:{}}},emits:["close"],setup(r,{emit:c}){const fa=r,ka=n(),ya=c,ha=u("jdkSettings"),xa=u(""),_a=u(""),ba=u(!1),ga=u([]),ja=u([]),wa=u([]),Va=u(!1),Ca=u(""),Ta=u([]),Ja=u(!1),Ua=u(!1),Da=u("正在请求安装..."),qa=()=>{X({type:"file",path:xa.value,change:a=>{xa.value=a,setTimeout((()=>{ba.value=!0}),0)}})},Ia=async()=>{try{const a=await H({data:JSON.stringify({jdk:xa.value})});ka.request(a),a.status&&(ba.value=!1),Ha()}catch(a){}},Sa=async()=>{try{const a=await N({name:_a.value});(null==a?void 0:a.status)?ka.request(a):ka.error("string"==typeof a?a:a.msg)}catch(a){}},Ka=a=>{a.hasOwnProperty("props")?ha.value=a.prop.name:ha.value=a.name,Ha()},Oa=async(a,e)=>{let l=e.name.replace("Tomcat",""),t=ka.load("正在"+("start"===a?"启动":"stop"===a?"停止":"重载")+"Tomcat"+l+"，请稍后...");try{const e=await A({data:JSON.stringify({type:a,version:l})});ka.request(e),Ha()}catch(n){}finally{t.close()}},za=u({}),Fa=u([{label:"JDK版本",prop:"name",width:100},{label:"JDK地址",render:a=>2===a.operation?k("span",{class:"truncate"},[a.path]):k("span",{class:"truncate bt-link ",onClick:()=>{z(a),ya("close")}},[a.path])},{label:"操作",align:"right",width:136,render:a=>{switch(a.operation){case 0:return k("span",{class:" bt-link",onClick:()=>{(async a=>{try{Ta.value.find((e=>{e.name===a.name&&(e.operation=3)}));const e=await M({version:a.name});ka.request(e),e.status&&Q(),Ha()}catch(e){}})(a)}},[b("安装")]);case 1:return k("span",{class:"bt-danger",onClick:()=>{(async a=>{await s({title:"删除jdk",isHtml:!0,content:"是否删除【 ".concat(a.name,'】，<span class="text-danger">此操作将会删除该JDK目录下的所有文件，请确保该JDK未被使用</span>，是否继续操作？')}),o({loading:"正在删除，请稍后...",request:L({data:JSON.stringify({jdk:a.path})}),success:Ha})})(a)}},[b("删除")]);case 2:return k("span",null,[b("不可操作")]);case 3:return k("span",{class:"bt-link",onClick:()=>{Ha()}},[b("正在安装,点击刷新")])}}}]),Ha=async()=>{try{Ja.value=!0;const a=await E();Ta.value=a.data.jdk_info.sort(((a,e)=>e.operation-a.operation)),ga.value.length=0,ja.value=[];for(let e=0;e<a.data.jdk_info.length;e++)a.data.jdk_info[e].is_current&&(_a.value=a.data.jdk_info[e].name),1===a.data.jdk_info[e].operation&&ga.value.push({label:a.data.jdk_info[e].name,value:a.data.jdk_info[e].name}),0!==a.data.jdk_info[e].operation&&ja.value.push({label:a.data.jdk_info[e].name,value:a.data.jdk_info[e].path});wa.value=[],a.data.tomcat_status.forEach((a=>{wa.value.push({name:"Tomcat".concat(a.version),...a,popover:!1,portInput:a.port})}))}catch(a){}finally{Ja.value=!1}};return d((async()=>{fa.compData.name?(ha.value=fa.compData.name,Ka({name:fa.compData.name})):(ha.value="jdkSettings",await Ha())})),p((()=>{})),(n,r)=>{const c=O,u=C,d=T,p=J,z=U,H=K,N=e,E=S,M=D,L=i,A=l,X=t,fa=m("bt-loading");return v(),f("div",null,[k(A,{type:"left-bg-card",class:"h-full",modelValue:x(ha),"onUpdate:modelValue":r[3]||(r[3]=a=>_(ha)?ha.value=a:null),onTabClick:Ka},{default:y((()=>[k(M,{label:"JDK管理",name:"jdkSettings",lazy:!0,class:"overflow-y-auto"},{default:y((()=>[k(E,null,{"header-left":y((()=>[h("div",W,[k(d,{placement:"bottom",width:"380",trigger:"click",visible:x(ba),"onUpdate:visible":r[1]||(r[1]=a=>_(ba)?ba.value=a:null),"popper-class":"white-tips-popover"},{default:y((()=>[h("div",Y,[r[10]||(r[10]=b(" jdk路径: ")),k(c,{modelValue:x(xa),"onUpdate:modelValue":r[0]||(r[0]=a=>_(xa)?xa.value=a:null),placeholder:"请输入JDK路径",icon:"el-folder-opened",onIconClick:qa,class:"!w-[20rem] mx-[12px]",width:"20rem"},null,8,["modelValue"]),k(u,{type:"primary",onClick:Ia},{default:y((()=>r[9]||(r[9]=[b("添加")]))),_:1})])])),reference:y((()=>[k(u,{type:"primary"},{default:y((()=>r[11]||(r[11]=[b("添加自定义JDK")]))),_:1})])),_:1},8,["visible"]),x(a)?w("",!0):(v(),f("div",Z,[r[12]||(r[12]=h("span",{class:"mr-[4px]"},"命令行版本",-1)),k(z,{class:"!w-[14rem]",modelValue:x(_a),"onUpdate:modelValue":r[2]||(r[2]=a=>_(_a)?_a.value=a:null),onChange:Sa},{default:y((()=>[(v(!0),f(g,null,j(x(ga),(a=>(v(),q(p,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]))])])),"header-right":y((()=>[k(H,{onRefresh:Ha})])),content:y((()=>[V(k(N,{height:"440",column:x(Fa),data:x(Ta)},null,8,["column","data"]),[[fa,x(Ja)]])])),_:1})])),_:1}),k(M,{label:"Tomcat管理",name:"tomcatSettings",lazy:!0},{default:y((()=>[h("div",$,[(v(!0),f(g,null,j(x(wa),((a,e)=>(v(),f("div",{class:"border border-[#EBEEF5] mb-[16px]",key:a.name},[h("div",aa,I(a.name),1),a.status?(v(),f("div",ea,[h("div",la,[h("div",ta,[r[13]||(r[13]=b("当前状态：")),k(x(F),{modelValue:a.running,"onUpdate:modelValue":e=>a.running=e,data:["已停止","运行中"]},null,8,["modelValue","onUpdate:modelValue"])]),h("div",na,[b(" 端口："+I(a.port)+" ",1),k(d,{placement:"bottom",width:"400",visible:a.popover},{default:y((()=>[h("div",sa,[r[15]||(r[15]=b(" 端口: ")),k(L,{modelValue:a.portInput,"onUpdate:modelValue":e=>a.portInput=e,type:"number",placeholder:"请输入端口",width:"20rem",class:"w-[20rem] mx-[12px]"},null,8,["modelValue","onUpdate:modelValue"]),k(u,{type:"primary",onClick:e=>(async a=>{let e=ka.load("正在更改Tomcat端口，请稍后...");try{const e=await G({data:JSON.stringify({port:a.portInput,version:a.name.replace("Tomcat","")})});a.popover=!1,ka.request(e),Ha()}catch(l){}finally{e.close()}})(a)},{default:y((()=>r[14]||(r[14]=[b("更改")]))),_:2},1032,["onClick"])])])),reference:y((()=>[h("span",{class:"ml-[4px] bt-link",onClick:e=>(a=>{a.popover=!a.popover,a.portInput!==a.port&&(a.portInput=a.port)})(a)},"更改",8,oa)])),_:2},1032,["visible"])]),h("span",ia,"jdk路径:"+I(a.jdk_path),1)]),h("div",ra,[a.running?w("",!0):(v(),q(u,{key:0,type:"default",onClick:e=>Oa("start",a)},{default:y((()=>r[16]||(r[16]=[b("启动")]))),_:2},1032,["onClick"])),a.running?(v(),q(u,{key:1,type:"default",onClick:e=>Oa("stop",a)},{default:y((()=>r[17]||(r[17]=[b("停止")]))),_:2},1032,["onClick"])):w("",!0),k(u,{type:"default",onClick:e=>Oa("restart",a)},{default:y((()=>r[18]||(r[18]=[b("重载配置")]))),_:2},1032,["onClick"]),k(u,{type:"info",class:"!mr-[8px] danger-button",onClick:e=>(async a=>{await s({title:"卸载Tomcat",isHtml:!0,content:"是否卸载【 ".concat(a.name,'】，<span class="text-danger">此操作将会删除该Tomcat目录下的所有文件，请确保该Tomcat未被使用</span>，是否继续操作？')}),o({loading:"正在卸载Tomcat，请稍后...",request:P({data:JSON.stringify({jdk_path:a.jdk_path,type:"uninstall",version:a.name.replace("Tomcat","")})}),success:Ha})})(a)},{default:y((()=>r[19]||(r[19]=[b("卸载")]))),_:2},1032,["onClick"]),k(z,{class:"ml-[8px] !w-[16rem]",modelValue:a.jdk_path,"onUpdate:modelValue":e=>a.jdk_path=e,onChange:e=>(async a=>{let e=ka.load("正在更改JDK路径，请稍后...");try{const e=await R({version:a.name.replace("Tomcat",""),jdk_path:a.jdk_path});ka.request(e)}catch(l){}finally{e.close()}})(a)},{default:y((()=>[(v(!0),f(g,null,j(x(ja),(a=>(v(),q(p,{key:a.value,label:a.value.replace("/bin/java",""),value:a.value.replace("/bin/java","")},null,8,["label","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])])):!a.status&&a.is_install?(v(),f("div",ca,[h("div",null,[r[21]||(r[21]=b(" 正在安装， ")),k(u,{type:"default",size:"small",onClick:x(Q)},{default:y((()=>r[20]||(r[20]=[b("查看详情")]))),_:1},8,["onClick"])])])):(v(),f("div",ua,[h("div",null,[r[23]||(r[23]=b(" 当前版本未安装，点击安装后操作 ")),k(u,{type:"default",size:"small",onClick:e=>(a=>{Va.value=!0,za.value=a})(a)},{default:y((()=>r[22]||(r[22]=[b("点击安装")]))),_:2},1032,["onClick"])])]))])))),128))])])),_:1})])),_:1},8,["modelValue"]),k(X,{title:"安装tomcat",modelValue:x(Va),"onUpdate:modelValue":r[5]||(r[5]=a=>_(Va)?Va.value=a:null),area:36,showFooter:"",onConfirm:r[6]||(r[6]=a=>(async()=>{try{const a=await B({java_path:Ca.value,version:za.value.name.replace("Tomcat","")});a.status?Q():ka.error(a.msg),Va.value=!1}catch(a){}})())},{default:y((()=>[h("div",da,[r[25]||(r[25]=h("div",{class:"flex items-center text-[1.4rem]"},[h("i",{class:"svgtofont-el-warning-filled text-warning !text-[4rem] mr-[12px]"}),b(" 是否安装Tomcat？ ")],-1)),h("div",pa,[r[24]||(r[24]=b(" jdk版本： ")),k(z,{class:"!w-[16rem] ml-[12px]",modelValue:x(Ca),"onUpdate:modelValue":r[4]||(r[4]=a=>_(Ca)?Ca.value=a:null),"empty-values":[null,void 0]},{default:y((()=>[k(p,{label:"默认版本",value:""}),(v(!0),f(g,null,j(x(ja),(a=>(v(),q(p,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])])),_:1},8,["modelValue"]),k(X,{title:"安装信息",modelValue:x(Ua),"onUpdate:modelValue":r[7]||(r[7]=a=>_(Ua)?Ua.value=a:null),area:[50,36],onCancel:r[8]||(r[8]=()=>Da.value="正在请求安装...")},{default:y((()=>[h("div",ma,[h("pre",{innerHTML:x(Da),class:"whitespace-pre-wrap"},null,8,va)])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-0085a861"]]);export{fa as default};
