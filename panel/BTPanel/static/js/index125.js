import{c as e,r as a,h as t,o as s,n as o,k as r,l,e as d,x as i,q as m,p as c,y as u,z as n,A as p,a7 as f,a4 as _}from"./base-lib.js?v=1734676359";import{_ as y}from"./index335.js?v=1734676359";import{b as h,e as j}from"./utils-lib.js?v=1734676359";import{g as b,ak as x}from"./useStore3.js?v=1734676359";import{k}from"./useController.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const v={class:"p-2rem"},D={class:"flex items-center"},w={key:0,class:"text-[#888] mt-[8px] ml-10rem"},g=j(e({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(e,{expose:j,emit:g}){const C=h(),T=e,{rowData:Y,siteType:q}=T.compData,A=!!Array.isArray(Y),{refreshSiteTable:E}=b(),S=g,V=a(),M=t({edate:Y.edate||""}),z={},H=e=>e.getTime()<Date.now()-864e5,I=()=>{M.edate="",O(),U()},O=()=>{const e=document.querySelector(".date .el-input__inner");e&&(e.value="永久"),null==e||e.blur()},R=e=>{e||O()},U=async e=>{try{if(A){let e=[],a=[];Y.forEach((a=>{e.push(a.id)}));const t=await x({edate:M.edate?M.edate:"0000-00-00",sites_id:e});Object.keys(t.error).forEach((e=>{a.push({name:e,status:!1})})),await t.success.forEach((e=>{a.push({name:e,status:!0})})),k({title:"批量设置到期时间",resultTitle:"设置到期时间",resultData:a}),E(),S("close")}else{let e=C.load("正在设置到期时间，请稍后...");const a=await x({id:Y.id,edate:M.edate?M.edate:"0000-00-00"});a.data.status?(C.request(a),E()):C.error(a.data.msg),e.close(),S("close")}}catch(a){}};return j({onConfirm:U}),s((()=>{"0000-00-00"===Y.edate&&(M.edate="",o((()=>{O()})))})),(e,a)=>{const t=y,s=p,o=f,h=_;return r(),l("div",v,[d(h,{ref_key:"formRef",ref:V,model:c(M),rules:z},{default:i((()=>[d(o,{label:"到期时间",prop:"edate"},{default:i((()=>[m("div",D,[d(t,{modelValue:c(M).edate,"onUpdate:modelValue":a[0]||(a[0]=e=>c(M).edate=e),"value-format":"YYYY-MM-DD","disabled-date":H,class:"date",onChange:R,type:"date",placeholder:"选择日期"},null,8,["modelValue"]),d(s,{type:"default",class:"!ml-[.4rem]",onClick:I},{default:i((()=>a[1]||(a[1]=[u(" 设为永久 ")]))),_:1})])])),_:1})])),_:1},8,["model"]),c(M).edate?(r(),l("div",w,"* 到期当天24点后过期")):n("",!0)])}}}),[["__scopeId","data-v-1b83ee26"]]);export{g as default};
