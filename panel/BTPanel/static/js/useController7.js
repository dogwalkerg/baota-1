import{bR as e,bV as t,l as a,H as s,M as l,aM as n,G as r,a1 as i,o,c as u,d as c,e as d,bX as p,bY as m,O as v,J as h,bJ as f,an as y,bK as g,U as w,h as b,x as _,aR as x,r as S,k,R as C,a6 as A}from"./utils-lib.js?v=1734676359";import{applyCertOrderPay as L,checkSslMethod as T,applyBusSsl as N,checkUrlTxt as D,removeCloudCert as E,getDockerDeploySiteDomain as I,getDeploySiteDomain as P,uploadCertToCloud as O,getCertList as j,updateSslTask as V,setSslInfo as q,setProxyHttps as R,setDockerHttps as H,setSiteHttps as M,closeSiteHttps as B,downloadCert as U,applyProxyCertArrange as J,applyCertApi as z,getLetsEncryptList as F,downloadCertToLocal as X,setDockerCertToSite as G,setCertToSite as Z,delLetsEncrypt as W,getOrderDetail as K,authDomainApi as Q,renewalCert as Y,validateDomain as $,getComposerLine as ee,getDockerLetsEncryptSite as te,getLetsEncryptSite as ae,getDnsData as se,setDomainDNS as le,applyCertByca as ne,applyTrustAsiaCert as re,verifyTrustAsiaCret as ie,verifyTrustAsiaCert as oe,getTrustAsiaList as ue,letCertInitApi as ce,letRenewCert as de,reissueCertOrder as pe,getDnsApiList as me,closeCertArrange as ve,setBatchCertToSite as he}from"./site.js?v=1734676359";import{_ as fe}from"./index90.js?v=1734676359";import{s as ye,r as ge,i as we,h as be,e as _e,y as xe,c as Se,k as ke,J as Ce,x as Ae,H as Le,q as Te,m as Ne,p as De,aw as Ee,A as Ie,j as Pe,l as Oe,I as je,aX as Ve,F as qe,v as Re,n as He,az as Me,B as Be,M as Ue,C as Je,at as ze,av as Fe,o as Xe,z as Ge,aj as Ze,P as We,ag as Ke,ah as Qe,a2 as Ye,aY as $e,aT as et}from"./base-lib.js?v=1734676359";import{_ as tt}from"./index91.js?v=1734676359";import{a as at,u as st}from"./column.js?v=1734676359";import{u as lt,S as nt}from"./useStore11.js?v=1734676359";import{u as rt}from"./useStore7.js?v=1734676359";import{n as it,c as ot}from"./useController3.js?v=1734676359";import{u as ut}from"./useStore9.js?v=1734676359";import{g as ct}from"./useStore10.js?v=1734676359";import{o as dt}from"./validator.js?v=1734676359";const{siteInfo:pt,siteType:mt,isRefreshList:vt}=rt(),{isRefreshLocalList:ht}=ye(ut()),{orderInfo:ft,sslApplicationInfo:yt,certVerifyInfo:gt,otherPopup:wt,isRefreshSSL:bt,sslDnsApiInfo:_t}=lt(),{buyArtificialServiceEvent:xt,getCertAdminInfoEvent:St,submitCertInfoEvent:kt,setBusSslDeployEvent:Ct,getSslListEvent:At,verifyBusCertEvent:Lt,getCertSslListEvent:Tt,getDomainListEvent:Nt,jumpSslTabEvent:Dt}=nt(),Et=ge(!1),It=ge([]),Pt=["企业级证书","极速申请","防劫持/防篡改","提高SEO权重","赔付保证","不成功可退款","官方推荐(宝塔官网bt.cn也在使用)"],Ot=[{content:()=>_e("span",{class:"text-danger"},[xe("如果您的站点有使用CDN、高防IP、反向代理、301重定向等功能，可能导致验证失败")])},{content:"证书支持购买多年，只能一年签发一次（有效期一年），需在到期前30天内续签(续签暂不需要验证域名)。"},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败。"},{content:"商用证书相对于普通证书，具有更高的安全性、赔付保障和支持通配符和多域名等方式。"}],jt=e=>{let t="text-green";return e.endDate?(e.endDay<=30&&(t="text-orange"),_e("span",{class:e.endDay<=10?"text-danger":t},[e.endDay>0?"剩余".concat(e.endDay," 天"):"已过期"])):_e("span",null,[xe("--")])},Vt=async e=>{const t=await St();yt.value={...yt.value,...t.data},ft.value=e,kr({orderInfo:e})},qt=e=>{try{let t=[];return Object.keys(e).forEach((a=>{e[a].forEach((e=>{t.push({field:a,error:e})}))})),{data:t,total:t.length,other:{}}}catch(t){return{data:[],total:0,other:{}}}},Rt=async e=>{var t;const{data:a,status:s}=await Lt(e);s&&Cr(a),null==(t=wt.value)||t.unmount()},Ht=async()=>{try{const e=await At({siteName:pt.value.name});return bt.value=!1,e}catch(e){return{data:[],total:0,other:{}}}},Mt=ge(!1),Bt=ge(0),Ut=ge({}),Jt={defalutList:[],domianNumList:[],classList:[],brandList:[],typeList:[]},zt=ge({addPrice:0,productName:"",price:0,totalPrice:0,originalPrice:0,deploymentPrice:0,pid:0,years:1,yearsPrice:0,number:1,extraNumber:0,extraPrice:0,install:1}),Ft=ge({num:1,certClassAcitve:"OV",certClass:[{name:"OV证书",title:"推荐企业使用",value:"OV",tips:[],data:[]},{name:"DV证书",title:"推荐个人，测试使用",value:"DV",subscript:"热销",tips:[]},{name:"EV证书",title:"推荐大型政企使用，高安全性",value:"EV",tips:[]}],certBrandAcitve:"",certBrand:[{name:"Positive",title:"Positive",value:"Positive",tips:[]},{name:"锐安信",title:"锐安信",value:"锐安信",tips:[]},{name:"CFCA",title:"CFCA",value:"CFCA",tips:[]},{name:"Digicert",title:"Digicert",value:"Digicert",tips:[]},{name:"GeoTrust",title:"GeoTrust",value:"GeoTrust",tips:[]},{name:"Sectigo",title:"Sectigo",value:"Sectigo",tips:[]}],certTypeAcitve:"single",certType:[{name:"single",title:"单域名",value:"single",tips:[]},{name:"multiple",title:"多域名",value:"multiple",tips:[]},{name:"wildcard",title:"泛域名",value:"wildcard",tips:[]}],certLifeAcitve:1,certLife:[{name:"1年",title:"1年",value:1,tips:[]},{name:"2年",title:"2年",value:2,tips:[]},{name:"3年",title:"3年",value:3,tips:[]},{name:"4年",title:"4年",value:4,tips:[]},{name:"5年",title:"5年",value:5,tips:[]}],certDeployAcitve:1,certDeploy:[{name:"不需要",title:"不需要",value:0,tips:[]},{name:"部署服务",title:"部署服务",value:1,tips:[]},{name:"部署服务（国密）",title:"部署服务（国密）",value:2,tips:[]}]}),Xt={single:["仅支持绑定一个二级域名或者子域名，例如 bt.com、cloud.bt.com、dnspod.cloud.bt.com的其中之一 。","如需要绑定同级的所有子域名，例如*.bt.com，请购买泛域名证书。"],wildcard:["带通配符的域名，例如：*.bt.com、*.cloud.bt.com均为泛域名，包含同一级的全部子域名。","注意泛域名不支持跨级，例如*.bt.com 不包含 *.cloud.bt.com的支持"]},Gt={0:[],1:["宝塔提供9:00 - 24:00的人工部署证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"],2:["宝塔提供9:00 - 24:00的人工部署国密算法证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"]},Zt=we((()=>{const e=Ft.value.certClass.filter((e=>e.value===Ft.value.certClassAcitve));return e&&e.length>0?e[0].tips:[]})),Wt=we((()=>{const e=Ft.value.certBrand.filter((e=>e.value===Ft.value.certBrandAcitve));return e&&e.length>0?e[0].tips:[]})),Kt=we((()=>{const e=Ft.value.certType.filter((e=>e.value===Ft.value.certTypeAcitve));return e&&e.length>0?e[0].tips:[]})),Qt=we((()=>{const e=Ft.value.certLife.filter((e=>e.value===parseInt(Ft.value.certLifeAcitve)));return e&&e.length>0?e[0].tips:[]})),Yt=we((()=>{const e=Ft.value.certDeploy.filter((e=>e.value===parseInt(Ft.value.certDeployAcitve)));return e&&e.length>0?e[0].tips:[]})),$t=async()=>{try{Mt.value=!0;const{data:e,status:t}=await Tt();if(Mt.value=!1,!t)return l.request({msg:"获取证书列表失败",status:!1}),{status:!1,msg:"获取证书列表失败"};Ut.value=e.info.recommend,sa(),na(e.info),ia(e.data),oa()}catch(e){return{status:!1,msg:"获取证书列表失败"}}},ea=(e=Ft.value.num)=>{let t=e;if(n(e)&&"number"!=typeof e?(e=Number(e.data),t=Number(Ft.value.num)||1):t=Number(Ft.value.num+e)||1,t&&(t<1||t>99))return Ft.value.num=t<1?1:99,l.error("域名数量范围为1-99");Ft.value.num=t,"wildcard"!==Ft.value.certTypeAcitve&&(Ft.value.certTypeAcitve=Ft.value.num>1?"multiple":"single"),oa()},ta=(e,t,a)=>{a||(a=Ft.value[t].filter((t=>t.value===e))),a.disable||("".concat(t,"Acitve")in Ft.value&&(Ft.value["".concat(t,"Acitve")]=e),oa())},aa=()=>{var e;return Ut.value[null==(e=Ft.value.certClassAcitve)?void 0:e.toLowerCase()]},sa=()=>{Ft.value.certClassAcitve="OV",Ft.value.certBrandAcitve=aa(),Ft.value.certTypeAcitve="single",Ft.value.certLifeAcitve=1,Ft.value.certDeployAcitve=1},la=(e,t,a)=>e.map(((e,s)=>{const l=a?a(e,t):t[e.value];return{...e,tips:l}})),na=({type:e,brand:t,times:a})=>{Ft.value.certClass=la(Ft.value.certClass,e,((e,t)=>t["".concat(e.value).toLowerCase()])),Xt.multiple=Xt.single,Ft.value.certType=la(Ft.value.certType,Xt),Ft.value.certDeploy=la(Ft.value.certDeploy,Gt),Ft.value.certBrand=la(Ft.value.certBrand,t,((e,t)=>t["Positive"!==e.value?"".concat(e.value).toLowerCase():"Positive"])),Ft.value.certLife=la(Ft.value.certLife,a,((e,t)=>t[e.value+"_year"]))},ra=(e={})=>{let{num:t,classify:a,brand:s,type:l,life:n,deploy:r}=e;const i=Ft.value;return t||(t=i.num),a||(a=i.certClassAcitve),s||(s=i.certBrandAcitve),l||(l=i.certTypeAcitve),n||(n=i.certLifeAcitve),r||(r=i.certDeployAcitve),{num:t,classify:a,brand:s,type:l,life:n,deploy:r}},ia=e=>{const t=[];e.forEach((e=>{var a;const s=null==(a=e.type.match(/(OV|DV|EV)/))?void 0:a[0],l=-1!==e.code.indexOf("wildcard"),n=e.add_price>0;let r=l?"wildcard":n?"multiple":"single";"Digicert"===e.brand&&(r=l?"wildcard":"single"),t.push({...e,type:s,certType:r,isMulti:n})})),Jt.defalutList=t},oa=()=>{ua(Jt.defalutList),ma(),va()},ua=e=>{let{num:t}=ra();const a=e.filter((e=>!(t>1)||e.isMulti));a.length>0&&(Jt.domianNumList=a,ca(a))},ca=e=>{const{classify:t}=ra(),a=e.filter((e=>e.type===t));a.length>0&&(Jt.classList=a,da(a))},da=e=>{const{brand:t}=ra(),a=e.filter((e=>e.brand===t));a.length>0&&(Jt.brandList=a,pa(a))},pa=e=>{const{type:t}=ra();1===e.length&&(Ft.value.certTypeAcitve=e[0].certType);const a=e.filter((e=>{const a="multiple"===Ft.value.certTypeAcitve&&"wildcard"!==e.certType&&e.isMulti,s="wildcard"===Ft.value.certTypeAcitve&&"wildcard"===e.certType&&e.isMulti;return e.certType===t||a||s}));a.length>0&&(Jt.typeList=a)},ma=()=>{const{domianNumList:e,classList:t,brandList:a,typeList:s}=Jt;Ft.value.certClass.forEach((t=>{let a=e.some((e=>e.type===t.value));"EV"==t.value&&"wildcard"===Ft.value.certTypeAcitve&&(a=!1),t.disable=!a})),Ft.value.certBrand.forEach((e=>{var a;const s=!t.some((t=>t.brand===e.value));if(e.hidden=s,e.subscript=e.value===aa()?"推荐":"",e.value===Ft.value.certBrandAcitve&&e.hidden){Ft.value.certBrandAcitve=aa();const e=null==(a=null==Jt?void 0:Jt.classList)?void 0:a.filter((e=>e.brand===Ft.value.certBrandAcitve));e.length>0&&(Jt.brandList=e,pa(e))}})),Ft.value.certType.forEach((e=>{let t=!a.some((t=>t.certType===e.value));"single"===e.value&&Ft.value.num>1&&(t=!0),"multiple"===e.value&&1===Ft.value.num&&(t=!0),"multiple"===e.value&&Ft.value.num>1&&(t=!1),e.hidden=t}))},va=()=>{const e=Jt.typeList[0]||null;if(Bt.value=(null==e?void 0:e.num)||0,e){const{num:t,life:a,deploy:s}=ra(),{price:l,other_price:n,add_price:r,pid:i,num:o,install_price:u,install_price_v2:c}=e,d=t-o<0?0:t-o,p=[0,u,c][s],m=r*d,v=(m+l)*a+p,h=n+m+p;zt.value={addPrice:r||0,productName:e.title,price:l,totalPrice:v,originalPrice:h,deploymentPrice:p,pid:i,years:a,yearsPrice:l*a,number:o,extraNumber:d,extraPrice:m,install:Number(s)}}},ha=ge({oid:0,wxcode:"",alicode:"",qq:"",orderInfo:{}}),fa=async e=>{const{pid:t,install:a,years:s,extraNumber:n}=zt.value,i={pdata:JSON.stringify({pid:t,install:a,years:s,num:n})},{data:o,msg:u}=await r({loading:"正在创建商业证书订单，请稍后...",request:L(i)}),{status:c}=o;if(!c)return l.error(u);const{oid:d,wxcode:p,alicode:m,qq:v,order_info:h}=o.msg;ha.value={oid:d,wxcode:p,alicode:m,qq:v,orderInfo:h},Xr({...ha.value,productInfo:zt.value})},ya=[{content:"通配符证书只支持DNS验证"}],ga=[{content:"多域名只支持DNS验证"}],wa=ge(!1),ba=ge(!1),_a=ge(""),xa=ge(""),Sa=ge([]),ka=ge([]),Ca=ge(!1),Aa=ge(),La=ge({domain:""}),Ta=ge("CNAME_CSR_HASH"),Na=ge(!0),Da=ge("dns"),Ea=ge(!1),Ia=ge(!1),Pa=[{content:"https或者http验证，必须保证网站能通过http/https访问"},{content:"域名前缀是www,提醒用户解析上级根域名，如申请www.bt.cn，请确保解析bt.cn"},{content:()=>_e("a",{class:"text-primary",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[xe("如何验证商用证书?")])}],Oa=[{content:"申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)"},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败"},{content:"SSL证书可选名称赠送规则："},{content:"1、申请根域名(如：bt.cn),赠送下一级为www的域名(如：www.bt.cn)"},{content:"2、申请当前host为www的域名（如：www.bt.cn）,赠送上一级域名，(如: bt.cn)"},{content:"3、申请其它二级域名，(如：app.bt.cn)，赠送下一级为www的域名 (如：www.app.bt.cn)"}],ja=ge([{value:"CNAME_CSR_HASH",label:"DNS验证(CNAME解析)",tips:"如网站还未备案完成，可选【DNS验证】",isCheck:"",checkTips:[]},{value:"HTTP_CSR_HASH",label:"文件验证(HTTP)",tips:"如网站未开启301、302、强制HTTPS、反向代理功能，请选择HTTP",isCheck:"",checkTips:[]},{value:"HTTPS_CSR_HASH",label:"文件验证(HTTPS)",tips:"如网站开启【强制HTTPS】，请选【HTTPS验证】",isCheck:"",checkTips:[]}]),Va=[{content:"OV/EV证书申请流程条件："},{content:"1、填写网站验证信息(文件验证或DNS验证)"},{content:"2、完成邮箱认证，根据CA发送的邮件完善邮件内容(中文填写即可)"},{content:"3、企查查或者爱企查、百度地图、114best能查询到相关企业信息，且公司名和公司地址完全匹配"},{content:"4、企查查或其他平台留下的电话能保证周一到周五(7:00 - 15:00)能接听到CA的认证电话，电话号码归属地来自美国，请留意接听。"}],qa=we((()=>{const e=[];return Ia.value&&e.push(...ya),Ea.value&&e.push(...ga),e.push(...Pa),"dv"!==ft.value.type&&e.push(...Va),e})),Ra=we((()=>{const e=Ia.value?"*":"www";return Ea.value?"多域名".concat(Ia.value?"通配符":"","证书，每行一个域名，支持").concat(ft.value.limit,"个域名，必填项,例如：\r").concat(e,".bt.cn\r").concat(e,".bttest.cn"):"请输入需要申请证书的域名（单域名".concat(Ia.value?"通配符":"","证书），必填项，例如：").concat(e,".bt.cn")})),Ha=ge({domains:"",dcvMethod:"",auth_to:"",Administrator:{address:"",city:"",country:"",email:"",firstName:"",lastName:"",job:"",name:"",mobile:"",organation:"",postCode:"",state:""}}),Ma=we((()=>Ha.value.Administrator.lastName+Ha.value.Administrator.firstName)),Ba=()=>{Ha.value.Administrator={...yt.value,name:""},Ha.value.Administrator.name=Ma.value;const{pid:e,oid:t,title:a,limit:s,install:l,code:n}=ft.value,r=n.indexOf("ev")>-1?"ev":n.indexOf("ov")>-1?"ov":"dv";Ea.value=n.indexOf("multi")>-1,Ia.value=n.indexOf("wildcard")>-1,ft.value={pid:e,oid:t,title:a,limit:s,install:l,isMulti:Ea.value,isWildcard:Ia.value,type:r}},Ua=async()=>{var e,t;try{const a=await Nt();Sa.value=a.data.map((e=>({label:e.name,value:e.name,...e}))),wa.value=!0,xa.value=(null==(t=null==(e=Sa.value)?void 0:e[0])?void 0:t.name)||"",ka.value=Sa.value}catch(a){}},Ja=e=>{Sa.value=[],ka.value.forEach((t=>{t.name.indexOf(e)>-1&&Sa.value.push(t)})),Sa.value.length||(Sa.value=ka.value)},za=async()=>{Ha.value.domains=xa.value,wa.value=!1,Ia.value||Fa()},Fa=async()=>{Ca.value=!0;const{data:e}=await T(xa.value);Ca.value=!1,ja.value.forEach((t=>{i(e[t.value])?(t.isCheck=!!e[t.value],t.checkTips=!!e[t.value]):(t.isCheck=!1,t.checkTips=e[t.value])}))},Xa=be({domain:[e({message:"域名不能为空"}),{validator:(e,a,s)=>{t(a)?!Ia.value&&a.indexOf("*")>-1?s(new Error("当前为单域名证书，不支持通配符申请")):s():s(new Error("域名格式错误，请重新输入"))},trigger:["change"]}]}),Ga=()=>{ba.value=!0},Za=async()=>{var e;await(null==(e=Aa.value)?void 0:e.validate()),Ha.value.domains=La.value.domain,ba.value=!1,Ia.value||Fa()},Wa=e=>{const t=Da.value;if("dns"!==t){const a=_t.value.find((e=>e.value===t));if(a){const t=!a.data;(!e||e&&t)&&Tr({title:"设置".concat(a.info.title,"接口"),row:a.info})}}},Ka=async e=>{var t,a;let s=null;if(!e.value.domains)return l.error("域名不能为空");if(!e.value.Administrator.state&&!e.value.Administrator.city)return l.error("所在地区不能为空");if(!e.value.Administrator.address&&"dv"!==ft.value.type)return l.error("公司详细地址不能为空");if(!e.value.Administrator.organation)return l.error("公司名称不能为空");if(!e.value.Administrator.name)return l.error("姓名不能为空");if(!e.value.Administrator.email)return l.error("邮箱不能为空");if(!e.value.Administrator.mobile)return l.error("手机不能为空");try{s=l.load("正在提交证书信息，请稍后...");const{job:r,postCode:i,country:o,firstName:u,lastName:c,name:d,state:p,city:m,address:v,organation:h,email:f,mobile:y}=e.value.Administrator,g=await N(JSON.stringify({pid:ft.value.pid,oid:ft.value.oid,domains:null==(t=Ha.value.domains)?void 0:t.split("\n").filter((e=>e.trim())),dcvMethod:Ta.value,auth_to:Da.value,Administrator:{job:r,postCode:i,country:o,lastName:d,state:p,city:m,address:v,organation:h,email:f,mobile:y}}));if(n(g.data.msg)&&g.data.msg.hasOwnProperty("code")){let e=g.data.errors;It.value=[],Object.keys(e).forEach((t=>{e[t].forEach(((e,a)=>{It.value.push({field:t,error:e})}))})),Et.value=!0}else{let e=g.msg||g.data.msg,t=g.data.status;l.request(g.data||{msg:t?e||"提交成功":e||"资料提交错误，请检查管理员信息是否填写正确，如填写错误请联系客服重置订单",status:t})}if(g.data.status){bt.value=!0;const{data:e,status:t}=await Lt(ft.value.oid);e&&Cr(e),null==(a=wt.value)||a.unmount()}}catch(r){}finally{s&&s.close()}},Qa=async(e,t)=>{try{const a={url:e.url,content:e.content},s=await r({loading:"正在验证商用证书，请稍后...",request:D(a),data:Number});ls.value[t].status=s}catch(a){}},Ya=async()=>{var e,t;const{data:a}=await Lt(gt.value.oid);a&&(gt.value=a),await ts(),"PENDING"===(null==(e=gt.value)?void 0:e.certStatus)&&l.success("验证中，请耐心等待！"),"COMPLETE"===(null==(t=gt.value)?void 0:t.certStatus)&&l.success("验证成功！"),wt.value.unmount(),bt.value=!0},$a=e=>{as({oid:gt.value.oid,type:ss.value})},es=ge([{content:"本次验证结果是由【本服务器验证】，实际验证将由【CA服务器】进行验证，请耐心等候"},{content:"请确保以上列表所有项都验证成功后点击【验证域名】重新提交验证"},{content:"如长时间验证不通过，请通过【修改验证方式】更改为【DNS验证】"},{content:()=>_e("span",null,[xe("如何添加域名解析，《"),_e("a",{href:"https://cloud.tencent.com/document/product/302/3446",class:"text-primary",target:"__blink"},[xe("点击查看教程")]),xe("》，和咨询服务器运营商")])}]),ts=async()=>{var e;if(null==(e=gt.value)?void 0:e.data){const{data:{dcvList:e,DCVdnsHost:t,DCVdnsType:a,DCVdnsValue:s,DCVfileName:l,DCVfileContent:n},paths:r}=gt.value;ns.value=null==e?void 0:e.map((e=>e.domainName)).join(","),ss.value=e[0].dcvMethod;const i={dnsHost:t,dnsType:a,dnsValue:s,fileName:l,fileContent:n,filePath:"/.well-known/pki-validation/"};return"CNAME_CSR_HASH"!==ss.value&&(ls.value=null==r?void 0:r.map((e=>({url:e.url,status:e.status,content:n}))),es.value.splice(3,1,{content:()=>_e("span",null,[xe("SSL添加文件验证方式 ->> "),_e("a",{href:"https://www.bt.cn/bbs/thread-56802-1-1.html",target:"_blank",class:"text-primary"},[xe("查看教程")])])})),i}return l.error("获取数据失败"),{}},as=e=>a({title:"验证域名-"+(e.type.indexOf("CNAME_")>-1?"DNS验证":"文件验证"),area:52,showFooter:!0,btn:["更改","取消"],component:()=>s((()=>import("./modify-verify-way.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e}),ss=ge(""),ls=ge([]),ns=ge(),rs={id:"wechat-customer",class:"wechat-customer"},is={style:{background:"rgba(32, 165, 58, 0.1)",width:"100%",height:"46px",display:"flex","flex-direction":"row","align-items":"center","justify-content":"center"}},os={class:"qrcode-wechat",style:{width:"128px",height:"128px",margin:"8px 0 4px 0"}},us={id:"wechatCustomerQrcode"},cs=d(Se({__name:"customer-popover",props:{trigger:{default:"click"},showArrow:{type:Boolean,default:!0},placement:{default:"left"}},setup(e,{expose:t}){const a=e,s=ge(null),l=we((()=>a.trigger)),n=we((()=>a.showArrow)),r=we((()=>a.placement));return t({BtCustomerPopover:()=>s}),(e,t)=>{const a=u,i=c,o=Ee;return ke(),Ce(o,Ne({ref_key:"BtCustomerPopover",ref:s},e.$attrs,{trigger:De(l),placement:De(r),effect:"light","popper-class":"BtCustomerPopover","show-arrow":De(n),"popper-style":{padding:"0",border:"0",background:"0"}}),{reference:Ae((()=>[Le(e.$slots,"default",{},void 0,!0)])),default:Ae((()=>[Te("div",rs,[Te("div",is,[_e(a,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",style:{"font-size":"16px",display:"flex","flex-direction":"row","flex-wrap":"nowrap","align-items":"center"}},{default:Ae((()=>t[0]||(t[0]=[Te("div",{class:"flex items-center border-b border-solid border-[#20a53a60] pb-4px"},[xe(" 点击咨询客服 "),Te("i",{class:"svgtofont-el-d-arrow-right ml-4px w-[15px]"})],-1)]))),_:1})]),Te("div",os,[Te("div",us,[_e(i,{src:"/customer/customer-qrcode.png"})])]),t[1]||(t[1]=Te("div",{class:"wechat-title"},[Te("img",{class:"icon",style:{width:"17px",height:"17px"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),Te("div",{class:"scan-title",style:{"font-size":"16px"}},"扫一扫")],-1)),t[2]||(t[2]=Te("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[Te("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])])),_:3},16,["trigger","placement","show-arrow"])}}}),[["__scopeId","data-v-b8224117"]]),ds={class:"h-full"},ps={class:"recommendList"},ms={class:"text-[1.3rem] ml-[8px] text-stroke-primary"},vs={class:"flex flex-col w-full pt-[16px]"},hs={class:"flex items-center"},fs={class:"flex items-center"},ys=d(Se({__name:"index",setup(e,{expose:t}){const{sslAlertState:n}=lt(),{BtTable:r,BtRefresh:i,refresh:u}=p({request:Ht,columns:[{label:"域名",prop:"domainName",width:120,render:(e,t)=>_e("span",{class:"w-full whitespace-pre-line"},[e.domainName?e.domainName.join("、"):"--"])},{label:"证书类型",prop:"title",showOverflowTooltip:!0},{label:"到期时间",width:100,render:jt,showOverflowTooltip:!0},{label:"状态",prop:"expire",width:160,showOverflowTooltip:!1,render:(e,t)=>{const l=[],n=(e,t)=>_e("span",{style:"color: ".concat(e,";")},[t]),r=_e(Ee,{placement:"bottom-end",width:"400","popper-class":"white-theme",trigger:"click"},{default:()=>_e("div",{class:"bus-ssl-popover"},[_e("div",{class:"ssl-popover-item"},[_e("span",{class:"ssl-popover-title"},[xe("自行排查")]),_e("p",null,[xe("以图文的形式，一步步教您验证并部署商业SSL")]),_e("a",{class:"bt-link",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[xe("如何验证商用证书?")])]),_e("div",{class:"ssl-popover-item"},[_e("span",{class:"ssl-popover-title"},[xe("购买人工")]),_e("p",null,[xe("不会部署?人工客服帮你全程部署，不成功可退款")]),_e(Ie,{size:"small",type:"primary",onClick:()=>(async({oid:e})=>{try{const t=await xt({pdata:JSON.stringify({oid:e})});ft.value=t.data,a({isAsync:!0,title:"购买人工服务",area:60,component:()=>s((()=>import("./pay-ssl-service.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:t.data})}catch(t){}})(e)},{default:()=>[xe("购买人工")]})])]),reference:()=>_e("span",{class:"bt-link"},[xe("排查方法?")])});let i=e.domainName&&e.domainName.length>0;if(""!=e.certId||i)if(""==e.certId&&0!==e.domainName.length)l.push(_e("span",{class:"bt-warn"},[xe("待提交")]));else if(1===e.status)switch(e.orderStatus){case"COMPLETE":l.push(n("primary","订单完成"));break;case"PENDING":l.push((o="orange",u="验证中",_e(Ee,{trigger:"hover",placement:"left","popper-class":"popover-default",width:"300",enterable:!1,"open-delay":100,"close-delay":0},{default:()=>_e("div",{class:"flex items-center p-[2px] whitespace-nowrap"},[xe("1、如填写错误，联系人工可重置订单"),_e("br",null,null),xe("2、如验证方式选择错误，联系人工修改验证方式")]),reference:()=>_e("div",{style:"color: ".concat(o,";")},[u])})));break;case"CANCELLED":l.push(n("medium","已取消"));break;case"FAILED":l.push(n("danger","申请失败"));break;case"EXPIRED":l.push(n("medium","已过期"));break;default:l.push(n("orange","待验证"))}else switch(e.status){case 0:l.push(n("orange","未支付"));break;case-1:l.push(n("medium","已取消"))}else l.push(_e("span",{class:"bt-warn",onClick:()=>Vt(e)},[xe("待完善资料")])),l.push(r);var o,u;const c=[];return l.map(((e,t)=>{c.push(e),t<l.length-1&&c.push(_e(tt,null,null))})),c}},{label:"操作",prop:"ps",width:140,align:"right",render:(e,t)=>{const a=(e,t)=>_e("span",{class:"bt-link",onClick:t},[e]),s=a("人工服务",(()=>dt())),n=a("下载",(()=>(({oid:e})=>{window.open("/ssl?action=download_cert&oid=".concat(e))})(e))),r=a("部署",(()=>(async({oid:e,title:t,domainName:a})=>{try{const s=pt.value.name,l=mt.value;await o({title:"部署证书",isHtml:!0,content:"是否部署该证书,是否继续？<br>\n\t\t    证书类型：".concat(t,"<br>\n\t\t    证书支持域名：").concat(a.join("、"),"<br>\n\t\t    部署站点名:").concat(s)});const n={proxy:{oid:e,site_name:s},docker:{oid:e,site_name:s},default:{oid:e,siteName:s}},r=await Ct(n[l]||n.default);return Ht(),xr(),bt.value=!0,vt.value=!0,ht.value=!0,Dt("currentCertInfo"),r}catch(s){}})(e))),i=a("验证",(()=>Rt(e.oid))),u=a("续签",(()=>Fr(e.oid))),c=[],d=e.domainName&&e.domainName.length>0;if(""!=e.certId||d)if(""==e.certId&&0!==e.domainName.length)c.push(a("提交",(()=>(async e=>{try{const{data:t}=await kt({oid:e.oid});if(-1===t.code&&t.errors)qt(t.errors),Et.value=!0;else{let a=t.msg||t.data.msg,s=t.status;l.request({msg:s?a||"提交成功":"资料提交错误，请检查管理员信息是否填写正确，如填写错误请联系客服重置订单",status:s}),s&&Rt(e.oid)}Ht()}catch(t){}})(e))));else if(1===e.status)switch(e.orderStatus){case"COMPLETE":1===e.ssl_state?c.push(_e("span",null,[xe("已部署")])):c.push(r),e.endDay<30&&c.push(u),c.push(n);break;case"PENDING":default:e.install&&c.push(s),c.push(i);break;case"CANCELLED":c.push(_e("span",null,[xe("无操作")]));break;case"FAILED":c.push(_e("span",{class:"bt-danger cursor-default"},[xe("申请失败")]));break;case"EXPIRED":c.push(r),c.push(n)}else c.push(_e("span",null,[xe("无操作")]));else e.install&&c.push(s),c.push(a("完善资料",(()=>Vt(e))));const p=[];return c.map(((e,t)=>{p.push(e),t<c.length-1&&p.push(_e(tt,null,null))})),p}}],extension:[m()]}),d=Pe((()=>{const e=document.querySelector("#pane-busSslList");e&&e.click()}),1e3);return t({init:u}),(e,t)=>{const a=Ie,s=c,l=fe,o=v;return ke(),Oe("div",ds,[Te("div",ps,[(ke(!0),Oe(je,null,Ve(De(Pt),((e,a)=>(ke(),Oe("div",{key:a,class:qe("".concat(6===a?"w-[22rem]":"w-[14rem]"," recomItem"))},[t[0]||(t[0]=Te("i",{class:"svgtofont-el-check font-bold text-[#ff8d00] text-[1.6rem]"},null,-1)),Te("span",ms,Re(e),1)],2)))),128))]),Te("div",vs,[_e(l,null,{"header-left":Ae((()=>[Te("div",hs,[_e(a,{type:"primary",onClick:De(wr)},{default:Ae((()=>t[1]||(t[1]=[xe(" 申请证书 ")]))),_:1},8,["onClick"]),_e(cs,{placement:"right"},{default:Ae((()=>[Te("div",fs,[_e(s,{src:"/static/icons/we-com.svg",class:"mx-[4px] w-2rem h-2rem",all:!0}),t[2]||(t[2]=Te("span",{class:"bt-link"},"售前客服",-1))])])),_:1})])])),"header-right":Ae((()=>[_e(De(i))])),content:Ae((()=>[_e(De(r),{"max-height":De(n)?320:380,onWheel:De(d)},null,8,["max-height","onWheel"])])),_:1})]),_e(o,{options:De(Ot),listStyle:"disc"},null,8,["options"])])}}}),[["__scopeId","data-v-7ea86f43"]]),{siteType:gs,siteInfo:ws}=rt(),{isRefreshSSL:bs}=lt(),_s=[{label:"所有",value:0},{label:"未过期",value:1},{label:"即将过期",value:2},{label:"已过期",value:3}],xs=ge(!1),Ss=ge(),ks=ge({}),Cs=ge(!1),As=be({typeValue:"全部",btnText:"部署证书",search:"",data:{all:[],site:[]},siteList:[]}),Ls=async(e=gs.value)=>{if(0===As.siteList.length)return void l.error("请选择站点");const{hash:t,subject:a}=ks.value;await Ar({hash:t,subject:a,list:As.siteList,type:e}),Cs.value=!1},Ts=async e=>{await o({title:"删除证书",content:"删除后该证书将不会显示在证书夹，是否继续操作？",icon:"warning-filled"}),await r({loading:"正在删除证书...",request:E({local:e.cloud_id>0?0:1,ssl_hash:e.hash}),message:!0}),bs.value=!0};ge([at(),{label:"站点名称",prop:"name",render:e=>e.current?e.name+"(当前站点)":e.name}]);const Ns=async e=>{let t={},a=!0;void 0!==e&&(t={cert_list:JSON.stringify(e.dns)},a=!1,ks.value=e);const s=await r({request:"docker"===gs.value?I(t):P(t),data:{all:Array,site:Array}});As.data={all:s.all.map((e=>({name:e}))),site:s.site.map((e=>({name:e})))},a||(Cs.value=!0,He((()=>{var e;As.data.all.forEach(((e,t)=>{e.name===ws.value.name&&(e.current=!0,As.data.all.unshift(As.data.all.splice(t,1)[0]))})),null==(e=Ss.value)||e.toggleRowSelection(As.data.all.find((e=>e.name===ws.value.name)),!0)})))},Ds=e=>{As.siteList=e,e.length<=0?As.btnText="部署证书":As.btnText="部署证书[已选择".concat(e.length,"项]")},Es=e=>{As.typeValue=e},Is=async e=>{try{await o({title:"上传云端证书",content:"将会上传证书信息至云端进行替换，是否继续操作？",icon:"warning-filled",type:"calc"});await r({loading:"正在上传证书至云端...",request:O({ssl_hash:e.hash}),message:!0});bs.value=!0}catch(t){}},Ps=ge(!1),Os=async()=>{Ps.value=!0,bs.value=!0,l.success("获取成功")},js=async(e,t=Ps.value)=>{try{const a={search_limit:e.search_limit,search_name:e.search,force_refresh:Number(t)};Ps.value=!1;const{data:s}=await r({loading:xs,request:j(a)});return h(s)||l.request(s),t&&l.success("获取成功"),{data:s,total:0,other:{}}}catch(a){return{data:[],total:0,other:{}}}},Vs={class:"relative h-[45rem]"},qs={class:"p-[20px]"},Rs={class:"flex flex-col p-[12px] bg-[#f5faf2]"},Hs={class:"mb-[4px]"},Ms={class:"mb-[4px]"},Bs={class:"mb-[4px]"},Us={class:"flex justify-between mb-[1rem]"},Js={class:"absolute bottom-0 w-full bg-[#f6f8f8] flex items-center justify-end p-[12px]"},zs=Se({__name:"index",setup(e,{expose:t}){const{isRefreshSSL:a}=lt(),s=g({key:"search_limit",options:_s,other:{class:"!w-[10rem] mr-1rem",filterable:!0}}),{BtTable:l,BtSearch:n,BtTableSelect:r,refresh:i}=f({request:js,columns:[{label:"域名",prop:"subject",render:e=>{var t;return Me("div",{class:"whitespace-pre-wrap"},(null==(t=e.dns)?void 0:t.join("\n"))||e.subject)}},{label:"到期时间",prop:"not_after"},{label:"品牌",prop:"info.issuer",showOverflowTooltip:!0},{label:"位置",render:e=>e.cloud_id>0?"云端":"本地"},st([{onClick:Is,width:60,title:"上传云端",isHide:e=>e.cloud_id>0},{onClick:Ns,title:"部署"},{onClick:Ts,title:"删除"}])],extension:[s,y(a)]});return t({init:i}),(e,t)=>{const a=Ie,s=w,i=ze,o=Fe,u=b,c=fe,d=Be("bt-loading");return ke(),Oe("div",null,[_e(c,null,{"header-left":Ae((()=>[_e(a,{type:"default",onClick:De(Os)},{default:Ae((()=>t[4]||(t[4]=[xe(" 从云端同步 ")]))),_:1},8,["onClick"])])),"header-right":Ae((()=>[Te("div",null,[_e(De(r))]),_e(De(n),{class:"w-[30rem]",placeholder:"请输入域名搜索"})])),content:Ae((()=>[_e(De(l),{"max-height":500})])),popup:Ae((()=>[_e(u,{title:"部署当前证书",modelValue:De(Cs),"onUpdate:modelValue":t[3]||(t[3]=e=>Ue(Cs)?Cs.value=e:null),area:52},{default:Ae((()=>{var e;return[Te("div",Vs,[Te("div",qs,[Te("div",Rs,[Te("span",Hs,"认证域名："+Re(De(ks).subject),1),Te("span",Ms,"证书类型："+Re(null==(e=De(ks).info)?void 0:e.issuer),1),Te("span",Bs,"到期时间："+Re(De(ks).not_after),1)]),t[5]||(t[5]=Te("span",{class:"!mt-[24px] !mb-[4px] inline-block"},"如下是需要批量部署证书的站点：",-1)),Te("div",Us,[_e(s,{type:"button",modelValue:De(As).typeValue,"onUpdate:modelValue":t[0]||(t[0]=e=>De(As).typeValue=e),size:"default",options:[{label:"全部",value:"全部"},{label:"匹配站点",value:"匹配站点"}],onChange:De(Es)},null,8,["modelValue","onChange"])]),Je((ke(),Ce(o,{ref_key:"deploySiteTableRef",ref:Ss,onSelectionChange:De(Ds),data:De(As).data["全部"===De(As).typeValue?"all":"site"],"max-height":180},{default:Ae((()=>[_e(i,{type:"selection",width:"55"}),_e(i,{label:"站点名称",prop:"name"},{default:Ae((e=>[xe(Re(String(e.row.name)+(e.row.current?"(当前站点)":"")),1)])),_:1})])),_:1},8,["onSelectionChange","data"])),[[d,"正在加载中，请稍后...","title"],[d,De(xs)]])]),Te("div",Js,[_e(a,{type:"warning",onClick:t[1]||(t[1]=e=>Cs.value=!1)},{default:Ae((()=>t[6]||(t[6]=[xe("取消")]))),_:1}),_e(a,{type:"primary",onClick:t[2]||(t[2]=e=>De(Ls)())},{default:Ae((()=>[xe(Re(De(As).btnText),1)])),_:1})])])]})),_:1},8,["modelValue"])])),_:1})])}}}),{sslInfo:Fs,sslTabActive:Xs}=lt(),{siteInfo:Gs,siteType:Zs,isRefreshList:Ws}=rt(),{isRefreshLocalList:Ks}=ye(ut()),Qs=[{content:()=>_e("span",null,[xe("粘贴您的*.key以及*.pem内容，然后保存即可"),_e("a",{href:"http://www.bt.cn/bbs/thread-704-1-1.html",class:"text-primary",target:"_blank"},[xe("[帮助]")]),xe("。")])},{content:"如果浏览器提示证书链不完整,请检查是否正确拼接PEM证书"},{content:"PEM格式证书 = 域名证书.crt + 根证书(root_bundle).crt"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"}],Ys=e=>{switch(e){case 3:Xs.value="busSslList";break;case 2:Xs.value="trustAsiaList";break;case 1:Xs.value="letsEncryptList";break;case 0:Xs.value="currentCertInfo";break;default:Xs.value="certFolderList"}},$s=ge(!1),el=ge(!1),tl=async e=>{e?it({onCancel:()=>{Fs.value.pushAlarm=!e}}):(el.value="all"===Fs.value.push.task_data.project,$s.value=!0)},al=()=>{Fs.value.pushAlarm=!0},sl=async()=>{let e;$s.value=!1;try{e=l.load("正在关闭证书到期提醒，请稍后...");const t=(()=>{const{id:e,task_data:t,sender:a}=Fs.value.push;return{template_id:1,task_id:e,status:0,task_data:JSON.stringify({task_data:{status:!1,type:"site_ssl",project:el.value?"all":Gs.value.name,cycle:parseInt(t.cycle),title:"网站SSL到期提醒",interval:600,tid:1},sender:a,time_rule:{send_interval:0,time_range:[0,86399]},number_rule:{day_num:0,total:3}})}})(),a=await V(t);l.request(a),a.status&&xr()}catch(t){}finally{e&&e.close()}},ll=async()=>{let e=!1;const{key:t,csr:a,type:s}=Fs.value,{name:n}=Gs.value;if(!rl.value&&!il.value)return l.error("请填写完整的证书内容");rl.value===t&&il.value===a||(e=!0,await o({title:"证书保存提示",content:"当前证书内容发生改变，证书信息将同步更新，继续操作？"}));const i={proxy:{site_name:n,key:rl.value,csr:il.value},docker:{site_name:n,key:rl.value,csr:il.value},default:{type:e?0:s,siteName:n,key:rl.value,csr:il.value}};await r({loading:"正在保存证书信息，请稍后...",request:q(i[Zs.value]||i.default,Zs.value),message:!0,success:e=>{e.status&&(Ws.value=!0,Ks.value=!0,xr())}})},nl=async e=>{try{e||await o({title:"关闭强制HTTPS",content:"关闭强制HTTPS后需要清空浏览器缓存才能生效,是否继续操作?",icon:"warning-filled"});const{name:t}=Gs.value,a=Zs.value,s={proxy:{site_name:t,force_https:e?"1":"0"},docker:{site_name:t,force_https:e?"1":"0"},default:{siteName:t}},l=s[a]||s.default,n={proxy:R,docker:H,default:e?M:B},i=n[a]||n.default;await r({loading:"正在".concat(e?"开启":"关闭","强制HTTPS，请稍后..."),request:i(l),message:!0}),await xr()}catch(t){Fs.value.https=!e}},rl=we({get:()=>Fs.value.key,set:e=>{Fs.value.key=e}}),il=we({get:()=>Fs.value.csr,set:e=>{Fs.value.csr=e}}),ol=async()=>{const e={siteName:Gs.value.name,pem:il.value,key:rl.value},{status:t,msg:a}=await r({loading:"正在下载证书，请稍后...",request:U(e),data:{status:Boolean,msg:String}});t&&window.open("/download?filename="+encodeURIComponent(a))};let ul=!0;const cl=()=>{try{ul?ul=!1:br()}catch(e){}},dl=()=>{var e;try{let t={};const{push:a}=Fs.value;if(a&&(a.status,1)){const{sender:e,module:s,status:l,id:n}=Fs.value.push,{cycle:r}=a.task_data;t={cycle:r||1,push:Array.isArray(e)?e:e?e.split(","):[],dueAlarm:a.status,id:n||(new Date).getTime(),domainName:Gs.value.name}}return"all"===(null==(e=null==a?void 0:a.task_data)?void 0:e.project)&&a.status&&(t.allSsl=!0),{data:t,status:!0}}catch(t){return{status:!1,msg:"获取证书到期提醒配置失败"}}},pl=async(e,t)=>{try{await t();const a=(e=>{const{id:t,allSsl:a,push:s,cycle:l,dueAlarm:n}=e;return{template_id:1,task_id:Fs.value.push.id,status:n?1:0,task_data:JSON.stringify({task_data:{status:n,type:"site_ssl",project:a?"all":Gs.value.name,cycle:parseInt(l),title:"网站SSL到期提醒",interval:600,tid:1},sender:s,time_rule:{send_interval:0,time_range:[0,86399]},number_rule:{day_num:0,total:3}})}})(e.value),s=await r({loading:"正在设置到期提醒，请稍后...",request:V(a),message:!0});return xr(),s.status}catch(a){return!1}},ml={class:"flex flex-col w-full overflow-y-hidden"},vl={key:0,class:"ssl-status-info"},hl={class:"left flex-1"},fl=["title"],yl={class:"!mb-0"},gl={class:"right flex-1"},wl=["title"],bl={key:0},_l={key:1,class:"text-danger"},xl={class:"!mb-0"},Sl={class:"flex items-center"},kl={class:"flex flex-1 justify-start"},Cl={class:"flex-1 mr-[20px]"},Al={class:"flex-1"},Ll={class:"my-[16px]"},Tl={class:"p-2rem"},Nl={class:"flex"},Dl={class:"ml-4"},El={class:"mt-8px flex items-center"},Il=d(Se({__name:"index",setup(e,{expose:t}){const{sslInfo:a}=lt(),s=["其他证书","Let's Encrypt","宝塔SSL","商业证书"],l=we((()=>-1!==a.value.type?s[a.value.type]:s[0]));return Xe(cl),t({init:cl}),(e,t)=>{var s,n,r,i;const o=u,c=Ze,d=We,p=Ie,m=v,h=Ke,f=Qe,y=b;return ke(),Oe("div",ml,[(null==(s=De(a))?void 0:s.isCertInfo)?(ke(),Oe("div",vl,[Te("div",hl,[Te("div",null,[t[10]||(t[10]=Te("span",null,"证书分类：",-1)),Te("span",null,[_e(o,{onClick:t[0]||(t[0]=e=>De(Ys)(De(a).type))},{default:Ae((()=>[xe(Re(De(l)),1)])),_:1})])]),Te("div",null,[t[11]||(t[11]=Te("span",null,"认证域名：",-1)),Te("span",{class:"truncate max-w-24rem",title:De(a).dns.join("、")},Re(De(a).dns.join("、")),9,fl)]),Te("div",yl,[t[12]||(t[12]=Te("span",null,"强制HTTPS：",-1)),Te("span",null,[_e(c,{size:"small",class:"!mb-0",modelValue:De(a).https,"onUpdate:modelValue":t[1]||(t[1]=e=>De(a).https=e),onChange:De(nl)},null,8,["modelValue","onChange"])])])]),Te("div",gl,[Te("div",null,[t[13]||(t[13]=Te("span",null,"证书品牌：",-1)),Te("span",{class:"truncate max-w-24rem",title:De(a).issuer},Re(De(a).issuer),9,wl)]),Te("div",null,[t[14]||(t[14]=Te("span",null,"到期时间：",-1)),Te("span",null,[Number(De(a).endtime)>0?(ke(),Oe("span",bl,Re(De(a).notAfter),1)):(ke(),Oe("span",_l,"证书已过期"))])]),Te("div",xl,[t[16]||(t[16]=Te("span",null,"到期提醒：",-1)),Te("span",Sl,[_e(c,{size:"small",class:"!mb-0",modelValue:De(a).pushAlarm,"onUpdate:modelValue":t[2]||(t[2]=e=>De(a).pushAlarm=e),onChange:De(tl)},null,8,["modelValue","onChange"]),_e(o,{class:"ml-[8px]",onClick:t[3]||(t[3]=e=>De(it)())},{default:Ae((()=>t[15]||(t[15]=[xe(" 到期设置提醒 ")]))),_:1})])])])])):Ge("",!0),Te("div",kl,[Te("div",Cl,[t[17]||(t[17]=Te("div",{class:"mb-[4px]"},"密钥(KEY)",-1)),_e(d,{type:"textarea",rows:12,modelValue:De(rl),"onUpdate:modelValue":t[4]||(t[4]=e=>Ue(rl)?rl.value=e:null)},null,8,["modelValue"])]),Te("div",Al,[t[18]||(t[18]=Te("div",{class:"mb-[4px]"},"证书(PEM格式)",-1)),_e(d,{type:"textarea",rows:12,modelValue:De(il),"onUpdate:modelValue":t[5]||(t[5]=e=>Ue(il)?il.value=e:null)},null,8,["modelValue"])])]),Te("div",Ll,[_e(p,{type:"primary",class:"mr-[4px]",onClick:De(ll)},{default:Ae((()=>{var e;return[xe(Re((null==(e=De(a))?void 0:e.isStart)?"保存":"保存并启用证书"),1)]})),_:1},8,["onClick"]),(null==(n=De(a))?void 0:n.isSupportRenewal)||1===(null==(r=De(a))?void 0:r.type)?(ke(),Ce(p,{key:0,type:"primary",class:"mr-[4px]",onClick:t[6]||(t[6]=e=>De(Br)())},{default:Ae((()=>t[19]||(t[19]=[xe(" 续签证书 ")]))),_:1})):Ge("",!0),De(a).csr?(ke(),Ce(p,{key:1,type:"default",class:"mr-[4px]",onClick:t[7]||(t[7]=e=>De(ol)())},{default:Ae((()=>t[20]||(t[20]=[xe(" 下载证书 ")]))),_:1})):Ge("",!0),(null==(i=De(a))?void 0:i.isStart)?(ke(),Ce(p,{key:2,type:"default",onClick:De(Gr)},{default:Ae((()=>t[21]||(t[21]=[xe(" 关闭SSL ")]))),_:1},8,["onClick"])):Ge("",!0)]),_e(m,{options:De(Qs),"list-style":"disc",class:"ml-[20px]"},null,8,["options"]),_e(y,{title:"关闭证书到期提醒",showFooter:"",modelValue:De($s),"onUpdate:modelValue":t[9]||(t[9]=e=>Ue($s)?$s.value=e:null),onConfirm:De(sl),onCancel:De(al),area:["auto"]},{default:Ae((()=>[Te("div",Tl,[Te("div",Nl,[t[24]||(t[24]=Te("i",{class:"svgtofont-el-warning-filled !text-[4rem] text-warning"},null,-1)),Te("div",Dl,[t[23]||(t[23]=Te("div",{class:"py-[.3rem] leading-[2.4rem] text-[1.3rem]"},"关闭证书到期提醒后将不在提醒和证书到期，是否继续操作？",-1)),Te("div",El,[t[22]||(t[22]=Te("div",null,"应用配置",-1)),_e(f,{modelValue:De(el),"onUpdate:modelValue":t[8]||(t[8]=e=>Ue(el)?el.value=e:null),class:"!w-[20rem] ml-2rem"},{default:Ae((()=>[_e(h,{label:"应用到当前站点",value:!1}),_e(h,{label:"应用到所有未设置过的站点",value:!0})])),_:1},8,["modelValue"])])])]),_e(m,{options:[{content:"任务优先级：单个站点的任务优先于所有站点的任务。"}],"list-style":"disc",class:"ml-4rem mt-2rem"})])])),_:1},8,["modelValue","onConfirm","onCancel"])])}}}),[["__scopeId","data-v-14f3a614"]]),{siteInfo:Pl,siteType:Ol}=rt(),{isRefreshSSL:jl,sslDnsApiInfo:Vl,otherPopup:ql}=lt(),{jumpSslTabEvent:Rl}=nt(),Hl=ge(!1),Ml=be({}),Bl=ge([]),Ul=ge([]),Jl=ge(!1),zl=ge(""),Fl=e=>{var t;const a=(null==(t=e.domains)?void 0:t.length)>0,s=a?(l=e.endDay)<=0||l<=7?"text-danger":l<=15?"text-orange":"text-[#20a53a]":"text-[#333]";var l;const n=a?e.endDay>0?"剩余".concat(e.endDay,"天"):"已过期":"--";return _e("span",{class:s},[n])},Xl=e=>{let t="";if("pending"===e.status){if(e.expires<(new Date).getTime()/1e3)return t=_e("span",null,[xe("--")]),t;t=_e("span",{class:"text-[#e6a23c]"},[xe("待验证")])}else t=_e("span",{class:"text-[#20a53a]"},[xe("订单完成")]);return t},Gl=[{content:()=>_e("span",{class:"text-danger"},[xe("注意：请勿将SSL证书用于非法网站")])},{content:()=>_e("span",null,[xe("Let's Encrypt 证书申请和续签限制"),_e("a",{class:"bt-link",href:"https://letsencrypt.org/zh-cn/docs/rate-limits/",target:"_blank"},[xe("点击查看")])])},{content:()=>_e(je,null,[xe("Let's Encrypt因更换根证书，部分老旧设备访问时可能提示不可信，考虑购买")," ",_e("span",{class:"bt-link",onClick:()=>Rl("busSslList")},[xe("[商业证书]")])])},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败"},{content:"Let's Encrypt免费证书，有效期3个月，支持多域名。默认会自动续签"},{content:"若您的站点使用了CDN或301重定向会导致续签失败"},{content:"在未指定SSL默认站点时未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"}],Zl=ge([{label:"解析域名",prop:"domain"},{label:"记录值",showOverflowTooltip:!0,prop:"auth_value",render(e,t){const a="dns"===Ml.auth_type?e.auth_value:e.file_path;return _e("div",{class:"flex items-center"},[_e("div",{class:"truncate w-[15rem]"},[a]),_e("span",{class:"svgtofont-icon-copy ml-[4px] text-[#666] text-[1.6rem] w-[1.6rem] cursor-pointer",onClick:()=>_({value:a})},null)])}},{label:"类型",prop:"type",render:(e,t)=>"dns"===Ml.auth_type?_e("span",null,[e.type]):_e("div",{class:"flex items-center"},[_e("div",{class:"truncate w-[15rem]"},[e.content]),_e("span",{class:"svgtofont-icon-copy ml-[4px] text-[#666] text-[1.6rem] w-[1.6rem] cursor-pointer",onClick:()=>_({value:e.content})},null)])},{label:"必需",prop:"must",width:100}]),Wl=ge(!1),Kl=async()=>{try{const e=await r({loading:Wl,request:F({siteName:Pl.value.name}),data:Array});return{data:e,total:e.length,other:{}}}catch(e){return{data:[],total:0,other:{}}}},Ql=async({index:e},t=!1,a=Pl.value.name)=>{try{const s={index:e,siteName:a},l=await r({loading:"正在部署证书，请稍候...",request:"docker"===Ol.value?G(s):Z(s),message:!1,data:{status:Boolean,msg:String}});return Lr(l,t),l.status&&Rl("currentCertInfo"),{status:l.status,msg:l.msg}}catch(s){return{status:!1,msg:"部署失败"}}},Yl=async e=>{const t=await Ir(),{data:a}=await Q({index:Ml.index,domain:e.domain});t._props.onCancel(),"valid"===a.status?l.success("验证成功"):!0===a.status?(Hl.value=!1,Ql(a,!0)):Er(a,e.data,Ml)},$l=async()=>{const e=await Ir(),t=await r({request:$({index:Ml.index}),message:!1});e._props.onCancel(),!0===t.status?(Hl.value=!1,Ql(t,!0)):Er({msg:t.data},Bl.value,Ml)},en=()=>{Zr({})},tn=ge([{content:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{content:""},{content:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}]),an=ge([]),sn=ge("dns"),ln=ge(!1),nn=async(e={id:Pl.value.id})=>{try{const t=await r({request:"docker"==Ol.value?te(e):ae(e),data:{domains:Array}});return pn.domain=t.domains.map((e=>e.name)),an.value=t.domains,{data:t.domains,status:!0,msg:"获取站点数据成功"}}catch(t){return{status:!1,msg:"获取站点数据失败"}}},rn=async e=>{try{e=Ye(e.value);const t=Ol.value,a=Pl.value.name;if(0===e.checkList.length)return l.error("请选择一个域名"),!1;const s=an.value.filter((t=>e.checkList.includes(t.name)));if("1"===e.resource&&gn(s)&&!pn.auth_to)return l.error("选中的域名存在未设置DNS接口配置"),!1;if("1"===e.resource&&e.autoWildcard&&e.checkList.some((e=>-1!==e.indexOf("*"))))return l.error("开启自动组合泛域名时不能选择泛域名"),!1;let n={domains:JSON.stringify(e.checkList),auth_type:"1"==e.resource?"dns":"http",auth_to:"1"===e.resource&&e.auth_to?"dns":JSON.stringify(e.checkList),auto_wildcard:e.autoWildcard?"1":"0",id:Pl.value.id};const r=await Ir(),i={proxy:{...n,site_name:a},docker:{...n,site_name:a},default:n},o=await z(i[t]||i.default,t);r._props.onCancel();const u=await ql.value;return o.status&&(null==u||u.unmount()),jr(o.data,e),o.status}catch(t){return l.error("程序发生错误！"),!1}},on=e=>{a({isAsync:!0,title:"配置DNS接口",area:50,component:()=>s((()=>import("./set-domain-dns.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{row:e,refresh:nn},showFooter:!0})},un=e=>{var t;const a=sn.value;if("dns"!==a&&"http"!==a){const s=null==(t=Vl.value)?void 0:t.find((e=>e.value===a));if(s){const t=!s.data;(!e||e&&t)&&Tr({title:"设置".concat(s.info.title,"接口"),row:s.info})}}},cn=e=>{const t=an.value.filter((e=>1===e.apply_ssl));pn.checkList=e?t.map((e=>e.name)):[],ln.value=!1},dn=e=>{const t=e.length;pn.checkAll=t===pn.domain.length,ln.value=t>0&&t<pn.domain.length},pn=be({resource:"0",auth_to:!1,autoWildcard:!1,checkAll:!1,domain:[],checkList:[]}),mn=ge([{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"},{content:()=>_e("span",null,[xe("在DNS验证中，我们提供了多种自动化DNS-API，并提供了手动模式-"),_e("span",{class:"bt-link",onClick:()=>{x(),S.push({name:"domain"})}},[xe("点击添加DNS接口")])])},{content:"使用DNS接口申请证书可自动续期，手动模式下证书到期后需重新申请"}]),vn=[{content:()=>_e("span",{class:"text-danger"},[xe("注意：请勿将SSL证书用于非法网站")])},{content:"使用【DnsPod/阿里云DNS】等接口前您需要先在弹出的窗口中设置对应接口的API"}],hn=ge([{content:()=>_e("span",null,[" ",xe("Let's Encrypt 证书申请和续签限制")," ",_e("a",{class:"bt-link",target:"_blank",href:"https://letsencrypt.org/zh-cn/docs/rate-limits/"},[xe("点击查看")])])},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败"},{content:"Let's Encrypt免费证书，有效期3个月，支持多域名。默认会自动续签"},{content:"若您的站点使用了CDN或301重定向会导致续签失败"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"}]),fn=we((()=>{const e="0"===pn.resource?hn.value:mn.value,t=vn.concat([]);return t.splice(1,0,...e),t})),yn=()=>{Object.assign(pn,{resource:"0",auth_to:!1,autoWildcard:!1,checkAll:!1,domain:[],checkList:[]})},gn=e=>e.some((e=>0===e.dns_status)),wn=ge("正在申请证书..."),bn=ge(),_n=async()=>{bn.value=setInterval((async()=>{try{await r({request:ee({filename:"/www/server/panel/logs/letsencrypt.log",num:10}),data:{msg:[String,wn]}})}catch(e){clearInterval(bn.value)}}),2e3)},xn=ge(),Sn=ge([{title:"文件验证 - HTTP",name:"http",data:!1,config:!1}]),kn=async e=>{const{dns:t,id:a}=e;let s={domains:JSON.stringify(t),auth_type:"http",auth_to:a||"dns",auto_wildcard:"0"};if("http"===sn.value){const e=JSON.stringify(t);if(-1!==(null==e?void 0:e.indexOf("*.")))return l.error("包含通配符的域名不能使用文件验证(HTTP)!")}else{if("dns"!==sn.value){const{data:e,info:{data:t}}=Vl.value.find((e=>e.value===sn.value));if(!e)return void l.error("指定dns接口没有设置密钥信息");s.auth_to="".concat(sn.value,"|").concat(t[0].value,"|").concat(t[1].value)}s.auth_type="dns"}s.id=Pl.value.id,s.siteName=Pl.value.name;(await ql.value).unmount();const n=await Ir(),{data:r}="proxy"==Pl.value.project_type||"nginx"==Pl.value.project_type||"docker"==Pl.value.project_type?await J({...s,site_name:Pl.value.name},"docker"==Pl.value.project_type?"docker":"proxy"):await z(s,Ol.value);null==n||n.unmount(),jr(r,s)},Cn=async()=>{sn.value="http";const{data:e}=await Nr();e&&Array.isArray(e)&&(Sn.value=Sn.value.concat(e))},An=ge([]),Ln=async()=>{try{await r({request:se(),data:{data:[Array,An]}})}catch(e){return{data:[],total:0,other:{}}}},Tn=async e=>{try{if(!e.dns_id)return void l.error("请选择验证类型");const t={dns_id:e.dns_id,ids:JSON.stringify(e.ids)},a=await r({loading:"正在配置DNS接口，请稍候...",request:le(t),message:!0});return a.status&&(e.dns_id="",e.ids=[],nn()),a.status}catch(t){return!1}},Nn=Se({__name:"index",setup(e,{expose:t}){const{isRefreshSSL:s,sslAlertState:n}=lt(),{BtTable:i,BtRefresh:u,refresh:c}=p({request:Kl,columns:[{label:"域名",prop:"domains",render:(e,t)=>_e("span",{class:"w-full whitespace-pre-line"},[e.domains?e.domains.join("\n"):"--"])},{label:"到期时间",prop:"expires",width:110,render:Fl},{label:"订单状态",prop:"status",width:80,render:Xl},{label:"验证方式",prop:"auth_type",width:80,render:(e,t)=>_e("span",null,["dns"===e.auth_type?"DNS验证":"文件验证"])},{label:"操作",prop:"ps",width:190,showOverflowTooltip:!1,align:"right",render:(e,t)=>{let s=[];return"pending"!==e.status?s=[_e("span",{class:"cursor-pointer bt-link",onClick:()=>Ql(e,!1)},[xe("部署")]),_e(tt,null,null),_e("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{try{const t=await r({loading:"正在获取证书信息，请稍后...",request:X({index:e}),message:!1,data:{status:Boolean,msg:String}});return t.status?window.open(t.msg):l.request(t),{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"下载失败"}}})(e)},[xe("下载")]),_e(tt,null,null),_e("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{const t=await Ir(),a=await r({request:Y({index:e}),message:!1,data:{status:Boolean,msg:String}});t._props.onCancel(),l.msg({dangerouslyUseHTMLString:!0,message:a.msg,type:a.status?"success":"error",duration:a.status?2e3:0,showClose:!a.status}),a.status&&Kl()})(e)},[xe("续签")]),_e(tt,null,null)]:e.expires>=(new Date).getTime()/1e3&&(s=[_e("span",{class:"cursor-pointer bt-link",onClick:()=>(async e=>{var t,s,n;const{data:i}=await r({loading:"正在验证证书申请状态，请稍后...",request:K({index:e.index}),message:!1});if(i.hasOwnProperty("status")&&i.hasOwnProperty("msg"))l.request(i);else{Ul.value=i.auths,i.hasOwnProperty("error")?(Jl.value=i.error,zl.value=i.error_msg):(Jl.value=!1,zl.value=""),Object.assign(Ml,e),Bl.value=[],null==(t=i.auths)||t.forEach((e=>{Bl.value.push(e.data)}));const l="dns"===e.auth_type;Zl.value[1].label=l?"记录值":"文件路径",Zl.value[1].prop=l?"auth_value":"file_path",Zl.value[2].label=l?"类型":"文件内容",Zl.value[2].prop=l?"type":"content",tn.value[1].content="可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(null==(n=null==(s=Bl.value[0])?void 0:s.domain)?void 0:n.replace("*.","")),a({title:"手动".concat("dns"===Ml.auth_type?"解析TXT记录":"创建验证文件"),area:70,component:()=>_e("div",{class:"p-[1.5rem]"},[xe("请按以下列表做TXT解析:"),_e("span",{class:"ml-[.4rem] text-danger"},{errorMsg:zl}),_e(fe,null,{content:()=>_e("div",{class:"max-h-[38rem] overflow-auto"},[Ul.value.map(((e,t)=>e.data.length>0&&_e("div",{key:t},[_e("span",null,[xe("验证域名："),e.domain]),_e(k,{class:"my-[1rem]",column:Zl.value,data:e.data},null),Jl.value&&_e("div",{class:"flex justify-end"},[_e(Ie,{type:"default",onClick:()=>Yl(e)},{default:()=>[xe("验证")]})])])))]),"footer-right":()=>!Jl.value&&_e(Ie,{type:"default",onClick:$l},{default:()=>[xe("验证")]})}),_e(v,{options:tn.value,listStyle:"disc",class:"ml-[20px]"},null)])}),jl.value=!0}})(e)},[xe("验证")]),_e(tt,null,null)]),s.push(_e("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{try{await o({title:"删除证书订单",content:"确定删除证书订单吗？"});const t=await r({loading:"正在删除证书，请稍候...",request:W({index:e}),message:!0});return jl.value=!0,{status:t.status,msg:t.msg}}catch(t){return{status:!1,msg:"删除失败"}}})(e)},[xe("删除")])),s}}],extension:[m(),y(s)]});return t({init:c}),(e,t)=>{const a=Ie,s=fe,l=v;return ke(),Oe("div",null,[_e(s,null,{"header-left":Ae((()=>[_e(a,{type:"primary",onClick:De(en)},{default:Ae((()=>t[0]||(t[0]=[xe("申请证书")]))),_:1},8,["onClick"])])),"header-right":Ae((()=>[_e(De(u))])),content:Ae((()=>[_e(De(i),{"default-sort":{prop:"date",order:"descending"},maxHeight:De(n)?280:320},null,8,["maxHeight"])])),_:1}),_e(l,{options:De(Gl),"list-style":"disc",class:"pl-1rem"},null,8,["options"])])}}}),{refs:{isRefreshCertificateList:Dn}}=ct(),{sslInfo:En,sslTabActive:In,isRefreshSSL:Pn,applySslInfo:On}=lt(),{siteInfo:jn,siteType:Vn}=rt(),{useDeployTrustAsiaCert:qn,getDomainListEvent:Rn,jumpSslTabEvent:Hn}=nt(),Mn=ge(!1),Bn=ge(""),Un=ge(),Jn=ge([]),zn=[{content:()=>_e("span",{class:"text-danger"},[xe("注意：请勿将SSL证书用于非法网站，一经发现，吊销证书。")])},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)。"},{content:"宝塔SSL申请的是免费版TrustAsia DV SSL CA - G5证书，仅支持单个域名申请。"},{content:"有效期1年，不支持续签，到期后需要重新申请"},{content:"建议使用二级域名为www的域名申请证书,此时系统会默认赠送顶级域名为可选名称"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:()=>_e("span",null,[xe("测试SSL申请注意事项及教程"),_e("a",{href:"https://www.bt.cn/bbs/thread-33113-1-1.html",target:"_blank",class:"btlink"},[" ",xe("使用帮助")])])}],Fn=e=>{switch(e.stateName){case"待验证":return _e("span",{class:"text-[#e6a23c]"},[e.stateName]);case"已过期":return _e("span",{class:"text-danger"},[e.stateName]);case"验证中":return _e("span",{class:"text-[#fc6d26]"},[e.stateName]);case"审核已终止":return _e("span",null,[e.stateName]);default:return _e("span",{class:"text-[#20a53a]"},[e.stateName])}},Xn=e=>{Un.value=e,a({isAsync:!0,title:"申请免费宝塔SSL证书",area:60,component:()=>s((()=>import("./apply-bt-ssl.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},Gn=async({partnerOrderId:e},t=!1)=>{const a=Vn.value,{name:s}=jn.value,l={proxy:{site_name:s,partnerOrderId:e},default:{siteName:s,partnerOrderId:e}},n=l[a]||l.default,r=await qn(n,a);Lr(r,t),Hn("currentCertInfo")},Zn=async()=>{try{const{data:e}=await r({loading:Mn,request:ue({siteName:jn.value.name})});return Bn.value=e.partnerOrderId,Pn.value=!1,{data:e.data,total:e.data.length,other:{}}}catch(e){return{data:[],total:0,other:{}}}},Wn=async()=>{var e,t;try{const a=await Rn();return Jn.value=a.data,Un.value&&Un.value.ssl_id&&(On.value.domain=null==(t=null==(e=Jn.value)?void 0:e.find((e=>e.name===Un.value.authDomain)))?void 0:t.name),Jn.value=Jn.value.map((({name:e,id:t})=>({value:e,label:e}))),{data:On.value,status:!0}}catch(a){}},Kn=async e=>{var t;try{const a=null==(t=Un.value)?void 0:t.ssl_id;let s={...e,orgDivision:"总务",path:jn.value.path};a&&(s.ssl_id=a),delete s.data,s.status;const n=a?ne:re,{data:i,msg:o,status:u}=await r({loading:"正在提交证书申请资料，请稍后...",request:n(s)});if(u){l.success(i.msg||o||"申请成功");const{data:e,status:t,msg:a}=await r({loading:"正在验证证书申请状态，请稍后...",request:ie({partnerOrderId:i.partnerOrderId,siteName:jn.value.name})});t?"COMPLETED"==e.stateCode?(l.success("验证成功！即将开始证书部署！"),Gn(i)):l.success("等待CA验证中，若长时间未能成功验证，请登录官网使用DNS方式重新申请..."):l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:a,type:"error",duration:0,showClose:!0})}else l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:i.msg||o,type:"error",duration:0,showClose:!0});return Pn.value=!0,Dn.value=!0,u}catch(a){return!1}},Qn={class:"text-[1.2rem] h-[4.2rem] leading-[1.8rem]"},Yn={class:"flex flex-col w-full pt-[16px]"},$n=Se({__name:"index",setup(e,{expose:t}){const{sslAlertState:a,isRefreshSSL:s}=lt(),{BtTable:n,BtRefresh:i,refresh:o}=p({request:Zn,columns:[{label:"域名",prop:"commonName"},{label:"到期时间",width:110,render:(e,t)=>C(e.endtime,"yyyy/MM/dd")},{label:"状态",prop:"stateName",width:100,render:Fn},{label:"操作",prop:"ps",width:200,showOverflowTooltip:!1,align:"right",render:e=>{if("审核已终止"===e.stateName)return _e("span",null,[xe("--")]);let t=[_e("span",{class:"bt-link",onClick:()=>Gn(e,!1)},[xe("部署")])];return"WF_DOMAIN_APPROVAL"===e.stateCode&&""!==e.authDomain?t=[_e("span",{class:"bt-link",onClick:()=>(async e=>{const t={partnerOrderId:e.partnerOrderId,siteName:jn.value.name},a=await r({loading:"正在验证证书申请状态，请稍后...",request:oe(t),message:!0,data:{status:Boolean,"data.stateCode":[String,"stateCode"]}});a.status&&"COMPLETED"===a.stateCode?Gn(e,!0):l.success("等待CA验证中，若长时间未能成功验证，请登录官网使用DNS方式重新申请...")})(e)},[xe("验证域名")]),_e($e,{direction:"vertical"},null),_e("span",{class:"bt-link",onClick:()=>Xn(e)},[xe("修改域名")])]:"WF_DOMAIN_APPROVAL"===e.stateCode&&""===e.authDomain?t=[_e("span",{class:"bt-link",onClick:()=>Xn(e)},[xe("填写域名")])]:e.partnerOrderId===Bn.value&&(t=[_e("span",null,[xe("已部署")]),_e(tt,null,null),_e("span",{class:"bt-link",onClick:()=>(async()=>{try{await Gr(),Zn()}catch(e){}})()},[xe("关闭")])]),t}}],extension:[m(),y(s)]});return t({init:o}),(e,t)=>{const s=u,l=et,r=Ie,o=fe,c=v;return ke(),Oe("div",null,[_e(l,{type:"error",class:"my-[16px]",closable:!1},{title:Ae((()=>[Te("span",Qn,[t[2]||(t[2]=Te("span",null," 提示：尊敬的用户您好，感谢您对宝塔免费证书的支持，由于证书签发机制的调整，原一年的免费证书，将缩短至90天。本调整将于2024年4月25日生效。请注意及时续签。 ",-1)),_e(s,{class:"!inline-block",href:"https://www.trustasia.com/view-free-ssl-one-year-adjustment-announcement/",target:"_blank"},{default:Ae((()=>t[1]||(t[1]=[xe(" 查看详情 ")]))),_:1}),t[3]||(t[3]=xe(" 。 "))])])),_:1}),Te("div",Yn,[_e(o,null,{"header-left":Ae((()=>[_e(r,{type:"primary",onClick:t[0]||(t[0]=e=>De(Xn)())},{default:Ae((()=>t[4]||(t[4]=[xe(" 申请证书 ")]))),_:1})])),"header-right":Ae((()=>[_e(De(i))])),content:Ae((()=>[_e(De(n),{"default-sort":{prop:"date",order:"descending"},"max-height":De(a)?280:320},null,8,["max-height"])])),_:1})]),_e(c,{options:De(zn),"list-style":"disc",class:"ml-[20px]"},null,8,["options"])])}}}),{sslInfo:er,certVerifyInfo:tr,sslTabActive:ar,letApplyInfo:sr,isRefreshSSL:lr,pollingPopup:nr,sslDnsApiInfo:rr,productInfo:ir,orderInfo:or,otherPopup:ur}=lt(),{siteInfo:cr,siteType:dr,isBindExtranet:pr,isRefreshList:mr}=rt(),{isRefreshLocalList:vr}=ye(ut()),{getSSLInfoEvent:hr,jumpSslTabEvent:fr}=nt(),yr=we((()=>{var e,t;return'当前证书 -<span class="'.concat((null==(e=er.value)?void 0:e.isStart)?"text-primary":"text-danger",'">[').concat((null==(t=er.value)?void 0:t.isStart)?"已部署SSL":"未部署SSL","]</span>")})),gr=[{label:()=>_e("span",{innerHTML:yr.value},null),name:"currentCertInfo",lazy:!0,render:()=>_e(Il,null,null)},{label:"商用SSL证书",name:"busSslList",lazy:!0,render:()=>_e(ys,null,null)},{label:"宝塔证书",name:"trustAsiaList",lazy:!0,render:()=>_e($n,null,null)},{label:"Let's Encrypt",name:"letsEncryptList",lazy:!0,render:()=>_e(Nn,null,null)},{label:"证书夹",name:"certFolderList",lazy:!0,render:()=>_e(zs,null,null)}],wr=()=>{ar.value="busSslList",a({isAsync:!0,title:"购买商业证书",area:[79],component:()=>s((()=>import("./apply-bus-ssl.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},br=()=>{var e,t;let a=null==(e=cr.value.project_type)?void 0:e.toLowerCase();dr.value=a,pr.value=!!(null==(t=cr.value.project_config)?void 0:t.bind_extranet);["php","html","phpasync","proxy","docker"].includes(a)&&(pr.value=!0),pr.value&&_r()},_r=async()=>{const e=l.load("正在获取站点证书部署信息，请稍候...");await xr(),e.close()},xr=async()=>{try{const{data:e}=await hr({siteName:cr.value.name});return Sr(e),{data:e,status:!0,msg:"获取证书信息成功"}}catch(e){}},Sr=e=>{const{type:t,httpTohttps:a,index:s,auth_type:l,key:n,csr:r,cert_data:{dns:i=[],subject:o="",issuer:u="",endtime:c="",notAfter:d=""}={},push:p,status:m,oid:v}=e;er.value={...er.value,isCertInfo:!!o,https:a,type:t,key:n||"",csr:r||"",index:s||"",authType:l||"",oid:v,dns:i||[],subject:o,issuer:u,endtime:c,notAfter:d,push:p,pushAlarm:!!("object"==typeof p?p.status:p),isSupportRenewal:(()=>{let e=!1;return c<=30&&(e=!0),2===t&&c<0&&(e=!0),0!==t&&-1!==t||(e=!1),e})(),isStart:m}},kr=async e=>{or.value=e.orderInfo,ur.value=await a({title:"完善商业证书资料",area:64,component:()=>s((()=>import("./bus-cert-verify-info.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},Cr=async e=>{tr.value=e,ur.value=await a({title:"验证域名-"+(e.isCNAME?"DNS验证":"文件验证"),area:64,component:()=>s((()=>import("./bus-cert-verify-way.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},Ar=async e=>{var t;const{hash:a,subject:s,list:l,type:n}=e;await o({title:"部署证书",content:"批量部署证书后，原有证书将被覆盖，是否继续？",icon:"warning-filled"});const i=l.map((e=>({ssl_hash:a,siteName:e.name,certName:s}))),u={proxy:{BatchInfo:JSON.stringify(i),site_name:cr.value.name},docker:{BatchInfo:JSON.stringify(i),site_name:cr.value.name},default:{BatchInfo:JSON.stringify(i)}},c=u[n]||u.default,d=await r({loading:"正在部署证书，请稍候...",request:he(c,n),data:{faildList:Array,successList:Array}});(null==(t=cr.value)?void 0:t.name)&&xr(),mr.value=!0,vr.value=!0,await ot({title:"批量部署结果",resultTitle:"部署证书操作",resultData:[...d.faildList.map((e=>({name:e.siteName,status:!1,msg:e.msg||e.error_msg}))),...d.successList.map((e=>({name:e.siteName,status:!0})))]})},Lr=(e,t)=>{if(e.status)l.request(e),xr(),mr.value=!0,lr.value=!0,vr.value=!0;else{const a=t?"当前证书已成功申请！自动部署失败，请尝试手动部署证书！\n":"";l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:a+e.msg,type:e.status?"success":"error",showClose:!e.status})}},Tr=e=>a({isAsync:!0,title:e.title,area:50,component:()=>s((()=>import("./dns-verify-info.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0,compData:e.row}),Nr=async()=>{try{const e=await r({request:me(),data:Array});return h(e)&&Dr(e),{data:e,status:!0}}catch(e){return{status:!1,msg:"获取DNS接口信息失败"}}},Dr=e=>{rr.value=e.filter((e=>"CloudxnsDns"!==e.name)).map((e=>({label:e.title,value:e.name,config:!!e.data,data:!!e.data&&""!=e.data[0].value,info:e})))},Er=(e,t,a)=>{var s,n,r,i,o,u,c,d;if(e.msg&&A(e.msg))return void l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg,type:"error",showClose:!0,duration:0});let p="",m=e.msg[0];if(void 0===(null==(s=e.msg[1])?void 0:s.challenges))p+="\n\t\t\t<p><span>响应状态：</span>".concat(e.msg[1].status,"</p>\n\t\t\t<p><span>错误类型：</span>").concat(e.msg[1].type,"</p>\n\t\t\t<p><span>错误来源：</span><a href='https://letsencrypt.org/' style='color:#20a53a'>Let's Encrypt官网</a></p>\n\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t错误代码：\n\t\t\t\t<pre class=\"!text-white !bg-[#333] !inline-block !ml-[4px]\">\n\t\t\t\t\t").concat(e.msg[1].detail,"\n\t\t\t\t</pre>\n\t\t\t</div>");else if(!(null==(n=e.msg[1])?void 0:n.challenges[1])&&(null==(r=e.msg[1])?void 0:r.challenges[0])&&(e.msg[1].challenges[1]=e.msg[1].challenges[0]),"invalid"===e.msg[1].status){let s="";for(const a of t){const t=a.outerText||a.auth_value;if(null==t?void 0:t.includes(e.msg[1].identifier.value)){const e=t.split("\t");if((null==e?void 0:e.length)>1){s=e[1];break}}}const l=null==(i=e.msg[1])?void 0:i.identifier.value,n=null==(o=e.msg[1])?void 0:o.challenges[1],r=null==n?void 0:n.error.detail;if(p+="\n\t\t\t\t<p><span>验证域名：</span>".concat(l,"</p>\n\t\t\t"),"dns"===(null==a?void 0:a.type)||"dns"===(null==a?void 0:a.auth_type)){const e="_acme-challenge.".concat(l);p+="\n\t\t\t\t\t<p><span>验证解析：</span>".concat(e,"</p>\n\t\t\t\t\t<p><span>验证内容：</span>").concat(s||n.token,'</p>\n\t\t\t\t\t<div class="flex flex-col">\n\t\t\t\t\t\t错误代码：\n\t\t\t\t\t\t<pre class="!text-white !bg-[#333] !inline-block !ml-[4px]">\n\t\t\t\t\t\t\t').concat(r,"\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</div>\n\t\t\t\t")}else{const t="http://".concat(l,"/.well-known/acme-challenge/").concat(null==(u=e.msg[1])?void 0:u.challenges[0].token);p+="\n\t\t\t\t\t<p><span>验证URL：</span><a style='color:#20a53a' href='".concat(t,"' target='_blank'>点击查看</a></p>\n\t\t\t\t\t<p><span>验证内容：</span>").concat(null==(c=e.msg[1])?void 0:c.challenges[0].token,'</p>\n\t\t\t\t\t<div class="flex flex-col">\n\t\t\t\t\t\t错误代码：\n\t\t\t\t\t\t<pre class="!text-white !bg-[#333] !inline-block !ml-[4px]">\n\t\t\t\t\t\t\t').concat(null==(d=e.msg[1])?void 0:d.challenges[0].error.detail,"\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</div>\n\t\t\t\t")}p+="<p><span>验证结果：</span> <a style='color:red;'>验证失败</a></p>"}l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,icon:"x",message:'\n\t\t\t<div class="flex items-center justify-center mt-[.8rem] mb-2rem">\n\t\t\t\t<i class="svgtofont-el-circle-close-filled mr-[.8rem] text-[#F56C6C] !text-[3rem]"></i>\n\t\t\t\t<a style="color: red; font-size:16px">\n\t\t\t\t\t'.concat(m,'\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div class="p-[2rem] border border-1 border-color-[#dedede] !rounded-[4px] !mb-[12px] !leading-[26px] bg-[#f8f8f8]">\n\t\t\t\t').concat(p,"\n\t\t\t</div>\n\t\t"),showClose:!0,duration:0})},Ir=()=>a({area:[50,25],showFooter:!1,component:()=>s((()=>import("./lets-encrypt-progress.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)}),Pr=ge([{label:"解析域名",prop:"name"},{label:"记录值",prop:"txt",render:(e,t)=>_e("div",{class:"flex items-center"},[_e("div",{class:"truncate w-[15rem]"},[e.txt]),_e("span",{class:"svgtofont-icon-copy ml-[4px] text-[#666] text-[1.6rem] w-[1.6rem] cursor-pointer",onClick:()=>_({value:e.txt})},null)])},{label:"类型",prop:"type"},{label:"必需",prop:"force",width:100}]),Or=ge(),jr=(e,t)=>{if(!1===e.status&&e.hasOwnProperty("msg")&&A(e.msg))l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg,type:"error",showClose:!0,duration:0});else if(!0!==e.status&&"pending"!==e.status&&void 0===(null==e?void 0:e.save_path))Er(e,sr.value.dnsTable,sr.value.info);else{if("pending"===e.status&&"dns"===e.auth_type){Rr(e,t);let s=[];e.auths.forEach((e=>{let t=[];const a=e.domain.replace("*.","");t.push({name:"_acme-challenge.".concat(a),type:"TXT",txt:e.auth_value,force:"是"}),t.push({name:a,type:"CAA",txt:'0 issue "letsencrypt.org"',force:"否"}),s.push({domain:e.domain,data:t})}));const l=[{content:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{content:"可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(e.auths[0].domain.replace("*.",""))},{content:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}],n=!!e.hasOwnProperty("error")&&e.error;return Object.assign(Ml,e),void(Or.value=a({title:"手动解析TXT记录",area:70,component:()=>_e("div",{class:"p-[1.5rem]"},[xe("请按以下列表做TXT解析:"),_e(fe,null,{content:()=>_e("div",{class:"max-h-[38rem] overflow-auto"},[s.map(((t,a)=>_e("div",{key:a},[t.data.length>0&&_e(je,null,[_e("span",null,[xe("验证域名："),t.domain]),_e(k,{class:"my-[1rem]",column:Pr.value,data:t.data},null),n.value&&_e("div",{class:"flex justify-end"},[_e(Ie,{type:"default",onClick:()=>Vr({index:e.index,domain:t.domain})},{default:()=>[xe("验证")]})])])])))]),"footer-right":()=>!n.value&&_e(Ie,{type:"default",onClick:$l},{default:()=>[xe("验证")]})}),_e(v,{options:l,listStyle:"disc",class:"ml-20x"},null)])}))}Hr(e)}},Vr=async e=>{const t=await Ir(),{data:a}=await Q(e);if(null==t||t.unmount(),"valid"===a.status)l.success("验证成功");else if(!0===a.status){const e=await Or.value;e&&e.unmount(),qr(a,!0)}else Er(a,sr.value.dnsTable,sr.value.info)},qr=async({index:e},t=!1,a=cr.value.name)=>{const s=await r({loading:"正在部署证书，请稍候...",request:Z({index:e,siteName:a}),message:!1,data:{status:Boolean,msg:String}});Lr(s,t)},Rr=(e,t)=>{sr.value.dnsTable=e.auths,sr.value.info.index=e.index,sr.value.info.type=t.auth_type},Hr=async(e,t)=>{if(!e.private_key||!e.cert||!e.root)return void l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:"部署失败，请关闭SSL后重新尝试部署！",type:"error",showClose:!0,duration:0});const{private_key:a,cert:s,root:n}=e,i=cr.value.project_type,o={proxy:{site_name:cr.value.name,key:a,csr:s+n},default:{type:1,siteName:cr.value.name,key:a,csr:s+n}};await r({loading:"正在保存证书信息，请稍后...",request:q(o[i]||o.default,i),message:!0,success:e=>{if(!0===e.status)xr(),fr("currentCertInfo");else{let t=e.msg;t="当前证书申请并验证成功，自动部署失败，请尝试手动部署证书！\n"+t,l.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:t,type:"error",showClose:!0,duration:0})}}})},Mr=e=>{a({title:"支付成功",area:[60,60],component:()=>s((()=>import("./pay-bus-success.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},Br=async({type:e,oid:t,index:a,authType:s}=er.value,{name:l}=cr.value)=>{if(3===e)zr(t,e);else if(32===(null==a?void 0:a.length)&&-1===a.indexOf("/")&&"dns"!==s)Jr(a);else{const{data:e}=await r({request:ce({siteName:l,pem_file:a})});Ur(e)}},Ur=async e=>{xn.value=e,ur.value=a({title:"续签Let's Encrypt证书",area:50,component:()=>s((()=>import("./lets-encrypt-renew.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},Jr=async e=>{const t=await Ir(),{data:a}=await r({request:de({index:e})});t._props.onCancel(),jr(a,{auth_type:a.auth_type})},zr=(e,t)=>{if(3===t)Fr(e)},Fr=async e=>{await o({title:"商业证书续签",content:"当前证书订单需要重新生成新订单，需要手动续签，和重新部署证书，是否继续操作？"});const t={pdata:JSON.stringify({oid:e})},a=await r({loading:"正在续签商业证书，可能等待时间较长，请稍后...",request:pe(t),data:Object});if(n(a)&&a.hasOwnProperty("order_info")){let e=a.order_info;Xr({oid:a.oid,wxcode:a.wxcode,alicode:a.alicode,orderInfo:e,productInfo:{...e,productName:e.title,totalPrice:a.data.price,isRenew:!0}})}else l.request(a);xr()},Xr=async e=>{ir.value=e.productInfo,or.value=e.orderInfo,nr.value=a({title:"支付商业证书订单",area:[60],component:()=>s((()=>import("./pay-bus-ssl.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},Gr=async()=>{const e=dr.value,t=cr.value.name,a={proxy:{site_name:t},default:{updateOf:1,siteName:t}},s=a[e]||a.default;await r({loading:"正在关闭证书，请稍后...",request:ve(s,e),message:!0,success:()=>{mr.value=!0,vr.value=!0}}),xr()},Zr=async e=>{ur.value=a({isAsync:!0,title:"申请Let's Encrypt证书",area:64,component:()=>s((()=>import("./applay-lest-ssl.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:e})},Wr=()=>{a({component:()=>s((()=>import("./index143.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),area:52,compData:{title:"SSL证书需求反馈收集",type:28,isNoRate:!0,softName:"1",isCard:!1,id:993}})};export{Jn as $,ja as A,Ia as B,cs as C,Ca as D,Wa as E,_a as F,Ja as G,xa as H,Sa as I,Oa as J,wa as K,za as L,Aa as M,La as N,Xa as O,ba as P,Za as Q,ts as R,ss as S,ns as T,ls as U,es as V,$a as W,Ya as X,Qa as Y,Cr as Z,Wn as _,Xn as a,Un as a0,Kn as a1,$t as a2,Mt as a3,Ft as a4,ea as a5,Bt as a6,zt as a7,ta as a8,Zt as a9,on as aA,Tn as aB,Ln as aC,An as aD,xr as aE,Wt as aa,Kt as ab,Qt as ac,Yt as ad,fa as ae,Ka as af,_n as ag,bn as ah,wn as ai,Mr as aj,kr as ak,Cn as al,sn as am,un as an,Sn as ao,kn as ap,xn as aq,pn as ar,fn as as,rn as at,nn as au,yn as av,ln as aw,cn as ax,dn as ay,an as az,Xr as b,Ar as c,wr as d,Wr as e,Ha as f,Ta as g,Na as h,dl as i,qa as j,Da as k,Ir as l,br as m,It as n,pl as o,Et as p,Ba as q,Br as r,Er as s,gr as t,Lr as u,Nr as v,Ea as w,Ra as x,Ua as y,Ga as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
