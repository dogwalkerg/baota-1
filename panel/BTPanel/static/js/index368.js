import{G as t,l as e,H as a,o as s,ah as o,bR as r,b as n,al as l,bX as i,an as p,O as c}from"./utils-lib.js?v=1734676359";import{_ as u}from"./index90.js?v=1734676359";import{r as _,e as m,y,h as d,I as h,aN as g,c as b,k as x,l as w,x as v,p as k}from"./base-lib.js?v=1734676359";import{u as f,a as q,g as E}from"./column.js?v=1734676359";import{bM as j,bN as T,bO as N,bP as z,bQ as A,bR as L,bS as I,bT as P,bU as R,bV as $,bW as C,bX as O,bY as U,bZ as D}from"./useStore3.js?v=1734676359";import{f as S}from"./validator.js?v=1734676359";import{n as V}from"./useController.js?v=1734676359";const X=n(),{siteInfo:B}=V(),W=_({}),M=_(!1),H=[{content:"支持添加多个不同目录的代理"},{content:"如添加后访问异常请尝试清理浏览器缓存"}],Z=async()=>{try{const e=await t({request:j({site_name:B.value.name}),data:{data:Array}});return Array.isArray(e.data)?{data:e.data,total:e.data.length}:{data:[],total:0}}catch(e){return{data:[],total:0}}},G=()=>{e({isAsync:!0,title:"添加反向代理",area:60,btn:"确认",component:()=>a((()=>import("./add-url-proxy.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},Q=async(e,a)=>{t({loading:"正在修改反向代理备注，请稍后...",request:T({site_name:B.value.name,proxy_path:e.proxy_path,remark:a}),message:!0})},Y=t=>{W.value=t,e({isAsync:!0,title:"反向代理设置【".concat(t.proxy_path,"】"),area:[76,60],component:()=>a((()=>import("./setting.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{row:t}})},F=async e=>{if("/"===e.proxy_path)return void X.error("根目录不能删除");await s({title:"删除反向代理【".concat(e.proxy_path,"】"),width:"35rem",icon:"warning-filled",content:"您真的要删除反向代理【".concat(e.proxy_path,"】吗？")});(await t({loading:"正在删除，请稍后...",request:N({site_name:B.value.name,proxy_path:e.proxy_path}),message:!0})).status&&(M.value=!0)},J=[{content:"目标：可以填写你需要代理的站点，目标如果选URL地址则必须为可正常访问的URL，如果选UNIX则必须是套接字文件"},{content:"http地址示例：http://127.0.0.1:15700"},{content:"unix地址示例：/tmp/panel.sock"},{content:()=>m("span",null,[y("发送域名：将域名添加到请求头传递到后端服务器，默认为目标URL域名，若设置不当可能导致代理无法正常访问，例如："),m("br",null,null),y("http://192.168.100.20:19888，则发送域名保持$http_host即可"),m("br",null,null),y("http://www.bt.cn，则发送域名应当改为www.bt.cn"),m("br",null,null),y("上面例子仅为常见情况，请以实际为准")])}],K=[{label:"URL地址",value:"http"},{label:"UNIX地址",value:"unix"}],tt=d({targetType:"http",sitename:"",cachetime:1,proxysite:"http://",todomain:"$http_host",path:"",ps:"",websocket:!1}),et=_(!1),at=_(!1),st=_(!1),ot=_(),rt=d({proxyname:[{required:!0,message:"请输入代理名称",trigger:"blur"},{validator:(t,e,a)=>{e.length<3?a(new Error("代理名称必须大于3个字符串")):e.match(/^[a-zA-Z0-9_.-]+$/g)?a():a(new Error("代理名称不能包含特殊字符"))}}],proxysite:[{required:!0,message:"请输入目标地址",trigger:"blur"},{validator:(t,e,a)=>{if(!e)return void a(new Error("http"===tt.targetType?"目标地址不能为空":"请选择sock文件"));if("unix"===tt.targetType)return void a();let s=e.replace(/^http[s]?:\/\//,"");s=s.replace(/(:|\?|\/|\\)(.*)$/,""),/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(s)?tt.todomain="$http_host":tt.todomain=s,a()}},{}],todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}],path:[{required:!0,message:"请输入根目录",trigger:"blur"}]}),nt=async()=>{tt.proxysite="http"===tt.targetType?"http://":""},lt=t=>{if("unix"===tt.targetType)return void(tt.todomain="$http_host");let e=t.replace(/^http[s]?:\/\//,"");e=e.replace(/(:|\?|\/|\\)(.*)$/,""),tt.todomain=e},it=()=>{S({type:"file",path:tt.proxysite||"/www/dk_project/wwwroot",change:t=>{tt.proxysite=t}})},pt=async e=>{const{path:a,proxysite:s,todomain:o,targetType:r,ps:n}=tt;let l={site_name:B.value.name,proxy_path:a,proxy_pass:s,proxy_host:o,proxy_type:r,remark:n};await ot.value.validate();(await t({loading:st,request:z(l),message:!0})).status&&(M.value=!0,e&&e())},ct=_("proxy"),ut=_({proxy_type:"",proxy_path:"",proxy_pass:"",proxy_host:"$http_host",ip_limit:{},basic_auth:{},proxy_cache:{},gzip:{},sub_filter:{},websocket:{},proxy_log:{},custom_config:[],proxy_conf:"",remark:"",template_proxy_conf:""}),_t=async()=>{try{const t=await j({site_name:B.value.name,proxy_path:W.value.proxy_path});if(!t.status)return void X.error(t.msg);ut.value=t.data.data}catch(t){o(t)}},mt=_(!1),yt=d({targetType:"http",sitename:"",proxysite:"",todomain:"$http_host",path:"",ps:"",websocket:!1,proxy_connect_timeout:30,proxy_send_timeout:30,proxy_read_timeout:30}),dt=d({proxysite:[{required:!0,message:"请输入目标url",trigger:"blur",validator:(t,e,a)=>{e?a():a(new Error("目标URL不能为空"))}}],todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}],proxy_connect_timeout:[{required:!0,message:"请输入连接超时时间",trigger:["blur","change"],validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):a():a(new Error("连接超时时间不能为空"))}}],proxy_send_timeout:[{required:!0,message:"请输入后端请求超时时间",trigger:["blur","change"],validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):a():a(new Error("后端请求超时时间不能为空"))}}],proxy_read_timeout:[{required:!0,message:"请输入代理响应超时时间",trigger:["blur","change"],validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):a():a(new Error("代理响应超时时间不能为空"))}}]}),ht=t=>{const{proxy_type:e,proxy_pass:a,proxy_host:s,proxy_path:o,remark:r,global_websocket:n,websocket:l,timeout:i}=t;yt.targetType=e,yt.proxysite=a,yt.todomain=s,yt.path=o,yt.ps=r,mt.value=n,yt.websocket=null==l?void 0:l.websocket_status,yt.proxy_connect_timeout=null==i?void 0:i.proxy_connect_timeout,yt.proxy_send_timeout=null==i?void 0:i.proxy_send_timeout,yt.proxy_read_timeout=null==i?void 0:i.proxy_read_timeout},gt=async()=>{const{path:e,proxysite:a,todomain:s,targetType:o,ps:r,websocket:n,proxy_connect_timeout:l,proxy_send_timeout:i,proxy_read_timeout:p}=yt,c={site_name:B.value.name,proxy_path:e,proxy_pass:a,proxy_host:s,proxy_type:o,remark:r,websocket:n?1:0,proxy_connect_timeout:l,proxy_send_timeout:i,proxy_read_timeout:p};await ot.value.validate(),await t({loading:st,request:A(c),message:!0})},bt='一行一条配置，请以;结尾，例如：\nproxy_set_header Cookie "cookie_name=cookie_value";\nallow 192.168.1.0/24;\naccess_log /www/wwwlogs/xxx.log;',xt=d({config:""}),wt=[{content:"注意：一行一条配置，请以;结尾"},{content:()=>m(h,null,[y("案例："),m("br",null,null),y("重定向请求：return 301 /new-page;"),m("br",null,null),y("重写URL：rewrite ^/blog/(.*)$ /$1 break;"),m("br",null,null),y("文件上传限制：client_max_body_size 10M;"),m("br",null,null),y("处理特定http方法："),m("br",null,null),y("limit_except POST "),"{",y(" "),m("br",null,null),y("    allow 192.168.1.0/24;"),m("br",null,null),y("    deny all;"),m("br",null,null),"}",m("br",null,null),y("限制请求速率：limit_rate 100k;"),m("br",null,null)])},{content:"保存配置前请核对配置是否正确，错误的配置可能会导致反向代理无法正常访问"}],vt=async t=>{try{let t={site_name:B.value.name,proxy_path:ut.value.proxy_path,custom_conf:xt.config};const e=await L(t);X.request(e)}catch(e){}},kt=()=>{xt.config=ut.value.custom_conf||""},ft=d({subfilter:[]}),qt=[{content:"规则解释如下"},{content:"g：替换所有匹配到的关键字"},{content:"i：不区分大小写"},{content:"o：只替换匹配到的第一个"},{content:"r：使用正则表达式"}],Et=async e=>{await t({loading:"正在删除，请稍后...",request:O({site_name:B.value.name,proxy_path:ut.value.proxy_path,oldstr:e.oldstr,newstr:e.newstr}),message:!0}),_t()},jt=t=>{const e=[t.oldstr,t.newstr],a=t.sub_type.replace(/g/g,""),s=a.includes("i")?"不区分大小写":"",o=a.includes("o")?"只替换第一个":"",r=a.includes("r")?"使用正则表达式":"";switch(a.length){case 0:return"效果:将全部'".concat(e[0],"'替换为'").concat(e[1],"''");case 1:return"效果:将".concat(o?"":"全部","'").concat(e[0],"'替换为'").concat(e[1],"'，匹配时").concat(s||o||r);case 2:return"效果:将".concat(o?"":"全部","'").concat(e[0],"'替换为'").concat(e[1],"'，匹配时").concat(s||o||r,"并且").concat(r||o||s);case 3:return"效果:将'".concat(e[0],"'替换为'").concat(e[1],"'，匹配时").concat(s,"、").concat(o,"并且").concat(r)}},Tt=t=>{try{ft.subfilter=t.sub_filter_str}catch(e){}},Nt=_([{label:"原关键词",prop:"oldstr"},{label:"替换词",prop:"newstr"},{label:"规则",prop:"mode",width:50,render:t=>m(g,{class:"item",effect:"dark","open-delay":500,content:jt(t),placement:"top-start"},{default:()=>[m("div",{class:"flex items-center"},["".concat(t.sub_type)])]})},f([{title:"删除",onClick:t=>{Et(t)}}])]),zt=()=>{Object.assign(At,{oldstr:"",newstr:""}),It.value=[],Pt.value="默认效果:将全部'http://www.bt.cn'替换为'https://www.bt.cn'",e({isAsync:!0,title:"添加内容替换【".concat(ut.value.proxy_path,"】"),area:60,btn:"确认",component:()=>a((()=>import("./setting-replace-add.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{proxy_path:ut.value.proxy_path,subs_filter:ut.value.subs_filter}})},At=d({oldstr:"",newstr:""}),Lt={oldstr:[r({message:"请输入原关键词"})]},It=_([]),Pt=_("默认效果:将全部'http://www.bt.cn'替换为'https://www.bt.cn'"),Rt=_(),$t=t=>{Ct(It.value)},Ct=t=>{const e=t.includes("i")?"不区分大小写":"",a=t.includes("o")?"只替换第一个":"",s=t.includes("r")?"使用正则表达式":"";switch(t.length){case 0:Pt.value="默认效果:将全部".concat(At.oldstr,"替换为").concat(At.newstr);break;case 1:Pt.value="效果:将".concat(a?"":"全部").concat(At.oldstr,"替换为").concat(At.newstr,"，匹配时").concat(e||a||s);break;case 2:Pt.value="效果:将".concat(a?"":"全部").concat(At.oldstr,"替换为").concat(At.newstr,"，匹配时").concat(e||a||s,"并且").concat(s||a||e);break;case 3:Pt.value="效果:将".concat(At.oldstr,"替换为").concat(At.newstr,"，匹配时").concat(e,"、").concat(a,"并且").concat(s)}},Ot=async e=>{await Rt.value.validate();const a={site_name:B.value.name,oldstr:At.oldstr,newstr:At.newstr,proxy_path:ut.value.proxy_path,sub_type:It.value.length?It.value.join(""):"g"};(await t({loading:st,request:I(a),message:!0})).status&&(_t(),e&&e())},Ut=_(),Dt=d({status:!1,time:"",unit:"m"}),St=[{label:"分钟",value:"m"},{label:"小时",value:"h"},{label:"天",value:"d"}],Vt=[{content:"缓存是一种用于加速网站性能和提高用户体验的技术"},{content:"开启后资源会被缓存，如果影响网站访问请关闭"},{content:"缓存键由主机名、URI 和请求参数组成"},{content:"默认忽略的响应头有：Set-Cookie|Cache-Control|expires|X-Accel-Expires"},{content:"默认缓存的静态资源有：css|js|jpg|jpeg|gif|png|webp|woff|eot|ttf|svg|ico|css.map|js.map"}],Xt=t=>{Bt()},Bt=async()=>{const e={site_name:B.value.name,proxy_path:ut.value.proxy_path,cache_status:Dt.status?1:0,expires:"".concat(Dt.time).concat(Dt.unit)};await Ut.value.validate(),await t({loading:st,request:P(e),message:!0})},Wt=d({status:!1}),Mt=async e=>{const a={site_name:B.value.name,proxy_path:ut.value.proxy_path,status:e?1:0};await t({loading:"正在保存，请稍后...",request:R(a),message:!0})},Ht=[{content:"启用缓冲（默认）：Nginx 会将后端服务器（被代理的服务器）的响应数据先存储在自己的缓冲区中"},{content:"启用缓冲（默认）：提高性能和稳定性，优化资源利用，但也会造成延迟问题，内存占用高"},{content:"关闭缓冲：数据访问实时性增强，降低内存占用风险，但也会对后端服务器（被代理的服务器）压力增大，性能也有一定影响"},{content:"什么业务可以关闭缓冲：例如AI类型的，比如ThinkChat等"}],Zt=_(),Gt=d({status:!1,type:"",level:1,minLength:"",unit:"m"}),Qt=[{label:"k",value:"k"},{label:"m",value:"m"}],Yt=[{content:"用于对 HTTP 响应的内容进行压缩，以减少数据传输量，提高网站性能和加载速度"},{content:"压缩级别1-9，例如：1为压缩速度最快，但压缩率较低；9为压缩速度最慢，但压缩率最高，建议默认"},{content:"如果开启gzip后影响网站正常访问，请关闭此功能 和请求参数组成"}],Ft={type:[{required:!0,message:"请输入压缩类型",trigger:["blur","change"]}],minLength:[{required:!0,message:"请输入正确的压缩最小长度",trigger:"blur",validator:(t,e,a)=>{e?isNaN(Number(e))?a(new Error("请输入数字")):Number(e)<1?a(new Error("请输入正确数字")):a():a(new Error("压缩最小长度不能为空"))}},{}]},Jt=t=>{Gt.status=t.gzip_status,Gt.type=t.gzip_types,Gt.level=t.gzip_comp_level;let e="",a="m";t.gzip_min_length&&t.gzip_min_length.length>1&&(e=t.gzip_min_length.slice(0,-1),a=t.gzip_min_length.slice(-1)),Gt.minLength=e,Gt.unit=a},Kt=t=>{te()},te=async()=>{const e={site_name:B.value.name,proxy_path:ut.value.proxy_path,gzip_status:Gt.status?1:0,gzip_min_length:"".concat(Gt.minLength).concat(Gt.unit),gzip_comp_level:Gt.level,gzip_types:Gt.type};await Zt.value.validate(),await t({loading:st,request:$(e),message:!0})},ee=d({loading:!1,type:"black",white:[],black:[]}),ae=t=>{ee.white=t.ip_white.map((t=>({ip:t,type:"white"}))),ee.black=t.ip_black.map((t=>({ip:t,type:"black"})))},se=async e=>{const a=!!Array.isArray(e);await s({title:"".concat(a?"批量删除":"删除").concat("white"===ee.type?"白":"黑","名单"),content:"".concat(a?"批量删除选中的ip，是否继续操作？":"删除".concat("white"===ee.type?"白":"黑","名单【").concat(e.ip,"】，是否继续操作？"))});let o={site_name:B.value.name,proxy_path:ut.value.proxy_path};a?(o.ips=e.map((t=>t.ip)).join("\n"),o.ip_type=ee.type):(o.ip=e.ip,o.ip_type=e.type);const r=a?U:D;(await t({loading:"正在删除，请稍后...",request:r(o),message:!0})).status&&_t()},oe=_([q(),{label:"IP",prop:"ip",minWidth:120},f([{title:"删除",onClick:t=>{se(t)}}])]),re=[{label:"删除IP",value:"delete",event:async(t,e,a,s)=>{se(a.value)}}],ne=()=>{ee.type="ipBlackList"===ct.value?"black":"white",ie.value.types=ee.type,ie.value.address="",ae(ut.value.ip_limit)},le=()=>{e({isAsync:!0,title:"添加IP".concat("ipBlackList"===ct.value?"黑":"白","名单【").concat(ut.value.proxy_path,"】"),area:40,btn:"确认",component:()=>a((()=>import("./setting-ip-add.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{name:B.value.name,proxy_path:ut.value.proxy_path,listType:ee.type,refreshEvent:()=>{ie.value.address="",_t()}}})},ie=_({types:ee.type,address:""}),pe=_(),ce=[{content:"一行一条配置，多个IP请换行"}],ue={address:[{validator:(t,e,a)=>{e.length>0?a():a(new Error("请输入IP地址"))},trigger:["blur","change"]}]},_e=async e=>{const{types:a,address:s}=ie.value,o={site_name:B.value.name,proxy_path:ut.value.proxy_path,ip_type:a,ips:s};await pe.value.validate();(await t({loading:st,request:C(o),message:!0})).status&&(_t(),e())},me=b({__name:"index",setup(t,{expose:e}){const{BtOperation:a}=l({options:[{label:"添加反向代理",type:"button",active:!0,onClick:G}]}),{BtTable:s,refresh:o}=i({request:Z,columns:[{label:"代理目录",prop:"proxy_path",minWidth:120},{label:"目标",prop:"proxy_pass",minWidth:200},E({request:Q,prop:"remark"}),f([{onClick:Y,title:"设置"},{onClick:F,title:"删除"}])],extension:[p(M)]});return e({init:o}),(t,e)=>{const o=u,r=c;return x(),w("div",null,[m(o,{class:"h-[59rem]"},{"header-left":v((()=>[m(k(a))])),content:v((()=>[m(k(s),{"max-height":560})])),_:1}),m(r,{class:"mt-[2rem] ml-[1.6rem]",options:k(H)},null,8,["options"])])}}}),ye=Object.freeze(Object.defineProperty({__proto__:null,default:me},Symbol.toStringTag,{value:"Module"}));export{Ot as $,qt as A,Tt as B,Dt as C,Xt as D,St as E,Bt as F,Ut as G,Vt as H,Jt as I,Gt as J,Kt as K,Qt as L,te as M,Zt as N,Ft as O,Yt as P,ct as Q,le as R,ne as S,ee as T,oe as U,re as V,ae as W,Wt as X,Mt as Y,Ht as Z,_t as _,it as a,At as a0,$t as a1,It as a2,Ct as a3,Pt as a4,Rt as a5,Lt as a6,_e as a7,ie as a8,ce as a9,pe as aa,ue as ab,ye as ac,ot as b,rt as c,st as d,J as e,at as f,ht as g,lt as h,ut as i,yt as j,mt as k,gt as l,dt as m,kt as n,pt as o,et as p,xt as q,bt as r,nt as s,K as t,tt as u,vt as v,wt as w,zt as x,ft as y,Nt as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
