import{t as e,a3 as a,dg as t,c as s,k as l}from"./utils-lib.js?v=1734676359";import{c as r,r as o,h as n,az as i,o as u,k as p,l as d,q as m,e as c,x as y,I as g,aX as b,p as f,J as h,M as v,y as _,z as j,bj as k,ag as x,ah as w,af as P,ad as C}from"./base-lib.js?v=1734676359";import{createIpRules as O,removeIpRules as D,getIpFlowsAreasInfo as I,getIpFlowTrend as S}from"./site.js?v=1734676359";import{a as V}from"./useController4.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./useStore7.js?v=1734676359";import"./useStore8.js?v=1734676359";import"./useController3.js?v=1734676359";import"./validator.js?v=1734676359";import"./useStore9.js?v=1734676359";import"./useMethod5.js?v=1734676359";const q={class:"p-[2rem]"},E={class:"flex items-center justify-between mb-[8px]"},J={key:1},M=r({__name:"index",props:{compData:{default:()=>({})}},setup(r){var M,N;const z=r,{proxy:A}=k(),H=o("PHPMOD"===(null==(N=null==(M=z.compData)?void 0:M.project_config)?void 0:N.type)),Q=o(),T=o("today"),U=n([{label:"IP地址",prop:"ip",render:e=>i("span",{class:e.deny_status?"line-through text-[#bbb] cursor-pointer":"text-[#20a53a] cursor-pointer",on:{click:async()=>{try{await A.$confirm({title:"IP地址",message:"确定要".concat(e.deny_status?"解封":"封禁","当前ip吗？"),icon:"warning"});let a=null;if(e.deny_status)a=await D({data:JSON.stringify({address:e.ip})});else{let t={choose:"address",address:e.ip,domain:"",types:"drop",brief:"网站流量点击IP手动封禁"};a=await O({data:JSON.stringify(t)})}A.$message.request(a),W()}catch(a){}}}},e.ip)},{label:"归属地",render:e=>i("div",{class:"flex",style:{gap:"4px"}},[i("span",e.country),i("span",e.province),i("span",e.city)])},{label:"造成流量",prop:"flow",render:a=>i("span",e(a.flow))}]),$=o([{title:"今天",key:"today"},{title:"昨天",key:"yesterday"},{title:"近7天",key:"l7"},{title:"近30天",key:"l30"},{title:"近1小时",key:"h1"}]),B=o([]),L=o("流量趋势"),{BtECharts:X,getEChart:F,setOption:G,setQuickOption:K}=a({options:{xAxis:{type:"category",data:[]},yAxis:{type:"value",name:"单位:字节",axisLabel:{margin:2,formatter:function(e,a){return e>=1e4&&e<1e7?e=e/1e4+"万":e>=1e7&&(e=e/1e7+"千万"),e}}},grid:{show:!1,bottom:"20%",right:"5%"},series:[{data:[],type:"line"}]}}),R=async()=>{let e=[],a=[0,0,0,0,0,0,0],t=!1;try{const s=await S({site_name:z.compData.name,query_date:T.value});s&&(a=[]),s.forEach((s=>{"h1"!=T.value&&"today"!=T.value&&"yesterday"!=T.value||(t=!0),e.push(ae(String(s.time),t)),a.push(s.flow)}))}catch(s){}K(e,a)},W=async()=>{try{const e=await I({site_name:z.compData.name,query_date:T.value});B.value=e}catch(e){}},Y=e=>{L.value=e,"流量趋势"===e?R():W()},Z=e=>{T.value=e,"流量趋势"===L.value?R():W()},ee=()=>{V({...z.compData,tabName:"flowQuota"},"limit")},ae=(e,a)=>{let t="";return a?(t=e.substring(8,10)+":"+(12===e.length?e.substring(10,12):"00"),t):(12===e.length||10===e.length?t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)+" "+e.substring(8,10)+":"+(12===e.length?e.substring(10,12):"00"):8===e.length&&(t=e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)),t)};return u((()=>{R()})),(e,a)=>{const r=x,o=w,n=P,i=C,u=s,k=l;return p(),d("div",q,[m("div",E,[c(o,{modelValue:f(T),"onUpdate:modelValue":a[0]||(a[0]=e=>v(T)?T.value=e:null),onChange:Z,class:"!w-[10rem]"},{default:y((()=>[(p(!0),d(g,null,b(f($),((e,a)=>(p(),h(r,{key:a,label:e.title,value:e.key},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),c(i,{modelValue:f(L),"onUpdate:modelValue":a[1]||(a[1]=e=>v(L)?L.value=e:null),onChange:Y},{default:y((()=>[c(n,{label:"流量趋势"}),c(n,{label:"IP TOP 10"})])),_:1},8,["modelValue"]),f(t)||f(H)?j("",!0):(p(),h(u,{key:0,onClick:ee},{default:y((()=>a[2]||(a[2]=[_("流量限额>>")]))),_:1}))]),m("div",null,["流量趋势"===f(L)?(p(),h(f(X),{key:0,ref_key:"totalCharts",ref:Q,class:"h-[32rem]"},null,512)):j("",!0),"IP TOP 10"===f(L)?(p(),d("div",J,[c(k,{column:f(U),data:f(B)},null,8,["column","data"])])):j("",!0)])])}}});export{M as default};
