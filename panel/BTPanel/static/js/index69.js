import{_ as e}from"./index90.js?v=1734676359";import{u as t,am as a,an as s,bf as n,o as l,b as i,p as o,a7 as r,aj as d,ao as c,c as m}from"./utils-lib.js?v=1734676359";import{_ as u}from"./index182.js?v=1734676359";import{c as p,R as v,r as _,e as h,y,n as f,aj as b,o as w,b as g,W as x,k as j,J as C,x as k,q as D,p as S}from"./base-lib.js?v=1734676359";import{g as B}from"./useStore10.js?v=1734676359";import{e as N}from"./validator.js?v=1734676359";import{s as q,u as R,d as H,a as L,b as M}from"./useMethod7.js?v=1734676359";import{d as T,a as A,s as E}from"./useMethod6.js?v=1734676359";import{n as V,o as z,p as J,q as P,t as U,v as W,w as F}from"./ssl.js?v=1734676359";import{a as G,u as I,c as K}from"./column.js?v=1734676359";import{u as O}from"./index124.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./index107.js?v=1734676359";const Q={class:"flex items-center"},X=p({__name:"index",setup(p){const X=i(),{mainHeight:Y}=t(),{refs:{tabActive:Z,isRefreshDomainList:$,typeList:ee}}=B();v([]),_([]);const te=v([]);_(null);const ae=[{content:"手动同步",active:!0,event:()=>{fe()}},{content:"DNS接口设置",dropdownClass:"bg-white",splitButton:!0,event:()=>{H()}}],se=[{label:"设置分类",value:"type",event:(e,t,a,s)=>E(a.value,"domain")},{label:"配置DNS接口",value:"dnsSet",event:(e,t,a,s)=>T(a.value[0],a.value)},{label:"设置到期时间",value:"dateSet",event:(e,t,a,s)=>q({},a.value)},{label:"删除",value:"delete",event:async(e,t,a,s)=>{const{label:n,value:l}=s,i=new Map([["delete","即将批量删除选中的域名"]]),o=async(e,t)=>{const{domain:a}=e;if("delete"===l)return await W({domains:a})};await e({title:"批量".concat(n),content:"".concat(i.get(l),"，是否继续操作！"),column:[{label:"域名",prop:"domain"},K()],onConfirm:async()=>(await t(o),$.value=!0,!1)})}}],ne=O({key:"type",name:"域名分类",options:()=>[{label:"全部分类",value:"-1"}],event:{get:async()=>{const{data:e}=await J();return ee.value=e,ee.value=d(e,"array",[]).map((e=>({label:e.name,value:e.type_id}))),ee.value.unshift({label:"全部分类",value:"all"}),ee.value},add:e=>P(e),delete:e=>U({type_id:e.id})},ignore:["0"],field:"name",showEdit:!1}),le=c(se),{BtTable:ie,BtPage:oe,BtRefresh:re,BtTableCategory:de,BtRecommendSearch:ce,BtColumn:me,BtBatch:ue,BtErrorMask:pe,refresh:ve}=a({request:async e=>{try{let t={p:e.p,type_id:o(e.type)||"all"===e.type?"-1":e.type,search:e.search,limit:e.limit};"-1"===t.type_id&&delete t.type_id;const{data:a}=await z(t);return{data:a.data,total:r(a.page),other:{search_history:a.search_history}}}catch(t){return{data:[],total:0}}},columns:[G(),{label:"域名",prop:"domain",width:250},{label:"分组",width:180,isCustom:!0,render:e=>{const t=ee.value.find((t=>t.value==e.type_id));return t?t.label:"未分组"}},{label:"解析数量",prop:"sbd_count",isCustom:!0},{label:"DNS接口",width:200,isCustom:!0,render:e=>{var t;return h("div",{class:"flex items-center"},[(null==(t=e.dns)?void 0:t.dns_name)?h("span",null,[e.dns.dns_name]):h("span",{class:"bt-link cursor-pointer",onClick:()=>T(e)},[y("未配置")]),h("div",{class:"el-divider el-divider--vertical"},null),h("span",{class:"bt-link cursor-pointer",onClick:()=>T(e)},[y("点击配置")])])}},{label:"到期时间",isCustom:!0,render:e=>{const t=(new Date).setHours(0,0,0,0),a=e.endtime?new Date(e.endtime.replace(/-/g,"/")).getTime():0,s=0!==e.endtime&&a<t,n=0!==e.endtime&&a-Date.now()<6048e5;return h("span",{class:"cursor-pointer "+(s?"bt-danger":n?"bt-warn":"bt-link"),onClick:()=>{q(e)}},[s?"已过期":0===e.endtime?"未设置":e.endtime])}},{prop:"report_id",label:"到期告警",render:e=>{const t=(new Date).setHours(0,0,0,0),a=0!==e.endtime&&new Date(e.endtime).getTime()/1e3<t/1e3;let s=""!=e.report_id;return h(b,{size:"small",modelValue:s,"onUpdate:modelValue":e=>s=e,disabled:(0===e.endtime||a)&&!s,onChange:t=>{t?(e.report_id="1",A({...e,cancel:()=>{f((()=>{e.report_id=""}))}})):ye(e)}},null)}},I([{onClick:e=>{e.dns_id?L(e):(X.error("请先配置DNS"),T(e))},title:"解析"},{onClick:e=>{var t;(null==(t=e.dns)?void 0:t.dns_name)?M(e):(X.error("请先配置DNS"),T(e))},title:"解析记录管理",width:120},{onClick:e=>{he(e)},title:"删除"}])],extension:[ne,le,s($),n("search",{name:"ssl",key:"get_domain_list",list:[],showRecommend:!1})]});R({closeAlarm:e=>ye(e),delDomain:e=>he(e)});const _e=()=>{N({title:"SSL证书需求反馈收集",type:28,isNoRate:!0,softName:"1",isCard:!1,id:993})},he=async(e,t=!1)=>{let a;try{t||await l({title:"删除【".concat(e.domain,"】域名"),content:"删除该域名，是否继续操作？",icon:"warning",width:45}),t||(a=X.load("正在删除域名，请稍候..."));const s=await W({domains:e.domain});return t||X.request(s),s.status&&!t&&($.value=!0),s}catch(s){}finally{a&&a.close()}},ye=async e=>{let t=e.report_id;try{e.report_id="",await l({title:"删除【".concat(e.domain,"】到期告警"),content:"删除该域名到期告警，是否继续操作？",icon:"warning",width:45});let a=X.load("正在删除域名到期告警，请稍候...");const s=await V({task_id:t});X.request(s),s.status&&($.value=!0),a&&a.close()}catch(a){a&&f((()=>{e.report_id=t}))}},fe=async()=>{let e;try{e=X.load("正在同步域名列表，请稍后...");const t=await F();X.request(t),t.status&&($.value=!0)}catch(t){}finally{e&&e.close()}};return w((()=>{Z.value=g().name})),x("sslHistoryList",te),(t,a)=>{const s=u,n=m,l=e;return j(),C(l,null,{"header-left":k((()=>[D("div",Q,[h(s,{options:ae}),a[1]||(a[1]=D("span",{class:"ml-[8px] text-[1.1rem]"},"当前域名列表仅显示顶级域名，配置DNS，可以快速解析域名和申请证书。",-1)),h(n,{class:"ml-[12px] flex items-center",onClick:_e},{default:k((()=>a[0]||(a[0]=[D("div",{class:"flex items-center"},[D("span",{class:"svgtofont-desired text-[1.6rem]"}),D("span",null,"需求反馈")],-1)]))),_:1})])])),"header-right":k((()=>[h(S(de),{class:"!w-[140px] mr-[10px]"}),h(S(ce),{type:"ssl-domain",placeholder:"请输入域名",class:"!w-[270px] mr-[10px]"}),h(S(me))])),content:k((()=>[h(S(ie),{"min-height":S(Y)},null,8,["min-height"])])),"footer-left":k((()=>[h(S(ue))])),"footer-right":k((()=>[h(S(oe))])),_:1})}}});export{X as default};
