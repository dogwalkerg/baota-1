import{D as e,bR as l,bS as a,j as t,a4 as o,O as s,b as r}from"./utils-lib.js?v=1734676359";import{c as n,r as p,i as d,o as u,k as i,J as m,x as c,e as _,p as f,q as v,y as w,z as b,M as j,C as h,D as V,a7 as g,aN as x,Q as y,ae as k,ad as U,aw as P,A as C}from"./base-lib.js?v=1734676359";import{_ as I}from"./index88.js?v=1734676359";import{advanceCheckPort as O}from"./site.js?v=1734676359";import{f as A}from"./validator.js?v=1734676359";import{u as S,S as q}from"./useStore7.js?v=1734676359";import{a as z}from"./index56.js?v=1734676359";const J={class:"flex items-center"},B={class:"flex items-center"},D=n({__name:"index",setup(n,{expose:D}){const F=r(),{siteInfo:M}=S(),{getRootUser:N,getProjectConfig:R}=q(),E=p(!!M.value),G=p([]),H=p(!1),Q=p(0),K=p({project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1,env:"",envPath:""}),L=[{content:"执行命令：请输入项目需要携带的参数，默认请输入执行文件名"},{content:()=>_("span",null,[w("项目教程可参考:"),_("a",{class:"bt-link",href:"https://www.bt.cn/bbs/thread-93034-1-1.html"},[w("https://www.bt.cn/bbs/thread-93034-1-1.html")])])}],T=()=>{A({type:"file",path:K.value.project_exe,change:e=>{var l;K.value.project_exe=e,K.value.project_cmd=null==e?void 0:e.replace(/\/\//g,"/");let a=null==(l=e.substring(e.lastIndexOf("/")+1))?void 0:l.replace(/\./g,"_");K.value.project_name=a,K.value.project_ps=a}})},W=e=>{K.value.project_ps=e},X=async()=>{if(K.value.port)try{const e=await O({port:K.value.port},"go");e.status||(F.request(e),K.value.port="")}catch(e){}},Y=()=>{A({type:"file",path:K.value.envPath,change:e=>{K.value.envPath=e}})},{BtForm:Z,submit:$}=e({data:K.value,options:e=>d((()=>[{type:"slots",key:"custom",rules:{project_exe:[l({message:"请选择项目可执行文件"})],project_name:[l({message:"请输入项目名称"})],port:[l({message:"请输入端口号",trigger:["change"]}),a()],project_cmd:[l({message:"请输入项目执行命令"})]}}])),submit:async(e,l)=>await z(e,l,Q.value)});return u((async()=>{const e=await N();if(G.value=e.data.map((e=>({label:e,value:e}))),Object.assign(K.value,{project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1,env:"",envPath:""}),E.value){const{data:e}=await R({data:JSON.stringify({project_name:M.value.name})}),{env_list:l,env_file:a}=e.project_config;a&&(Q.value=2),(null==l?void 0:l.length)>0&&(Q.value=1),Object.assign(K.value,{...null==e?void 0:e.project_config,project_ps:null==e?void 0:e.ps,is_power_on:!!(null==e?void 0:e.project_config.is_power_on),not_install_pkg:!!(null==e?void 0:e.project_config.not_install_pkg),envPath:a||"",env:(null==l?void 0:l.length)&&Array.isArray(l)?l.map((e=>e.k+"="+e.v)).join("\n"):""})}})),D({onConfirm:$}),(e,l)=>{const a=I,r=g,n=t,p=x,d=y,u=k,O=U,A=o,S=P,q=C,z=s;return i(),m(f(Z),{"label-width":"100px",class:"p-[20px]"},{custom:c((()=>[_(r,{label:"项目执行文件",prop:"project_exe"},{default:c((()=>[_(a,{modelValue:f(K).project_exe,"onUpdate:modelValue":l[0]||(l[0]=e=>f(K).project_exe=e),icon:"el-folder-opened",placeholder:"请选择项目可执行文件",onIconClick:T,width:"32rem"},null,8,["modelValue"])])),_:1}),_(r,{label:"项目名称",prop:"project_name"},{default:c((()=>[_(n,{onInput:W,width:"32rem",disabled:f(E),modelValue:f(K).project_name,"onUpdate:modelValue":l[1]||(l[1]=e=>f(K).project_name=e),placeholder:"请输入GO项目名称"},null,8,["disabled","modelValue"])])),_:1}),_(r,{label:"项目端口",prop:"port"},{default:c((()=>[v("div",J,[_(n,{width:"20rem",type:"number",onBlur:X,class:"mr-[12px]",modelValue:f(K).port,"onUpdate:modelValue":l[2]||(l[2]=e=>f(K).port=e),placeholder:"请输入项目的真实端口"},null,8,["modelValue"]),f(E)?b("",!0):(i(),m(d,{key:0,modelValue:f(K).release_firewall,"onUpdate:modelValue":l[3]||(l[3]=e=>f(K).release_firewall=e)},{default:c((()=>[l[15]||(l[15]=w(" 放行端口 ")),_(p,{class:"item",effect:"dark",content:"选中将在防火墙安全组放行监听端口，放行后该项目可在外网访问",placement:"right"},{default:c((()=>l[14]||(l[14]=[v("i",{class:"svgtofont-el-question-filled text-warning"},null,-1)]))),_:1})])),_:1},8,["modelValue"]))])])),_:1}),_(r,{label:"执行命令",prop:"project_cmd"},{default:c((()=>[_(n,{modelValue:f(K).project_cmd,"onUpdate:modelValue":l[4]||(l[4]=e=>f(K).project_cmd=e),placeholder:"请输入项目的执行命令",width:"32rem"},null,8,["modelValue"])])),_:1}),_(r,{label:"环境变量",class:"mt-[1.6rem]"},{default:c((()=>[_(O,{modelValue:f(Q),"onUpdate:modelValue":l[5]||(l[5]=e=>j(Q)?Q.value=e:null)},{default:c((()=>[_(u,{label:0},{default:c((()=>l[16]||(l[16]=[w("无")]))),_:1}),_(u,{label:1},{default:c((()=>l[17]||(l[17]=[w("指定变量")]))),_:1}),_(u,{label:2},{default:c((()=>l[18]||(l[18]=[w("从文件加载")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),h(_(r,{label:" "},{default:c((()=>[h(_(n,{width:"40rem",type:"textarea",rows:3,resize:"none",modelValue:f(K).env,"onUpdate:modelValue":l[6]||(l[6]=e=>f(K).env=e),placeholder:"环境变量，1行1个，例如： JAVA_HOME=/usr/local/btjdk/jdk8"},null,8,["modelValue"]),[[V,1===f(Q)]]),h(_(a,{modelValue:f(K).envPath,"onUpdate:modelValue":l[7]||(l[7]=e=>f(K).envPath=e),icon:"el-folder-opened",placeholder:"请选择环境变量文件",onIconClick:Y,width:"32rem"},null,8,["modelValue"]),[[V,2===f(Q)]])])),_:1},512),[[V,0!==f(Q)]]),_(r,{label:"运行用户"},{default:c((()=>[v("div",B,[_(A,{modelValue:f(K).run_user,"onUpdate:modelValue":l[8]||(l[8]=e=>f(K).run_user=e),options:f(G),class:"mr-[8px] !w-[16rem]"},null,8,["modelValue","options"]),l[19]||(l[19]=v("span",{class:"text-[1.2rem] text-[#666]"},"* 无特殊需求请选择www用户",-1))])])),_:1}),_(r,{label:"开机启动"},{default:c((()=>[_(d,{modelValue:f(K).is_power_on,"onUpdate:modelValue":l[9]||(l[9]=e=>f(K).is_power_on=e)},{default:c((()=>l[20]||(l[20]=[w("是否设置开机自动启动（默认自带守护进程每120秒检测一次）")]))),_:1},8,["modelValue"])])),_:1}),_(r,{label:"项目备注"},{default:c((()=>[_(n,{width:"32rem",modelValue:f(K).project_ps,"onUpdate:modelValue":l[10]||(l[10]=e=>f(K).project_ps=e),placeholder:"输入项目备注，非必填"},null,8,["modelValue"])])),_:1}),f(E)?b("",!0):(i(),m(r,{key:0,label:"绑定域名"},{default:c((()=>[_(S,{placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"400",visible:f(H),"onUpdate:visible":l[13]||(l[13]=e=>j(H)?H.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:c((()=>[_(n,{rows:4,resize:"none",width:"40rem",modelValue:f(K).domains,"onUpdate:modelValue":l[11]||(l[11]=e=>f(K).domains=e),type:"textarea",onFocus:l[12]||(l[12]=e=>H.value=!0),placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null,8,["modelValue"])])),default:c((()=>[l[21]||(l[21]=v("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[w(" 如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),v("br"),w(" IP地址格式：192.168.1.199"),v("br"),w(" 泛解析添加方法 *.domain.com"),v("br"),w(" 如另加端口格式为 www.domain.com:88 ")],-1))])),_:1},8,["visible"])])),_:1})),f(E)?(i(),m(r,{key:1,label:" "},{default:c((()=>[_(q,{type:"primary",onClick:f($)},{default:c((()=>l[22]||(l[22]=[w("保存配置")]))),_:1},8,["onClick"])])),_:1})):(i(),m(r,{key:2,label:""},{default:c((()=>[_(z,{options:L})])),_:1}))])),_:1})}}});export{D as _};
