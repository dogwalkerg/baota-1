import{g as e,s as a,r as l,h as s,c as t,o,bY as n,B as c,k as i,l as r,q as d,y as m,p,C as u,I as f,aX as h,J as v,x as y,e as w,v as g,F as k,z as x,Q as b,ap as C,ao as j,an as M,ag as V,ah as _,P as S,ae as P,aN as L,ad as A,A as U}from"./base-lib.js?v=1734676359";import{u as q,M as H,dp as N,dq as I,dr as O,o as Q,G as E,ds as R,dt as T,cB as D,a_ as F,d as G,e as B}from"./utils-lib.js?v=1734676359";import{H as J}from"./store4.js?v=1734676359";import{m as z}from"./validator.js?v=1734676359";import{u as X}from"./controller.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./useStore.js?v=1734676359";import"./config.js?v=1734676359";const Y=e("REC-INSTALL-STORE",(()=>{const e=J(),{memory:t}=a(e),{isRefreshMenu:o,getGlobalInfo:n}=q(),c=l(),i=s({lnmp:{type:"lnmp",title:"LNMP（推荐）",install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!1,options:[]},PHP:{icon:"php",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},lamp:{type:"lamp",title:"LAMP",install:1,soft:{Apache:{icon:"apache",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!1,options:[]},PHP:{icon:"php",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},java:{type:"java",title:"JAVA",install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},MySQL:{icon:"mysql",value:"",selected:!0,options:[]},"Pure-Ftpd":{icon:"pureftpd",value:"",selected:!1,options:[]},jdk:{icon:"java",value:"",selected:!0,options:[]},phpMyAdmin:{icon:"phpmyadmin",value:"",selected:!0,options:[]}}},docker:{type:"docker",title:"Docker",install:1,soft:{Nginx:{icon:"nginx",value:"",selected:!0,options:[]},Docker:{icon:"docker",value:"",selected:!0,options:[{label:"Dokcer服务",value:""}]}}}}),r=l(!1),d=l([]),m=["home","soft","exit","config"],p=l([]),u=l([]),f={5.1:{max:256,rec:512},5.5:{max:600,rec:1024},5.6:{max:800,rec:1024},5.7:{max:1500,rec:2048},"8.0":{max:5e3,rec:6144},AliSQL:{max:800,rec:1024},"mariadb_10.0":{max:800,rec:1024},"mariadb_10.1":{max:1500,rec:2048}},h={"4.0":["5.2","5.3","5.4","5.5","5.6","7.0","7.1","7.2","7.3","7.4"],4.4:["5.4","5.4","5.5","5.6","7.0","7.1","7.2","7.3"],4.9:["5.6","7.0","7.1","7.2","7.3","7.4","8.0"],"5.0":["7.2","7.3","7.4","8.0"],5.1:["7.2","7.3","7.4","8.0"]},v=["4.0"],y=["5.1"],w=["5.2","5.3","5.5","7.0"],g={2.2:{php:{min:"5.2",max:"5.4"},model:"php5_module"},2.4:{php:{min:"5.3",max:"8.1"},model:"php-fpm"}},k=(e,a)=>{const{icon:l,value:s}=e,o=f[s];switch(l){case"apache":H.warn("当前PHP将会以".concat(g[s].model,"模式运行!"));break;case"mysql":t.value.memTotal<o.max&&H.warn("您的内存小于".concat(o.rec/1024,"GB，不建议安装MySQL-").concat(s));break;case"php":(e=>{const a=i[e].soft.PHP.value;i[e].soft.phpMyAdmin.options=[],Object.keys(h).forEach((l=>{const s=h[l];s&&s.indexOf(a)>-1&&(i[e].soft.phpMyAdmin.options.push({label:"phpMyAdmin ".concat(l),value:l}),i[e].soft.phpMyAdmin.value=l)}))})(a)}},x=async()=>{try{r.value=!0;const e=(await F()).data.map((({id:e,show:a,title:l,children:s})=>{let t=(e.replace(/memu([A|_]?)/,"")||"home").toLowerCase();return"dologin"===t&&(t="exit"),"btwaf"===t&&(t="waf"),s=!!s&&s.map((a=>{let l=a.id;return"proxy"===l&&(l="nginx"),{...a,parentId:e,name:l}})),{name:t,show:a,title:l,id:e,children:s}}));d.value=e,o.value=!0}catch(e){}finally{r.value=!1}};return{recommend:i,initSoft:async()=>{const e=await T(),{data:a}=e;a.forEach((e=>{const{name:a}=e;if("Tomcat"===a)return;const l=[];let s="";switch(e.versions.forEach((({version:e})=>{const o="PHP"===a&&"8.0"===e,n="MySQL"===a&&"5.7"===e,c="phpMyAdmin"===a&&"5.0"===e,i="jdk"===a&&e.includes("1.8"),r=f[e];let d="";switch(a.toLowerCase()){case"nginx":d=["1.25","1.26"].includes(e)?"[支持http3]":"";break;case"mysql":if(t.value.memTotal<r.max&&(d="[推荐".concat(r.rec/1024,"G内存机器安装]")),y.includes(e))return;break;case"php":if(w.includes(e))return;break;case"apache":d="[PHP运行模式：".concat(g[e].model,"]");break;case"phpmyadmin":if(!h[e])return;if(v.includes(e))return;if(-1!==h[e].indexOf("8.0"))return;break;case"jdk":e=e.replace("jdk","")}(!s&&o||n||c||i)&&(s=e),l.push({label:"".concat(a," ").concat(e),value:e,ps:d,disabled:!1})})),a.toLowerCase()){case"php":p.value.push(...l);break;case"phpmyadmin":u.value.push(...l)}!s&&l.length>0&&(s=l[0].value),Object.keys(i).forEach((e=>{const t=i[e].soft[a];t&&(t.value=s,t.options=l,"phpMyAdmin"===a&&"java"!==e&&k(i[e].soft.PHP,e))}))}))},installSoft:async e=>{let a=0;const l=H.load("正在添加软件至消息盒子，请稍后..."),s=i[e].install;for(const o in i[e].soft){const l=i[e].soft[o];if(l.selected){let e=o.toLowerCase();if("php"===e)e="php-"+l.value;else if("pure-ftpd"===e)e="pureftpd";else{if("jdk"===e){try{N({name:e,version:"java"===l.icon?"jdk"+l.value:l.value,type:1})}catch(t){}continue}if("docker"===e){await I({type:s?0:1});continue}}try{let t="";t=3===l.value.split(".").length?l.value.split(".")[2]:"0",await O({sName:e,version:"java"===l.icon?"jdk"+l.value:l.value,min_version:t,type:s,id:a++})}catch(t){}}}l.close(),await z(),n(),H.success("已将下载任务添加到队列!"),c.value("close")},changeSoftwareVersion:k,cancelShowRec:async()=>{await Q({icon:"warning-filled",title:"取消显示推荐安装",content:"不再显示推荐安装信息，继续操作？"}),await E({loading:"正在取消显示推荐安装，请稍后...",request:R({path:"/www/server/nginx"}),success:e=>{e.status?H.success("设置成功"):H.error("设置失败"),c.value("close")}})},goSoft:()=>{window.location.href="/soft"},goSetting:()=>{window.location.href="/config"},handleMenuChange:async e=>{try{let a={hide_list:JSON.stringify([e.id])};e.parentId&&(a.site_menu=1);const l=await D(a);l.status?H.success("设置成功，后期可以在左侧菜单栏中修改。"):H.request(l),await x(),X()}catch(a){}},updateMenuItems:x,load:r,menuList:d,getList:e=>e.filter((e=>!m.includes(e.name))),filterList:m,emits:c}})),K={class:"h-full p-[2rem]"},W={class:"commend-title"},Z={class:"commend-msg"},$={class:"select-con"},ee={class:"el-dropdown-link flex items-center text-[1.2rem]"},ae=["onClick"],le={class:"flex items-center justify-between"},se=["onClick"],te={key:1,class:"flex items-center justify-between text-[1.2rem]"},oe=["onClick"],ne={class:"commend-title"},ce={class:"commend-msg"},ie={class:"flex recommend-soft-list overflow-y-auto flex-wrap gap-[1.5rem]"},re={class:"rounded-[.4rem] recommend-cont"},de={class:"mb-[1rem] pl-[.5rem] recommend-title text-center inline-block w-full font-bold text-[1.8rem]"},me={class:"soft-list"},pe={class:"pl-8 text-orange"},ue={class:"flex items-baseline my-8"},fe={class:"flex justify-center"},he=B(t({__name:"index",emits:["close"],setup(e,{emit:l}){const s=Y(),{recommend:t,emits:q}=a(s),H=l;return q.value=H,o((()=>{s.initSoft(),s.updateMenuItems(),n(document.querySelector(".close-ad"),"click",(()=>{s.cancelShowRec()}))})),(e,a)=>{const l=b,o=C,n=j,q=M,H=G,N=V,I=_,O=S,Q=P,E=L,R=A,T=U,D=c("bt-loading");return i(),r("div",K,[d("div",W,[a[4]||(a[4]=d("div",{class:"text-[1.6rem] inline-block"},"左侧菜单设置",-1)),d("div",Z,[a[2]||(a[2]=m("-- 可以隐藏和关闭一些不需要的页面和功能，在面板")),d("span",{class:"text-primary cursor-pointer hover:text-[#1d9534]",onClick:a[0]||(a[0]=(...e)=>p(s).goSetting&&p(s).goSetting(...e))}," 设置 "),a[3]||(a[3]=m("或左侧菜单栏下方可随时调整"))])]),u((i(),r("div",$,[(i(!0),r(f,null,h(p(s).getList(p(s).menuList),(e=>(i(),r("div",{class:"select-box",key:e.id},[e.children?(i(),v(q,{key:0,"hide-on-click":!1},{dropdown:y((()=>[w(n,null,{default:y((()=>[(i(!0),r(f,null,h(e.children,(e=>(i(),v(o,{key:e.id},{default:y((()=>[d("div",le,[d("span",{class:"cursor-pointer",onClick:a=>p(s).handleMenuChange(e)},g(e.title),9,se),w(l,{modelValue:e.show,"onUpdate:modelValue":a=>e.show=a,class:"ml-[1rem]",onChange:a=>p(s).handleMenuChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:2},1024)))),128))])),_:2},1024)])),default:y((()=>[d("span",ee,[d("span",{class:"cursor-pointer whitespace-nowrap",onClick:a=>p(s).handleMenuChange(e)},g(e.title),9,ae),a[5]||(a[5]=d("i",{class:"svgtofont-arrow-down ml-[.5rem]"},null,-1)),w(l,{modelValue:e.show,"onUpdate:modelValue":a=>e.show=a,class:"ml-[.5rem] w-[1.6rem] h-[1.6rem]",onChange:a=>p(s).handleMenuChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])),_:2},1024)):(i(),r("div",te,[d("span",{class:"cursor-pointer whitespace-nowrap",onClick:a=>p(s).handleMenuChange(e)},g(e.title),9,oe),w(l,{modelValue:e.show,"onUpdate:modelValue":a=>e.show=a,class:"ml-[.5rem] w-[1.6rem] h-[1.6rem]",onChange:a=>p(s).handleMenuChange(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]))])))),128))])),[[D,p(s).load]]),d("div",ne,[a[9]||(a[9]=d("div",{class:"text-[1.6rem] inline-block"},"一键安装套件",-1)),d("div",ce,[a[6]||(a[6]=m(" -- 我们为您提供以下套件一键安装，请按需选择或在")),d("span",{class:"text-primary cursor-pointer hover:text-[#1d9534]",onClick:a[1]||(a[1]=(...e)=>p(s).goSoft&&p(s).goSoft(...e))}," 软件商店 "),a[7]||(a[7]=m("页面中手动安装，推荐安装")),a[8]||(a[8]=d("span",null,'"LNMP"',-1))])]),d("div",ie,[(i(!0),r(f,null,h(p(t),(e=>(i(),r("div",{key:e.type,class:"recommend-soft-item flex-1"},[d("div",re,[d("span",de,g(e.title),1),d("ul",me,[(i(!0),r(f,null,h(e.soft,((a,t)=>(i(),r("li",{key:t,class:"flex items-center"},[w(H,{type:"icons",src:"soft/ico-".concat(a.icon,".svg"),class:k(["ml-1 mr-4","docker"!==a.icon?"!w-[3.2rem] !h-[3.2rem]":"!mr-[.6rem] !w-[5.5rem] !h-[3.2rem]"])},null,8,["src","class"]),"docker"!==a.icon?(i(),v(I,{key:0,modelValue:a.value,"onUpdate:modelValue":e=>a.value=e,class:"flex-1 mr-[2rem]",size:"small",onChange:l=>p(s).changeSoftwareVersion(a,e.type)},{default:y((()=>[(i(!0),r(f,null,h(a.options,(e=>(i(),v(N,{key:e.value,class:"flex justify-between",label:e.label,disabled:e.disabled,value:e.value},{default:y((()=>[d("span",null,g(e.label),1),d("span",pe,g(e.ps),1)])),_:2},1032,["label","disabled","value"])))),128))])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):x("",!0),"docker"===a.icon?(i(),v(O,{key:1,class:"no-drap mr-[2rem]",value:"Docker服务",readOnly:""})):x("",!0),w(l,{modelValue:a.selected,"onUpdate:modelValue":e=>a.selected=e},null,8,["modelValue","onUpdate:modelValue"])])))),128))]),d("div",ue,[a[14]||(a[14]=d("span",{class:"mr-4 whitespace-nowrap"},"安装方式：",-1)),w(R,{modelValue:e.install,"onUpdate:modelValue":a=>e.install=a,class:"whitespace-nowrap"},{default:y((()=>[w(E,{class:"item",effect:"dark",placement:"top-start"},{content:y((()=>a[10]||(a[10]=[d("div",{class:"w-110"},"即rpm/deb，安装时间极快（5-10分钟），版本与稳定性略低于编译安装，适合快速部署测试",-1)]))),default:y((()=>[w(Q,{class:"!mr-[1.2rem]",value:1},{default:y((()=>a[11]||(a[11]=[m("极速安装")]))),_:1})])),_:1}),w(E,{class:"item",effect:"dark",placement:"top-start"},{content:y((()=>a[12]||(a[12]=[d("div",{class:"w-110"},"安装时间长（30分钟到2小时），性能最大化，适合生产环境",-1)]))),default:y((()=>[w(Q,{class:"!mr-0",value:0},{default:y((()=>a[13]||(a[13]=[m("编译安装")]))),_:1})])),_:1})])),_:2},1032,["modelValue","onUpdate:modelValue"])]),d("div",fe,[w(T,{type:"primary",onClick:a=>p(s).installSoft(e.type)},{default:y((()=>a[15]||(a[15]=[m("一键安装")]))),_:2},1032,["onClick"])])])])))),128))])])}}}),[["__scopeId","data-v-d3072ec3"]]);export{he as default};
