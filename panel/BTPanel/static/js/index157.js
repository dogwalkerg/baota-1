import{G as e,b3 as a,M as l,t as s,ak as t,j as n,aa as i,e as r}from"./utils-lib.js?v=1734676359";import{_ as o}from"./index101.js?v=1734676359";import{r as u,c,s as d,o as m,B as p,k as v,l as f,e as g,x as _,q as x,C as b,p as w,M as y,y as k,I as h,aX as V,J as j,v as C,z as q,ay as U,A as W,ag as S,ah as H,at as N,av as R,a7 as z,a4 as A}from"./base-lib.js?v=1734676359";import{B as D}from"./index185.js?v=1734676359";import{S as E,_ as I}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1734676359";import{S as P,_ as B}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1734676359";import{V as M,R as T,P as X,m as F,W as G,X as J,Q as O}from"./validator.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./ace.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";const Q=P(),K=E(),L=u({}),Y={active:"活动连接(Active connections)",accepts:"总连接次数(accepts)",handled:"总握手次数(handled)",requests:"总请求数(requests)",Reading:"请求数(Reading)",Writing:"响应数(Writing)",Waiting:"驻留进程(Waiting)",worker:"工作进程(Worker)",workercpu:"Nginx占用CPU(Workercpu)",workermen:"Nginx占用内存(Workermen)"},Z=u([]),$=u("service"),ee=u(""),ae=u(!1),le=u(!1),se=u([]),te=u(""),ne=u(""),ie=u(""),re=u([]),oe=async()=>{let a={};Z.value.forEach((e=>{a[e.name]=e.value})),await e({loading:"正在保存中，请稍后...",request:M(a),message:!0})},ue=async()=>{await e({loading:"正在保存中，请稍后...",request:a({path:"/www/server/nginx/conf/nginx.conf",data:ee.value,encoding:"utf-8"}),message:!0})},ce=async()=>{await e({loading:ae,request:T({path:"/www/wwwlogs/nginx_error.log"}),data:{msg:[String,te]}})},de=async()=>{if(ne.value!==ie.value)try{await X({sName:"nginx",version:ne.value,min_version:""}),F()}catch(e){}else l.error("当前版本与选择版本一致")},me=({props:{name:a}})=>{switch(a){case"service":pe();break;case"performance":(async()=>{await e({loading:le,request:G(),data:[Array,Z]})})();break;case"config":(async()=>{await e({loading:ae,request:O({path:"/www/server/nginx/conf/nginx.conf"}),data:{data:[String,ee]}})})();break;case"load":(async()=>{await e({loading:ae,request:J(),success:e=>{se.value=[];const a=["bytes","bytes_read","bytes_written"];Object.keys(e.data).forEach((l=>{se.value.push({name:l,ps:Y[l],value:a.includes(l)?s(Number(e.data[l])):e.data[l]})}));const l=se.value.findIndex((e=>"active"===e.name));if(l>-1){const[e]=se.value.splice(l,1);se.value.unshift(e)}}})})();break;case"logs":ce()}},pe=e=>{$.value="service",e&&(L.value=e),K.init(L.value),Q.init({name:"nginx"}),ne.value=L.value.version.split(".")[0]+"."+L.value.version.split(".")[1],ie.value=L.value.version.split(".")[0]+"."+L.value.version.split(".")[1],re.value=L.value.versions},ve={class:"my-[12px]"},fe={class:"flex text-[#666] items-center"},ge={class:"flex flex-col text-[#666] performance"},_e={key:0,class:"flex items-center"},xe={key:1,class:"flex items-center"},be=r(c({__name:"index",props:{compData:{default:{}}},setup(e){const a=e,{compData:l}=d(E());return m((()=>{pe(a.compData),l.value.refreshEvent=async()=>{const{data:e}=await t({name:"web"});l.value.status=e.s_status}})),(e,a)=>{const l=U,s=D,t=W,r=S,u=H,c=N,d=R,m=n,E=z,P=A,M=o,T=i,X=p("bt-loading");return v(),f("div",null,[g(T,{modelValue:w($),"onUpdate:modelValue":a[2]||(a[2]=e=>y($)?$.value=e:null),type:"left-bg-card",class:"h-full",onTabClick:w(me)},{default:_((()=>[g(l,{label:"服务",name:"service"},{default:_((()=>[g(I),g(B)])),_:1}),g(l,{label:"配置文件",name:"config"},{default:_((()=>[a[4]||(a[4]=x("span",{class:"my-[4px] text-[#666]"},"提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换",-1)),x("div",ve,[b(g(s,{class:"!h-[38rem] !w-[52rem]",modelValue:w(ee),"onUpdate:modelValue":a[0]||(a[0]=e=>y(ee)?ee.value=e:null),id:"configContent",filePath:"/www/server/nginx/conf/nginx.conf"},null,8,["modelValue"]),[[X,w(ae)]])]),g(t,{type:"primary",onClick:w(ue)},{default:_((()=>a[3]||(a[3]=[k("保存")]))),_:1},8,["onClick"]),a[5]||(a[5]=x("ul",{class:"leading-8 mt-20px text-[1.2rem] list-disc ml-[20px]"},[x("li",null,"此处为nginx主配置文件,若您不了解配置规则,请勿随意修改")],-1))])),_:1}),g(l,{label:"版本切换",name:"version"},{default:_((()=>[x("div",fe,[a[7]||(a[7]=x("span",null,"选择版本",-1)),g(u,{class:"mx-[12px] !w-[18rem]",modelValue:w(ne),"onUpdate:modelValue":a[1]||(a[1]=e=>y(ne)?ne.value=e:null)},{default:_((()=>[(v(!0),f(h,null,V(w(re),((e,a)=>(v(),j(r,{key:a,label:"nginx "+e.m_version,value:e.m_version},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),g(t,{type:"primary",onClick:w(de)},{default:_((()=>a[6]||(a[6]=[k("切换")]))),_:1},8,["onClick"])])])),_:1}),g(l,{label:"负载状态",name:"load"},{default:_((()=>[b((v(),j(d,{maxHeight:"500",data:w(se),border:"",style:{width:"100%"}},{default:_((()=>[g(c,{prop:"ps",label:"字段"}),g(c,{prop:"value",label:"当前值"})])),_:1},8,["data"])),[[X,w(ae)]])])),_:1}),b((v(),j(l,{label:"性能调整",name:"performance"},{default:_((()=>[x("div",ge,[g(P,{"label-position":"right","label-width":"186px"},{default:_((()=>[(v(!0),f(h,null,V(w(Z),((e,a)=>(v(),j(E,{label:e.name,key:a},{default:_((()=>["gzip"!=e.name?(v(),f("div",_e,[g(m,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,type:"worker_processes"!==e.name?"number":""},null,8,["modelValue","onUpdate:modelValue","type"]),x("span",null,C(e.ps),1)])):q("",!0),"gzip"==e.name?(v(),f("div",xe,[g(u,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,class:"!w-[8rem] mr-4px"},{default:_((()=>[g(r,{label:"开启",value:"on"}),g(r,{label:"关闭",value:"off"})])),_:2},1032,["modelValue","onUpdate:modelValue"]),x("span",null,C(e.ps),1)])):q("",!0)])),_:2},1032,["label"])))),128)),g(E,{label:" "},{default:_((()=>[g(t,{onClick:w(oe),type:"primary"},{default:_((()=>a[8]||(a[8]=[k("保存")]))),_:1},8,["onClick"])])),_:1})])),_:1})])])),_:1})),[[X,w(le)]]),g(l,{label:"错误日志",name:"logs"},{default:_((()=>[g(M,{content:w(te),autoScroll:!0,isHtml:!0,"full-screen":{title:"全屏查看日志",onRefresh:w(ce)},style:"height:540px"},null,8,["content","full-screen"])])),_:1})])),_:1},8,["modelValue","onTabClick"])])}}}),[["__scopeId","data-v-83ec4a8d"]]);export{be as default};
