import{l as e,H as l,G as a,a4 as t,c as s,b as o}from"./utils-lib.js?v=1734676359";import{c as r,r as n,h as m,o as i,k as c,l as d,p as u,J as p,x as v,q as f,z as y,v as _,F as x,e as k,I as b,aX as w,M as V,y as h,P as g,ae as j,ad as D,A as E}from"./base-lib.js?v=1734676359";import{_ as P}from"./index116.js?v=1734676359";import{bC as C,bD as U,bE as z}from"./useStore3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";import"./column.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";const M={class:"flex items-center"},q={class:"ml-[1rem]"},L={class:"flex items-center mt-6"},S={class:"w-[20rem] flex ml-[1rem]"},A={class:"flex items-center mt-6"},F={class:"w-[20rem] flex ml-[1rem]"},H={class:"my-6 flex items-center leading-[3rem]"},I={class:"flex ml-[1rem]"},K=["onClick"],G={key:1,class:"flex mt-[1.2rem]"},J={class:"flex-1 mr-[2rem]"},N={class:"flex-1"},O={class:"list-disc text-[#777] px-[2rem] pt-[1.2rem]"},R={class:"flex items-center"},T=r({__name:"index",props:{compData:{default:()=>({})}},emits:["close"],setup(r,{emit:T}){const X=o(),Y=r,{addNoPortLogin:B}=Y.compData,Q=n(!1),W=n(!1),Z=n(!1),$=n([]),ee=m({domain:"",port:"",key:"",cert:""}),le=T,ae=n("auto"),te=[{title:"不部署证书",value:"no"},{title:"自定义证书",value:"auto"},{title:"选择已有证书",value:"select"}],se=e=>{ee.key=e.key,ee.cert=e.cert},oe=async()=>{a({loading:"正在关闭反向代理，请稍候...",request:C({container_id:Y.compData.row.id}),message:!0,success:e=>{e.status&&(ae.value="no",ee.key="",ee.cert="",ee.port="",ee.domain="",W.value=!1)}})},re=async e=>{const l=X.load("正在获取配置中，请稍候...");try{const{data:l}=await U({container_id:e}),a=l.proxy_port;a.length>0&&($.value=a.map((e=>({label:e,value:e}))),ee.port=a[0]),Z.value=a.length>0;const{cert:t,key:s,name:o}=l;ee.domain=o,ae.value=l.ssl?"auto":"no",W.value=!!l.status,ee.key=s||"",ee.cert=t||""}catch(a){l.close()}finally{l.close()}},ne=async()=>{if(ee.domain)if("no"===ae.value||ee.key&&ee.cert){if(Q.value){const{id:e,name:l}=Y.compData.row;await a({request:z({container_id:e,container_name:l,container_port:ee.port,domain:ee.domain,privateKey:ee.key,certPem:ee.cert}),message:!0}),re(Y.compData.row.id)}else B(ee);le("close")}else X.error("请填写证书内容");else X.error("域名不能为空")};return i((()=>{Y.compData.row&&(Q.value=!0,re(Y.compData.row.id))})),(a,o)=>{const r=P,n=g,m=t,i=j,C=D,U=E,z=s;return c(),d("div",{class:x(u(Q)?"":"p-[2.4rem]")},[!u(Z)&&u(Q)?(c(),p(r,{key:0,width:"36rem"},{content:v((()=>o[6]||(o[6]=[f("i",{class:"svgtofont-el-warning-filled text-warning mr-4px text-2rem"},null,-1),f("span",null,"当前容器暂无端口映射，无法做容器反向代理",-1)]))),_:1})):y("",!0),f("div",M,[o[7]||(o[7]=f("span",null,"反向代理状态：",-1)),f("span",q,_(u(W)?"已开启":"未开启"),1),f("span",{class:x(u(W)?"svgtofont-icon-start text-[#20a53a]":"svgtofont-icon-stop text-[#ff0000]")},null,2)]),f("div",L,[o[8]||(o[8]=f("span",null,"绑定域名",-1)),f("div",S,[k(n,{modelValue:u(ee).domain,"onUpdate:modelValue":o[0]||(o[0]=e=>u(ee).domain=e),disabled:u(W),placeholder:"请输入绑定域名"},null,8,["modelValue","disabled"])])]),f("div",A,[o[9]||(o[9]=f("span",null,"需要代理的本地端口",-1)),f("div",F,[u(Q)&&u($).length>0?(c(),p(m,{key:0,modelValue:u(ee).port,"onUpdate:modelValue":o[1]||(o[1]=e=>u(ee).port=e),placeholder:"请选择端口号",disabled:u(W),options:u($),class:"w-[20rem]"},null,8,["modelValue","disabled","options"])):(c(),p(n,{key:1,modelValue:u(ee).port,"onUpdate:modelValue":o[2]||(o[2]=e=>u(ee).port=e),type:"number",placeholder:"端口号"},null,8,["modelValue"]))])]),f("div",H,[o[10]||(o[10]=f("span",null,"SSL证书",-1)),f("div",I,[k(C,{modelValue:u(ae),"onUpdate:modelValue":o[3]||(o[3]=e=>V(ae)?ae.value=e:null),size:"small"},{default:v((()=>[(c(),d(b,null,w(te,((a,t)=>k(i,{key:t,value:a.value},{default:v((()=>[f("span",{onClick:t=>{return s=a.value,ae.value=s,void("select"===s&&e({component:()=>l((()=>import("./selected-cert-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"免端口登录",area:70,showFooter:!1,compData:{selectdCert:se}}));var s}},_(a.title),9,K)])),_:2},1032,["value"]))),64))])),_:1},8,["modelValue"])])]),"no"!==u(ae)?(c(),d("div",G,[f("div",J,[o[11]||(o[11]=f("div",{class:"text-[1.2rem] mb-[.8rem]"},_("密钥(KEY)"),-1)),k(n,{class:"text-[1.2rem]",type:"textarea",modelValue:u(ee).key,"onUpdate:modelValue":o[4]||(o[4]=e=>u(ee).key=e),rows:13,size:"small",placeholder:"粘贴您的*.key文件内容"},null,8,["modelValue"])]),f("div",N,[o[12]||(o[12]=f("div",{class:"text-[1.2rem] mb-[.8rem]"},_("证书(PEM格式)"),-1)),k(n,{type:"textarea",modelValue:u(ee).cert,"onUpdate:modelValue":o[5]||(o[5]=e=>u(ee).cert=e),rows:13,size:"small",placeholder:"粘贴您的*.pem文件内容"},null,8,["modelValue"])])])):y("",!0),k(U,{onClick:ne,type:"primary",class:"!mt-1rem"},{default:v((()=>o[13]||(o[13]=[h("保存")]))),_:1}),u(W)?(c(),p(U,{key:2,onClick:oe,class:"!mt-1rem"},{default:v((()=>o[14]||(o[14]=[h("关闭反向代理")]))),_:1})):y("",!0),f("ul",O,[o[17]||(o[17]=f("li",null,"配置此域名的证书到面板，浏览器即可信任访问",-1)),f("li",null,[f("div",R,[o[16]||(o[16]=h(" 粘贴您的*.key以及*.pem内容，然后保存即可 ")),k(z,{href:"https://www.bt.cn/bbs/thread-105443-1-1.html"},{default:v((()=>o[15]||(o[15]=[h("帮助")]))),_:1})])]),o[18]||(o[18]=f("li",null,"如果浏览器提示证书链不完整,请检查是否正确拼接PEM证书",-1)),o[19]||(o[19]=f("li",null,"PEM格式证书 = 域名证书.crt + 根证书(root_bundle).crt",-1)),o[20]||(o[20]=f("li",null,[h("如需更多设置，请前往"),f("a",{class:"bt-link",href:"/docker/dockersite"},"Docker--网站")],-1))])],2)}}});export{T as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
