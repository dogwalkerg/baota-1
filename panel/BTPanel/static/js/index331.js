import{_ as a}from"./index90.js?v=1734676359";import{h as e,b as l,o as s,k as t,av as n}from"./utils-lib.js?v=1734676359";import{_ as o}from"./index182.js?v=1734676359";import{c as d,r as i,ax as r,R as u,i as m,w as p,k as c,J as f,x as v,q as _,e as h,p as b,N as w,l as g,I as S,aX as y,z as V,M as x,ag as N,ah as j,a7 as D,P as k,a4 as C,o as R,W as q,B as L,C as U}from"./base-lib.js?v=1734676359";import{I as J,J as P,K as z,G as F}from"./ssl.js?v=1734676359";import{u as I}from"./column.js?v=1734676359";import{g as O}from"./useStore10.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const B={class:"py-[16px]"},E=d({__name:"index",props:{title:{type:String,default:"添加NDS验证"}},setup(a){const s=l(),t=i({dns_name:"",ps:""}),n=i(null),o=r("isShowForm",u(!1)),d=r("formParams",u([])),R=r("isRefreshDNSList",u(!1)),q=r("formRow",u({})),L=i([]),U=m((()=>!!q.value.id)),z=a=>{var e;L.value=(null==(e=d.value.find((e=>e.id.toLowerCase()===a.toLowerCase())))?void 0:e.params)||[],I()},F=i({dns_name:[{required:!0,message:"请选择验证类型",trigger:"change"}]}),I=()=>{L.value.forEach((a=>{F.value[a]=[{required:!0,message:"请输入".concat(a),trigger:"blur"}]}))},O=()=>{t.value={dns_name:"",ps:""},q.value={dns_name:"DNSPodDns"}},E=async()=>{const a=n.value;if(!(await a.validate().catch((()=>!1))))return!1;try{let a,e={...t.value};if(t.value.id){a=await J({dns_id:e.id,ps:e.ps||"",pdata:JSON.stringify(e)})}else{a=await P({dns_name:e.dns_name,ps:e.ps||"",pdata:JSON.stringify(e)})}s.request(a),o.value=!1,R.value=!0,O()}catch(e){return s.error(e),!1}},G=async()=>{O()};return p(d,(a=>{a.length&&(t.value.dns_name=a[0].id,z(a[0].id))})),p(q,(a=>{t.value={...a},a.dns_name&&z(a.dns_name)}),{immediate:!0}),p(o,(a=>{a&&q.value.dns_name&&(t.value={...q.value},z(q.value.dns_name))})),(l,s)=>{const i=N,r=j,u=D,m=k,p=C,R=e;return c(),f(R,{title:a.title,modelValue:b(o),"onUpdate:modelValue":s[3]||(s[3]=a=>x(o)?o.value=a:null),area:["50rem"],"show-footer":"",onCancel:G,onConfirm:E},{default:v((()=>[_("div",B,[h(p,{ref_key:"dnsformRef",ref:n,size:"small",model:b(t),rules:b(F),class:"relative w-full","label-position":"right",onSubmit:s[2]||(s[2]=w((()=>{}),["prevent"]))},{default:v((()=>[h(u,{label:"验证类型",prop:"dns_name","label-width":"100"},{default:v((()=>[h(r,{modelValue:b(t).dns_name,"onUpdate:modelValue":s[0]||(s[0]=a=>b(t).dns_name=a),class:"!w-[33rem]",size:"default",filterable:"","default-first-option":"",placeholder:"请选择验证类型",disabled:b(U),onChange:z},{default:v((()=>[(c(!0),g(S,null,y(b(d),(a=>(c(),f(i,{key:a.id,label:a.name,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),b(L).length?(c(!0),g(S,{key:0},y(b(L),((a,e)=>(c(),f(u,{key:e,label:a,prop:a,"label-width":"100"},{default:v((()=>[h(m,{modelValue:b(t)[a],"onUpdate:modelValue":e=>b(t)[a]=e,class:"!w-[33rem]",placeholder:"请输入".concat(a)},null,8,["modelValue","onUpdate:modelValue","placeholder"])])),_:2},1032,["label","prop"])))),128)):V("",!0),h(u,{prop:"ps",label:"备注","label-width":"100"},{default:v((()=>[h(m,{modelValue:b(t).ps,"onUpdate:modelValue":s[1]||(s[1]=a=>b(t).ps=a),placeholder:"请输入备注",clearable:"",class:"!w-[33rem]"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["title","modelValue"])}}}),G={class:"p-[16px]"},H=d({__name:"index",setup(e){const d=l(),{refs:{isRefreshDomainList:r}}=O(),m=i([]),f=i({}),_=i(!1),w=i(!1),S=i(!1),y=u("添加DNS接口"),V=u({}),x=[{label:"类型",prop:"dns_name"},{label:"账号备注",prop:"ps"},I([{onClick:a=>{V.value=a,y.value="编辑【".concat(a.dns_name,"】"),S.value=!0},title:"编辑"},{onClick:a=>{j(a)},title:"删除"}])],N=[{content:"添加DNS接口",active:!0,event:()=>{y.value="添加DNS接口",S.value=!0}}],j=async a=>{await s({title:"删除【".concat(a.dns_name,"】"),content:"删除该验证接口，是否继续操作？",icon:"warning"});try{const e=await z({dns_id:a.id});d.request(e),w.value=!0,r.value=!0}catch(e){}};return p(w,(a=>{a&&((async()=>{_.value=!0;const{data:a}=await F(),e=n(a);if(e("data")){const{data:e}=a;m.value=e}if(e("add_data")){const{add_data:e}=a;f.value=e}_.value=!1})(),w.value=!1)}),{immediate:!0}),R((()=>{w.value=!0})),q("isShowForm",S),q("formParams",f),q("isRefreshDNSList",w),q("formRow",V),(e,l)=>{const s=o,n=t,d=a,i=L("bt-loading");return c(),g("div",G,[h(d,null,{"header-left":v((()=>[h(s,{options:N})])),content:v((()=>[U(h(n,{class:"soft-table",column:x,"max-height":"350",data:b(m),description:"列表为空"},null,8,["data"]),[[i,b(_)],[i,"正在加载NDS验证接口列表，请稍后...","title"]])])),popup:v((()=>[h(E,{title:b(y)},null,8,["title"])])),_:1})])}}});export{H as default};
