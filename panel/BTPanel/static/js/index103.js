import{o as e,b as a,O as t,h as s,e as l}from"./utils-lib.js?v=1734676359";import{_ as i}from"./index101.js?v=1734676359";import{s as o,r as n,h as r,n as u,c,i as m,e as d,y as p,o as v,k as f,l as x,q as g,v as h,p as b,x as w,I as _,aX as y,J as j,M as C,A as k,aY as T,a$ as D,b0 as S}from"./base-lib.js?v=1734676359";import{_ as z}from"./index272.js?v=1734676359";import{C as H,w as O,s as F,i as M,o as N}from"./index13.js?v=1734676359";import{P as V,Q as q,R as I}from"./useMethod2.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index90.js?v=1734676359";import"./index97.js?v=1734676359";import"./index99.js?v=1734676359";import"./index107.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./useMethod3.js?v=1734676359";import"./database.js?v=1734676359";import"./validator.js?v=1734676359";const L=a(),A=H(),{rowData:J}=o(A),R=n("正在获取中...."),B=n({log_path:"",size:""}),G=n(!1),U=n(""),P=n([]),Q=n(0),X=n(""),Y=n(),$=n(),E=r({status:!1,time:3}),K=n([new Date((new Date).setHours(0,0,0,0)),new Date((new Date).setHours(23,59,59,999))]),W=n(),Z=n(),ee=[{label:"全部",value:0},{label:"近7天",value:1},{label:"近30天",value:2},{label:"自定义时间",value:3}],ae=e=>{Q.value=e,3!==e?(X.value="",se(!1)):Y.value.focus()},te=e=>{Q.value=3,X.value=e,se(!1)},se=async e=>{try{e&&($.value=(e=>{let a=Number(e);return a=a<3?3:a,a})(E.time));let a=0,t=0;if(0!==Q.value){const e=1===Q.value?7:30,s=(new Date).getTime();a=(new Date(s-24*e*60*60*1e3).getTime()/1e3).toFixed(0),t=(s/1e3).toFixed(0),3===Q.value&&(a=(new Date(X.value[0]).getTime()/1e3).toFixed(0),t=(new Date(X.value[1]).getTime()/1e3).toFixed(0))}else a="",t="";const s=await V({id:J.value.id,start_timestamp:a,end_timestamp:t});R.value=s.data.msg||"暂无日志",le(),e&&ie()}catch(a){}},le=()=>{u((()=>{const e=document.querySelector(".pre-box");e&&(e.scrollTop=e.scrollHeight)}))},ie=async()=>{try{const{data:e}=await q({id:J.value.id});B.value.log_path=e.log_path,B.value.size=e.size}catch(e){}},oe=e=>{E.status=e.status,E.time=e.time,W.value[J.value.id]=E,Z.value=e.timer,sessionStorage.setItem("CRONTAB-LOGS",JSON.stringify(W.value))},ne=()=>{const e=sessionStorage.getItem("CRONTAB-LOGS");W.value=e?JSON.parse(e):{},W.value&&W.value[J.value.id]&&(E.status=W.value[J.value.id].status,E.time=Number(W.value[J.value.id].time)||3),ie(),se()},re=async()=>{try{await e({title:"提示",content:"确定清空日志吗？"});const a=await I({id:J.value.id});L.request(a),se(!0)}catch(a){}},ue=async()=>{try{G.value=!0,U.value="",P.value=[],O.request("/crontab/set_execute_script",{customType:"model",onMessage:e=>{!0!==e&&"successful"!==e&&(P.value.push(e),U.value=P.value.join("\n"))}})}catch(e){}},ce=e=>{const a=new Date;return a.setHours(23,59,59,999),e.getTime()>a.getTime()},me=async()=>{await F(!1,!0),ne()},de={class:"p-[20px]"},pe={class:"pb-2rem flex gap-2rem leading-2rem"},ve={class:"max-w-[54rem] truncate"},fe=["title"],xe={class:"flex justify-between items-end"},ge={class:"flex items-center"},he={class:"flex refresh-btn"},be={class:"flex items-center relative"},we={class:"pre-box bg-[#333] mt-[12px] text-white h-[48rem] overflow-auto p-[20px]"},_e=["innerHTML"],ye={class:"flex-wrap"},je=l(c({__name:"index",emits:["close"],setup(e,{emit:a}){const l=a,o=m((()=>[...M.value?[{content:d("span",{class:"bt-link",onClick:()=>N(n)},[p("一键跳转至本地备份目录")])}]:[],{content:"若您发现任务无法定时执行，可尝试点击【重装Crontab】进行重新安装"}])),n=()=>{l("close")};return v(ne),(e,a)=>{const l=z,n=k,r=T,u=D,c=S,m=t,v=i,H=s;return f(),x("div",de,[g("div",pe,[g("div",ve,"日志路径："+h(b(B).log_path),1),g("div",{class:"w-[20rem] truncate",title:"大小：".concat(b(B).size)},"大小： "+h(b(B).size),9,fe)]),g("div",xe,[g("div",ge,[g("div",he,[d(l,{refreshFn:()=>b(se)(!0),"session-config":b(E),onSave:b(oe)},null,8,["refreshFn","session-config","onSave"])]),d(n,{onClick:b(re)},{default:w((()=>a[2]||(a[2]=[p(" 清空日志 ")]))),_:1},8,["onClick"]),d(r,{direction:"vertical",class:"!h-[2rem] !mx-1rem"}),d(n,{onClick:b(me)},{default:w((()=>a[3]||(a[3]=[p("执行任务")]))),_:1},8,["onClick"]),d(n,{onClick:b(ue)},{default:w((()=>a[4]||(a[4]=[p("重装Crontab")]))),_:1},8,["onClick"])]),g("div",be,[d(u,{size:"default",class:"control-btn"},{default:w((()=>[(f(!0),x(_,null,y(b(ee),((e,a)=>(f(),j(n,{key:a,type:b(Q)===a?"primary":"",onClick:a=>b(ae)(e.value)},{default:w((()=>[p(h(e.label),1)])),_:2},1032,["type","onClick"])))),128))])),_:1}),d(c,{modelValue:b(X),"onUpdate:modelValue":a[0]||(a[0]=e=>C(X)?X.value=e:null),type:"daterange",ref_key:"player",ref:Y,align:"right",size:"default",class:"!absolute right-0 top-0 opacity-0 !w-0 !h-0","range-separator":"","start-placeholder":"开始日期","end-placeholder":"结束日期","disabled-date":b(ce),"default-time":b(K),onChange:b(te)},null,8,["modelValue","disabled-date","default-time","onChange"])])]),g("div",we,[g("pre",{class:"whitespace-pre-wrap",innerHTML:b(R)},null,8,_e)]),d(m,{options:b(o),"list-style":"disc",class:"mt-[1rem] mx-[1rem]"},null,8,["options"]),d(H,{title:"正在检查Crontab，请耐心等候",modelValue:b(G),"onUpdate:modelValue":a[1]||(a[1]=e=>C(G)?G.value=e:null),area:[60]},{default:w((()=>[g("div",ye,[d(v,{class:"h-[40rem] !rounded-none",content:b(U)},null,8,["content"])])])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-88c73069"]]);export{je as default};
