import{u as e,o as a,ah as t,aa as l,c as s,O as r,h as o,b as i,H as n}from"./utils-lib.js?v=1734676359";import{c as u,r as m,h as c,i as p,W as d,o as v,B as _,C as f,p as y,k as x,l as h,I as b,e as g,M as w,J as j,x as D,y as k,z as T,q as V,aX as E,A as N,a$ as I,ah as z,a7 as A,a4 as L,d as O,ag as R}from"./base-lib.js?v=1734676359";import{_ as C}from"./index100.js?v=1734676359";import{_ as P}from"./index116.js?v=1734676359";import{c as S}from"./useController3.js?v=1734676359";import{serviceAdmin as F,getPluginInfo as U,getProofFind as H,setConfigSite as J}from"./site.js?v=1734676359";import{u as M}from"./useStore7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";const q=""+new URL("../images/soft_ico/tamper_core_service.png",import.meta.url).href,B={class:"relative h-full"},W={class:"flex items-center"},X={key:2,class:"absolute top-0 z-10 h-full w-full bg-[#FAFAFA] text-center flex flex-col items-center justify-center"},$={class:"p-2rem"},G=u({__name:"index",props:{compData:{default:{}}},setup(u,{expose:G}){const K=O((()=>n((()=>import("./overview.js?v=1734676359")),__vite__mapDeps([]),import.meta.url))),Q=O((()=>n((()=>import("./exclude-protect-ext.js?v=1734676359")),__vite__mapDeps([]),import.meta.url))),Y=O((()=>n((()=>import("./protect-ext.js?v=1734676359")),__vite__mapDeps([]),import.meta.url))),Z=O((()=>n((()=>import("./advanced.js?v=1734676359")),__vite__mapDeps([]),import.meta.url))),ee=O((()=>n((()=>import("./white-list.js?v=1734676359")),__vite__mapDeps([]),import.meta.url))),ae=i(),{payment:te}=e(),{siteInfo:le}=M(),se=m(!1),re=m(),oe=m("pro"===te.value.authType?"tamper_proof_refactored":"tamper_core"),ie=m(!1),ne=m(!1),ue=m({}),me=m(!1),ce=m(),pe=m(!1),de=c({sites:[],list:[]}),ve=c({sites:[{required:!0,message:"请选择同步配置",trigger:"blur"}]}),_e=[{isHtml:!0,content:'【一键应用】将当前网站已配置的<span class="text-danger">排除目录</span>，<span class="text-danger">防护文件</span>，同步配置到其他网站'}],fe=p((()=>{const e="tamper_core"==oe.value;return{title:"".concat(e?"堡塔企业级防篡改":"网站防篡改程序","-功能介绍"),height:36,ps:"".concat(e?"内核版防篡改,用于保护站点内容安全，防止黑客非法修改网页、网站挂马等入侵行为，支持Centos/Debian/Ubuntu，注意：不能与其它防篡改软件同时使用":"事件型防篡改，用于保护站点内容安全，防止黑客非法修改网页、网站挂马等入侵行为"),source:e?180:46,desc:["保护站点内容安全","阻止黑客非法修改网页","阻止网站被挂马","阻止其他入侵行为"],isInstall:ne.value,tabImgs:["https://www.bt.cn/Public/new/plugin/introduce/site/".concat(e?"tamper_core_preview":"tamper_proof_preview",".png")],pluginInfo:ue.value}})),ye=m("overview"),xe=m(),he=m(!0),be=[{content:"启动",event:()=>ge("start")},{content:"重启",event:()=>ge("restart")},{content:"重载配置",event:()=>ge("reload")}],ge=async e=>{let l;try{let t="";switch(e){case"start":t="启动";break;case"restart":t="重启";break;case"reload":t="重载"}await a({title:"".concat(t,"防篡改服务"),content:"".concat(t,"项目后，当前服务将").concat(t,"运行，是否继续操作？")}),l=ae.load("正在".concat(t,"防篡改服务，请稍候..."));const s=await F({action:e});ae.msg({customClass:"bt-message-error-html !max-w-[36rem]",dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",showClose:!s.status,duration:s.status?5e3:0}),s.status&&we()}catch(s){t(s)}finally{null==l||l.close()}},we=async()=>{try{se.value=!0;const{data:e}=await U({sName:"tamper_core"}),{data:a}=await U({sName:"tamper_proof_refactored"}),t=e.setup&&e.endtime>0,l=a.setup&&a.endtime>=0;ie.value=!1,ne.value=!0,t?oe.value="tamper_core":l?oe.value="tamper_proof_refactored":(oe.value="pro"===te.value.authType?"tamper_proof_refactored":"tamper_core","free"===te.value.authType?ne.value=!1:ie.value=!0),ie.value=t||l,ue.value="tamper_core"==oe.value?e:a;let s={type:oe.value,maskLayer:ie.value};"tamper_core"==oe.value?(s.isVersion=parseFloat(e.version)>=3.2,xe.value=[{label:"概览",name:"overview",lazy:!0,render:()=>g(K,{compData:s},null)},{label:"受保护的文件类型",lazy:!0,name:"protect",render:()=>g(Y,{compData:{...s,childType:"protect"}},null)},{label:"白名单",lazy:!0,name:"exclude",render:()=>g(ee,{compData:{...s,childType:"exclude"}},null)},{label:"高级设置",name:"advanced",lazy:!0,render:()=>g(Z,{compData:{...s,childType:"advanced"}},null)}]):xe.value=[{label:"概览",name:"overview",lazy:!0,render:()=>g(K,{compData:s},null)},{label:"排除目录",name:"exclude",lazy:!0,render:()=>g(Q,{compData:{...s,childType:"exclude"}},null)},{label:"保护文件/扩展名",name:"protect",lazy:!0,render:()=>g(Q,{compData:{...s,childType:"protect"}},null)}]}catch(e){}finally{se.value=!1}},je=()=>{},De=()=>{var e,a,t;de.list=(null==(t=null==(a=null==(e=re.value)?void 0:e.getRef())?void 0:a.overview)?void 0:t.sitesList)||[],me.value=!0},ke=async()=>{var e;await ce.value.validate();try{const{data:a}=await H({siteName:le.value.name});let t={protectExt:JSON.stringify(a.protectExt),excludePath:JSON.stringify(a.excludePath),sites:JSON.stringify(de.sites.map((e=>{var a;return{siteName:e,path:null==(a=de.list)?void 0:a.find((a=>a.siteName==e)).path}}))),sourceSite:le.value.path};const l=await J(t);return me.value=!1,void S({title:"批量设置配置",resultData:null==(e=l.data)?void 0:e.map((e=>({name:e.ps,status:e.status,msg:e.msg}))),resultTitle:"配置",showMult:!1})}catch(a){t(a)}};return d("kernelModuleStatus",he),v(we),G({init:we}),(e,a)=>{const t=l,i=N,n=s,u=P,m=I,c=C,p=R,d=z,v=A,O=L,S=r,F=o,U=_("bt-loading");return f((x(),h("div",B,[y(ie)?(x(),h(b,{key:0},[g(t,{ref_key:"tamperRef",ref:re,type:"bg-card",modelValue:y(ye),"onUpdate:modelValue":a[0]||(a[0]=e=>w(ye)?ye.value=e:null),options:y(xe)},null,8,["modelValue","options"]),"overview"!==y(ye)&&"tamper_proof_refactored"===y(oe)?(x(),j(i,{key:0,type:"primary",class:"absolute top-0 right-0",onClick:De},{default:D((()=>a[3]||(a[3]=[k(" 一键应用 ")]))),_:1})):T("",!0),"tamper_core"==y(oe)&&parseFloat(y(ue).version)<3.2?(x(),j(u,{key:1,visible:!0},{content:D((()=>[V("div",W,[a[5]||(a[5]=V("span",null,"版本过低无法使用，请点击更新",-1)),g(n,{onClick:je,class:"!font-bold !text-[1.4rem]"},{default:D((()=>a[4]||(a[4]=[k(" 【企业级防篡改】 ")]))),_:1})])])),_:1})):"tamper_core"!=y(oe)||y(he)?T("",!0):(x(),h("div",X,[a[6]||(a[6]=V("div",{class:"text-[#666] text-[24px] mb-1rem flex items-center"},[V("img",{width:"30",src:q}),k(" 【服务已停止】 ")],-1)),a[7]||(a[7]=V("div",{class:"text-[#999] text-[14px] mb-2rem"},"检测到当前服务未开启，请尝试手动启动！否则无法正常使用防篡改插件功能",-1)),g(m,{options:be})]))],64)):(x(),j(c,{key:1,data:y(fe),class:"p-20px"},null,8,["data"])),g(F,{title:"一键应用",modelValue:y(me),"onUpdate:modelValue":a[2]||(a[2]=e=>w(me)?me.value=e:null),area:50,"show-footer":"",onConfirm:ke},{default:D((()=>[V("div",$,[g(O,{ref_key:"applyFormRef",ref:ce,model:y(de),rules:y(ve),disabled:y(pe)},{default:D((()=>[g(v,{label:"同步配置",prop:"sites"},{default:D((()=>[g(d,{modelValue:y(de).sites,"onUpdate:modelValue":a[1]||(a[1]=e=>y(de).sites=e),multiple:"","collapse-tags":"",class:"!w-30rem",placeholder:"请选择"},{default:D((()=>[(x(!0),h(b,null,E(y(de).list,(a=>(x(),h(b,null,[a.siteName!==e.compData.name?(x(),j(p,{key:a.siteName,label:a.siteName,value:a.siteName},null,8,["label","value"])):T("",!0)],64)))),256))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules","disabled"]),g(S,{options:_e,"list-style":"disc",class:"mt-2rem ml-2rem"})])])),_:1},8,["modelValue"])])),[[U,y(se)]])}}});export{G as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
