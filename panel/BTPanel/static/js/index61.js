import{_ as e}from"./index90.js?v=1734676359";import{u as t}from"./index124.js?v=1734676359";import{r as a,c as s,s as n,e as o,y as r,w as i,o as l,k as c,J as u,x as m,p,q as d}from"./base-lib.js?v=1734676359";import{l as _,H as f,aj as g,M as v,o as y,u as j,al as b,am as h,p as w,ao as x}from"./utils-lib.js?v=1734676359";import{f as C}from"./validator.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";import{c as S,a as k,h as O,g as B,u as P}from"./column.js?v=1734676359";import{u as T,g as J,a as L,b as I,o as N,h as R,i as E,s as M,d as q,f as A,k as G}from"./useController3.js?v=1734676359";import{u as H,S as D}from"./useStore7.js?v=1734676359";import{setProject as U,removeProject as V}from"./site.js?v=1734676359";const{activeType:z,settingTabActive:F,siteInfo:K,isRefreshList:Q}=H(),{addGeneralProject:W,editGeneralProject:X,delGeneralProjectEvent:Y,setSiteInfo:Z,getRootUser:$,getProjectConfig:ee}=D(),te=a([]),ae=()=>{K.value=null,_({title:"添加通用项目",area:62,component:()=>f((()=>import("./index316.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},se=(e,t)=>{Z(e,t),_({title:"通用项目管理["+e.name+"] -- 添加时间["+e.addtime+"]",area:[84,72],component:()=>f((()=>import("./index317.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},ne=async(e,t,a,s)=>{const{label:n,value:o}=s,r=new Map([["start","批量启动选中项目后，项目将正常访问"],["stop","批量停用选中的项目后，项目将会停止运行"],["restart","批量重启选中的项目后，项目将会重新启动"],["delete","批量删除选中的项目后，项目将无法恢复"]]),i=async(e,t)=>{const a=new Map([["start",U],["stop",U],["restart",U],["delete",V]]),{name:s}=e,n=a.get(o);switch(o){case"start":case"stop":case"restart":if(n){const t=await n({data:JSON.stringify({project_name:s})},z.value,o),a=t.status?1:2;return"start"===o?{...e,batchStatus:a,message:t.msg.replace(/<br>/g,"\n")}:{...e,batchStatus:a,message:t.status?t.data.msg:t.data.data}}case"delete":if(n)return await n({data:JSON.stringify({project_name:s})},z.value)}};await e({title:"批量".concat(n),content:"".concat(r.get(o),"，是否继续操作？"),column:[{label:"项目名称",prop:"name"},S()],onConfirm:async()=>(await t(i),Q.value=!0,!1)})},oe=(e,t)=>{C({type:"file",path:e,change:e=>{t&&t(e)}})},re=async()=>{const{data:e}=await $();if(te.value=e.map((e=>({label:e,value:e}))),K.value){const{data:e}=await ee({data:JSON.stringify({project_name:K.value.name})});return{...null==e?void 0:e.project_config,project_ps:null==e?void 0:e.ps,is_power_on:!!(null==e?void 0:e.project_config.is_power_on),project_log:(null==e?void 0:e.project_config.project_log)?1:0,web_log:(null==e?void 0:e.project_config.web_log)?1:0}}return{project_exe:"",project_name:"",port:"",project_cmd:"",run_user:"www",project_ps:"",domains:"",release_firewall:!1,is_power_on:!1,bind_extranet:!1}},ie=async e=>{try{const t={...e};if(""!==t.domains){t.bind_extranet=1;const e=g(t.domains,"string","");t.domains=e.split("\n")}else t.bind_extranet=0,delete t.domains;K.value&&(t.id=K.value.id);const a=K.value?X:W,s=await a({data:JSON.stringify(t)});return v.msg({dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",duration:s.status?2e3:0,showClose:!s.status,customClass:"!max-w-[66rem]"}),Q.value=!0,s.status}catch(t){return{status:!1,msg:"发生错误"}}},le=async e=>{try{await y({title:"删除项目-".concat(e.name),content:"风险操作，此操作不可逆，删除".concat(e.name,"项目后您将无法管理该项目，是否继续操作？"),type:"calc"});const t={data:JSON.stringify({project_name:e.name})},a=await Y(t);return v.request(a),Q.value=!0,a}catch(t){return{status:!1,msg:"删除项目失败"}}},ce=s({__name:"index",setup(a){const{mainHeight:s}=j(),{getSiteList:_,setSiteInfo:f}=D(),{isRefreshList:v,siteInfo:y}=n(D()),{BtOperation:C}=b({options:[{type:"button",label:"添加通用项目",active:!0,onClick:ae},{type:"button",label:"项目守护隔离时间",onClick:R}]}),S=t({key:"type_id",name:"Other分类",options:()=>[{label:"全部分类",value:"all"}],event:E,ignore:["0"],field:"type_name"}),H=x([{label:"启动项目",value:"start",event:ne},{label:"停用项目",value:"stop",event:ne},{label:"重启项目",value:"restart",event:ne},q(),A({classList:G}),{label:"删除项目",value:"delete",event:ne}]),{BtTable:U,BtPage:V,BtRefresh:z,BtSearch:F,BtColumn:K,BtBatch:Q,BtTableCategory:W,refresh:X,config:Y}=h({request:e=>{const{type_id:t,...a}=e;return _({data:JSON.stringify({...a,type_id:w(t)||"all"===t?"":t})})},columns:[k(),T({onClick:e=>{se(e)}}),J({onClick:(e,t)=>{if("setting"===t)return void se(e,"state");const a=e.run?"stop":"start";M(e,"restart"===t?t:a)}}),{label:"运行端口",isCustom:!0,render:e=>{const t=g(e.listen,"array",[]);return 0==t.length?"--":t.join("、")}},O(),L(),B({table:"sites",width:200}),I({onClick:e=>{se(e,"ssl")}}),P([{title:"设置",onClick:e=>se(e)},{title:"删除",onClick:le}])],extension:[S,H],empty:()=>o("span",null,[r("您的列表为空，您可以"),o("span",{class:"bt-link",onClick:ae},[r("添加一个项目")])])});return i(v,(async e=>{var t;if(e){if(await X(),null==(t=y.value)?void 0:t.name){const e=Y.data.find((e=>e.name===y.value.name));e&&f(e)}v.value=!1}})),l((()=>{})),(t,a)=>{const n=e;return c(),u(n,null,{"header-left":m((()=>[o(p(C)),d("div",{class:"flex items-center ml-1rem",onClick:a[0]||(a[0]=(...e)=>p(N)&&p(N)(...e))},a[1]||(a[1]=[d("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),d("span",{class:"bt-link"},"需求反馈",-1)]))])),"header-right":m((()=>[o(p(W),{class:"!w-[200px] mr-[10px]"}),o(p(F),{class:"mr-[10px]",placeholder:"请输入项目名称或备注"}),o(p(z),{class:"mr-[10px]"}),o(p(K))])),content:m((()=>[o(p(U),{"max-height":p(s)-220},{empty:m((()=>a[2]||(a[2]=[r(" 您的列表为空，您可以添加一个项目 ")]))),_:1},8,["max-height"])])),"footer-left":m((()=>[o(p(Q))])),"footer-right":m((()=>[o(p(V))])),_:1})}}}),ue=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));export{re as a,ue as i,oe as o,ie as s,te as u};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
