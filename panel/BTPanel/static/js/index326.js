import{O as e,h as l,b as a,x as t,k as s}from"./utils-lib.js?v=1734676359";import{_ as o}from"./index90.js?v=1734676359";import{c as r,r as n,o as i,k as p,l as c,y as u,q as d,v as m,p as v,e as f,x,I as h,aX as y,J as g,z as b,A as w}from"./base-lib.js?v=1734676359";import{validateDomain as _,getOrderDetail as k,authDomainApi as j}from"./site.js?v=1734676359";import{g as C}from"./useStore10.js?v=1734676359";import{l as T}from"./useController7.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./useStore11.js?v=1734676359";import"./useStore7.js?v=1734676359";import"./useController3.js?v=1734676359";import"./validator.js?v=1734676359";import"./useStore9.js?v=1734676359";import"./useMethod5.js?v=1734676359";const S={class:"p-[1.5rem]"},D={class:"ml-[.4rem] text-danger"},O={class:"max-h-[38rem] overflow-auto"},L={key:0,class:"flex justify-end"},M={class:"h-full overflow-auto bg-black text-white"},H=["innerHTML"],q=r({__name:"index",props:{compData:{type:Object,default:()=>{}}},emits:["close"],setup(r,{emit:q}){const N=a(),z=r,P=q,{refs:{isRefreshCertificateList:R}}=C(),U=n({}),X=n([]),A=n(!1),E=n("");n();const F=n([]),I=n(!1),J=n(""),B=n([{text:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{text:""},{text:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}]),G=n([{label:"解析域名",prop:"domain",showOverflowTooltip:!0},{label:"记录值",prop:"auth_value",showOverflowTooltip:!0,render(e,l){const a="dns"===U.value.auth_type?e.auth_value:e.file_path;return f("div",{class:"flex items-center"},[f("div",{class:"truncate w-[15rem]"},[a]),f("span",{class:"svgtofont-icon-copy ml-[4px] text-[#666] text-[1.6rem] w-[1.6rem] cursor-pointer",onClick:()=>t({value:a})},null)])}},{label:"类型",prop:"type",showOverflowTooltip:!0,render:(e,l)=>"dns"===U.value.auth_type?f("span",null,[e.type]):f("div",{class:"flex items-center"},[f("div",{class:"truncate w-[15rem]"},[e.content]),f("span",{class:"svgtofont-icon-copy ml-[4px] text-[#666] text-[1.6rem] w-[1.6rem] cursor-pointer",onClick:()=>t({value:e.content})},null)])},{label:"必需",prop:"must",width:100}]),K=e=>{var l,a;let t="";if(void 0===e[1].challenges)t+="<p><span>响应状态：</span>"+e[1].status+"</p>",t+="<p><span>错误类型：</span>"+e[1].type+"</p>",t+="<p><span>错误来源：</span><a href='https://letsencrypt.org/' style='color:#20a53a'>Let's Encrypt官网</a></p>",t+='<div class="flex flex-col">错误代码：<pre class="!text-white  !bg-[#333] !inline-block  ! ml-[4px] ">'+e[1].detail+"</pre></div>";else if(e[1].challenges[1]||e[1].challenges[0]&&(e[1].challenges[1]=e[1].challenges[0]),"invalid"===e[1].status){let s="";for(let t=0;t<X.value.length;t++){if(-1==(null==(l=X.value[t].outerText)?void 0:l.indexOf(e[1].identifier.value)))continue;let o=null==(a=X.value[t].outerText)?void 0:a.split("\t");if((null==o?void 0:o.length)>1){s=o[1];break}}if(t+="<p><span>验证域名：</span>"+e[1].identifier.value+"</p>","dns"===U.value.type){t+="<p><span>验证解析：</span>"+("_acme-challenge."+e[1].identifier.value)+"</p>",t+="<p><span>验证内容：</span>"+s+"</p>",t+='<div class="flex flex-col">错误代码：<pre class="!text-white  !bg-[#333] !inline-block  ! ml-[4px] ">'+e[1].challenges[1].error.detail+"</pre></div>"}else{t+="<p><span>验证URL：</span><a style='color:#20a53a' href='"+("http://"+e[1].identifier.value+"/.well-known/acme-challenge/"+e[1].challenges[0].token)+"' target='_blank'>点击查看</a></p>",t+="<p><span>验证内容：</span>"+e[1].challenges[0].token+"</p>",t+='<div class="flex flex-col">错误代码：<pre class="!text-white  !bg-[#333] !inline-block  ! ml-[4px] ">'+e[1].challenges[0].error.detail+"</pre></div>"}t+="<p><span>验证结果：</span> <a style='color:red;'>验证失败</a></p>"}N.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,icon:"x",message:'<div class="flex items-center justify-center  mt-[8px]  mb-[20px]"><i class="svgtofont-el-circle-close-filled  mr-[8px] text-[#F56C6C] text-[3rem]"></i><a style="color: red;font-size:16px">'+e[0]+'</a></div><div class=" p-[20px] border border-1 border-color-[#dedede] ! rounded-[4px] ! mb-[12px] !leading-[26px] bg-[#f8f8f8]">'+t+"</div>",showClose:!0,duration:0})},Q=async()=>{try{A.value=!0;const e=await T(),{data:l}=await _({index:U.value.index});if(e._props.onCancel(),A.value=!1,!0===l.status)R.value=!0,P("close");else{if("string"==typeof(null==l?void 0:l.msg))return N.error(l.msg);K(l)}}catch(e){}};return i((()=>{(async e=>{var l,a;let t=null;try{t=N.load("正在验证证书申请状态，请稍后...");const s=await k({index:e.index});s.status?(F.value=s.data.auths,s.data.hasOwnProperty("error")?(I.value=s.data.error,J.value=s.data.error_msg):(I.value=!1,J.value=""),U.value=e,G.value[1].label="dns"===e.auth_type?"记录值":"文件路径",G.value[1].prop="dns"===e.auth_type?"auth_value":"file_path",G.value[2].label="dns"===e.auth_type?"类型":"文件内容",G.value[2].prop="dns"===e.auth_type?"type":"content",B.value[1].text="可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(null==(a=null==(l=X.value[0])?void 0:l.domain)?void 0:a.replace("*.",""))):(N.request(s),P("close"))}catch(s){}finally{t&&t.close()}})(z.compData.row)})),(a,t)=>{const r=s,n=w,i=o,_=e,k=l;return p(),c("div",S,[t[2]||(t[2]=u(" 请按以下列表做TXT解析: ")),d("span",D,m(v(J)),1),f(i,null,{content:x((()=>[d("div",O,[(p(!0),c(h,null,y(v(F),((e,l)=>(p(),c(h,null,[e.data.length?(p(),c("div",{key:l},[d("span",null,"验证域名："+m(e.domain),1),f(r,{class:"my-[1rem]",column:v(G),data:e.data},null,8,["column","data"]),v(I)?(p(),c("div",L,[f(n,{type:"default",onClick:l=>(async e=>{try{A.value=!0;const l=await T(),{data:a}=await j({index:U.value.index,domain:e});if(l._props.onCancel(),A.value=!1,"valid"===a.status)N.success("验证成功");else if(!0===a.status)P("close");else{if("string"==typeof(null==a?void 0:a.msg))return N.error(a.msg);K(a)}}catch(l){}})(e.domain)},{default:x((()=>t[0]||(t[0]=[u("验证")]))),_:2},1032,["onClick"])])):b("",!0)])):b("",!0)],64)))),256))])])),"footer-right":x((()=>[v(I)?b("",!0):(p(),g(n,{key:0,type:"primary",onClick:Q},{default:x((()=>t[1]||(t[1]=[u("验证")]))),_:1}))])),_:1}),f(_,{list:v(B),listStyle:"disc",class:"ml-[2rem]"},null,8,["list"]),f(k,{visible:v(A),area:[50,25],"show-close":!1},{default:x((()=>[d("div",M,[d("pre",{innerHTML:v(E),class:"whitespace-pre-wrap p-[1rem]"},null,8,H)])])),_:1},8,["visible"])])}}});export{q as default};
