import{G as e,M as t,ah as a,o as n,l as r,H as l,a5 as o,a7 as s,al as i,am as c,R as u,an as p,ao as d,e as m,X as v}from"./utils-lib.js?v=1734676359";import{g as h,r as g,R as b,s as f,c as y,az as w,e as _,k,J as x,x as E,p as C,P as O,aj as j,a9 as T,y as D,aa as N,A as P,ax as V,aw as H,b5 as B,a5 as q,o as I,l as S}from"./base-lib.js?v=1734676359";import{_ as R}from"./index90.js?v=1734676359";import{a as z,b as A,u as W,o as M}from"./column.js?v=1734676359";import{an as L,ao as U,ap as J,aq as G,ar as F,as as K,at as X}from"./useStore3.js?v=1734676359";import{l as Y,D as Q,d as Z,m as $}from"./useController.js?v=1734676359";import{f as ee}from"./validator.js?v=1734676359";import{h as te}from"./form-item.js?v=1734676359";import{_ as ae}from"./index91.js?v=1734676359";const ne=h("DOCKER-SITE-ENV-PHP-STORE",(()=>{const o=g(!1),s=g(),i=g([]),c=g([]),u=g([]),p=b([]),d=b({}),m=g(!1),v=g(!1),h=()=>{v.value=!0};return{versionOptions:i,extendOptions:c,templateOptions:u,extendsupOptions:p,resetData:()=>{i.value=[],c.value=[],u.value=[],m.value=!1,o.value=!1,s.value={},p.value=[],d.value={}},getExtend:async(n="all")=>{try{const r={version:n},l=await e({loading:"正在获取版本，请稍后...",request:L(r),message:!1});l.status?d.value=l.data:(t.error(l.msg),a(l))}catch(r){a(r)}},getTemplate:async n=>{try{const r=await e({loading:"正在获取版本，请稍后...",request:U(n||{p:1,row:100}),message:!1});if(!r.status)return t.error(r.msg),a(r),!1;u.value=r.data.data.map((e=>({label:e.name,name:e.name,value:e.id,ext:e.exts,version:e.version,disabled:!1})))}catch(r){a(r)}},popoverFocus:m,isEdit:o,rowData:s,allData:d,refreshTemplateTable:v,setRefreshTemplateTable:h,delPhpTemplate:async(t,r,l)=>{try{await n({title:"删除【".concat(t.name,"】模板"),content:"删除【".concat(t.name,"】模板，此操作不可逆，是否继续操作？"),icon:"warning-filled"}),await e({loading:"正在删除，请稍后...",request:J({id:t.id}),message:!0,success:e=>{h(),l&&l(e)}})}catch(o){a(o)}},useBatchEventHandle:async(a,o,s,i,c)=>{await n({title:"删除模板",content:"删除选中的".concat(s.value.length,"个模板，此操作不可逆，是否继续操作？"),icon:"warning-filled"});const u={ids:s.value.map((e=>e.id)).join(",")};await e({loading:"正在删除，请稍后...",request:G(u),success:async e=>{Array.isArray(e.data.data)?await r({title:"批量删除结果",area:42,component:()=>l((()=>import("./index102.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{resultData:e.data.data.map((e=>{const t=s.value.find((t=>t.id===Number(e.id)));return{name:null==t?void 0:t.name,status:e.status,msg:e.msg}})),resultTitle:"删除扩展模板"}}):t.request(e),h(),c()}})}}}));let re=null,le="";const oe=g(""),se=e=>{let a=[];re=o({route:"/sock_shell",onMessage:(n,r)=>{a.push(r.data),a.length>50?oe.value=null==a?void 0:a.slice(a.length-50).join(" "):oe.value=null==a?void 0:a.join(" "),(r.data.includes("bt_successful")||r.data.includes("bt_failed"))&&(null==re||re.close(),a=[]),r.data.includes("bt_successful")&&(e(),t.success("创建成功")),r.data.includes("bt_failed")&&t.error("创建失败")}}),null==re||re.send(le)},ie=()=>{null==re||re.close(),re=null,le="",oe.value=""},ce=(e,t)=>{le=e,r({title:"创建日志",area:60,component:()=>l((()=>import("./index366.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),onCancel:()=>{t&&t()}})},ue=ne(),{getVersion:pe,setTypeRefreshTable:de}=Y(),{versionOptions:me,extendOptions:ve,allData:he,extendsupOptions:ge,isEdit:be,rowData:fe,templateOptions:ye}=f(ue),{resetData:we,getExtend:_e,getTemplate:ke,setRefreshTemplateTable:xe}=ue;g();const Ee=e=>(be.value=!!(null==e?void 0:e.name),fe.value=e||{},new Promise(((e,t)=>{r({title:"创建",area:80,btn:["确认","取消"],component:()=>l((()=>import("./php-form.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),onCancel:()=>{we(),e(!1)}})}))),Ce=e=>(be.value=!!(null==e?void 0:e.name),fe.value=e||{},new Promise(((e,t)=>{r({title:"创建",area:60,btn:["确认","取消"],component:()=>l((()=>import("./php-template-form.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})}))),Oe=async t=>{try{const{data:a}=await e({request:U(t||{p:1,row:100})});return a.status?{data:a.data,total:s(a.page)}:{data:[],total:0}}catch(a){}},je=async e=>{try{await _e(),await ke();const t=await pe("php");t.status&&(me.value=t.data.php.map((e=>({label:e,value:e}))),ve.value=t.data.repo_urls.map((e=>({label:e.name,value:e.repo}))),me.value.length>0&&(be.value||(e.value.version=me.value[0].value),De(me.value[0].value)),ve.value.length>0&&!be.value&&(e.value.repo_url=ve.value[0].value)),be.value&&De(fe.value.version)}catch(t){}},Te=async e=>{try{await _e();const t=await pe("php");t.status&&(me.value=t.data.php.map((e=>({label:e,value:e}))),me.value.length>0&&(be.value||(e.value.version=me.value[0].value),De(me.value[0].value))),be.value&&De(fe.value.version)}catch(t){}},De=e=>{var t;try{e&&(ge.value=(null==(t=he.value[e])?void 0:t.map((e=>({label:e,value:e}))))||[],ye.value=ye.value.map((t=>({...t,label:"".concat(t.name).concat(t.version!==e?"(当前PHP版本不支持)":""),disabled:t.version!==e}))))}catch(a){}},Ne=(e,a,n,r,l)=>{var o,s,i;try{if(e.includes(",")){if(""===n)return r.value.exts=[],t.error("请先选择PHP版本");a.value=(null==(o=he.value[n])?void 0:o.filter((t=>t.includes(e))).map((e=>({label:e,value:e}))))||[];const i=[],c=[];e.split(",").filter((e=>""!==e&&" "!==e)).forEach((e=>{he.value[n].includes(e)?c.push(e):i.push(e)})),r.value.exts=c,null==(s=l.value)||s.blur(),i.length>0?t.success("已选中".concat(c.length,"个扩展，当前PHP版本不支持这").concat(i.length,"个扩展：【").concat(i.join(","),"】")):c.length>0&&t.success("已选中".concat(c.length,"个扩展"))}else a.value=(null==(i=he.value[n])?void 0:i.filter((t=>t.includes(e))).map((e=>({label:e,value:e}))))||[]}catch(c){}},Pe=()=>{try{return be.value?{name:fe.value.name,version:fe.value.version,repo_url:fe.value.repo_url,template:"",exts:fe.value.exts.split(","),id:fe.value.id}:{name:"",version:"",repo_url:"",template:"",exts:""}}catch(e){}},Ve=()=>{try{return be.value?{name:fe.value.name,version:fe.value.version,exts:fe.value.exts.split(","),id:fe.value.id}:{name:"",version:"",exts:""}}catch(e){}},He=async(a,n)=>{try{const r={runtime_name:a.name,runtime_version:a.version,repo_url:a.repo_url,exts:a.exts.join(","),runtime_type:"php",...a.id?{id:a.id}:{}};await e({request:F(r),success:e=>{e.status?(n(),ce("tail -f /www/dk_project/runtime/build/php/".concat(a.name,"/build.log"),(()=>{de("php")}))):t.error(e.msg)}})}catch(r){}},Be=async(t,a)=>{try{const n={name:t.name,version:t.version,exts:t.exts.join(","),...t.id?{id:t.id}:{}};await e({request:K(n),message:!0,success:e=>{e.status&&(a(),xe())}})}catch(n){}},qe=h("DOCKER-SITE-LOG-STORE",(()=>{const e=g("run"),a=g({compose:"",log_file:""}),n=g("");return{rowData:a,tabActive:e,logContent:n,getEnvLog:async()=>{try{const r={log_type:e.value,..."run"===e.value?{compose_file:a.value.compose}:{log_file:a.value.log_file}},l=t.load("正在获取日志，请稍后..."),{data:o}=await X(r);l.close(),o.status?n.value=o.data:(t.error(o.msg),n.value="暂无日志内容")}catch(r){}},resteData:()=>{n.value="",a.value.compose_file="",a.value.log_file="",e.value="run"}}})),Ie=()=>f(qe()),Se=qe(),{resteData:Re}=Se,{rowData:ze}=f(Se),Ae=(e,t)=>(ze.value.compose=e.compose,ze.value.log_file=e.log_file,new Promise(((a,n)=>{r({title:"【".concat(e.name,"】日志"),area:65,component:()=>l((()=>import("./index367.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:t||"run",onCancel:()=>{Re(),a(!1)}})}))),We=m(y({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:n}=Q(),{refreshEnvTable:o}=f(a),{delDockerEnv:s,useBatchEventHandle:m,cleanCache:v,refreshTemplate:h}=a,{BtOperation:g}=i({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Ee()}},{type:"button",label:"扩展模板",onClick:()=>{new Promise(((e,t)=>{r({title:"扩展模板",area:90,component:()=>l((()=>import("./extend-template.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})}))}},{type:"button",label:"清理构建缓存",onClick:()=>{v("php")}}]}),{BtOperation:b}=i({options:[{type:"button",label:"更新环境模板",onClick:()=>{h("php")}}]}),y=d([{label:"删除",value:"delete",event:m}]),{BtTable:O,BtPage:j,BtBatch:T,refresh:D}=c({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"php"}),columns:[z(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:100},A({function:e=>{let t="异常",a="#ff0000";switch(e.status){case"normal":t="正常",a="#20a53a";break;case"initializing":t="构建中",a="#555"}return w("span",{style:{color:a},onClick:()=>{"normal"!==e.status&&Ae(e,"build")},class:"normal"!==e.status?"cursor-pointer":""},_("span",{class:"flex items-center"},[t,_("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))}}),{label:"创建时间",minWidth:100,prop:"addtime",render:e=>_("span",null,[e.addtime?u(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},W([{width:80,isHide:e=>"normal"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"php",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{Ae(e)},title:"日志"},{onClick:e=>{Ee(e)},title:"编辑"},{onClick:e=>{s(e,"php")},title:"删除"}])],extension:[y,p(o)]});return t({init:D}),(e,t)=>{const a=R;return k(),x(a,null,{"header-left":E((()=>[_(C(g))])),"header-right":E((()=>[_(C(b))])),content:E((()=>[_(C(O),{"min-height":300,class:"fix-table"})])),"footer-left":E((()=>[_(C(T))])),"footer-right":E((()=>[_(C(j))])),_:1})}}}),[["__scopeId","data-v-ad7afb89"]]),Me=h("DOCKER-SITE-ENV-JAVA-STORE",(()=>{const t=g(!1),n=g(),r=g([]),l=g([]),o=g([]),s=b([]),i=b({}),c=g(!1);return{versionOptions:r,extendOptions:l,templateOptions:o,extendsupOptions:s,resetData:()=>{r.value=[],l.value=[],o.value=[],c.value=!1,t.value=!1,n.value={},s.value=[],i.value={}},getExtend:async(t="all")=>{try{const n={version:t},r=await e({loading:"正在获取版本，请稍后...",request:L(n),message:!1});r.status?(i.value=r.data,l.value=r.data.repo_urls.map((e=>({label:e.name,value:e.repo})))):a(r)}catch(n){a(n)}},getTemplate:async t=>{try{const n=await e({loading:"正在获取版本，请稍后...",request:U(t||{p:1,row:100}),message:!1});n.status?o.value=n.data.data.map((e=>({label:e.name,value:e.id,ext:e.exts}))):a(n)}catch(n){a(n)}},popoverFocus:c,isEdit:t,rowData:n,allData:i}})),Le=Me(),{getVersion:Ue,setTypeRefreshTable:Je}=Y(),{versionOptions:Ge,isEdit:Fe,rowData:Ke}=f(Le),{resetData:Xe}=Le,Ye=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},Qe=e=>(Fe.value=!!(null==e?void 0:e.name),Ke.value=e||{},new Promise(((e,t)=>{r({title:"创建",area:80,btn:["确认","取消"],component:()=>l((()=>import("./java-form.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Xe(),e(!1)}})}))),Ze=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},$e=e=>{const{BtTable:a}=c({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>_(O,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>Ze(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>_(O,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>Ze(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>_(j,{modelValue:e.access,"onUpdate:modelValue":t=>e.access=t,onChange:t=>Ze(t,e,"output")},null)},{label:"协议",prop:"protocol",width:140,render:e=>_(N,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>Ze(t,e,"protocol")},{default:()=>[_(T,{value:"tcp"},{default:()=>[D("TCP")]}),_(T,{value:"udp"},{default:()=>[D("UDP")]})]})},{label:" ",prop:"del",width:70,render:a=>_(P,{type:"default",class:"svgtofont-el-delete",onClick:()=>{if(1==e.length)return t.error("至少保留一条端口映射");e.splice(e.findIndex((e=>e.id===a.id)),1)}},null)}]});return te("端口",(()=>_("div",{class:"w-[90%]"},[_(a,null,null),_("div",{class:"text-[#999] text-[1.2rem]"},[D("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])])),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:["blur","change"],validator:(e,t,a)=>{et(t,a)}}]})},et=(e,a)=>{if(0==e.length)return!0;const n={};for(let r=0;r<e.length;r++){const l=e[r];switch(!0){case""==l.server:return!a&&t.error("端口表格第".concat(r+1,"行")+"本地端口不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!a&&t.error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围"),a&&a(new Error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!a&&t.error("端口表格第".concat(r+1,"行")+"容器端口不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!a&&t.error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围"),a&&a(new Error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!a&&t.error("端口表格第".concat(r+1,"行")+"协议不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"协议不能为空")),!1}n["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return a&&a(),n},tt=async e=>{try{const t=await Ue("java");t.status&&(Ge.value=t.data.java.map((e=>({label:e,value:e}))),Ge.value.length>0&&!Fe.value&&(e.value.version=Ge.value[0].value))}catch(t){}},at=()=>{var e;try{if(Fe.value){const t=[];return null==(e=Object.entries(JSON.parse(Ke.value.ports||"{}")))||e.forEach(((e,a)=>{if(e[1]){const[a,...n]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:n,output:"0.0.0.0"===e[1][0].HostIp})}})),{name:Ke.value.name,version:Ke.value.version,path:Ke.value.path,command:Ke.value.command,port:t,id:Ke.value.id}}return{name:"",version:"",path:"",command:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},nt=async(a,n)=>{try{const r=et(a.port);if(!r)return!1;const l={runtime_name:a.name,runtime_version:a.version,site_path:a.path,command:a.command,ports:!0===r?"":JSON.stringify(r),runtime_type:"java",...a.id?{id:a.id}:{}};await e({request:F(l),success:e=>{e.status?(n(),ce("tail -f /www/dk_project/runtime/run/java/".concat(a.name,"/create.log"),(()=>{Je("java")}))):t.error(e.msg)}})}catch(r){}};const rt=m(y({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:n}=Q(),{refreshJavaEnvTable:r}=f(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:m}=a,{BtOperation:v}=i({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Qe()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("java")}}]}),h=d([{label:"删除",value:"delete",event:o}]);V("popupClose",(()=>{}));const{BtTable:g,BtPage:b,BtBatch:y,refresh:O}=c({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"java"}),columns:[z(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:60},A({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="#20a53a";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return _(H,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>_("div",{class:"flex items-center"},[_("span",{class:"bt-link cursor-pointer",onClick:()=>m("running"===e.status?"stop":"start",e,"java")},["running"===e.status?"停止":"启动"]),_(ae,null,null),_("span",{class:"bt-link cursor-pointer",onClick:()=>m("restart",e,"java")},[D("重启")])]),reference:()=>w("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{m("running"===e.status?"stop":"start",e,"java")}},_("span",{class:"flex items-center"},[t,_("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"port",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let n=0;for(let r=0;r<t.length;r++){if(n>=10){a.push("......");break}const e=t[r];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),n++)}return _("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map((e=>{return _(B,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!q(t)?e:{default:()=>[e]});var t}))])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>_("span",null,[e.addtime?u(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>_("span",{class:"btlink truncate inline-block max-w-[20rem] cursor-pointer leading-[3.7rem]",title:e.path,onClick:()=>M(e,"path")},[e.path])},W([{width:80,isHide:e=>"running"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"java",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{Ae(e)},title:"日志"},{onClick:e=>{Qe(e)},title:"编辑"},{onClick:e=>{l(e,"java")},title:"删除"}])],extension:[h,p(r)]});return t({init:O}),(e,t)=>{const a=R;return k(),x(a,null,{"header-left":E((()=>[_(C(v))])),"header-right":E((()=>t[0]||(t[0]=[]))),content:E((()=>[_(C(g),{class:"fix-table"})])),"footer-left":E((()=>[_(C(y))])),"footer-right":E((()=>[_(C(b))])),_:1})}}}),[["__scopeId","data-v-5e2f716c"]]),lt=h("DOCKER-SITE-ENV-PYTHON-STORE",(()=>{const t=g(!1),n=g(),r=g([]),l=g([]),o=g([]),s=b([]),i=b({}),c=g(!1);return{versionOptions:r,extendOptions:l,templateOptions:o,extendsupOptions:s,resetData:()=>{r.value=[],l.value=[],o.value=[],c.value=!1,t.value=!1,n.value={},s.value=[],i.value={}},getExtend:async(t="all")=>{try{const n={version:t},r=await e({loading:"正在获取版本，请稍后...",request:L(n),message:!1});r.status?i.value=r.data:a(r)}catch(n){a(n)}},getTemplate:async t=>{try{const n=await e({loading:"正在获取版本，请稍后...",request:U(t||{p:1,row:100}),message:!1});n.status?o.value=n.data.data.map((e=>({label:e.name,value:e.id,ext:e.exts}))):a(n)}catch(n){a(n)}},popoverFocus:c,isEdit:t,rowData:n,allData:i}})),ot=lt(),{getVersion:st,setTypeRefreshTable:it}=Y(),{versionOptions:ct,extendOptions:ut,isEdit:pt,rowData:dt}=f(ot),{resetData:mt}=ot,vt=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},ht=()=>{var e;try{if(pt.value){const t=[];return null==(e=Object.entries(JSON.parse(dt.value.ports||"{}")))||e.forEach(((e,a)=>{if(e[1]){const[a,...n]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:n,output:"0.0.0.0"===e[1][0].HostIp})}})),{name:dt.value.name,version:dt.value.version,path:dt.value.path,repo_url:dt.value.repo_url,command:dt.value.command,port:t,id:dt.value.id}}return{name:"",version:"",repo_url:"mirrors.aliyun.com",path:"",template:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},gt=async e=>{try{const t=await st("python");t.status&&(ct.value=t.data.python.map((e=>({label:e,value:e}))),ut.value=t.data.repo_urls.map((e=>({label:e.name,value:e.repo}))),ct.value.length>0&&!pt.value&&(e.value.version=ct.value[0].value),ut.value.length>0&&!pt.value&&(e.value.repo_url=ut.value[0].value))}catch(t){}},bt=e=>(pt.value=!!(null==e?void 0:e.name),dt.value=e||{},new Promise(((e,t)=>{r({title:"创建",area:80,btn:["确认","取消"],component:()=>l((()=>import("./python-form.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),onCancel:()=>{mt(),e(!1)}})}))),ft=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},yt=e=>{const{BtTable:t}=c({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>_(O,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>ft(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>_(O,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>ft(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>_(j,{modelValue:e.access,"onUpdate:modelValue":t=>e.access=t,onChange:t=>ft(t,e,"output")},null)},{label:"协议",prop:"protocol",width:140,render:e=>_(N,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>ft(t,e,"protocol")},{default:()=>[_(T,{value:"tcp"},{default:()=>[D("TCP")]}),_(T,{value:"udp"},{default:()=>[D("UDP")]})]})},{label:" ",prop:"del",width:70,render:t=>_(P,{type:"default",class:"svgtofont-el-delete",onClick:()=>{e.splice(e.findIndex((e=>e.id===t.id)),1)}},null)}]});return te("端口",(()=>_("div",{class:"w-[90%]"},[_(t,null,null),_("div",{class:"text-[#999] text-[1.2rem]"},[D("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])])),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(e,t,a)=>{wt(t,a)}}]})},wt=(e,a)=>{if(0==e.length)return!0;const n={};for(let r=0;r<e.length;r++){const l=e[r];switch(!0){case""==l.server:return!a&&t.error("端口表格第".concat(r+1,"行")+"本地端口不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!a&&t.error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围"),a&&a(new Error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!a&&t.error("端口表格第".concat(r+1,"行")+"容器端口不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!a&&t.error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围"),a&&a(new Error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!a&&t.error("端口表格第".concat(r+1,"行")+"协议不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"协议不能为空")),!1}n["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return a&&a(),n},_t=async(a,n)=>{try{const r=wt(a.port);if(!r)return!1;const l={runtime_name:a.name,runtime_version:a.version,site_path:a.path,command:a.command,ports:!0===r?"":JSON.stringify(r),repo_url:a.repo_url,runtime_type:"python",...a.id?{id:a.id}:{}};await e({request:F(l),success:e=>{e.status?(ce("tail -f /www/dk_project/runtime/run/python/".concat(a.name,"/create.log"),(()=>{it("python")})),n()):t.error(e.msg)}})}catch(r){}};const kt=m(y({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:n}=Q(),{refreshPythonEnvTable:r}=f(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:m}=a,{BtOperation:v}=i({options:[{type:"button",label:"创建",active:!0,onClick:()=>{bt()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("python")}}]});V("popupClose",(()=>{}));const h=d([{label:"删除",value:"delete",event:o}]),{BtTable:g,BtPage:b,BtBatch:y,refresh:O}=c({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"python"}),columns:[z(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:50},A({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="#20a53a";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return _(H,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>_("div",{class:"flex items-center"},[_("span",{class:"bt-link cursor-pointer",onClick:()=>m("running"===e.status?"stop":"start",e,"python")},["running"===e.status?"停止":"启动"]),_(ae,null,null),_("span",{class:"bt-link cursor-pointer",onClick:()=>m("restart",e,"python")},[D("重启")])]),reference:()=>w("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{m("running"===e.status?"stop":"start",e,"python")}},_("span",{class:"flex items-center"},[t,_("i",{class:"svgtofont-el-loading !text-[1.2rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"port",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let n=0;for(let r=0;r<t.length;r++){if(n>=10){a.push("......");break}const e=t[r];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),n++)}return _("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map((e=>{return _(B,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!q(t)?e:{default:()=>[e]});var t}))])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>_("span",null,[e.addtime?u(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>_("span",{class:"btlink truncate inline-block max-w-[18rem] leading-[3.7rem] cursor-pointer",title:e.path,onClick:()=>M(e,"path")},[e.path])},W([{width:60,isHide:e=>"running"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"python",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{Ae(e)},title:"日志"},{onClick:e=>{m("stop",e,"python")},isHide:e=>"running"!==e.status,title:"停止"},{onClick:e=>{m("restart",e,"python")},isHide:e=>"running"!==e.status,title:"重启"},{onClick:e=>{bt(e)},title:"编辑"},{onClick:e=>{l(e,"python")},title:"删除"}])],extension:[h,p(r)]});return t({init:O}),(e,t)=>{const a=R;return k(),x(a,null,{"header-left":E((()=>[_(C(v))])),"header-right":E((()=>t[0]||(t[0]=[]))),content:E((()=>[_(C(g),{class:"fix-table"})])),"footer-left":E((()=>[_(C(y))])),"footer-right":E((()=>[_(C(b))])),_:1})}}}),[["__scopeId","data-v-05faaf99"]]),xt=h("DOCKER-SITE-ENV-GO-STORE",(()=>{const t=g(!1),n=g(),r=g([]),l=g([]),o=g([]),s=b([]),i=b({}),c=g(!1);return{versionOptions:r,extendOptions:l,templateOptions:o,extendsupOptions:s,resetData:()=>{r.value=[],l.value=[],o.value=[],c.value=!1,t.value=!1,n.value={},s.value=[],i.value={}},getExtend:async(t="all")=>{try{const n={version:t},r=await e({loading:"正在获取版本，请稍后...",request:L(n),message:!1});r.status?(i.value=r.data,l.value=r.data.repo_urls.map((e=>({label:e.name,value:e.repo})))):a(r)}catch(n){a(n)}},getTemplate:async t=>{try{const n=await e({loading:"正在获取版本，请稍后...",request:U(t||{p:1,row:100}),message:!1});n.status?o.value=n.data.data.map((e=>({label:e.name,value:e.id,ext:e.exts}))):a(n)}catch(n){a(n)}},popoverFocus:c,isEdit:t,rowData:n,allData:i}})),Et=xt(),{getVersion:Ct,setTypeRefreshTable:Ot}=Y(),{versionOptions:jt,isEdit:Tt,rowData:Dt}=f(Et),{resetData:Nt}=Et,Pt=e=>{ee({type:"dir",path:e.value.path||"/www/dk_project/wwwroot",change:(t,a)=>{e.value.path=t}})},Vt=e=>(Tt.value=!!(null==e?void 0:e.name),Dt.value=e||{},new Promise(((e,t)=>{r({title:"创建",area:80,btn:["确认","取消"],component:()=>l((()=>import("./go-form.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),onCancel:()=>{Nt(),e(!1)}})}))),Ht=(e,t,a)=>{switch(a){case"server":t.server=e;break;case"con":t.con=e;break;case"protocol":t.protocol=e;break;case"output":t.output=e}},Bt=e=>{const{BtTable:t}=c({request:()=>({data:e,total:e.length}),columns:[{label:"本地端口",prop:"server",render:e=>_(O,{modelValue:e.server,"onUpdate:modelValue":t=>e.server=t,placeholder:"如：10080",class:"w-[9rem]",onBlur:t=>Ht(t.target.value,e,"server")},null)},{label:"容器端口",prop:"con",render:e=>_(O,{modelValue:e.con,"onUpdate:modelValue":t=>e.con=t,placeholder:"如：80",class:"w-[9rem]",onBlur:t=>Ht(t.target.value,e,"con")},null)},{label:"允许外部访问",prop:"output",width:130,render:e=>_(j,{modelValue:e.access,"onUpdate:modelValue":t=>e.access=t,onChange:t=>Ht(t,e,"output")},null)},{label:"协议",prop:"protocol",width:140,render:e=>_(N,{modelValue:e.protocol,"onUpdate:modelValue":t=>e.protocol=t,onChange:t=>Ht(t,e,"protocol")},{default:()=>[_(T,{value:"tcp"},{default:()=>[D("TCP")]}),_(T,{value:"udp"},{default:()=>[D("UDP")]})]})},{label:" ",prop:"del",width:70,render:t=>_(P,{type:"default",class:"svgtofont-el-delete",onClick:()=>{e.splice(e.findIndex((e=>e.id===t.id)),1)}},null)}]});return te("端口",(()=>_("div",{class:"w-[90%]"},[_(t,null,null),_("div",{class:"text-[#999] text-[1.2rem]"},[D("请填写映射到服务器本地的端口，例如：本地10080映射容器的80")])])),"port",{attrs:{class:"!w-[52rem]"},rules:[{required:!0,trigger:"blur",validator:(e,t,a)=>{qt(t,a)}}]})},qt=(e,a)=>{if(0==e.length)return!0;const n={};for(let r=0;r<e.length;r++){const l=e[r];switch(!0){case""==l.server:return!a&&t.error("端口表格第".concat(r+1,"行")+"本地端口不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"本地端口不能为空")),!1;case isNaN(Number(l.server))||Number(l.server)<1||Number(l.server)>65535:return!a&&t.error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围"),a&&a(new Error("端口表格第".concat(r+1,"行")+"请输入正确的本地端口范围")),!1;case""==l.con:return!a&&t.error("端口表格第".concat(r+1,"行")+"容器端口不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"容器端口不能为空")),!1;case isNaN(Number(l.con))||Number(l.con)<1||Number(l.con)>65535:return!a&&t.error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围"),a&&a(new Error("端口表格第".concat(r+1,"行")+"请输入正确的容器端口范围")),!1;case 0==l.protocol.length:return!a&&t.error("端口表格第".concat(r+1,"行")+"协议不能为空"),a&&a(new Error("端口表格第".concat(r+1,"行")+"协议不能为空")),!1}n["".concat(l.con,"/").concat(l.protocol.join("/"))]=l.output?l.server:["127.0.0.1",l.server]}return a&&a(),n},It=async e=>{try{const t=await Ct("go");t.status&&(jt.value=t.data.go.map((e=>({label:e,value:e}))),jt.value.length>0&&!Tt.value&&(e.value.version=jt.value[0].value))}catch(t){}},St=()=>{var e;try{if(Tt.value){const t=[];return null==(e=Object.entries(JSON.parse(Dt.value.ports||"{}")))||e.forEach(((e,a)=>{if(e[1]){const[a,...n]=e[0].split("/");t.push({id:1e3*Math.random(),server:e[1][0].HostPort,con:a,protocol:n,output:"0.0.0.0"===e[1][0].HostIp})}})),{name:Dt.value.name,version:Dt.value.version,path:Dt.value.path,command:Dt.value.command,port:t,id:Dt.value.id}}return{name:"",version:"",path:"",command:"",port:[{server:"",con:"",output:!1,protocol:["tcp"],id:1e3*Math.random()}]}}catch(t){}},Rt=async(a,n)=>{try{const r=qt(a.port);if(!r)return!1;const l={runtime_name:a.name,runtime_version:a.version,site_path:a.path,command:a.command,ports:!0===r?"":JSON.stringify(r),runtime_type:"go",...a.id?{id:a.id}:{}};await e({request:F(l),success:e=>{e.status?(n(),ce("tail -f /www/dk_project/runtime/run/go/".concat(a.name,"/create.log"),(()=>{Ot("go")}))):t.error(e.msg)}})}catch(r){}};const zt=m(y({__name:"index",setup(e,{expose:t}){const a=Y(),{getEnvList:n}=Q(),{refreshGoEnvTable:r}=f(a),{delDockerEnv:l,useBatchEventHandle:o,cleanCache:s,setStatus:m}=a,{BtOperation:v}=i({options:[{type:"button",label:"创建",active:!0,onClick:()=>{Vt()}},{type:"button",label:"清理构建缓存",onClick:()=>{s("go")}}]}),h=d([{label:"删除",value:"delete",event:o}]);V("popupClose",(()=>{}));const{BtTable:g,BtPage:b,BtBatch:y,refresh:O}=c({request:e=>n({p:e.p||1,row:e.limit||20,runtime_type:"go"}),columns:[z(),{label:"名称",prop:"name",minWidth:100},{label:"版本",prop:"version",minWidth:60},A({event:()=>{},function:e=>{let t="异常",a="#fc750d";switch(e.status){case"running":t="运行中",a="#20a53a";break;case"exited":t="停止",a="#ff0000";break;case"initializing":t="构建中",a="#555"}return _(H,{placement:"right",width:"100",disabled:"initializing"===e.status,"popper-class":"detail-popover","popper-style":"min-width:60px;",trigger:"hover"},{default:()=>_("div",{class:"flex items-center"},[_("span",{class:"bt-link cursor-pointer",onClick:()=>m("running"===e.status?"stop":"start",e,"go")},["running"===e.status?"停止":"启动"]),_(ae,null,null),_("span",{class:"bt-link cursor-pointer",onClick:()=>m("restart",e,"go")},[D("重启")])]),reference:()=>w("span",{class:"cursor-pointer",style:{color:a},onClick:()=>{m("running"===e.status?"stop":"start",e,"go")}},_("span",{class:"flex items-center"},[t,_("i",{class:"svgtofont-el-loading !text-[1.6rem] animation-spin",style:"initializing"===e.status?"display:inline-block":"display:none;"},null)]))})}}),{label:"端口",prop:"ports",minWidth:250,render:e=>{const t=Object.entries(JSON.parse(e.ports||"{}"))||[],a=[];let n=0;for(let r=0;r<t.length;r++){if(n>=10){a.push("......");break}const e=t[r];e[1]&&(a.push("".concat(e[1][0].HostIp||"0.0.0.0",":").concat(e[1][0].HostPort,"--\x3e").concat(e[0]," ")),n++)}return _("span",{key:e.id,class:"whitespace-pre-wrap gap-4 leading-[2.5]"},[a.map((e=>{return _(B,{type:"success",size:"default",class:"mr-1"},"function"==typeof(t=e)||"[object Object]"===Object.prototype.toString.call(t)&&!q(t)?e:{default:()=>[e]});var t}))])}},{label:"创建时间",minWidth:150,prop:"addtime",render:e=>_("span",null,[e.addtime?u(Number(e.addtime),"yyyy-MM-dd HH:mm:ss"):"--"])},{label:"运行目录",minWidth:200,prop:"path",render:e=>_("span",{class:"btlink truncate inline-block max-w-[20rem] leading-[3.7rem] cursor-pointer",title:e.path,onClick:()=>M(e,"path")},[e.path])},W([{width:80,isHide:e=>"running"!==e.status,onClick:e=>{Z({type:"runEnv",formData:{type:"go",env:"".concat(e.name,":").concat(e.version)}})},title:"创建网站"},{onClick:e=>{Ae(e)},title:"日志"},{onClick:e=>{Vt(e)},title:"编辑"},{onClick:e=>{l(e,"go")},title:"删除"}])],extension:[h,p(r)]});return t({init:O}),(e,t)=>{const a=R;return k(),x(a,null,{"header-left":E((()=>[_(C(v))])),"header-right":E((()=>t[0]||(t[0]=[]))),content:E((()=>[_(C(g),{class:"fix-table"})])),"footer-left":E((()=>[_(C(y))])),"footer-right":E((()=>[_(C(b))])),_:1})}}}),[["__scopeId","data-v-98f0cc90"]]),At={class:"p-[20px]"},Wt=y({__name:"index",setup(e){const{tabActive:t}=$(),{BtTabs:a}=v({type:"card",value:t,options:[{label:"PHP",name:"php",render:()=>_(We,null,null)},{label:"JAVA",name:"java",lazy:!0,render:()=>_(rt,null,null)},{label:"Python",name:"python",lazy:!0,render:()=>_(kt,null,null)},{label:"GO",name:"go",lazy:!0,render:()=>_(zt,null,null)}]}),n=e=>{};return I((()=>{})),(e,t)=>(k(),S("div",At,[_(C(a),{onChange:n})]))}}),Mt=Object.freeze(Object.defineProperty({__proto__:null,default:Wt},Symbol.toStringTag,{value:"Module"}));export{Pt as A,Bt as B,Rt as C,ne as D,It as E,se as F,ie as G,oe as H,Mt as I,Oe as a,Be as b,He as c,Te as d,Ne as e,Pe as f,je as g,qe as h,Me as i,at as j,Ye as k,$e as l,nt as m,tt as n,Ce as o,lt as p,ht as q,vt as r,De as s,Ve as t,Ie as u,yt as v,_t as w,gt as x,xt as y,St as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
