import{_ as e}from"./index90.js?v=1734676359";import{l as a,H as t,o as r,G as i,b as s,k as n}from"./utils-lib.js?v=1734676359";import{g as l,s as o,r as u,R as _,h as d,az as c,c as g,o as p,a1 as v,B as m,k as h,l as f,e as b,x as y,p as E,y as w,C,A as k}from"./base-lib.js?v=1734676359";import{a6 as j,a7 as S,a8 as q,a9 as x,aa as D,H as A}from"./useMethod2.js?v=1734676359";import{C as L}from"./index14.js?v=1734676359";import{u as T}from"./column.js?v=1734676359";import{C as O}from"./useStore2.js?v=1734676359";const R=l("CRONTAB-SCHEDULE-EVENT-STORE",(()=>{const{rowData:e}=o(L()),n=s(),l=O(),{logCompData:g}=o(l),p=u(),v=u([]),m=u(!1),h=e=>{g.value={request:j,data:{where_id:e.where_id}},a({title:"执行日志",area:86,compData:{request:j,data:{where_id:e.where_id}},component:()=>t((()=>import("./index110.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},f=async({where_id:e})=>{await r({title:"删除触发事件",icon:"warning-filled",content:"删除后不再触发事件规则,是否继续操作？"}),await i({loading:"正在删除，请稍后...",request:S({where_id:e}),message:!0,success:b})},b=async()=>{await i({loading:m,request:q({trigger_id:e.value.trigger_id}),data:[Array,v]})},y=(e,r)=>{B(),e&&(p.value=r),a({title:"".concat(e?"编辑":"创建","触发事件"),area:60,showFooter:!0,component:()=>t((()=>import("./add-event.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},E=_([]),w=u(),C=u([]),k=u(),R=_([]),V=d({on:"script",run_script_id:"",operator:"in",op_value:"",run_script:"",trigger_id:e.value.trigger_id,args:""}),N=d({is_args:"",args_holder:"",args_title:""}),F=d({op_value:[{required:!0,message:"请输入比较值",trigger:"blur"}],args:[{required:!0,message:"请输入参数",trigger:"blur"}],run_script_id:[{required:!0,message:"请选择脚本",trigger:"change"}]}),H=async()=>C.value=await A(),P=_(1),$=()=>{let e=document.querySelectorAll(".task-cascader .el-cascader-menu__list");if(e.length>=P.value-1){let a=e[P.value];if(!a)return;a.querySelectorAll(".el-cascader-node__label").forEach((e=>{e.nextElementSibling||e.addEventListener("click",z)}))}},z=e=>{const a=e.target.previousElementSibling.querySelector('input[type="checkbox"]');a&&a.click()},B=()=>{p.value={},Object.assign(V,{on:"script",run_script_id:"",operator:"in",op_value:"",run_script:"",trigger_id:e.value.trigger_id,args:""}),N.is_args=""};return{eventData:v,eventLoad:m,tableColumns:E,init:()=>{E.value=[{label:"触发内容",render:e=>c("span","当执行结果【".concat({in:"包含","not in":"不包含","=":"等于","!=":"不等于",">":"大于",">=":"大于等于","<":"小于","<=":"小于等于"}[e.operator],"】【").concat(e.op_value,"】时，执行【").concat(e.script_info.name,"】"))},T([{onClick:e=>y(!0,e),title:"编辑"},{onClick:h,title:"日志"},{onClick:f,title:"删除"}])],b()},openAddEventView:y,getTaskEventList:b,deleteDataEvent:f,openLogEvent:h,$reset:()=>{v.value=[],m.value=!1,E.value=[],e.value={},p.value={}},propsData:{label:"name",value:"script_id",children:"script_list",multiple:!0,checkStrictly:!0},taskEventRef:k,taskEventForm:V,rules:F,argsForm:N,scriptLibraryData:C,scriptSectionRef:w,operatorValue:R,changeScript:e=>{if(0===e.length)return;const a=w.value.getCheckedNodes()[0].data;1===a.is_args?(N.is_args=!0,N.args_holder=a.args_ps,N.args_title=a.args_title):N.is_args=!1;const t=w.value.getCheckedNodes(),r=t.every((e=>3===e.data.type_id)),i=t.find((a=>a.value===e[e.length-1][1]));3===i.data.type_id&&r?(V.run_script_id=e,R.value=e.map((e=>e[1]))):(V.run_script_id=e[e.length-1],3===i.data.type_id?R.value=[i.data.type_id]:R.value=[])},onConfirm:async e=>{var a;if(await k.value.validate(),0===V.run_script_id.length)return void n.error("请选择脚本");const t={...V,run_script_id:V.run_script_id[1]||V.run_script_id[0][1]};delete t.on;const r=null==(a=p.value)?void 0:a.where_id;r&&(delete t.trigger_id,t.where_id=p.value.where_id),R.value.length>0&&(t.actions=R.value.join(","),t.run_script_id=""),await i({loading:"正在提交，请稍后...",message:!0,request:r?x(t):D(t)}),e(),b()},getScriptType:H,initAddEvent:()=>{var e;if(H(),null==(e=p.value)?void 0:e.trigger_id){const{operator:e,op_value:a,trigger_id:t,run_script_id:r,args:i,run_script:s}=p.value;if(Object.assign(V,{operator:e,op_value:a,trigger_id:t,run_script_id:[void 0,r],args:i,run_script:s}),p.value.actions){const e=p.value.actions.split(",");R.value=e,V.run_script_id=e.map((e=>[void 0,Number(e)]))}if(a){const{args_ps:e,args_title:a,is_args:t}=p.value.script_info;N.args_holder=e,N.args_title=a,N.is_args=!!t}}},setLabelClick:e=>{e&&setTimeout((()=>{$()}),200)},expandChange:e=>{P.value=e.length,setTimeout((()=>{$()}),200)},$reset_event_form:B}})),V={class:"p-20px"},N=g({__name:"index",setup(a){const t=R(),{init:r,$reset:i,openAddEventView:s}=t,{eventData:l,eventLoad:u,tableColumns:_}=o(t);return p(r),v(i),(a,t)=>{const r=k,i=n,o=e,d=m("bt-loading");return h(),f("div",V,[b(o,null,{"header-left":y((()=>[b(r,{type:"primary",onClick:t[0]||(t[0]=e=>E(s)())},{default:y((()=>t[1]||(t[1]=[w("创建触发事件")]))),_:1})])),content:y((()=>[C(b(i,{"max-height":"460",column:E(_),data:E(l)},null,8,["column","data"]),[[d,E(u)]])])),_:1})])}}}),F=Object.freeze(Object.defineProperty({__proto__:null,default:N},Symbol.toStringTag,{value:"Module"}));export{R as C,F as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
