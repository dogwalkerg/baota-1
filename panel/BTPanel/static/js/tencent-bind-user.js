import{c as e,r as a,h as t,o as l,k as s,J as r,x as o,C as n,q as i,e as c,v as d,F as u,p as m,L as p,l as v,y as f,z as g,D as w,G as h,aw as b,a7 as y,P as x,A as k,aY as _,a4 as D}from"./base-lib.js?v=1734676359";import{_ as V}from"./index91.js?v=1734676359";import{M as j,s as q,aV as C,p as z,aZ as E,aY as I,aW as M,q as S,c as H,e as U}from"./utils-lib.js?v=1734676359";import{_ as L}from"./bt_logo_new.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const N={class:"flex !justify-center !w-full items-center"},T={class:"text-[2rem] text-dark inline-block mr-2 font-bold mt-12x"},B={key:0,class:"absolute el-form-item__error"},J={class:"flex justify-end items-centertext-[1.2rem] mt-[1rem]"},K={key:0,class:"view-con",style:{background:"#fff"}},O={class:"w-full mt-[1.5rem]"},Y={class:"w-full mt-[1.5rem]"},R={class:"w-[100%] mt-[1.2rem] flex items-center justify-center text-[#20a53a]",size:"default"},$={key:3,class:"flex justify-end items-centertext-[1.2rem] mt-[1rem] h-[1.68rem]"},A={key:0},F={class:"more-bind"},G=U(e({__name:"tencent-bind-user",props:{compData:{default:()=>({})}},setup(e,{expose:U}){const G=e,P=a(!1),W=a("获取验证码"),X=t({username:"",password:"",code:""}),Z=t({username:!1,password:!1,code:!1}),Q=a(""),ee=a(0),ae=a(),te=a(!1),le=a(G.compData.authData),se=a(1),re=t({order:"",uin:""}),oe=a({username:[{validator:(e,a,t)=>{var l,s;if((null==(l=G.compData)?void 0:l.title)&&(te.value=!1),/^1[3456789]\d{9}$/.test(a))t();else if(""===a)t(new Error("请输入宝塔官网账号"));else{if(null==(s=G.compData)?void 0:s.title)return te.value=!0,void t(new Error(" "));t(new Error("请输入正确的手机号"))}},trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{validator:(e,a,t)=>{a.length>=8?t():t(new Error("请输入至少8位密码"))},trigger:["blur","change"]}],token:[{required:!1,message:"请输入验证码",trigger:["blur","change"]},{validator:(e,a,t)=>{P.value||t(),6===a.length?t():t(new Error("请输入6位验证码，不可为空"))},trigger:["blur","change"]}]}),ne=()=>{ae.value.validate((async e=>{if(!e)return!1;{const e={...X};if(P.value){if(!X.code)return j.error("请输入验证码");e.token=Q.value,delete e.password}else delete e.code;const t=j.load("绑定堡塔账号，请稍候 ...");try{e.username=await q(e.username),e.password=await q(e.password);const a=await C({...e});if(j.request(a),a.status)return window.location.reload();if(z(a.data))return!1;if(!a.status&&"[]"===JSON.stringify(a.data))return j.request(a);-1===a.data.code&&(Q.value=a.data.token,P.value=!0)}catch(a){}finally{t.close()}}}))},ie=a(3);let ce=null,de=null;const ue=e=>{"string"==typeof e.data&&JSON.parse(e.data).code&&(async e=>{const a=JSON.parse(e.data);let t;try{t=j.load("正在绑定中......");const{data:e}=await I({...a,client:1});e.success||e.status?(window.removeEventListener("message",ue),window.location.href="/"):(t.close(),j.error(e.res||String(e.msg)),de.parent.postMessage({msg:e.res||e.msg,success:!1},"*"))}catch(l){null==t||t.close()}})(e)},me=async()=>{if(re.order){const e={client:1,order_no:re.order,uin:re.uin},a=await E(e);a.status&&(a.data.success||a.data.status)?pe(a.data.data||a.data.res):j.error(a.data.res||a.data.msg||a.data.data)}else re.uin?j.error("请输入订单号"):j.error("请输入腾讯云账号ID")},pe=e=>{const a=(window.screen.width-600)/2,t=(window.screen.height-800)/2;window.removeEventListener("message",ue),window.addEventListener("message",ue),de&&de.close(),de=window.open(e,"popup","width=600,height=800,left=".concat(a,",top=").concat(t)),de||j.error("授权弹窗被浏览器阻止，请允许弹窗以继续操作。")},ve=async()=>{var e;if(he.value)return void me();let a;try{ie.value=3,ce&&clearInterval(ce),a=j.load("正在绑定中......");const{data:t}=await I({client:1});if(t.status||t.success)window.location.href="/";else{a.close();const l=t.msg||t.res,s=document.querySelector(".location-con");let r=16;if(s){const e=s.getBoundingClientRect();r=e.top+window.scrollY-50}j.msg({customClass:(null==(e=G.compData)?void 0:e.title)?"customMsgDiv":"",type:"warning",dangerouslyUseHTMLString:!0,duration:3e3,offset:r,message:"".concat(l,'<div style="align-items:center;"><span style="display:inline-block;color:#ef0808;" class="loginErrorNum">').concat(ie.value,"</span>秒后切换到宝塔账号登录</div>")}),setTimeout((()=>{if(s){const e=s.getBoundingClientRect().left+window.scrollX,a=document.querySelector(".customMsgDiv");a&&(a.style.left="".concat(e+143,"px"),a.style.opacity="1")}}),0),ce=setInterval((()=>{if(ie.value<=1)return clearInterval(ce),void ge(1);ie.value-=1;const e=document.querySelector(".loginErrorNum");e&&(e.innerHTML="".concat(ie.value))}),1e3)}}catch(t){null==a||a.close()}},fe=async()=>{if(!X.username||!X.password)return void j.error("请先输入手机号和密码");Z.username=!0,Z.password=!0,(e=>{ee.value&&clearInterval(ee.value);const a=()=>{if(--e<=0)return clearInterval(ee.value),W.value="获取验证码",void(Z.code=!1);W.value="重新获取验证码(".concat(e,"s)")};a(),ee.value=setInterval(a,1e3),Z.code=!0})(60);const e=await M({username:X.username,token:Q.value});j.request(e)},ge=e=>{var a;se.value=e,(null==(a=G.compData)?void 0:a.onChangeType)&&G.compData.onChangeType(1===e?"bind":"other")},we=a(!1),he=a(!1),be=async e=>{try{if(1===e)return void ge(1);if(2===e)return void ge(2);we.value=1===le.value.client&&1===le.value.login,1===le.value.client&&1===le.value.login?ge(2):1===le.value.client&&0!==le.value.login?(ge(2),he.value=!0):ge(1)}catch(a){ge(1)}};return be(),U({onOpen:()=>{S(ae.value.$el,"username")},onCancel:()=>{ae.value.clearValidate()}}),l((()=>{var e;null==(e=ae.value)||e.clearValidate()})),(e,a)=>{var t;const l=b,j=y,q=x,C=H,z=k,E=H,I=V,M=_,S=x,U=D;return s(),r(U,{ref_key:"bindUserInfo",ref:ae,size:"medium",rules:m(oe),model:m(X),autocomplete:"off",class:u(["bind-user-info",{"bind-form":!!(null==(t=e.compData)?void 0:t.title)}])},{default:o((()=>{var t,b,y,x,k,_,D,V,H,U,G,Q,ee,ae,le;return[n(i("div",null,[c(j,{class:"text-center !mb-5 flex justify-center"},{default:o((()=>{var t;return[i("div",N,[i("h3",T,d((null==(t=e.compData)?void 0:t.title)||"切换宝塔官网账号"),1),c(l,{placement:"top-start",width:"200",trigger:"hover",content:"宝塔面板许多功能都依赖于官网，绑定仅限于为您提供更好的面板服务体验，不涉及您服务器任何敏感信息，请放心使用。",class:"inline-block relative -top-1.5"},{reference:o((()=>a[11]||(a[11]=[i("a",{class:"bt-ico-ask align-middle",href:"javascript:;"},"?",-1)]))),_:1})])]})),_:1}),(s(),r(j,{prop:"username",key:1,class:u({"!mb-[3rem]":!!(null==(t=e.compData)?void 0:t.title)})},{default:o((()=>{var t;return[c(q,{modelValue:m(X).username,"onUpdate:modelValue":a[0]||(a[0]=e=>m(X).username=e),clearable:"",required:"",class:"!leading-[4rem] !h-[4rem]",name:"username",autocomplete:"off",placeholder:"宝塔官网账号",disabled:m(Z).username,onKeyup:a[1]||(a[1]=p((e=>ne()),["enter"]))},null,8,["modelValue","disabled"]),(null==(t=e.compData)?void 0:t.title)&&m(te)?(s(),v("span",B,[a[13]||(a[13]=i("span",null,"请使用宝塔官网登录账号进行登录，若未有账号，可进行",-1)),c(C,{class:"!text-[12px]",href:"https://www.bt.cn/register"},{default:o((()=>a[12]||(a[12]=[f(" 免费注册 ")]))),_:1})])):g("",!0)]})),_:1},8,["class"])),(s(),r(j,{prop:"password",key:2},{default:o((()=>[c(q,{modelValue:m(X).password,"onUpdate:modelValue":a[2]||(a[2]=e=>m(X).password=e),clearable:"",required:"",type:"password",class:"!leading-[4rem] !h-[4rem]",name:"password",autocomplete:"off",placeholder:"密码","show-password":!0,disabled:m(Z).password,onKeyup:a[3]||(a[3]=p((e=>ne()),["enter","native"]))},null,8,["modelValue","disabled"])])),_:1})),n(c(j,{prop:"code"},{default:o((()=>[c(q,{modelValue:m(X).code,"onUpdate:modelValue":a[4]||(a[4]=e=>m(X).code=e),clearable:"",autocomplete:"off",placeholder:"验证码",onKeyup:a[5]||(a[5]=p((e=>ne()),["enter","native"])),type:"text"},{append:o((()=>[c(z,{class:"relative top-0 rounded-none rounded-r-[3px]",type:"primary",size:"default",disabled:m(Z).code,plain:"",onClick:fe},{default:o((()=>[f(d(m(W)),1)])),_:1},8,["disabled"])])),_:1},8,["modelValue"])])),_:1},512),[[w,m(P)]]),c(z,{class:"w-[100%] mt-[1.2rem]",type:"primary",size:"default",onClick:a[6]||(a[6]=e=>ne())},{default:o((()=>{var a,t;return[f(d((null==(a=e.compData)?void 0:a.btn)||((null==(t=e.compData)?void 0:t.title)?"绑定账号":"切换账号")),1)]})),_:1}),i("div",J,[c(E,{href:"https://www.bt.cn/register"},{default:o((()=>a[14]||(a[14]=[f("注册账号")]))),_:1}),c(I),c(E,{href:"https://www.bt.cn/login.html?page=reset"},{default:o((()=>a[15]||(a[15]=[f("忘记密码")]))),_:1}),c(I),c(E,{href:"https://www.bt.cn/bbs"},{default:o((()=>a[16]||(a[16]=[f("问题反馈")]))),_:1})])],512),[[w,1===m(se)]]),n(i("div",null,[(null==(b=e.compData)?void 0:b.title)?g("",!0):(s(),v("div",{key:0,class:"view-con",style:h((null==(y=e.compData)?void 0:y.title)?"":"background:#fff;")},[i("div",{class:"app-box",style:h((null==(x=e.compData)?void 0:x.title)?"":"background:#fff;")},a[17]||(a[17]=[i("img",{alt:"",src:L},null,-1)]),4),a[19]||(a[19]=i("div",{class:"change-icon"},[i("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[i("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1)),i("div",{class:"app-box",style:h((null==(k=e.compData)?void 0:k.title)?"":"background:#fff;")},a[18]||(a[18]=[i("div",{class:"tencent-icon"},null,-1)]),4)],4)),i("div",{class:u({"bg-white":null==(_=e.compData)?void 0:_.title,"rounded-[4px]":null==(D=e.compData)?void 0:D.title}),style:h({border:(null==(V=e.compData)?void 0:V.title)?"1px solid #ddd":"none","padding-top":(null==(H=e.compData)?void 0:H.title)?"2rem":"0"})},[(null==(U=e.compData)?void 0:U.title)?(s(),v("div",K,a[20]||(a[20]=[i("div",{class:"app-box",style:{background:"#fff"}},[i("img",{alt:"",src:L})],-1),i("div",{class:"change-icon"},[i("svg",{t:"1729493717851",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"19919",width:"200",height:"200"},[i("path",{d:"M914.618182 477.090909H546.909091V109.381818c0-18.618182-16.290909-34.909091-34.909091-34.909091s-34.909091 16.290909-34.909091 34.909091v367.709091H109.381818c-18.618182 0-34.909091 16.290909-34.909091 34.909091s16.290909 34.909091 34.909091 34.909091h367.709091v367.709091c0 18.618182 16.290909 34.909091 34.909091 34.909091s34.909091-16.290909 34.909091-34.909091V546.909091h367.709091c18.618182 0 34.909091-16.290909 34.909091-34.909091s-16.290909-34.909091-34.909091-34.909091z",fill:"#999999","p-id":"19920"})])],-1),i("div",{class:"app-box",style:{background:"#fff"}},[i("div",{class:"tencent-icon"})],-1)]))):g("",!0),m(he)?g("",!0):(s(),r(j,{key:1,class:u(["!mb-5 flex justify-center",{"p-[2.5rem]":null==(G=e.compData)?void 0:G.title,"!pt-0":null==(Q=e.compData)?void 0:Q.title}])},{default:o((()=>[c(M),a[21]||(a[21]=i("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold"}," 腾讯云用户专享特权： ",-1)),a[22]||(a[22]=i("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] flex items-center"},[i("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),f(" 免费使用原本需要付费的功能： ")],-1)),a[23]||(a[23]=i("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] ml-[1.9rem] flex items-center location-con"},[i("img",{src:"/static/img/soft_ico/ico-msg_push.png",class:"w-[2rem] mr-[1rem]"}),f(" 异常监控推送 ")],-1)),a[24]||(a[24]=i("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1rem] ml-[1.9rem] flex items-center"},[i("img",{src:"/static/img/soft_ico/ico-btapp.png",class:"w-[2rem] mr-[1rem]"}),f(" 堡塔app ")],-1)),a[25]||(a[25]=i("h3",{class:"text-[1.2rem] leading-[1] w-full text-[#999] inline-block mt-[1.5rem] flex items-center"},[i("span",{class:"svgtofont-el-check text-[#1d9534] font-bold mr-[.5rem]"}),f(" 宝塔官方付费软件均享额外折扣 ")],-1))])),_:1},8,["class"])),m(he)?(s(),r(j,{key:2,class:u(["!mb-0 flex justify-center",{"p-[2.5rem]":null==(ee=e.compData)?void 0:ee.title,"!pt-0":null==(ae=e.compData)?void 0:ae.title}])},{default:o((()=>[c(M),a[26]||(a[26]=i("h3",{class:"text-[1.4rem] w-full text-[#666] inline-block font-bold text-center"}," 腾讯云账号绑定 ",-1)),i("div",O,[c(S,{modelValue:m(re).uin,"onUpdate:modelValue":a[7]||(a[7]=e=>m(re).uin=e),size:"large",clearable:"",name:"uin",autocomplete:"off",placeholder:"请输入腾讯云账号ID"},null,8,["modelValue"])]),i("div",Y,[c(S,{modelValue:m(re).order,"onUpdate:modelValue":a[8]||(a[8]=e=>m(re).order=e),size:"large",clearable:"",name:"order",autocomplete:"off",placeholder:"请输入腾讯云市场订单号",onKeyup:p(me,["enter","native"])},null,8,["modelValue"])])])),_:1},8,["class"])):g("",!0),c(z,{type:"primary",class:"w-[85%] mt-[4rem] relative left-[7.5%]",style:{margin:"1rem auto 0"},size:"default",onClick:ve},{default:o((()=>[f(d(m(we)?"一键激活专享特权":"绑定腾讯云账号"),1)])),_:1}),i("div",R,[i("span",{class:"cursor-pointer hover:text-[#1d9534]",onClick:a[9]||(a[9]=e=>ge(1))},"已有宝塔账号登录")]),(null==(le=e.compData)?void 0:le.title)?(s(),v("div",$)):g("",!0)],6)],512),[[w,2===m(se)]]),1===m(se)&&(m(we)||m(he))?(s(),v("div",A,[a[28]||(a[28]=i("div",{class:"more-title"},[i("span",null,"更多绑定方式")],-1)),i("div",F,[n(i("div",{class:"bind-box",onClick:a[10]||(a[10]=e=>be(2))},a[27]||(a[27]=[i("i",{class:"tencent_ico"},null,-1),f(" 腾讯云账号 ")]),512),[[w,1===m(se)]])])])):g("",!0)]})),_:1},8,["rules","model","class"])}}}),[["__scopeId","data-v-8233f18e"]]);export{G as default};
