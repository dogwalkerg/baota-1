import{_ as e}from"./index90.js?v=1734676359";import{a7 as a,G as t,t as s,R as o,o as n,al as i,am as l,an as r,ao as c}from"./utils-lib.js?v=1734676359";import{s as m,c as d,k as p,l as u,e as f,x as b,p as _}from"./base-lib.js?v=1734676359";import{B as h,d as k,C as g,D as y}from"./useMethod5.js?v=1734676359";import{a as B,u as w,c as C}from"./column.js?v=1734676359";import{u as v}from"./useStore9.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";const{localRow:j,isRefreshBackupList:R}=m(v()),x=async(e,a,t,s)=>{const{label:o,value:n}=s,i=new Map([["delete","批量删除已选的备份文件，是否继续操作？"]]),l=async(e,a)=>{const{id:t}=e;if("delete"===n)return await y({bak_id:t})};await e({title:"批量".concat(o,"备份文件"),content:"".concat(i.get(n),"，是否继续操作！"),column:[{label:"备份文件",prop:"filename"},C()],onConfirm:async()=>(await a(l),R.value=!0,!1)})},q={class:"p-[2rem]"},L=d({__name:"index",setup(d){const{isRefreshBackupList:C}=m(v()),{BtOperation:L}=i({options:[{type:"button",label:"备份",active:!0,onClick:()=>{t({loading:"正在备份，请稍后...",request:k({s_id:j.value.id,bak_type:3}),success:e=>{e.status&&(R.value=!0)},message:!0})}}]}),M=c([{label:"删除",value:"delete",event:x}]),{BtTable:W,BtPage:z,BtRecommendSearch:D,BtRefresh:S,BtColumn:T,BtBatch:E,BtTableCategory:G,BtErrorMask:H,tableRef:I,classList:N,refresh:O}=l({request:e=>(async e=>{try{const{data:{data:t,page:s}}=await h({s_id:j.value.id,p:e.p,limit:e.limit});return{data:t,total:a(s)}}catch(t){return{data:[],total:0}}})(e),columns:[B(),{label:"文件名",prop:"filename",isCustom:!0,minWidth:180},{label:"文件大小",prop:"size",render:e=>s(Number(e.size),!0)},{label:"备份时间",prop:"addtime",minWidth:120,render:e=>o(e.bak_time)},{label:"信息",prop:"bak_type",minWidth:80,render:e=>1==e.bak_type?"仅文件":2==e.bak_type?"仅DB":"完整的备份"},w([{title:"恢复",onClick:async e=>{await n({title:"恢复备份文件",content:"将恢复站点文件和数据库，继续吗？",onConfirm:async()=>{t({loading:"正在恢复备份文件，请稍后...",request:g({bak_id:e.id}),success:e=>{},message:!0})}})}},{title:"下载",onClick:e=>{const a="".concat(window.location.origin);window.open("".concat(a,"/download?filename=").concat(encodeURIComponent(e.bak_file)).concat(e.filename?"&amp;name=".concat(e.filename):""))}},{title:"删除",onClick:e=>{n({title:"删除备份文件",content:"网站备份即将被删除 【".concat(e.filename,"】，是否继续操作?"),onConfirm:async()=>{t({loading:"正在删除备份文件，请稍后...",request:y({bak_id:e.id}),success:e=>{e.status&&(R.value=!0)},message:!0})}})}}])],extension:[M,r(C)]});return(a,t)=>{const s=e;return p(),u("div",q,[f(s,null,{"header-left":b((()=>[f(_(L))])),"header-right":b((()=>t[0]||(t[0]=[]))),content:b((()=>[f(_(W),{"min-height":500})])),"footer-left":b((()=>[f(_(E))])),"footer-right":b((()=>[f(_(z))])),_:1})])}}});export{L as default};
