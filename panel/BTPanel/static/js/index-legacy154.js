!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function r(t,n,r){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,n||"default");if("object"!=e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function a(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */a=function(){return n};var t,n={},r=Object.prototype,o=r.hasOwnProperty,u=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},c=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(t){f=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var a=t&&t.prototype instanceof b?t:b,o=Object.create(a.prototype),i=new E(r||[]);return u(o,"_invoke",{value:L(e,n,i)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var _="suspendedStart",m="suspendedYield",h="executing",v="completed",y={};function b(){}function g(){}function x(){}var w={};f(w,c,(function(){return this}));var z=Object.getPrototypeOf,k=z&&z(z(P([])));k&&k!==r&&o.call(k,c)&&(w=k);var j=x.prototype=b.prototype=Object.create(w);function q(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function C(t,n){function r(a,u,i,c){var s=d(t[a],t,u);if("throw"!==s.type){var l=s.arg,f=l.value;return f&&"object"==e(f)&&o.call(f,"__await")?n.resolve(f.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):n.resolve(f).then((function(e){l.value=e,i(l)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var a;u(this,"_invoke",{value:function(e,t){function o(){return new n((function(n,a){r(e,t,n,a)}))}return a=a?a.then(o,o):o()}})}function L(e,n,r){var a=_;return function(o,u){if(a===h)throw Error("Generator is already running");if(a===v){if("throw"===o)throw u;return{value:t,done:!0}}for(r.method=o,r.arg=u;;){var i=r.delegate;if(i){var c=O(i,r);if(c){if(c===y)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===_)throw a=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=h;var s=d(e,n,r);if("normal"===s.type){if(a=r.done?v:m,s.arg===y)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(a=v,r.method="throw",r.arg=s.arg)}}}function O(e,n){var r=n.method,a=e.iterator[r];if(a===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,O(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=d(a,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var u=o.arg;return u?u.done?(n[e.resultName]=u.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):u:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function V(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(V,this),this.reset(!0)}function P(n){if(n||""===n){var r=n[c];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,u=function e(){for(;++a<n.length;)if(o.call(n,a))return e.value=n[a],e.done=!1,e;return e.value=t,e.done=!0,e};return u.next=u}}throw new TypeError(e(n)+" is not iterable")}return g.prototype=x,u(j,"constructor",{value:x,configurable:!0}),u(x,"constructor",{value:g,configurable:!0}),g.displayName=f(x,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,f(e,l,"GeneratorFunction")),e.prototype=Object.create(j),e},n.awrap=function(e){return{__await:e}},q(C.prototype),f(C.prototype,s,(function(){return this})),n.AsyncIterator=C,n.async=function(e,t,r,a,o){void 0===o&&(o=Promise);var u=new C(p(e,t,r,a),o);return n.isGeneratorFunction(t)?u:u.next().then((function(e){return e.done?e.value:u.next()}))},q(j),f(j,l,"Generator"),f(j,c,(function(){return this})),f(j,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=P,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,a){return i.type="throw",i.arg=e,n.next=r,a&&(n.method="next",n.arg=t),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var u=this.tryEntries[a],i=u.completion;if("root"===u.tryLoc)return r("end");if(u.tryLoc<=this.prev){var c=o.call(u,"catchLoc"),s=o.call(u,"finallyLoc");if(c&&s){if(this.prev<u.catchLoc)return r(u.catchLoc,!0);if(this.prev<u.finallyLoc)return r(u.finallyLoc)}else if(c){if(this.prev<u.catchLoc)return r(u.catchLoc,!0)}else{if(!s)throw Error("try statement without catch or finally");if(this.prev<u.finallyLoc)return r(u.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var u=a?a.completion:{};return u.type=e,u.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;S(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:P(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}function o(e,t,n,r,a,o,u){try{var i=e[o](u),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var u=e.apply(t,n);function i(e){o(u,r,a,i,c,"next",e)}function c(e){o(u,r,a,i,c,"throw",e)}i(void 0)}))}}System.register(["./utils-lib-legacy.js?v=1734676359","./base-lib-legacy.js?v=1734676359","./index-legacy101.js?v=1734676359","./index-legacy88.js?v=1734676359","./index-legacy185.js?v=1734676359","./index.vue_vue_type_script_setup_true_lang-legacy8.js?v=1734676359","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1734676359","./validator-legacy.js?v=1734676359","./store-legacy4.js?v=1734676359","./useMethod-legacy3.js?v=1734676359","./__commonjsHelpers__-legacy.js?v=1734676359","./ace-legacy.js?v=1734676359","./index-legacy91.js?v=1734676359","./column-legacy.js?v=1734676359","./database-legacy.js?v=1734676359"],(function(e,t){"use strict";var o,i,c,s,l,f,p,d,_,m,h,v,y,b,g,x,w,z,k,j,q,C,L,O,V,S,E,P,N,M,B,I,F,U,D,G,T,H,K,Q,R,A,Y,J,X,W,Z,$,ee,te,ne,re,ae,oe,ue,ie,ce,se,le,fe,pe,de,_e,me,he,ve,ye,be,ge,xe,we,ze,ke,je,qe,Ce,Le,Oe,Ve;return{setters:[function(e){o=e.o,i=e.G,c=e.dd,s=e.M,l=e.de,f=e.af,p=e.b3,d=e.l,_=e.H,m=e.R,h=e.t,v=e.b0,y=e.r,b=e.ah,g=e.db,x=e.O,w=e.a4,z=e.h,k=e.j,j=e.aa,q=e.e},function(e){C=e.s,L=e.r,O=e.h,V=e.c,S=e.i,E=e.o,P=e.B,N=e.k,M=e.l,B=e.e,I=e.x,F=e.q,U=e.p,D=e.J,G=e.y,T=e.z,H=e.M,K=e.v,Q=e.C,R=e.I,A=e.aX,Y=e.D,J=e.A,X=e.a7,W=e.a4,Z=e.ay,$=e.bL,ee=e.bM,te=e.at,ne=e.av,re=e.ag,ae=e.ah,oe=e.aY,ue=e.aj},function(e){ie=e._},function(e){ce=e._},function(e){se=e.B},function(e){le=e.S,fe=e._},function(e){pe=e.S,de=e._},function(e){_e=e.A,me=e.f,he=e.B,ve=e.C,ye=e.D,be=e.E,ge=e.F,xe=e.G,we=e.H,ze=e.J,ke=e.K,je=e.L,qe=e.M,Ce=e.N,Le=e.O},function(e){Oe=e.H},function(e){Ve=e.u},null,null,null,null,null],execute:function(){var Se=le(),Ee=pe(),Pe=C(pe()).compData,Ne=Oe();C(Ne);var Me=L("service"),Be=L(!1);L(!0);var Ie=L(""),Fe=L(!1),Ue=O({re_level:1,tips:""}),De=[{label:"级别一",value:1},{label:"级别二",value:2},{label:"级别三",value:3},{label:"级别四",value:4},{label:"级别五",value:5},{label:"级别六",value:6}],Ge={recover:[{content:"启动完成后请立即备份和检查数据库完整性"},{content:"恢复级别说明（从1到6进行尝试）："},{content:"级别一：尝试忽略损坏的页，适用于轻微损坏的情况，可以尝试从数据中恢复。"},{content:"级别二：禁用后台线程，适合解决由于并发操作导致的问题。"},{content:"级别三：适用于需要快速恢复的场景，但可能会导致最近的数据丢失。"},{content:"级别四：适用于插入缓冲区引起问题时的恢复，可能会导致数据文件损坏。"},{content:"级别五：适合于需要快速启动但可能会导致数据一致性问题的情况。"},{content:"级别六：适用于最严重的情况，可能会导致较高的数据丢失及数据文件损坏。"}],config:[{content:"此处为mysql主配置文件，若您不了解配置规则，请勿随意修改"}],storage:[{content:"风险提示：迁移过程中Mysql将会停止运行，请谨慎操作"},{content:"风险提示：迁移过程中请等待迁移完成后再进行其他操作"}],memoryProtection:[{content:"说明：开启后将调整Mysql内存优先级，设置mysql为永不被系统杀死，可确保Mysql稳定运行。但可能导致其他进程异常被杀，严重时可能影响系统运行，建议需要Mysql稳定运行时在开启。"}]},Te=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({title:"mysqld服务",icon:"warning-filled",content:"即将开始修复mysql启动问题，是否继续？"});case 2:return e.next=4,i({loading:"正在修复启动，请稍后...",request:c(),success:function(){var e=u(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"data_err"===t.err_type?(Ue.tips=t.msg,Fe.value=!0):"log_err"===t.err_type?He(t.msg):(Qe(),s.msg({dangerouslyUseHTMLString:!0,message:t.msg,type:t.status?"success":"error",duration:t.status?2e3:0,showClose:!t.status,customClass:"".concat("port_in_use"===t.err_type?"max-w-[48rem]":"")}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),He=function(){var e=u(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({title:"修复MySQL启动",icon:"warning-filled",content:t});case 2:i({loading:"正在修复MySQL启动，请稍后...",request:_e(),message:!0,success:function(e){Qe()}});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ke=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ue.re_level>=4)){e.next=3;break}return e.next=3,o({title:"修复MYSQL启动",width:"39rem",isHtml:!0,content:'警告：当前选择的恢复等级将可能导致<span class="text-danger">数据文件损坏会丢失</span>，请做好服务器快照或备份好数据库数据目录【/www/server/data】如果启动成功，数据库将会进入只读模式'});case 3:return e.next=5,i({loading:"正在修复启动，请稍后...",request:l({re_level:Ue.re_level}),message:!0,success:function(){var e=u(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.status&&(Fe.value=!1),Qe();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Qe=function(){i({request:f({sName:"mysql"}),success:function(e){Pe.value=e.data}})},Re=L(""),Ae=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({loading:"正在保存配置，请稍后...",request:p({path:"/etc/my.cnf",data:Re.value,encoding:"utf-8"}),message:!0});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ye=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({loading:Be,request:g({path:"/etc/my.cnf"}),data:{data:[String,Re]}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Je=O({path:"",port:"",oldData:{path:"",port:""}}),Xe=function(){me({type:"dir",path:Je.path,change:function(e){Je.path=e}})},We=function(){var e=u(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="port"===Me.value,Je.path||t){e.next=3;break}return e.abrupt("return",s.error("存储位置不能为空"));case 3:if(Je.port||!t){e.next=5;break}return e.abrupt("return",s.error("端口不能为空"));case 5:if(!t||Je.port!==Je.oldData.port){e.next=7;break}return e.abrupt("return",s.success("未修改端口数据"));case 7:if(t||Je.path!==Je.oldData.path){e.next=9;break}return e.abrupt("return",s.success("未修改存储位置数据"));case 9:if(e.t0=!t,!e.t0){e.next=13;break}return e.next=13,o({title:"数据库迁移",icon:"warning-filled",content:"请确定是否迁移至:【".concat(Je.path,"】？")});case 13:n=r({},t?"port":"datadir",Je[t?"port":"path"]),i({loading:"正在设置，请稍后...",request:(t?ke:je)(n),message:!0}),setTimeout((function(){!t&&Ze()}),1e3);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d({title:"迁移任务",area:60,component:function(){return _((function(){return t.import("./progress-legacy.js?v=1734676359")}),void 0,t.meta.url)}});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$e=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({loading:Be,request:qe(),success:function(e){var t,n,r,a;Je.path=(null==e||null===(t=e.data)||void 0===t?void 0:t.datadir)||"",Je.port=(null==e||null===(n=e.data)||void 0===n?void 0:n.port)||"",Je.oldData.path=(null==e||null===(r=e.data)||void 0===r?void 0:r.datadir)||"",Je.oldData.port=(null==e||null===(a=e.data)||void 0===a?void 0:a.port)||""}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),et=L([{name:"启动时间",field:"Run",value:"无",function:function(e){return m(e.Run)}},{name:"总连接次数",field:"Connections",value:"无"},{name:"发送",value:"无",field:"other",function:function(e){return h(Number(e.Bytes_sent))}},{name:"接收",value:"无",field:"other",function:function(e){return h(Number(e.Bytes_received))}},{name:"每秒查询",value:"无",field:"other",function:function(e){return parseInt((e.Questions/e.Uptime).toString())}},{name:"每秒事务",value:"无",field:"other",function:function(e){return parseInt(((parseInt(e.Com_commit)+parseInt(e.Com_rollback))/e.Uptime).toString())}},{name:"File",value:"无",field:"File"},{name:"Position",value:"无",field:"Position"}]),tt=L([{name:"活动/峰值连接数",function:function(e){return e.Threads_running+"/"+e.Max_used_connections},value:"",ps:"若值过大,增加max_connections"},{name:"线程缓存命中率",value:"",function:function(e){var t=(100*(1-e.Threads_created/e.Connections)).toFixed(2);return isNaN(t)?"0":t+"%"},ps:"若过低,增加thread_cache_size"},{value:"",name:"索引命中率",function:function(e){var t=(100*(1-e.Key_reads/e.Key_read_requests)).toFixed(2);return isNaN(t)?"0":t+"%"},ps:"若过低,增加key_buffer_size"},{value:"",name:"Innodb索引命中率",function:function(e){var t=(100*(1-e.Innodb_buffer_pool_reads/e.Innodb_buffer_pool_read_requests)).toFixed(2);return isNaN(t)?"0":t},ps:"若过低,增加innodb_buffer_pool_size"},{value:"",name:"查询缓存命中率",function:function(e){var t=(parseInt(e.Qcache_hits)/(parseInt(e.Qcache_hits)+parseInt(e.Qcache_inserts))*100).toFixed(2)+"%";return"NaN%"==t&&(t="OFF"),t},ps:"若过低,增加query_cache_size"},{value:"",name:"创建临时表到磁盘",function:function(e){var t=(e.Created_tmp_disk_tables/e.Created_tmp_tables*100).toFixed(2);return isNaN(t)?"0":t+"%"},ps:"若过大,尝试增加tmp_table_size"},{value:"",name:"已打开的表",function:function(e){return e.Open_tables},ps:"table_open_cache配置值应大于等于此值"},{value:"",name:"没有使用索引的量",function:function(e){return e.Select_full_join},ps:"若不为0,请检查数据表的索引是否合理"},{value:"",name:"没有索引的JOIN量",function:function(e){return e.Select_range_check},ps:"若不为0,请检查数据表的索引是否合理"},{value:"",name:"排序后的合并次数",function:function(e){return e.Sort_merge_passes},ps:"若值过大,增加sort_buffer_size"},{value:"",name:"锁表次数",function:function(e){return e.Table_locks_waited},ps:"若值过大,请考虑增加您的数据库性能"}]),nt=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({loading:Be,request:Ce(),success:function(e){var t;if(!1===e.status||null!==(t=e.data)&&void 0!==t&&t.status)return s.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg||e.data.msg,type:"error",showClose:!0});et.value.forEach((function(t){t.function?t.value=t.function(e.data):t.value=e.data[t.field]})),tt.value.forEach((function(t){t.function&&(t.value=t.function(e.data))}))}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),rt=[{title:"1-2GB",data:{key_buffer_size:32,query_cache_size:32,tmp_table_size:32,innodb_buffer_pool_size:64,sort_buffer_size:256,read_buffer_size:256,read_rnd_buffer_size:256,join_buffer_size:512,thread_stack:256,binlog_cache_size:64,thread_cache_size:64,table_open_cache:128,max_connections:100}},{title:"2-4GB",data:{key_buffer_size:64,query_cache_size:64,tmp_table_size:64,innodb_buffer_pool_size:128,sort_buffer_size:512,read_buffer_size:512,read_rnd_buffer_size:512,join_buffer_size:1024,thread_stack:256,binlog_cache_size:64,thread_cache_size:96,table_open_cache:192,max_connections:200}},{title:"4-8GB",data:{key_buffer_size:128,query_cache_size:128,tmp_table_size:128,innodb_buffer_pool_size:256,sort_buffer_size:1024,read_buffer_size:1024,read_rnd_buffer_size:768,join_buffer_size:2048,thread_stack:256,binlog_cache_size:128,thread_cache_size:128,table_open_cache:384,max_connections:300}},{title:"8-16GB",data:{key_buffer_size:256,query_cache_size:256,tmp_table_size:256,innodb_buffer_pool_size:512,sort_buffer_size:1024,read_buffer_size:2048,read_rnd_buffer_size:1024,join_buffer_size:2048,thread_stack:384,binlog_cache_size:192,thread_cache_size:192,table_open_cache:1024,max_connections:400}},{title:"16-32GB",data:{key_buffer_size:1024,query_cache_size:384,tmp_table_size:1024,innodb_buffer_pool_size:1024,sort_buffer_size:4096,read_buffer_size:4096,read_rnd_buffer_size:2048,join_buffer_size:4096,thread_stack:512,binlog_cache_size:256,thread_cache_size:256,table_open_cache:2048,max_connections:500}}],at={key_buffer_size:"MB,用于索引的缓冲区大小",query_cache_size:"MB,查询缓存,不开启请设为0",tmp_table_size:"MB,临时表缓存大小",innodb_buffer_pool_size:"MB,Innodb缓冲区大小",innodb_log_buffer_size:"MB,Innodb日志缓冲区大小",sort_buffer_size:"KB * 连接数,每个线程排序的缓冲大小",read_buffer_size:"KB * 连接数读入缓冲区大小",read_rnd_buffer_size:"KB * 连接数随机读取缓冲区大小",join_buffer_size:"KB * 连接数关联表缓存大小",thread_stack:"KB * 连接数每个线程的堆栈大小",binlog_cache_size:"KB * 连接数二进制日志缓存大小(4096的倍数)",thread_cache_size:"线程池大小",table_open_cache:"表缓存",max_connections:"最大连接数"},ot=L(""),ut=L([]),it=L(),ct=function(){var e=u(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ut.value.forEach((function(e){rt[t].data[e.name]&&(e.value=rt[t].data[e.name]),"query_cache_size"!==e.name||rt[t].data.query_cache_size||(e.value=0)})),st();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),st=function(){var e,t=0,n=0,r=["key_buffer_size","query_cache_size","tmp_table_size","innodb_buffer_pool_size","innodb_log_buffer_size"],a=["sort_buffer_size","read_buffer_size","read_rnd_buffer_size","join_buffer_size","thread_stack","binlog_cache_size"],o=Number(ut.value.find((function(e){return"max_connections"===e.name})).value);ut.value.forEach((function(e){r.includes(e.name)?t+=Number(e.value):a.includes(e.name)&&(n+=Number(e.value)/1024)})),e=t+n*o,it.value=e},lt=function(){var e=u(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={query_cache_type:0},ut.value.forEach((function(e){var n="bt_query_cache_size"===e.name?"query_cache_size":e.name;t[n]=e.value})),t.query_cache_size>0&&(t.query_cache_type=1),t.max_heap_table_size=t.tmp_table_size,e.next=6,i({loading:"正在保存中，请稍后...",request:he(t),message:!0,success:function(e){e.status&&s.success("设置成功，重启数据库后配置生效，请重启数据库")}});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ft=function(){var e=u(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={restart:"重启",stop:"停止",reload:"重载配置",start:"启动"},e.next=3,o({title:"".concat(n[t],"mysqld服务"),content:"是否".concat(n[t],"mysqld服务？")});case 3:return e.next=5,i({loading:"正在".concat(n[t],"mysqld服务，请稍后..."),request:v({name:"mysqld",type:t}),message:!0,success:function(e){e.status&&y.go(0)}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=u(a().mark((function e(){var t,n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Be.value=!0,e.prev=1,t=["key_buffer_size","query_cache_size","tmp_table_size","innodb_buffer_pool_size","innodb_log_buffer_size","innodb_additional_mem_pool_size","sort_buffer_size","read_buffer_size","read_rnd_buffer_size","join_buffer_size","thread_stack","binlog_cache_size"],e.next=5,Le();case 5:n=e.sent,r=n.data,ut.value=[],r.mem.hasOwnProperty("join_buffer_size")||(r.mem.join_buffer_size=512),r.mem.hasOwnProperty("thread_stack")||(r.mem.thread_stack=256),r.mem.hasOwnProperty("binlog_cache_size")||(r.mem.binlog_cache_size=32),Object.keys(r.mem).forEach((function(e){t.includes(e);ut.value.push({name:e,value:r.mem[e],ps:at[e]?at[e]:""})})),it.value=r.mem.bt_mem_size,ot.value="",st(),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),b(e.t0);case 20:return e.prev=20,Be.value=!1,e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,17,20,23]])})));return function(){return e.apply(this,arguments)}}(),dt=L(""),_t=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o({title:"清空日志操作提示",icon:"warning-filled",content:"清空日志会导致运行错误信息丢失，无法排除问题，请谨慎操作，是否继续？"});case 2:return e.next=4,i({loading:"正在清空日志，请稍后...",request:ve({close:1}),message:!0,success:mt});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),mt=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({loading:Be,request:ye(),data:[String,dt]});case 2:dt.value=dt.value||"当前暂无数据";case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ht=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({loading:Be,request:be(),data:{msg:[String,dt]}});case 2:dt.value=dt.value||"当前暂无数据";case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),vt=L(!1),yt=L(),bt=L([]),gt=O({status:!1,size:""}),xt=L(!1),wt=O({days:""}),zt=O({days:[{required:!0,message:"请输入天数",trigger:"blur"},{validator:function(e,t,n){t<7?n(new Error("请输入大于7的天数")):n()}}]}),kt=function(){var e=u(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return gt.status=!t,e.next=3,o({title:(t?"开启":"关闭")+"二进制日志",icon:"warning-filled",content:(t?"开启二进制日志可以保护Mysql的数据安全，但同时会消耗一定磁盘存储，是否继续?":"关闭二进制日志后，将不会再记录所有对数据库的修改操作")+"二进制日志?"});case 3:return e.next=5,i({loading:"正在"+(t?"开启":"关闭")+"二进制日志，请稍后...",request:ge(),message:!0,success:function(e){Ct()}});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),jt=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yt.value.validate();case 2:return e.next=4,o({title:"清理日志",content:"即将清理【"+wt.days+"】天前的MySQL二进制日志，是否继续？",icon:"warning-filled"});case 4:return e.next=6,i({loading:"正在清理日志，请稍后...",request:_e({days:wt.days}),message:!0,success:function(e){e.status&&(xt.value=!1,qt(),Ct(),Lt())}});case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qt=function(){var e,t;xt.value=!1,null===(e=yt.value)||void 0===e||e.clearValidate(),null===(t=yt.value)||void 0===t||t.resetFields()},Ct=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({request:ge({status:1}),success:function(e){gt.status=e.data.binlog_status,gt.size=h(e.data.size)}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Lt=function(){var e=u(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({loading:Be,request:xe(),data:{data:[Array,bt]}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ot=function(){var e=u(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.row,e.next=3,o({title:"删除日志",icon:"warning-filled",content:"您真的要删除【".concat(n.name,"】日志？"),type:"calc"});case 3:return e.next=5,i({loading:"正在删除【".concat(n.name,"】日志，请稍后..."),request:we({path:n.path}),message:!0,success:Lt});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Vt=L(!1),St=function(){var e=u(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n="get"===t?{}:{status:Number(t)},e.next=4,ze(n);case 4:r=e.sent,"get"===t?(r.status||"当前状态关闭中！"===r.msg||s.request(r),Vt.value=Boolean(r.status)):s.request(r),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),b(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),Et=function(){var e=u(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="config"===e.t0?3:"port"===e.t0||"storage"===e.t0?5:"state"===e.t0?7:"performance"===e.t0?9:"errorLogs"===e.t0?11:"slowLogs"===e.t0?13:"binaryLogs"===e.t0?15:"memoryProtection"===e.t0?19:21;break;case 3:return Ye(),e.abrupt("break",21);case 5:return $e(),e.abrupt("break",21);case 7:return nt(),e.abrupt("break",21);case 9:return pt(),e.abrupt("break",21);case 11:return mt(),e.abrupt("break",21);case 13:return ht(),e.abrupt("break",21);case 15:return e.next=17,Lt();case 17:return Ct(),e.abrupt("break",21);case 19:return St("get"),e.abrupt("break",21);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pt=function(e){Me.value="service",e&&(Pe.value=e);var t=n(n({},Pe.value),{},{name:"mysqld"});Ee.init(t),Se.init(t),Ie.value=Pe.value.status},Nt={key:0},Mt={class:"p-2rem"},Bt={class:"content flex items-center"},It={class:"message flex-1 ml-4 py-[.3rem] leading-[2.4rem] text-[1.3rem]"},Ft={class:"text text-[15px] leading-[2.5rem] flex !flex-wrap break-all"},Ut={class:"my-[12px]"},Dt={class:"flex text-[#666] items-center"},Gt={class:"flex text-[#666] items-center"},Tt={class:"text-[#666] performance"},Ht={class:"flex items-center justify-center"},Kt={class:"flex items-center"},Qt={class:"ml-2rem"},Rt={class:"my-[12px]"},At={class:"my-[12px]"},Yt={class:"flex items-center"},Jt={class:"ml-[16rem]"},Xt=["onClick"],Wt={class:"p-[20px]"},Zt=V({__name:"index",props:{compData:{default:{}}},setup:function(e){var t=C(pe()).compData,n=e,r=S((function(){return t.value.status}));return E((function(){Pt(n.compData),t.value.refreshEvent=u(a().mark((function e(){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve("mysql");case 2:n=e.sent,t.value.status=n.s_status;case 4:case"end":return e.stop()}}),e)})))})),function(e,t){var n=J,a=x,o=w,u=X,i=W,c=z,s=Z,l=se,f=ce,p=k,d=$,_=ee,v=te,y=ne,b=re,g=ae,q=oe,C=ie,L=ue,O=j,V=P("bt-loading");return N(),M("div",null,[B(O,{modelValue:U(Me),"onUpdate:modelValue":t[12]||(t[12]=function(e){return H(Me)?Me.value=e:null}),type:"left-bg-card",position:"left",class:"h-full",onChange:U(Et)},{default:I((function(){return[B(s,{label:"服务",name:"service"},{default:I((function(){return[F("div",null,[B(de),B(fe),U(r)?T("",!0):(N(),D(n,{key:0,class:"mt-4rem",onClick:U(Te)},{default:I((function(){return t[13]||(t[13]=[G("修复启动")])})),_:1},8,["onClick"])),B(a,{options:[{content:"如需更换mysql版本，请备份好数据后，卸载mysql重新安装"}],class:"pl-1rem"},{default:I((function(){return[U(r)?T("",!0):(N(),M("li",Nt,"如无法正常启动，请尝试使用修复启动按钮进行修复启动"))]})),_:1}),B(c,{modelValue:U(Fe),"onUpdate:modelValue":t[1]||(t[1]=function(e){return H(Fe)?Fe.value=e:null}),area:50,title:"修复启动-恢复模式-innodb_force_recovery","show-footer":"",onConfirm:U(Ke)},{default:I((function(){return[F("div",Mt,[F("div",Bt,[t[14]||(t[14]=F("i",{class:"svgtofont-el-warning-filled !text-[4rem] text-warning"},null,-1)),F("div",It,[F("div",Ft,K(U(Ue).tips),1)])]),B(i,{model:U(Ue),"label-width":"80px"},{default:I((function(){return[B(u,{label:"恢复级别"},{default:I((function(){return[B(o,{modelValue:U(Ue).re_level,"onUpdate:modelValue":t[0]||(t[0]=function(e){return U(Ue).re_level=e}),options:U(De),class:"!w-20rem"},null,8,["modelValue","options"])]})),_:1})]})),_:1},8,["model"]),B(a,{options:U(Ge).recover,class:"pl-3rem"},null,8,["options"])])]})),_:1},8,["modelValue","onConfirm"])])]})),_:1}),B(s,{label:"配置文件",name:"config",lazy:!0},{default:I((function(){return[Q((N(),M("div",null,[t[16]||(t[16]=F("span",{class:"my-[4px] text-[#666]"}," 提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换 ",-1)),F("div",Ut,[B(l,{class:"!h-[48rem] !w-full",modelValue:U(Re),"onUpdate:modelValue":t[2]||(t[2]=function(e){return H(Re)?Re.value=e:null}),id:"configContent",onSave:U(Ae)},null,8,["modelValue","onSave"])]),B(n,{type:"primary",onClick:U(Ae)},{default:I((function(){return t[15]||(t[15]=[G("保存")])})),_:1},8,["onClick"]),B(a,{options:U(Ge).config,class:"pl-2rem"},null,8,["options"])])),[[V,U(Be)]])]})),_:1}),B(s,{label:"存储位置",name:"storage",lazy:!0},{default:I((function(){return[Q((N(),M("div",null,[F("div",Dt,[B(f,{icon:"icon-file_mode",onIconClick:U(Xe),width:"32rem",modelValue:U(Je).path,"onUpdate:modelValue":t[3]||(t[3]=function(e){return U(Je).path=e}),class:"!w-32rem"},null,8,["onIconClick","modelValue"]),B(n,{class:"ml-[12px]",onClick:U(We),type:"primary"},{default:I((function(){return t[17]||(t[17]=[G("迁移")])})),_:1},8,["onClick"])]),B(a,{options:U(Ge).storage,class:"pl-2rem"},null,8,["options"])])),[[V,U(Be)]])]})),_:1}),B(s,{label:"端口配置",name:"port",lazy:!0},{default:I((function(){return[Q((N(),M("div",Gt,[B(p,{modelValue:U(Je).port,"onUpdate:modelValue":t[4]||(t[4]=function(e){return U(Je).port=e}),type:"number",width:"10rem",class:"!w-10rem"},null,8,["modelValue"]),B(n,{type:"primary",class:"ml-[12px]",onClick:U(We)},{default:I((function(){return t[18]||(t[18]=[G("修改")])})),_:1},8,["onClick"])])),[[V,U(Be)]])]})),_:1}),B(s,{label:"当前状态",name:"state",lazy:!0},{default:I((function(){return[Q((N(),M("div",null,[B(_,{class:"margin-top",column:2,border:""},{default:I((function(){return[(N(!0),M(R,null,A(U(et),(function(e,t){return N(),D(d,{key:t},{label:I((function(){return[G(K(e.name),1)]})),default:I((function(){return[G(" "+K(e.value),1)]})),_:2},1024)})),128))]})),_:1}),B(y,{data:U(tt),class:"mt-[20px]","max-height":"400"},{default:I((function(){return[B(v,{prop:"name",label:"字段",width:"180"}),B(v,{prop:"value",label:"当前值",width:"100"}),B(v,{prop:"ps",label:"注意"})]})),_:1},8,["data"])])),[[V,U(Be)]])]})),_:1}),B(s,{label:"性能调整",name:"performance",lazy:!0},{default:I((function(){return[Q((N(),M("div",Tt,[F("div",Ht,[t[19]||(t[19]=G(" 优化方案 ")),B(g,{class:"!w-[12rem] mr-[20px] ml-8px",modelValue:U(ot),"onUpdate:modelValue":t[5]||(t[5]=function(e){return H(ot)?ot.value=e:null}),onChange:U(ct)},{default:I((function(){return[(N(!0),M(R,null,A(U(rt),(function(e,t){return N(),D(b,{key:t,value:t,label:e.title},null,8,["value","label"])})),128))]})),_:1},8,["modelValue","onChange"]),t[20]||(t[20]=G(" 最大使用内存 ")),B(p,{"text-type":"MB",width:"16rem",class:"!w-16rem ml-8px",readonly:"",modelValue:U(it),"onUpdate:modelValue":t[6]||(t[6]=function(e){return H(it)?it.value=e:null})},null,8,["modelValue"])]),B(q),B(i,{class:"performance-form","label-position":"right","label-width":"146px"},{default:I((function(){return[(N(!0),M(R,null,A(U(ut),(function(e,t){return Q((N(),D(u,{label:e.name,key:t},{default:I((function(){return[F("div",Kt,[B(p,{modelValue:e.value,"onUpdate:modelValue":function(t){return e.value=t},width:"16rem",class:"!w-16rem",type:"number",onChange:U(st)},null,8,["modelValue","onUpdate:modelValue","onChange"]),F("span",Qt,K(e.ps),1)])]})),_:2},1032,["label"])),[[Y,e.ps]])})),128)),B(u,{label:" ",class:"mt-1rem"},{default:I((function(){return[B(n,{type:"primary",onClick:U(lt)},{default:I((function(){return t[21]||(t[21]=[G("保存")])})),_:1},8,["onClick"]),B(n,{onClick:t[7]||(t[7]=function(e){return U(ft)("restart")})},{default:I((function(){return t[22]||(t[22]=[G("重启数据库")])})),_:1}),t[23]||(t[23]=F("span",{class:"ml-3rem"},"* 修改配置后，需重启数据库生效",-1))]})),_:1})]})),_:1})])),[[V,U(Be)]])]})),_:1}),B(s,{label:"错误日志",name:"errorLogs",lazy:!0},{default:I((function(){return[Q((N(),M("div",null,[B(n,{type:"default",onClick:U(_t)},{default:I((function(){return t[24]||(t[24]=[G("清空日志")])})),_:1},8,["onClick"]),F("div",Rt,[B(C,{class:"!h-[56rem] !w-full",content:U(dt),id:"errorLogs",isHtml:!0,fullScreen:{title:"全屏查看【错误日志】",onRefresh:U(mt)}},null,8,["content","fullScreen"])])])),[[V,U(Be)]])]})),_:1}),B(s,{label:"慢日志",name:"slowLogs",lazy:!0},{default:I((function(){return[Q((N(),M("div",At,[B(C,{content:U(dt),isHtml:!0,class:"!h-[60rem] !w-full",id:"slowLogs",fullScreen:{title:"全屏查看【慢日志】",onRefresh:U(ht)}},null,8,["content","fullScreen"])])),[[V,U(Be)]])]})),_:1}),B(s,{label:"二进制日志",name:"binaryLogs",lazy:!0},{default:I((function(){return[F("div",null,[F("div",Yt,[F("div",null,[t[25]||(t[25]=G(" 二进制日志 ")),B(L,{modelValue:U(gt).status,"onUpdate:modelValue":t[8]||(t[8]=function(e){return U(gt).status=e}),onChange:U(kt)},null,8,["modelValue","onChange"])]),F("span",Jt,K(U(gt).size),1)]),B(q),t[27]||(t[27]=F("span",null," · 温馨提示：Mysql二进制日志是记录当前的操作日志，可用于数据恢复，数据备份。 ",-1)),Q((N(),D(y,{class:"mt-[20px]",data:U(bt),"max-height":"500"},{default:I((function(){return[B(v,{prop:"name",label:"文件名"}),B(v,{prop:"size",label:"大小"},{default:I((function(e){return[G(K(U(h)(e.row.size)),1)]})),_:1}),B(v,{prop:"last_modified",label:"最后修改时间"},{default:I((function(e){return[G(K(U(m)(e.row.last_modified)),1)]})),_:1}),B(v,{align:"right",label:"操作"},{default:I((function(e){return[F("span",{class:"bt-link",onClick:function(t){return U(Ot)(e)}},"删除",8,Xt)]})),_:1})]})),_:1},8,["data"])),[[V,U(Be)]]),B(c,{title:"清理日志",modelValue:U(xt),"onUpdate:modelValue":t[10]||(t[10]=function(e){return H(xt)?xt.value=e:null}),area:42,showFooter:"",onCancel:U(qt),onConfirm:U(jt)},{default:I((function(){return[F("div",Wt,[B(i,{disabled:U(vt),class:"flex justify-center","label-position":"right",model:U(wt),ref_key:"binlogFormRef",ref:yt,rules:U(zt)},{default:I((function(){return[B(u,{label:"清理周期",prop:"days"},{default:I((function(){return[B(p,{modelValue:U(wt).days,"onUpdate:modelValue":t[9]||(t[9]=function(e){return U(wt).days=e}),type:"number",min:7,width:"24","text-type":"天"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["disabled","model","rules"]),t[26]||(t[26]=F("ul",{class:"leading-8 text-[1.2rem] list-disc ml-[48px]"},[F("li",null,"只能清理7天前的日志,请输入大于7的天数")],-1))])]})),_:1},8,["modelValue","onCancel","onConfirm"])])]})),_:1}),B(s,{label:"内存保护",name:"memoryProtection",lazy:!0},{default:I((function(){return[F("div",null,[F("div",null,[t[28]||(t[28]=G(" 内存保护 ")),B(L,{modelValue:U(Vt),"onUpdate:modelValue":t[11]||(t[11]=function(e){return H(Vt)?Vt.value=e:null}),onChange:U(St)},null,8,["modelValue","onChange"])]),B(a,{options:U(Ge).memoryProtection,class:"pl-2rem"},null,8,["options"])])]})),_:1})]})),_:1},8,["modelValue","onChange"])])}}});e("default",q(Zt,[["__scopeId","data-v-ec0dde4a"]]))}}}))}();
