import{H as e}from"./utils-lib.js?v=1734676359";import{d as a,a as t,g as s,b as l,c as n,e as c,f as i,u as o,h as r,i as d,s as u}from"./api.js?v=1734676359";import{t as p,a as f}from"./store6.js?v=1734676359";import{c as m,p as g,r as h,h as k,i as v,o as S,B as y,k as P,l as T,C as b,J as w,x as _,q as I,v as x,e as C,y as q,z as E,I as D,M as V}from"./base-lib.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const A={class:"flex items-center px-[1rem] py-[1.4rem] flex-wrap gap-y-1rem"},R={class:"mx-[1rem]"},j=["innerHTML"],N={class:"mx-[1rem]"},U={class:"mx-[1rem]"},L={key:0,class:"mx-[1rem]"},B={key:2},H={class:"p-[2rem]"},M={class:"p-[2rem]"},z={class:"alert alert-danger leading-2rem mb-1rem"},K={class:"flex items-center justify-between"},O={class:"p-[1rem]"},F={style:{"text-align":"right",margin:"0"}},J={class:"flex items-center"},Q=m({__name:"statusbar",props:{dependencies:{default:()=>({})}},setup(m,{expose:Q}){const Y=m,{BtDialog:G,BtLink:W,ElCard:X,ElIcon:Z,ElPopover:$,ElTable:ee,ElTableColumn:ae,ElInput:te,ElButton:se}=g(Y.dependencies.components),{getByteUnit:le}=g(Y.dependencies.utils),{useAxios:ne,useMessage:ce,useConfirm:ie,useDialog:oe}=g(Y.dependencies.hooks),re=ce(),de=h(!1),ue=h(!1),pe=h(!1),fe=h(!1),me=k({InstanceId:"",appId:"",secretId:"",secretKey:"",show:!0,PrivateAddresses:[],PublicAddresses:[],Region:"",Region_title:"",ExpiredTime:"",requestPack:{InstanceTrafficPackageSet:[],RequestId:"",TotalCount:0},requestInfoShow:!1,firstPhotoShow:!1,snapshotsList:[],SnapshotName:"",createSnapshotDisable:!1}),ge=v((()=>{const e=(e,a)=>"<span>".concat(e.join("、"),"(").concat(a,")</span>");if(me.PrivateAddresses.length>0&&me.PublicAddresses.length>0){const a=e(me.PrivateAddresses,"内"),t=e(me.PublicAddresses,"外");return"".concat(a," / ").concat(t)}return"----"})),he=v((()=>""!==me.Region&&""!==me.Region_title?"".concat(me.Region_title,"-").concat(me.Region):"----")),ke=v((()=>""!==me.ExpiredTime?ye(me.ExpiredTime):"----")),ve=v((()=>{const e=[];for(let a=0;a<me.requestPack.InstanceTrafficPackageSet.length;a++){const t=me.requestPack.InstanceTrafficPackageSet[a];for(let a=0;a<t.TrafficPackageSet.length;a++){const s=t.TrafficPackageSet[a];e.push({TrafficPackageId:s.TrafficPackageId,TrafficPackageTotal:le(s.TrafficPackageTotal),TrafficUsed:le(s.TrafficUsed),TrafficPackageRemaining:le(s.TrafficPackageRemaining),TrafficPackageStart:ye(s.StartTime),TrafficPackageEnd:ye(s.EndTime)})}}return e})),Se=v((()=>{if(me.requestPack.InstanceTrafficPackageSet.length>0){const e=me.requestPack.InstanceTrafficPackageSet[0];let a=0,t=0;for(let s=0;s<e.TrafficPackageSet.length;s++){const l=e.TrafficPackageSet[s];a+=l.TrafficPackageTotal,t+=l.TrafficUsed}return"".concat(le(t),"/").concat(le(a))}return"----"})),ye=e=>{if(!e)return"--";const a=new Date(e),t=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),n=String(a.getHours()).padStart(2,"0"),c=String(a.getMinutes()).padStart(2,"0"),i=String(a.getSeconds()).padStart(2,"0");return"".concat(t,"-").concat(s,"-").concat(l," ").concat(n,":").concat(c,":").concat(i)},Pe=()=>{window.open("https://console.cloud.tencent.com/lighthouse/instance/detail?id=".concat(me.InstanceId))},Te=e=>{window.open(e)},be=a=>{(a=a||{}).alert=pe.value?"当前密钥错误，请重新关联API密钥":"",oe({isAsync:!0,component:()=>e((()=>import("./config3.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:!1,area:[48],compData:{...a,dependencies:Y.dependencies}})},we=e=>{e?be({appId:me.appId,secretId:me.secretId,secretKey:me.secretKey,isEdit:e||!1}):be()},_e=async(e=!1)=>{try{pe.value=!1,de.value=!0,ue.value=!0;const{data:a}=await s();if(!1===(null==a?void 0:a.status)&&(null==a?void 0:a.msg))return;if(a){me.show=!1,me.secretKey=a.secretKey,me.appId=a.appid,me.secretId=a.secretId;const{data:t}=await l(e?{force:1}:{});f.value=t,Object.assign(me,t),"cvm"!==(null==t?void 0:t.server_type)?(p.value=!1,Ie()):p.value=!0,ue.value=!1}else ue.value=!1}catch(a){}finally{ue.value=!1}},Ie=async()=>{try{const{data:e}=await n();e&&e.msg&&(e.msg.indexOf("密钥连接错误")>-1||e.msg.indexOf("获取失败")>-1)?be({tips:"当前密钥错误，请重新绑定或取消当前密钥关联"}):me.requestPack=e}catch(e){de.value=!1,pe.value=!0}},xe=async(e=!1)=>{try{me.firstPhotoShow=!0;const{data:a}=p.value?await c():await i();me.snapshotsList=a.SnapshotSet,e&&re.success("刷新成功")}catch(a){}},Ce=async()=>{await ie({title:"更新腾讯云专版数据",content:"更新当前腾讯专版功能 (面板功能除外，面板更新请使用自带更新功能) ，是否继续操作?"});const e=await o();re.request(e)},qe=async()=>{if(me.SnapshotName)try{const e=re.load("正在创建快照，请稍后...");me.createSnapshotDisable=!0;const a=p.value?r:d,{data:t}=await a({SnapshotName:me.SnapshotName});e.close(),me.createSnapshotDisable=!1,fe.value=!1,re.request(t),me.SnapshotName="",t.status&&await xe()}catch(e){}else re.error("请输入快照名称")};return S((()=>{u(ne),_e()})),Q({tencentCloudDialog:be}),(e,s)=>{const l=y("bt-loading");return P(),T("div",null,[g(de)?b((P(),w(g(X),{key:0,class:"tencent min-h-[5.2rem] module-box"},{default:_((()=>[I("div",A,[s[27]||(s[27]=I("div",{class:"tencent_division flex items-center"},[I("i",{class:"tencent_ico"}),I("span",{class:"text-[14px] text-[#666] font-semibold ml-[5px]"},"腾讯云专享版")],-1)),I("div",R,[s[14]||(s[14]=I("span",null,"主机IPv4：",-1)),I("span",{innerHTML:g(ge)},null,8,j)]),I("div",N,[s[15]||(s[15]=I("span",null,"区域：",-1)),I("span",null,x(g(he)),1)]),I("div",U,[s[16]||(s[16]=I("span",null,"到期时间：",-1)),I("span",null,x(g(ke)),1)]),g(me).requestPack.InstanceTrafficPackageSet.length>0?(P(),T("div",L,[s[18]||(s[18]=I("span",null,"流量包：",-1)),I("span",null,x(g(Se)),1),C(g(W),{class:"ml-[0.5rem]",onClick:s[0]||(s[0]=e=>g(me).requestInfoShow=!0)},{default:_((()=>s[17]||(s[17]=[q("详情")]))),_:1})])):E("",!0),g(me).show?(P(),w(g(se),{key:1,class:"ml-[1rem]",onClick:s[1]||(s[1]=e=>we(!1))},{default:_((()=>s[19]||(s[19]=[q("关联腾讯云API密钥")]))),_:1})):(P(),T("div",B,[C(g(se),{class:"ml-[1rem]",onClick:Pe},{default:_((()=>s[20]||(s[20]=[q("续费")]))),_:1}),C(g(se),{class:"ml-[1rem]",onClick:Pe},{default:_((()=>s[21]||(s[21]=[q("升级套餐")]))),_:1}),C(g(se),{type:"default",class:"ml-[1rem]",onClick:s[2]||(s[2]=e=>we(!0))},{default:_((()=>s[22]||(s[22]=[q("密钥管理")]))),_:1}),C(g(se),{type:"default",class:"ml-[1rem]",onClick:s[3]||(s[3]=e=>xe())},{default:_((()=>s[23]||(s[23]=[q("快照")]))),_:1}),C(g(se),{type:"default",class:"ml-[1rem]",onClick:Ce},{default:_((()=>s[24]||(s[24]=[q("更新")]))),_:1}),C(g(se),{type:"default",class:"ml-[1rem]",onClick:s[4]||(s[4]=e=>_e(!0))},{default:_((()=>s[25]||(s[25]=[q("刷新"),I("i",{class:"svgtofont-el-refresh-right el-icon--right size-[1.3rem]"},null,-1)]))),_:1}),C(g(W),{class:"ml-[1rem]",onClick:s[5]||(s[5]=e=>Te("https://www.bt.cn/bbs/thread-66887-1-1.html"))},{default:_((()=>s[26]||(s[26]=[q("查看教程")]))),_:1})]))]),C(g(G),{title:"流量包管理",modelValue:g(me).requestInfoShow,"onUpdate:modelValue":s[6]||(s[6]=e=>g(me).requestInfoShow=e),area:[80,30]},{default:_((()=>[I("div",H,[C(g(ee),{data:g(ve),border:"","max-height":250},{default:_((()=>[C(g(ae),{prop:"TrafficPackageId",label:"流量包ID",width:"120"}),C(g(ae),{prop:"TrafficPackageTotal",label:"总量"}),C(g(ae),{prop:"TrafficUsed",label:"已用"}),C(g(ae),{prop:"TrafficPackageRemaining",label:"剩余"}),C(g(ae),{prop:"TrafficPackageStart",label:"开始时间",width:"150"}),C(g(ae),{prop:"TrafficPackageEnd",label:"结束时间",width:"150"})])),_:1},8,["data"])])])),_:1},8,["modelValue"]),C(g(G),{title:"腾讯云硬盘快照",modelValue:g(me).firstPhotoShow,"onUpdate:modelValue":s[12]||(s[12]=e=>g(me).firstPhotoShow=e),area:[62]},{default:_((()=>[I("div",M,[I("div",z,[s[33]||(s[33]=q(" 温馨提示： ")),g(p)?(P(),T(D,{key:1},[s[31]||(s[31]=I("div",null,[q(" 1、快照仅能捕获该时刻已经在云硬盘上的数据，而无法将在内存中的数据记录下来。因此，为了保证快照能尽可能回复完整的数据，建议您在制作快照前进行以下操作： "),I("ul",{class:"pl-1.6rem list-disc"},[I("li",null,"数据库业务：进行 flush and lock 表操作，加锁并下刷表数据"),I("li",null,"文件系统：进行 sync 操作，下刷内存数据")])],-1)),s[32]||(s[32]=I("div",null,[q(" 2、快照已正式商业化，请您关注因此产生的费用。有关快照的更多信号可参考"),I("a",{href:"https://cloud.tencent.com/document/product/362/5754",class:"BtLink",target:"_blank"},"快照概述"),q("以及"),I("a",{href:"https://cloud.tencent.com/document/product/362/17935",class:"BtLink",target:"_blank"},"快照商业化FAQ")],-1))],64)):(P(),T(D,{key:0},[s[28]||(s[28]=I("div",null,[q("1、每个地域的免费快照配额为已创建实例数"),I("span",{style:{"font-weight":"600"}},"(待回收实例和存储型套餐实例除外)乘以2"),q("，且最多不超过4个。")],-1)),s[29]||(s[29]=I("div",null,"2、使用存储型套餐的实例不支持创建快照。",-1)),s[30]||(s[30]=I("div",null,"3、创建快照通常可以在5分钟内完成，请耐心等待，创建过程中无需关机。",-1))],64))]),I("div",K,[C(g($),{modelValue:g(fe),"onUpdate:modelValue":s[9]||(s[9]=e=>V(fe)?fe.value=e:null),placement:"right","popper-class":"myPopover",width:"200"},{reference:_((()=>[C(g(se),{type:"primary"},{default:_((()=>s[36]||(s[36]=[q("创建快照")]))),_:1})])),default:_((()=>[I("div",O,[C(g(te),{modelValue:g(me).SnapshotName,"onUpdate:modelValue":s[7]||(s[7]=e=>g(me).SnapshotName=e),disabled:g(me).createSnapshotDisable,size:"small",class:"mb-[1rem]",placeholder:"请输入快照名称"},null,8,["modelValue","disabled"]),I("div",F,[C(g(se),{size:"small",type:"default",onClick:s[8]||(s[8]=e=>fe.value=!1)},{default:_((()=>s[34]||(s[34]=[q("取消")]))),_:1}),C(g(se),{type:"primary",size:"small",loading:g(me).createSnapshotDisable,onClick:qe},{default:_((()=>s[35]||(s[35]=[q("确定")]))),_:1},8,["loading"])])])])),_:1},8,["modelValue"]),C(g(se),{type:"default",onClick:s[10]||(s[10]=e=>xe(!0))},{default:_((()=>s[37]||(s[37]=[I("span",{class:"svgtofont-el-refresh"},null,-1)]))),_:1})]),C(g(ee),{data:g(me).snapshotsList,border:"","max-height":250,class:"mt-[1rem]"},{default:_((()=>[C(g(ae),{prop:"SnapshotName",label:"快照名称",width:"120"}),C(g(ae),{prop:"CreatedTime",label:"创建时间",formatter:e=>ye(e.CreatedTime)},null,8,["formatter"]),C(g(ae),{prop:"TrafficUsed",label:"操作",align:"right"},{default:_((e=>[C(g(W),{onClick:s[11]||(s[11]=e=>Te("https://console.cloud.tencent.com/cvm/snapshot/list"))},{default:_((()=>s[38]||(s[38]=[q("回滚")]))),_:1}),s[40]||(s[40]=I("div",{class:"el-divider el-divider--vertical"},null,-1)),C(g(W),{onClick:s=>(async e=>{try{await ie({title:"删除[".concat(e.SnapshotName,"]快照"),content:"是否删除当前【".concat(e.SnapshotName,"】快照，删除后将无法恢复，是否继续？")});const s=re.load("正在删除快照，请稍后..."),l=p.value?a:t,n=await l({SnapshotId:e.SnapshotId});s.close(),re.request(n),await xe()}catch(s){}})(e.row)},{default:_((()=>s[39]||(s[39]=[q("删除")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])])),_:1},8,["modelValue"])])),_:1})),[[l,g(ue)]]):E("",!0),g(pe)?(P(),w(g(X),{key:1,shadow:"always","body-style":{padding:"0",display:"flex",minHeight:"5.2rem"},class:"module-box min-h-[5.2rem] !text-danger !bg-[#f2dede] px-1.6rem"},{default:_((()=>[C(g(Z),{name:"svgtofont-el-warning",class:"text-[#a94442]"}),I("div",J,[s[42]||(s[42]=q(" 密钥连接错误，请重新绑定或取消当前密钥关联! ")),C(g(W),{class:"ml-1rem",onClick:s[13]||(s[13]=e=>be())},{default:_((()=>s[41]||(s[41]=[q("[ 密钥管理 ]")]))),_:1})])])),_:1})):E("",!0)])}}});export{Q as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
