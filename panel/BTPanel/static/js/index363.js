import{G as a,M as e,ah as t,o as s,D as r,O as l,e as o,aa as n}from"./utils-lib.js?v=1734676359";import{g as i,r as u,c,s as m,i as d,e as _,y as p,o as w,k as v,l as b,p as g,q as N,x as f,A as h,az as y,C as E,D as x,a1 as D,J as q,M as S}from"./base-lib.js?v=1734676359";import{b as I,l as O,d as j,i as C,F}from"./form-item.js?v=1734676359";import{getDatabaseTimeOut as R,setDatabaseTimeOut as T,getDatabasePasswordConfig as k,setDatabasePasswordConfig as B,getDatabaseLoginLimit as M,setDatabaseLoginLimit as G}from"./database.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const L=i("DATABASE-MYSQL-ADVANCED-REINFORCE-STORE",(()=>{const r=u({default_password_lifetime:"90",expire_logs_days:"180",interactive_timeout:"300",wait_timeout:"300"}),l=u({validate_password_length:"",validate_password_mixed_case_count:"",validate_password_number_count:"",validate_password_policy:"STRONG",validate_password_special_char_count:"",status:!1,oldStatus:!1}),o=u({connection_control_failed_connections_threshold:"5",connection_control_max_connection_delay:"1800000",connection_control_min_connection_delay:"2147483647",status:!1,oldStatus:!1});return{resetData:()=>{r.value.default_password_lifetime="",r.value.expire_logs_days="",r.value.interactive_timeout="",r.value.wait_timeout="",l.value.validate_password_length="",l.value.validate_password_mixed_case_count="",l.value.validate_password_number_count="",l.value.validate_password_policy="STRONG",l.value.validate_password_special_char_count="",l.value.status=!1,l.value.oldStatus=!1,o.value.connection_control_failed_connections_threshold="5",o.value.connection_control_max_connection_delay="1800000",o.value.connection_control_min_connection_delay="2147483647",o.value.status=!1,o.value.oldStatus=!1},getBaseData:async()=>{try{const s=await a({loading:"正在获取数据，请稍后...",request:R(),data:{default_password_lifetime:String,expire_logs_days:String,interactive_timeout:String,wait_timeout:String,msg:String,status:Boolean}});s.hasOwnProperty("default_password_lifetime")?(r.value.default_password_lifetime=s.default_password_lifetime,r.value.expire_logs_days=s.expire_logs_days,r.value.interactive_timeout=s.interactive_timeout,r.value.wait_timeout=s.wait_timeout):(e.error(s),t(s))}catch(s){t(s)}},baseFormData:r,setBaseData:async e=>{try{a({loading:"正在设置，请稍后...",message:!0,request:T(e)})}catch(s){t(s)}},passwordFormData:l,getPasswordData:async()=>{try{const e=await a({loading:"正在获取数据，请稍后...",request:k()});e.status?(l.value.validate_password_length=e.data.validate_password_length||"10",l.value.validate_password_mixed_case_count=e.data.validate_password_mixed_case_count||"",l.value.validate_password_number_count=e.data.validate_password_number_count||"",l.value.validate_password_policy=e.data.validate_password_policy||"STRONG",l.value.validate_password_special_char_count=e.data.validate_password_special_char_count||"",l.value.status="ON"===e.data.status||"on"===e.data.status,l.value.oldStatus="ON"===e.data.status||"on"===e.data.status):t(e)}catch(e){t(e)}},setPasswordData:async e=>{try{if(!e.status){try{await s({title:"关闭密码复杂度验证",content:"关闭后将不会进行密码复杂度验证，是否继续操作！"}),a({loading:"正在关闭，请稍后...",message:!0,request:B({...e,status:e.status?"on":"off"}),success:a=>{a.status||(l.value.status=!0)}})}catch(r){l.value.status=!0}return}a({loading:"正在保存，请稍后...",message:!0,request:B({...e,status:e.status?"on":"off"})})}catch(r){t(r)}},limitFormData:o,getLimitData:async()=>{try{const e=await a({loading:"正在获取数据，请稍后...",request:M()});e.status?(o.value.connection_control_failed_connections_threshold=e.data.connection_control_failed_connections_threshold||"",o.value.connection_control_max_connection_delay=e.data.connection_control_max_connection_delay||"1800000",o.value.connection_control_min_connection_delay=e.data.connection_control_min_connection_delay||"2147483647",o.value.status="ON"===e.data.status||"on"===e.data.status,o.value.oldStatus="ON"===e.data.status||"on"===e.data.status):t(e)}catch(e){t(e)}},setLimitData:async e=>{try{if(!e.status){try{await s({title:"关闭登录限制",content:"关闭后将不会进行登录次数限制，是否继续操作！"}),a({loading:"正在关闭，请稍后...",message:!0,request:G({...e,status:e.status?"on":"off"}),success:a=>{a.status||(o.value.status=!0)}})}catch(r){o.value.status=!0}return}a({loading:"正在保存，请稍后...",message:!0,request:G({...e,status:e.status?"on":"off"})})}catch(r){t(r)}}}})),A={class:"p-[2rem]"},P={class:"flex justify-end pr-[28rem]"},U=o(c({__name:"reinforce-base",setup(a,{expose:e}){const t=L(),{baseFormData:s}=m(t),{getBaseData:o,setBaseData:n}=t,i=[{content:"设置180天日志可能会占用大量磁盘空间，请注意是否留有充足空间"},{content:"设置密码到期后需及时更新密码，否则mysq|将连接异常"},{content:"以上均为等保默认推荐值"}],{BtForm:u,submit:c}=r({data:()=>s.value,options:a=>d((()=>[I("日志保存时间","expire_logs_days",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("天"),_("span",{class:"ml-[1.5rem]"},[p("建议180天")])])},attrs:{class:"!w-[20rem]",placeholder:"日志保存时间"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的日志保存时间")):Number.isInteger(Number(e))?Number(e)<1?t(new Error("请输入正确的日志保存时间")):t():t(new Error("请输入正确的日志保存时间"))},trigger:"blur"}]}),I("等待超时时间","wait_timeout",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("秒"),_("span",{class:"ml-[1.5rem]"},[p("建议300秒")])])},attrs:{class:"!w-[20rem]",placeholder:"等待超时时间"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的等待超时时间")):Number.isInteger(Number(e))?Number(e)<1?t(new Error("请输入正确的等待超时时间")):t():t(new Error("请输入正确的等待超时时间"))},trigger:"blur"}]}),I("命令行超时设置","interactive_timeout",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("秒"),_("span",{class:"ml-[1.5rem]"},[p("建议300秒")])])},attrs:{class:"!w-[20rem]",placeholder:"命令行超时时间"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的命令行超时时间")):Number.isInteger(Number(e))?Number(e)<1?t(new Error("请输入正确的命令行超时时间")):t():t(new Error("请输入正确的命令行超时时间"))},trigger:"blur"}]}),I("密码到期时间","default_password_lifetime",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("天"),_("span",{class:"ml-[1.5rem]"},[p("建议90天,")]),_("span",{class:"text-[#ef0808]"},[p("请先重置mysql root密码后 再设置密码到期时间")])])},attrs:{class:"!w-[45.2rem]",placeholder:"密码到期时间"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的密码到期时间")):Number.isInteger(Number(e))?Number(e)<1?t(new Error("密码到期时间最低设置1天")):t():t(new Error("请输入正确的密码到期时间"))},trigger:"blur"}]})])),submit:async(a,e,t)=>{await e(),n(a.value)}});return w((()=>{o()})),e({init:o}),(a,e)=>{const t=h,s=l;return v(),b("div",A,[_(g(u)),N("div",P,[_(t,{type:"primary",onClick:g(c)},{default:f((()=>e[0]||(e[0]=[p("保存")]))),_:1},8,["onClick"])]),_(s,{class:"mt-[20rem]",options:i})])}}}),[["__scopeId","data-v-b8efae9e"]]),V={class:"p-[2rem]"},W={class:"flex justify-end pr-[18rem]"},H=o(c({__name:"reinforce-password",setup(a,{expose:e}){const t=L(),{passwordFormData:s}=m(t),{getPasswordData:o,setPasswordData:n}=t,i=[{content:'<span class="text-[#ef0808]">设置密码复杂度后 如不按照规则设置密码，可能无法正常创建数据库，修改用户密码/同步用户密码</span>',isHtml:!0},{content:"以上均为等保默认推荐值"},{content:()=>_("div",null,[p("密码验证强度类型："),_("div",null,[_("p",null,[p("LOW：只检查密码长度")]),_("p",null,[p("MEDIUM：检查长度、数字、大写字母、小写字母、特殊字符")]),_("p",null,[p("STRONG：检查长度、数字、大写字母、小写字母、特殊字符、字典文件")])])])}],{BtForm:u,submit:c,ref:D}=r({data:()=>s.value,options:a=>d((()=>[O("开启密码复杂度验证","status",{attrs:{onChange:async a=>{!a&&s.value.oldStatus&&n({status:!1})}}}),...a.value.status?[I("最短密码长度","validate_password_length",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议10位")])])},attrs:{class:"!w-[17.6rem]",placeholder:"最短密码长度"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的最短密码长度")):Number.isInteger(Number(e))?Number(e)<6?t(new Error("最短密码长度不能小于6")):t():t(new Error("请输入正确的最短密码长度"))},trigger:"blur"}]}),I("密码最少数字个数","validate_password_number_count",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议至少1位")])])},attrs:{class:"!w-[19.3rem]",placeholder:"最少数字"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的密码最少数字个数")):Number.isInteger(Number(e))?t():t(new Error("请输入正确的密码最少数字个数"))},trigger:"blur"}]}),I("密码最少特殊字符个数","validate_password_special_char_count",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议至少1位")])])},attrs:{class:"!w-[19.3rem]",placeholder:"最少特殊字符"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的密码最少特殊字符个数")):Number.isInteger(Number(e))?t():t(new Error("请输入正确的密码最少特殊字符个数"))},trigger:"blur"}]}),I("密码最少大小写英文字符个数","validate_password_mixed_case_count",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",{class:"ml-[.5rem]"},[p("建议至少1位")])])},attrs:{class:"!w-[19.3rem]",placeholder:"大小写英文字符"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))?t(new Error("请输入正确的最少大小写英文字符个数")):Number.isInteger(Number(e))?t():t(new Error("请输入正确的最少大小写英文字符个数"))},trigger:"blur"}]}),j([C("密码验证强度","validate_password_policy",[{label:"LOW",value:"LOW"},{label:"MEDIUM",value:"MEDIUM"},{label:"STRONG",value:"STRONG"}],{attrs:{class:"!w-[11.1rem]",placeholder:"验证强度"},rules:[{required:!0,validator:(a,e,t)=>{""===e?t(new Error("请选择验证强度")):t()},trigger:"blur"}]}),F((()=>y("span",{class:"text-[1.2rem] text-[#666] ml-[1.5rem] leading-[3.2rem]"},"建议设置为STRONG")),{key:"jump",rules:{}})])]:[]])),submit:async(a,e,t)=>{await e(),n(a.value)}});return w((()=>{o()})),e({init:o}),(a,e)=>{const t=h,r=l;return v(),b("div",V,[_(g(u),{class:"h-[30rem]"}),E(N("div",W,[_(t,{type:"primary",onClick:g(c)},{default:f((()=>e[0]||(e[0]=[p("保存")]))),_:1},8,["onClick"])],512),[[x,g(s).status]]),E(_(r,{class:"mt-[4rem]",options:i},null,512),[[x,g(s).status]])])}}}),[["__scopeId","data-v-adf79aa4"]]),z={class:"p-[2rem]"},J={class:"flex justify-end pr-[18rem]"},Q=o(c({__name:"reinforce-limit",setup(a,{expose:e}){const t=L(),{limitFormData:s}=m(t),{getLimitData:o,setLimitData:n}=t,i=[{content:"以上均为等保默认推荐值"}],{BtForm:u,submit:c,ref:y}=r({data:()=>s.value,options:a=>d((()=>[O("开启限制登录","status",{attrs:{onChange:async a=>{!a&&s.value.oldStatus&&n({status:!1})}}}),...a.value.status?[I("验证错误锁定次数","connection_control_failed_connections_threshold",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("次"),_("span",{class:"ml-[.5rem]"},[p("密码错误超过设置次数后进行锁定")])])},attrs:{class:"!w-[35rem]",placeholder:"验证错误锁定次数"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))||!Number.isInteger(Number(e))||Number(e)<1?t(new Error("请输入正确的验证错误锁定次数")):t()},trigger:"blur"}]}),I("最小锁定时间","connection_control_min_connection_delay",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[p("毫秒"),_("span",{class:"ml-[.5rem]"},[p("推荐1800000毫秒（5分钟）")])])},attrs:{class:"!w-[33.4rem]",placeholder:"最小锁定时间"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))||!Number.isInteger(Number(e))||Number(e)<1?t(new Error("请输入正确的密码最小锁定时间(毫秒)")):t()},trigger:"blur"}]}),I("最长锁定时间","connection_control_max_connection_delay",{slots:{unit:()=>_("span",{class:"whitespace-nowrap ml-[.5rem]"},[_("span",null,[p("毫秒")]),_("span",{class:"ml-[.5rem]"},[p("默认2147483647毫秒")])])},attrs:{class:"!w-[30rem]",placeholder:"最长锁定时间"},rules:[{required:!0,validator:(a,e,t)=>{""===e||isNaN(Number(e))||!Number.isInteger(Number(e))||Number(e)<1?t(new Error("请输入正确的密码最长锁定时间")):t()},trigger:"blur"}]})]:[]])),submit:async(a,e,t)=>{await e(),n(a.value)}});return w((()=>{o()})),e({init:o}),(a,e)=>{const t=h,r=l;return v(),b("div",z,[_(g(u),{class:"h-[20rem]"}),E(N("div",J,[_(t,{type:"primary",onClick:g(c)},{default:f((()=>e[0]||(e[0]=[p("保存")]))),_:1},8,["onClick"])],512),[[x,g(s).status]]),E(_(r,{class:"mt-[24rem]",options:i},null,512),[[x,g(s).status]])])}}}),[["__scopeId","data-v-0c8a806c"]]),Y=c({__name:"index",props:{compData:{default:"base"}},setup(a,{expose:e}){const t=L(),{resetData:s}=t,r=a,l=u(),o=u(r.compData||"base"),i=[{label:"基础设置",name:"base",render:()=>_(U,null,null)},{label:"密码复杂度",name:"password",render:()=>_(H,null,null)},{label:"限制登录",name:"limit",render:()=>_(Q,null,null)}];return D((()=>{s()})),e({init:()=>{var a;const e=(null==(a=l.value)?void 0:a.getRef())||null;e&&e[o.value].init()}}),(a,e)=>{const t=n;return v(),q(t,{ref_key:"reinforceTab",ref:l,class:"w-full h-full",modelValue:g(o),"onUpdate:modelValue":e[0]||(e[0]=a=>S(o)?o.value=a:null),options:i},null,8,["modelValue"])}}});export{Y as default};
