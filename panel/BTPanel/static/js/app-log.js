import{_ as a}from"./index101.js?v=1734676359";import{G as e,aa as l,a5 as s}from"./utils-lib.js?v=1734676359";import{c as n,r as t,R as o,o as u,aB as i,k as c,l as r,e as m,x as p,J as d,z as f,p as v,M as _,ay as j}from"./base-lib.js?v=1734676359";import{ai as h,aj as b}from"./useStore3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const y={class:"p-2rem"},g=n({__name:"app-log",props:{compData:{default:()=>({service_name:"",appname:"",isInit:!1,appinfo:[]})}},setup(n){const g=n;let D=null,I=[];const V=t("run"),k=o(),{service_name:x,appname:S}=g.compData,q=(a,e)=>{try{const a=e.data;I.push(a),I.length>50?k.value=null==I?void 0:I.slice(I.length-50).join(" "):k.value=null==I?void 0:I.join(" "),(a.includes("bt_successful")||a.includes("bt_failed"))&&(null==D||D.close())}catch(l){null==D||D.close()}},H=a=>{k.value="",I=[],"run"===a?R():z()},M=()=>{"run"===V.value?R():z()},R=async()=>{e({request:h({service_name:x,app_name:S}),success:a=>{k.value=a.data.data}})},z=async()=>{if(g.compData.isInit)return D=s({route:"/sock_shell",onMessage:q}),void(null==D||D.send("tail -f "+(null==(a=g.compData.appinfo.filter((a=>"installed_log"===a.fieldKey))[0])?void 0:a.fieldValue)));var a;e({request:b({service_name:x}),success:a=>{k.value=a.data.data||""}})};return u((()=>{g.compData.isInit?(V.value="install",z()):R()})),i((()=>{null==D||D.close()})),(e,s)=>{const n=j,t=l,o=a;return c(),r("div",y,[m(t,{modelValue:v(V),"onUpdate:modelValue":s[0]||(s[0]=a=>_(V)?V.value=a:null),type:"card",onChange:H},{default:p((()=>[e.compData.isInit?f("",!0):(c(),d(n,{key:0,label:"运行日志",name:"run"})),m(n,{label:"安装日志",name:"install"})])),_:1},8,["modelValue"]),m(o,{content:v(k),isHtml:!0,fullScreen:{title:"全屏查看日志",onRefresh:M},class:"h-[46rem]"},null,8,["content","fullScreen"])])}}});export{g as default};
