import{G as e,a4 as a,aa as l,b as s,a5 as o,e as t}from"./utils-lib.js?v=1734676359";import{c as u,r as n,h as r,o as d,k as m,l as c,e as i,x as f,p,N as _,L as v,y as b,q as g,M as y,a7 as h,A as V,P as x,a4 as w,ay as k}from"./base-lib.js?v=1734676359";import{_ as j}from"./index101.js?v=1734676359";import{g as C,P as U,Y as q}from"./useStore3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const R={class:"flex flex-col p-[1.6rem] lib-box"},S={class:"rounded-default bg-[#333] h-[45.6rem]"},T={class:"rounded-default bg-[#333] h-[45.6rem]"},z=t(u({__name:"stash-pull-dialog",props:{compData:{default:()=>({})}},setup(t,{expose:u}){const{refs:{isRefreshTableList:z}}=C(),A=s();let E=null;const K=n(!1),L=n(""),M=n("common"),P=r({name:"",image:"",cmd:""}),D={model_index:"btdocker",mod_name:"image",def_name:"pull_from_some_registry",ws_callback:111,name:"",image:""},F=()=>{L.value=""},G=(e,a)=>{try{const e=a.data;if(L.value+="".concat(e),e.includes("bt_successful")||e.includes("bt_failed")){const a={status:e.includes("bt_successful"),msg:e.includes("bt_successful")?"拉取成功":"拉取失败"};A.request(a),a.status&&(z.value=!0),null==E||E.close(),K.value=!1}}catch(l){}},H=()=>{null==E||E.close(),L.value="",E=o({route:"/ws_model",onMessage:G}),null==E||E.send(D)},I=n(),N={image:[{validator:(e,a,l)=>{""===a?l(new Error("请输入镜像名")):l()},trigger:["blur"]}]},Y=n([]);d((async()=>{e({request:U(),data:Array,success:e=>{var a;e.forEach((e=>{Y.value.push({value:e.url,label:"".concat(e.name).concat("docker.io"===e.url?"":"(".concat(e.url,")")),url:e.url,name:e.name})})),P.name=null==(a=Y.value[0])?void 0:a.value}})}));const B=async()=>{try{if("cmd"===M.value)return void(async()=>{try{if(""===P.cmd)return void A.error("请输入命令");K.value=!0,D.name="",D.url="",D.image="",D.def_name="get_cmd_log",q({cmd:P.cmd},"image"),H()}catch(e){}})();if(""===P.name)return void A.error("请选择仓库名");K.value=!0,await I.value.validate((async e=>{e?(D.name=Y.value.find((e=>e.url==P.name)).name,D.url=Y.value.find((e=>e.url==P.name)).url,D.image=P.image,D.def_name="pull_from_some_registry",H()):K.value=!1}))}catch(e){}};return u({onConfirm:B,onCancel:()=>{z.value=!0}}),(e,s)=>{const o=a,t=h,u=V,n=x,r=j,d=w,C=k,U=l;return m(),c("div",R,[i(U,{modelValue:p(M),"onUpdate:modelValue":s[5]||(s[5]=e=>y(M)?M.value=e:null),type:"card",onChange:F},{default:f((()=>[i(C,{name:"common",label:"常规拉取"},{default:f((()=>[i(d,{ref_key:"cmdFormRef",ref:I,size:"default",model:p(P),rules:N,disabled:p(K),class:"relative w-full","label-position":"right",onSubmit:s[2]||(s[2]=_((()=>{}),["prevent"]))},{default:f((()=>[i(t,{prop:"name",label:"仓库名"},{default:f((()=>[i(o,{modelValue:p(P).name,"onUpdate:modelValue":s[0]||(s[0]=e=>p(P).name=e),options:p(Y),class:"!w-[32rem]"},null,8,["modelValue","options"])])),_:1}),i(t,{prop:"image",label:"镜像名"},{default:f((()=>[i(n,{class:"!w-[32rem]",modelValue:p(P).image,"onUpdate:modelValue":s[1]||(s[1]=e=>p(P).image=e),onKeydown:v(B,["enter","native"]),placeholder:"请输入镜像名，按回车拉取,如:image:v1"},{append:f((()=>[i(u,{type:"default",onClick:B},{default:f((()=>s[6]||(s[6]=[b("拉取")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),s[7]||(s[7]=g("div",{class:"resultTitle px-[.2rem] py-[.4rem] mt-[1.6rem]"},"拉取结果：",-1)),g("div",S,[i(r,{class:"h-[45.6rem] !rounded-none",content:p(L)},null,8,["content"])])])),_:1},8,["model","disabled"])])),_:1}),i(C,{name:"cmd",label:"命令拉取"},{default:f((()=>[i(d,{ref:"cmdRef",size:"large",model:p(P),rules:N,disabled:p(K),class:"relative w-full","label-position":"right",onSubmit:s[4]||(s[4]=_((()=>{}),["prevent"]))},{default:f((()=>[i(t,{prop:"cmd"},{default:f((()=>[i(n,{autofocus:"",modelValue:p(P).cmd,"onUpdate:modelValue":s[3]||(s[3]=e=>p(P).cmd=e),onKeyup:v(B,["enter","native"]),placeholder:"请输入需要执行的命令,docker pull redis:latest，按回车执行"},{append:f((()=>[i(u,{type:"default",onClick:B},{default:f((()=>s[8]||(s[8]=[b("执行命令")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),s[9]||(s[9]=g("div",{class:"resultTitle px-[.2rem] py-[.4rem] mt-[1.6rem]"},"拉取结果：",-1)),g("div",T,[i(r,{class:"h-[45.6rem] !rounded-none",content:p(L)},null,8,["content"])])])),_:1},8,["model","disabled"])])),_:1})])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-f2d3fcf3"]]);export{z as default};
