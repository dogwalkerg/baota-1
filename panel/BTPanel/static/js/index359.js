import{x as a,l as e,H as t,M as l,o as s,G as o,F as u,k as r,h as n,O as i}from"./utils-lib.js?v=1734676359";import{_ as c}from"./index90.js?v=1734676359";import{c as d,r as m,h as p,az as h,o as v,B as _,k as f,l as g,e as x,x as b,y as w,p as y,M as V,I as D,aX as j,J as C,C as E,q as P,v as k,A,ag as I,ah as L,at as S,av as M,bR as U}from"./base-lib.js?v=1734676359";import{u as q}from"./column.js?v=1734676359";import{exportUserData as R,delMysqlUser as F,getUserData as O,getMysqlCloudServer as G}from"./database.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const T={class:"break-words flex items-center justify-center w-full text-[#666]"},B={class:""},H={class:"p-20px"},z={class:"p-20px"},J=d({__name:"index",setup(d,{expose:J}){const X=m(0),K=m(!1),N=m(""),Q=m([]),W=m(!0),Y=m([]),Z=p({associatedPopup:!1,associatedData:[],associatedDataColumn:[{label:"数据库",prop:"database"},{label:"表",prop:"table"},{label:"权限",render:a=>a.access.map((a=>"".concat(a.title,"：").concat(a.access))).join("\n")}]}),$=m({resultMsg:"",resultData:"",resultStatus:!1}),aa=p({authPopup:!1,authData:[],authDataColumn:[{label:"权限",render:a=>a.map((a=>h("div","".concat(a.title,"：").concat(a.access))))}]}),ea=[{content:"说明：此处用户数据为连接mysql直接获取，未与面板数据库连接，建议仅对此处新建的用户进行操作，以防出现意外"},{content:"访问权限：localhost/127.0.0.1:仅限本机访问 %：允许任何人访问 IP地址：仅限此IP地址访问（不含本机）"},{content:"全局权限：全局权限是指对所有数据库拥有的权限 ALL PRIVILEGES即root最高权限，USAGE为普通用户，拥有指定数据库指定权限（关联数据库权限）"}],ta=a=>{e({title:"添加用户",area:60,component:()=>t((()=>import("./add-user2.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{refreshFn:()=>la(),serverList:Y},showFooter:!0})},la=async()=>{try{let a={sid:X.value};N.value&&(a.search=N.value);const e=await o({loading:W,request:O(a),data:{data:[Array,Q],status:Boolean}});return e.status?(Q.value.forEach((a=>{a.list.forEach((e=>{e.user=a.user}))})),e):(Q.value=[],l.error(e.msg||"获取用户数据失败"))}catch(a){}},sa=m([{label:"访问权限",render:a=>h("span","".concat(a.host).concat("%"==a.host?" - 所有人":"localhost"==a.host||"127.0.0.1"==a.host?" - 本地":""))},{prop:"password",label:"密码",width:50},{prop:"password_last_changed",label:"密码修改时间",width:160},q([{onClick:a=>{e({title:"数据库权限",area:80,component:()=>t((()=>import("./user-auth.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{row:a,sid:X.value,refreshEvent:la}})},title:"权限"},{onClick:({user:a,host:s})=>{if("root"===a&&"localhost"===s)return l.error("该用户不允许改密");e({title:"修改密码",area:42,compData:{username:a,host:s,sid:X.value},component:()=>t((()=>import("./user-pwd.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},title:"改密"},{onClick:async({host:a,user:e})=>{try{const t=await R({username:e,host:a,sid:X.value});$.value.resultMsg=t.data,$.value.resultStatus=!0,K.value=!0}catch(t){}},title:"导出"},{onClick:async({host:a,user:e})=>{try{await s({title:"删除用户",content:"删除用户后，该用户将无法访问数据库，是否继续操作？",icon:"warning-filled"}),await o({loading:"正在删除用户，请稍后...",request:F({username:e,host:a,sid:X.value}),message:!0,success:la})}catch(t){}},title:"删除"}])]),oa=async()=>{la(),(async()=>{var a,e;await o({loading:"正在获取服务器数据，请稍后...",request:G(),data:[Array,Y]}),Y.value=null==(a=Y.value)?void 0:a.filter((a=>""!==a.id)),X.value=null==(e=Y.value[0])?void 0:e.id})()};return v(oa),J({init:oa}),(e,t)=>{const l=A,s=I,o=L,d=u,m=r,p=S,h=M,v=U,q=n,R=c,F=i,O=_("bt-loading");return f(),g("div",null,[x(R,null,{"header-left":b((()=>[x(l,{type:"primary",onClick:ta},{default:b((()=>t[6]||(t[6]=[w("添加用户")]))),_:1})])),"header-right":b((()=>[x(o,{modelValue:y(X),"onUpdate:modelValue":t[0]||(t[0]=a=>V(X)?X.value=a:null),class:"mr-[1.5rem] !w-[16rem]",placeholder:"请选择",onChange:la},{default:b((()=>[(f(!0),g(D,null,j(y(Y),(a=>(f(),C(s,{key:a.value,label:a.ps,value:a.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),x(d,{modelValue:y(N),"onUpdate:modelValue":t[1]||(t[1]=a=>V(N)?N.value=a:null),placeholder:"请输入用户名",class:"!w-[20rem]",onSearch:la},null,8,["modelValue"])])),content:b((()=>[x(h,{data:y(Q),"max-height":"400"},{default:b((()=>[x(p,{type:"expand"},{default:b((a=>[E(x(m,{column:y(sa),data:a.row.list},null,8,["column","data"]),[[O,y(W)]])])),_:1}),x(p,{label:"用户",prop:"user"})])),_:1},8,["data"])])),popup:b((()=>[x(q,{title:"导出结果",modelValue:y(K),"onUpdate:modelValue":t[3]||(t[3]=a=>V(K)?K.value=a:null),area:38},{default:b((()=>[x(v,{icon:y($).resultStatus?"success":"error",title:y($).resultStatus?"导出成功":"导出失败"},{extra:b((()=>[P("div",T,[P("span",B,k(y($).resultMsg),1),x(l,{type:"text",onClick:t[2]||(t[2]=e=>{return t=y($).resultMsg,a({value:t});var t})},{default:b((()=>t[7]||(t[7]=[w("复制")]))),_:1})])])),_:1},8,["icon","title"])])),_:1},8,["modelValue"]),x(q,{title:"关联数据库",modelValue:y(Z).associatedPopup,"onUpdate:modelValue":t[4]||(t[4]=a=>y(Z).associatedPopup=a),area:80},{default:b((()=>[P("div",H,[x(m,{"max-height":"300",data:y(Z).associatedData,column:y(Z).associatedDataColumn,"default-sort":{prop:"user",order:"descending"}},null,8,["data","column"]),x(m,{"max-height":"300",data:y(Z).associatedData,column:y(Z).associatedDataColumn},null,8,["data","column"])])])),_:1},8,["modelValue"]),x(q,{title:"全局权限",modelValue:y(aa).authPopup,"onUpdate:modelValue":t[5]||(t[5]=a=>y(aa).authPopup=a),area:40},{default:b((()=>[P("div",z,[x(m,{"max-height":"300",data:y(aa).authData,column:y(aa).authDataColumn},null,8,["data","column"])])])),_:1},8,["modelValue"])])),_:1}),x(F,{options:ea,"list-style":"disc",class:"ml-20px mt-12px"})])}}});export{J as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
