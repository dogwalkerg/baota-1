import{cK as e,b as l,e as a,u as t,cL as s,R as i,cM as u,_ as n,j as r,F as c,k as o,E as p}from"./utils-lib.js?v=1734676359";import{c as v,r as d,B as f,k as m,l as h,q as y,C as b,e as x,p as w,M as k,L as g,x as _,y as C,F as D,P as I,A as R,R as V,i as F,Z as j,v as S,I as P,aX as E,z as T}from"./base-lib.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const A={class:"create-file-view flex"},B={class:"flex-1 flex items-center"},H=a(v({__name:"create-file",props:{type:{default:"Dir"},path:{},filelist:{}},emits:["createStatus"],setup(a,{emit:t}){const{error:s}=l(),i=t,u=a;let n=d("");const r=d(),c=async()=>{const l=r.value;if(!n.value)return void s("".concat("Dir"===u.type?"文件夹":"文件","名称不能为空"));const a=await e({type:u.type,path:u.path+"/"+n.value});a.status?o():(s(a.msg),l.$el.querySelector("input").focus())},o=()=>{u.filelist.value.shift(),i("createStatus")},p=e=>{n.value=e,/(\\|\/|\<|\>|\"|\&|\;)/g.test(e)&&(s('名称不能含有 /\\<>"&;符号'),n.value=e.replace(/(\\|\/|\<|\>|\"|\&|\;)/g,""))};return(e,l)=>{const a=I,t=R,s=f("focus");return m(),h("div",A,[y("div",{class:D(["flex","".concat("Dir"===e.type?"bt-open-dir folder-open-icon":"bt-open-dir file-text-icon")])},[l[4]||(l[4]=y("i",{class:"icon"},null,-1)),y("div",B,[b(x(a,{class:"!w-[22rem] mr-[1.6rem]",clearable:"",modelValue:w(n),"onUpdate:modelValue":l[0]||(l[0]=e=>k(n)?n.value=e:n=e),ref_key:"createfile",ref:r,onInput:p,onKeyup:l[1]||(l[1]=g((e=>e.target.blur()),["enter","native"]))},null,8,["modelValue"]),[[s]]),x(t,{type:"primary",class:"!mr-[.8rem]",onClick:c},{default:_((()=>l[2]||(l[2]=[C(" 创建 ")]))),_:1}),x(t,{type:"default",onClick:o},{default:_((()=>l[3]||(l[3]=[C("取消")]))),_:1})])],2)])}}}),[["__scopeId","data-v-b26b18e8"]]),K={class:"text-black text-1.4rem pl-[1.6rem] pt-[1.6rem]"},M={class:"p-[1.6rem] flex justify-between"},q={class:"file-selector-head"},z=["onClick"],L={class:"truncate max-w-[8rem]"},U={class:"ml-[0.4rem] flex items-align"},O={class:"ml-[1.6rem] h-[2.6rem]"},$={class:"flex h-[48rem] file-selector-main"},N={class:"w-[16rem] h-full pt-[1.2rem] text-xl inline-block overflow-auto disk-list"},X={class:"flex items-center flex-col"},Z=["onClick"],G=["title"],J={class:"h-full w-full inline-block flex w-[59rem]"},Q={class:"flex justify-between bg-[#f6f8f8] p-[1.2rem] pr-[1.6rem] rounded-md"},W={class:"ml-[9.6rem]"},Y={key:0,class:"flex align-middle items-center"},ee={class:"bg-white px-4 h-12 leading-[2.8rem] w-[30rem] inline-block border-light border-1 border-opacity-20 truncate"},le={class:"flex"},ae=a(v({__name:"index",props:{compData:{default:()=>({type:"all",path:"/www/wwwroot",change:()=>{},confirmText:"确认"})}},emits:["close"],setup(e,{expose:a,emit:v}){const D=v,I=e,{type:R,path:A,change:B}=I.compData,{error:ae,request:te}=l(),{panel:se}=t(),ie=d(),ue=d(),ne=d(0),re=d(0),ce=d(""),oe=d(),pe=d(R),ve=d(!1),de=d(!0),fe=d(!1),me=d(A||se.value.sitePath),he=d(A||se.value.sitePath),ye=V([]),be=V([]),xe=d([]),we=d(""),ke=d(),ge=d(),_e=F((()=>"file"===pe.value?"文件":"dir"===pe.value?"文件夹":"文件/文件夹"));j(ue,(e=>{const l=e[0],{width:a}=l.contentRect;ne.value=a})),j(ie,(e=>{const l=e[0],{width:a}=l.contentRect;re.value=a,re.value>ne.value&&(be.value=ye.value.slice(-4))}));const Ce=d([{label:"名称",prop:"name",showOverflowTooltip:!1,render:e=>e.create&&Se?x(H,{type:e.type,path:me.value,filelist:ge,onCreateStatus:()=>{Ee()}},null):x("span",{class:"bt-open-dir"},[x("i",{class:"svgtofont"+("dir"===e.type?"-icon-file_mode":"-file-text")},null),x("span",{onClick:l=>{"dir"===e.type&&Ke(e,l)}},[e.name])])},{label:"修改时间",width:160,prop:"mtime"},{label:"权限/所有者",width:125,prop:"accept"}]),De=({row:e,column:l,rowIndex:a,columnIndex:t})=>{if(0===a&&e.create&&Se)return[1,3]},Ie=()=>{1!==ye.value.length&&(me.value=ye.value[ye.value.length-2].path,Te())},Re=()=>{de.value=!1,he.value=me.value},Ve=()=>{de.value=!0,setTimeout((()=>{he.value=me.value}),1500)},Fe=e=>{me.value=he.value,Te(),e.preventDefault(),e.target.blur()},je=e=>{e||(e=""),we.value=e,Te(!0)};let Se=d(!1);const Pe=e=>{var l;if(Se.value)return!1;Se.value=!0,null==(l=ge.value)||l.unshift({title:"",name:"",mtime:"",accept:"",type:e,path:"",create:!0})},Ee=()=>{Se.value=!1,Te()},Te=async e=>{ve.value=!0;try{const l=await s({path:me.value,disk:!0,search:e?we.value:""});if(ke.value&&(ke.value.path=me.value,ke.value.title=me.value.split("/")[me.value.split("/").length-1]),!l.status)return ke.value=void 0,te(l),!1;const{DIR:a,FILES:t,DISK:i,PATH:u}=l.data;Ae(u),xe.value=i,ge.value=[...Be(a,"dir"),...Be(t)],Me()}catch(l){}finally{ve.value=!1}},Ae=e=>{let l="";const a=e.replace(/\/*$/,"");if(me.value=a,he.value=a,ye.value=[],""===a)return ye.value.push({title:"根目录",path:"/"}),void(be.value=ye.value);a.split("/").forEach(((e,a)=>{l+="".concat(1===a?"":"/").concat(e),ye.value.push({title:""===e&&0==a?"根目录":e,path:l})})),be.value=ye.value},Be=(e,l)=>{let a=[];return e.forEach((e=>{const t=e.split(";");let s=t[0];s.length>30&&(s=s.slice(0,30)+"..."),/[\u4E00-\u9FA5\uF900-\uFA2D]/.test(s)&&(s=s.slice(0,16)+"..."),a.push({title:t[0],name:s,mtime:i(1e3*Number(t[2]),"yyyy/MM/dd HH:mm:ss"),accept:"".concat(t[3]," / ").concat(t[4]),type:l||"file",path:me.value+"/"+t[0]})})),a},He=e=>{if(e&&!e.create){if("all"==pe.value)ke.value=e;else{if("dir"!==e.type&&"dir"===pe.value)return void ae("请选择文件夹，否则将无法选择");if("file"!==e.type&&"file"===pe.value)return;if(pe.value!==e.type)return ke.value=void 0,void u(oe.value).setCurrentRow();null!==e&&(ke.value=e)}fe.value=!0}},Ke=(e,l)=>{"dir"!==e.type||e.create||("file"===pe.value&&(fe.value=!1),me.value=e.path,Te(),l.stopPropagation&&l.stopPropagation())},Me=()=>{"file"==oe.value.type&&(ke.value=void 0,fe.value=!1),Se.value=!1};return a({onOpen:()=>(async()=>{await Te(),"file"!==pe.value&&(ke.value=ye.value[ye.value.length-1],fe.value=!0)})()}),(e,l)=>{var a;const t=n,s=r,i=c,u=o,v=p,d=f("bt-loading");return m(),h("section",null,[y("div",K,"选择"+S(w(_e)),1),y("div",M,[y("div",q,[y("i",{title:"返回上一层",class:"bt-open-icon inline-block",onClick:Ie},[x(t,{icon:"el-back",class:"leading-[2rem]"})]),y("div",{ref_key:"pathInputRef",ref:ue,class:"file-selector-input overflow-hidden"},[w(de)?(m(),h("ul",{key:0,ref_key:"pathRef",ref:ie,class:"absolute h-[30px] z-1 flex rounded-none bg-white"},[(m(!0),h(P,null,E(w(be),((e,l)=>(m(),h("li",{key:l,class:"flex items-center px-[1rem] h-[30px]",onClick:l=>{return a=e.path,void(me.value!==a&&(me.value=a,he.value=a,Te()));var a}},[y("span",L,S(e.title),1),y("i",U,[x(t,{icon:"el-arrow-right"})])],8,z)))),128))],512)):T("",!0),x(s,{class:"!w-[400px]",onFocus:Re,onBlur:Ve,onKeyup:g(Fe,["enter"]),modelValue:w(he),"onUpdate:modelValue":l[0]||(l[0]=e=>k(he)?he.value=e:null)},null,8,["modelValue"])],512),y("i",{title:"刷新",class:"bt-open-icon inline-block",onClick:l[1]||(l[1]=e=>Te())},[x(t,{icon:"el-refresh-right",class:"leading-[2rem]"})])]),x(i,{placeholder:"搜索文件/目录",class:"!w-[220px]",modelValue:w(we),"onUpdate:modelValue":l[2]||(l[2]=e=>k(we)?we.value=e:null),onClear:je,onSearch:je},null,8,["modelValue"])]),y("div",O,[y("span",{class:"create-file-btn mr-[0.8rem]",onClick:l[3]||(l[3]=e=>Pe("File"))},"新建文件"),y("span",{class:"create-file-btn",onClick:l[4]||(l[4]=e=>Pe("Dir"))},"新建文件夹")]),y("div",$,[y("div",N,[y("ul",X,[(m(!0),h(P,null,E(w(xe),((e,a)=>(m(),h("li",{class:"flex p-[0.8rem] pl-[1.6rem] items-center w-full",key:a,onClick:l=>{return a=e.path,me.value=a,void Te();var a}},[l[7]||(l[7]=y("i",{class:"file-disk-icon mr-[0.8rem] text-[14px]"},null,-1)),y("span",{class:"w-full truncate",title:"/"===e.path?"".concat("根目录"):e.path},S("/"===e.path?"根目录":e.path)+" ("+S(e.size[2])+") ",9,G)],8,Z)))),128))])]),y("div",J,[b(x(u,{ref_key:"tableRef",ref:oe,class:"file-selector-table",column:w(Ce),data:w(ge),"span-method":De,"highlight-current-row":"",border:!1,onCurrentChange:He,onRowDblclick:Ke,"empty-text":"(空)","max-height":"480"},null,8,["column","data"]),[[d,w(ve)],[d,"正在加载文件列表，请稍后...","title"]])])]),y("div",Q,[y("div",W,[w(fe)?(m(),h("div",Y,[y("span",null,"当前选中"+S(w(_e))+"：",1),y("span",ee,S(null==(a=w(ke))?void 0:a.title),1)])):T("",!0)]),y("span",le,[x(v,{type:"default",class:"BtButton--cancel",onClick:l[5]||(l[5]=e=>D("close"))},{default:_((()=>l[8]||(l[8]=[C(" 取消 ")]))),_:1}),x(v,{type:"primary",disabled:!w(fe),onClick:l[6]||(l[6]=e=>(B&&B(ke.value.path,ke.value.type),ce.value=ke.value.path,void D("close")))},{default:_((()=>[C(S(e.compData.confirmText||"确认"),1)])),_:1},8,["disabled"])])])])}}}),[["__scopeId","data-v-d1053abb"]]);export{ae as default};
