import{c as e,r as t,k as a,J as o,x as r,e as l,q as s,p as i,X as p,M as n,i as d,y as u,a7 as m}from"./base-lib.js?v=1734676359";import{D as c,a4 as h,j as g,E as y,_ as v,aO as f,bV as b}from"./utils-lib.js?v=1734676359";import{B as x}from"./index87.js?v=1734676359";import{t as w,c as _,h as j,e as k}from"./useController6.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./validator.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";import"./useStore7.js?v=1734676359";import"./site.js?v=1734676359";import"./useController3.js?v=1734676359";const T={class:"flex items-center"},V=e({__name:"index",setup(e,{expose:V}){const U=t(!1),$=t(!1),C=async()=>{F.value.proxysite="url"===F.value.targetType?"http://":""},E=e=>{if("object"==typeof e)return;if("unix"===F.value.targetType)return void(F.value.todomain="$http_host");let t=e.replace(/^http[s]?:\/\//,"");t=t.replace(/(:|\?|\/|\\)(.*)$/,""),F.value.todomain=t},{BtForm:I,submit:q,param:F}=c({data:{isEdit:!1,targetType:"url",sitename:"",cache:!1,advanced:!1,cachetime:1,proxysite:"http://",todomain:"$http_host",remark:"",port:80,domains:""},options:e=>d((()=>[{type:"custom",render:()=>l(f,{label:"域名",prop:"domains"},{default:()=>[l(x,{ref:"popover",placement:"top-start","popper-class":"green-tips-popover !p-0",title:"",width:"370",visible:U.value,"onUpdate:visible":e=>U.value=e,"trigger-keys":[],trigger:"focus"},{default:()=>l("div",{class:"!p-[12px] bg-[#20a53a] text-white"},[u("如需填写多个域名，请换行填写，每行一个域名，默认为80端口"),l("br",null,null),u("IP地址格式：192.168.1.199"),l("br",null,null),u("泛解析添加方法 *.domain.com"),l("br",null,null),u("如另加端口格式为 www.domain.com:88")]),reference:()=>l(g,{modelValue:e.value.domains,"onUpdate:modelValue":t=>e.value.domains=t,type:"textarea",width:"42rem",rows:6,resize:"none",onInput:t=>{"object"!=typeof t&&(e.value.remark=t.split("\n")[0])},onFocus:()=>U.value=!0,placeholder:"如需填写多个域名，请换行填写，每行一个域名，默认为80端口\nIP地址格式：192.168.1.199\n泛解析添加方法 *.domain.com\n如另加端口格式为 www.domain.com:88"},null)})]}),rules:{domains:[{required:!0,message:"请输入域名",trigger:"blur"},{trigger:["blur","input","change"],validator:(e,t,a)=>{const o=t.split("\n").filter((e=>e.length)),r=o.findIndex((e=>e.split(":")[0].length<3));o.map(((e,t)=>{b(e.split(":")[0])||a(new Error("当前域名格式错误，第".concat(t+1,"行，内容:").concat(e)))})),-1!==r?a(new Error("第 ".concat(r+1," 个域名长度不符合要求（必须大于3个字符）"))):a()}}]}},{type:"slots",key:"proxysite",rules:{proxysite:[{required:!0,message:"请输入目标地址",trigger:"blur"},{validator:(t,a,o)=>{if(!a)return void o(new Error("url"===e.value.targetType?"目标地址不能为空":"请选择sock文件"));if("unix"===e.value.targetType)return void o();let r=a.replace(/^http[s]?:\/\//,"");r=r.replace(/(:|\?|\/|\\)(.*)$/,""),/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(r)?e.value.todomain="$http_host":e.value.todomain=r,o()}}]}},{type:"slots",key:"todomain",rules:{todomain:[{required:!0,message:"请输入发送域名",trigger:["blur","change"]}]}},{type:"input",label:"备注",key:"remark",attrs:{placeholder:"请输入备注，可为空",width:"42rem"}},{type:"help",options:j}])),submit:k});return V({onConfirm:q}),(e,t)=>{const d=m;return a(),o(i(I),{class:"p-2rem","label-width":"100px"},{proxysite:r((()=>[l(d,{label:"目标",prop:"proxysite","label-width":"100px"},{default:r((()=>[s("div",T,[l(d,{"label-width":"50px"},{default:r((()=>[l(i(h),{modelValue:i(F).targetType,"onUpdate:modelValue":t[0]||(t[0]=e=>i(F).targetType=e),placeholder:"请选择",options:i(w),style:{width:"16rem","margin-right":"1rem"},onChange:C},null,8,["modelValue","options"])])),_:1}),l(i(g),{modelValue:i(F).proxysite,"onUpdate:modelValue":t[2]||(t[2]=e=>i(F).proxysite=e),placeholder:"url"===i(F).targetType?"请输入目标地址":"请选择sock文件",width:"24rem",iconType:"url"!==i(F).targetType&&"folder",onInput:E},p({_:2},["url"!==i(F).targetType?{name:"append",fn:r((()=>[l(i(y),{onClick:t[1]||(t[1]=e=>i(_)(i(F).proxysite))},{default:r((()=>[l(i(v),{icon:"el-folder-opened",class:"cursor-pointer"})])),_:1})])),key:"0"}:void 0]),1032,["modelValue","placeholder","iconType"])])])),_:1})])),todomain:r((()=>[l(d,{label:"发送域名(host)",prop:"todomain","label-width":"100px"},{default:r((()=>[l(i(x),{placement:"top-start",effect:"dark",title:"",content:"请求转发到后端服务器时的主机名，一般为$http_host，如果目标URL是域名，则需要改为域名",width:"400",visible:i($),"onUpdate:visible":t[5]||(t[5]=e=>n($)?$.value=e:null),"trigger-keys":[],trigger:"focus"},{reference:r((()=>[l(i(g),{onFocus:t[3]||(t[3]=e=>$.value=!0),modelValue:i(F).todomain,"onUpdate:modelValue":t[4]||(t[4]=e=>i(F).todomain=e),placeholder:"请输入发送域名",width:"42rem"},null,8,["modelValue"])])),_:1},8,["visible"])])),_:1})])),_:1})}}});export{V as default};
