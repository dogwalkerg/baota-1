import{g as a,r as e,h as t,c as s,s as n,B as l,C as u,p as r,k as o,l as i,e as d,q as v,y as m,M as c,aj as g}from"./base-lib.js?v=1734676359";import{_ as p}from"./index91.js?v=1734676359";import{bR as _,l as b,H as y,G as f,bm as h,K as S,dc as E,bn as k,M as w}from"./utils-lib.js?v=1734676359";const C=a("SOFT-STATUS-STOP-ALERT",(()=>{const a=e({}),s=e(!1),n=e(!1),l=e(),u=e(""),r=a=>{if(l.value){const{number_rule:a,task_data:e,sender:t,status:s}=l.value;Object.assign(v,{count:e.count||1,interval:e.interval||600,day_num:a.day_num,sender:t,status:s})}a.hasOwnProperty("onStatus")&&(v.status=a.onStatus),b({title:"状态停止告警设置",area:50,component:()=>y((()=>import("./config2.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),btn:!0,onCancel:()=>{a.onCancel&&a.onCancel()},onConfirm:c})},o=async()=>{await f({loading:s,request:S(),data:{data:Array,status:Boolean,msg:String},success:a=>{var e;a.status&&(l.value=a.data.find((a=>a.keyword===u.value)),n.value=(null==(e=l.value)?void 0:e.status)||!1)}})},i=e(),d=e(),v=t({status:!0,count:1,interval:100,day_num:3,sender:[]}),m=t({interval:[_({message:"请输入间隔时间"}),{validator:(a,e,t)=>{e<60&&!Number.isInteger(parseFloat(e))?t(new Error("间隔时间范围应为大于60的正整数")):t()},trigger:["blur","change"]}],day_num:[_({message:"请输入发送次数"}),{validator:(a,e,t)=>{e<0&&!Number.isInteger(parseFloat(e))?t(new Error("发送次数范围应为大于等于0的正整数")):t()},trigger:["blur","change"]}],sender:[_({message:"请选择告警方式"})]}),c=async e=>{var t;await i.value.validate();const s=(()=>{var a,e,t;const{status:s,count:n,interval:r,sender:o,day_num:i}=v,d={task_data:{type:"services",project:u.value,status:s,tid:"5",cycle:0,count:Number(n),interval:Number(r),title:"服务停止告警"},sender:o,number_rule:{day_num:Number(i),total:0},time_rule:{time_range:[0,86399],send_interval:0}};return{template_id:null==(a=l.value)?void 0:a.template_id,status:s?1:0,task_data:JSON.stringify(d),task_id:(null==(e=l.value)?void 0:e.id)||void 0,title:null==(t=l.value)?void 0:t.title}})();await f({loading:"正在设置状态，请稍后...",request:(null==(t=l.value)?void 0:t.template_id)?E(s):k({...s,template_id:"5"}),message:!0,success:t=>{t.status&&(g(a.value),e.unmount())}})},g=e=>{e&&(a.value=e),u.value=a.value.name,"mysqld"===a.value.name&&(u.value="mysql"),o()};return{isLoading:s,status:n,currentInfo:l,openPopupEvent:r,changeStatusEvent:async a=>{var e;a?r({onCancel:()=>{n.value=!a},onStatus:a}):await f({loading:"正在设置状态，请稍后...",request:h({status:0,task_id:null==(e=l.value)?void 0:e.id}),message:!0,success:async e=>{e.status||(n.value=!a),e.status&&(l.value.status=Boolean(n),v.status=Boolean(n))}})},alertFormRef:i,alarmRef:d,alertForm:v,rules:m,countOptions:[{label:"自动尝试重启项目",value:1},{label:"不做重启尝试",value:2}],alarmRefreshEvent:async()=>{var a;await(null==(a=d.value)?void 0:a.refresh()),w.success("刷新成功")},getPushData:o,init:g}})),j={class:"flex items-center"},O=s({__name:"index",setup(a){const e=C(),{isLoading:t,status:s,currentInfo:_}=n(e),{openPopupEvent:b,changeStatusEvent:y,getPushData:f}=e;return(a,e)=>{const n=p,_=g,f=l("bt-loading");return u((o(),i("div",null,[d(n,{direction:"horizontal"}),v("span",j,[e[2]||(e[2]=m("状态停止时提醒我： ")),d(_,{modelValue:r(s),"onUpdate:modelValue":e[0]||(e[0]=a=>c(s)?s.value=a:null),class:"mx-8px",onChange:r(y)},null,8,["modelValue","onChange"]),v("span",{class:"bt-link",onClick:e[1]||(e[1]=(...a)=>r(b)&&r(b)(...a))},"告警设置")])])),[[f,r(t)]])}}});export{C as S,O as _};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
