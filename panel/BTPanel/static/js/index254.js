import{s as e,g as a,r as t,i as s,h as l,n as u,c as n,o,a1 as i,k as r,l as d,e as c,x as m,F as p,p as v,M as f,I as y,J as h,z as _,G as b,b0 as g,a7 as D,a4 as F}from"./base-lib.js?v=1734676359";import{ay as w}from"./validator.js?v=1734676359";import{R as k,G as V,U as M,e as j}from"./utils-lib.js?v=1734676359";import{F as I,u as T,n as C,p as P}from"./useStore5.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./column.js?v=1734676359";const x=a("FTP_PWD_VALIDITY_PERIOD",(()=>{const a=I(),{rowData:n}=e(a),o=t(),i=t(),r=t(!1),d=t();s((()=>n.value.id));const c=s((()=>n.value.end_time)),m=l({disabledDate:e=>e.getTime()<Date.now(),shortcuts:[{text:"永久",value:()=>{(new Date).setTime(0),p.value=0,d.value=0,u((()=>{A()}))}}]}),p=t(k(new Date,"yyyy-MM-dd")),v=t({status:"1",channel:[]}),f=s((()=>p.value===k(new Date,"yyyy-MM-dd")?"0"===c.value:0==Number(d.value)||p.value===k(new Date,"yyyy-MM-dd")));return{pickerRef:o,rowData:n,updateFtpInfo:i,ftpForm:v,isTime:f,pickerOptions:m,datePicker:p,isChange:r,selectValue:d}})),R=()=>e(x()),{rowData:S,isRefreshFtpList:Y}=T(),{updateFtpInfo:q,ftpForm:N,datePicker:O,isChange:U,selectValue:z}=R(),G=[{label:"仅发送通知",value:"1"},{label:"停用当前FTP账号",value:"2"},{label:"自动修改FTP密码并发送",value:"3"},{label:"不触发",value:"0"}],J={channel:[{required:!0,message:"请选择告警方式",trigger:"blur"}]},L=e=>{U.value=!0,z.value=e},A=()=>{const e=document.querySelector(".date .el-input__inner");e&&(e.value="永久")},B=async()=>{N.value.channel=N.value.channel.filter((e=>""!==e)),await q.value.validate();const e={id:JSON.stringify([S.value.id]),end_time:!U.value&&!Number(S.value.end_time)||0==z.value?0:new Date(O.value).getTime()/1e3,push_action:N.value.status,channel:N.value.channel.join(",")},a=await V({loading:"正在设置到期密码配置，请稍候...",request:C(e),data:{status:Boolean},message:!0});return Y.value=!0,a.status},E=async()=>{await(async(e={id:S.value.id})=>{const a=await V({loading:"正在设置到期密码配置，请稍候...",request:P(e),data:{channel:String,push_action:String}});N.value.channel=""===a.channel?[]:a.channel.split(","),N.value.status=a.push_action})(),"0"===S.value.end_time?A():O.value=k(Number(S.value.end_time),"yyyy-MM-dd")},H=()=>{S.value={},N.value={status:"1",channel:[]}},W={class:"container-dialog"},K=j(n({__name:"index",setup(e,{expose:a}){const{updateFtpInfo:t,ftpForm:s,isTime:l,pickerOptions:u,datePicker:n,pickerRef:k}=R();return a({onConfirm:B}),o(E),i(H),(e,a)=>{const o=g,i=D,V=M,j=w,I=F;return r(),d("div",W,[c(I,{ref_key:"updateFtpInfo",ref:t,rules:v(J),model:v(s),class:p(v(l)?"btCustomForm":"btCustomForm bt-custom-form1"),style:b("0"==v(s).status||v(l)?"":"padding-left: 1rem")},{default:m((()=>[c(i,{label:"密码有效期",class:p(v(l)?"typeClass":"")},{default:m((()=>[c(o,{ref_key:"pickerRef",ref:k,modelValue:v(n),"onUpdate:modelValue":a[0]||(a[0]=e=>f(n)?n.value=e:null),type:"date",class:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD","disabled-date":v(u).disabledDate,shortcuts:v(u).shortcuts,onChange:v(L)},null,8,["modelValue","disabled-date","shortcuts","onChange"])])),_:1},8,["class"]),v(l)?_("",!0):(r(),d(y,{key:0},[c(i,{label:"到期动作"},{default:m((()=>[c(V,{modelValue:v(s).status,"onUpdate:modelValue":a[1]||(a[1]=e=>v(s).status=e),options:v(G),size:"small",style:{gap:"0.8rem"}},null,8,["modelValue","options"])])),_:1}),"0"!==v(s).status?(r(),h(i,{key:0,label:"告警方式",prop:"channel"},{default:m((()=>[c(j,{modelValue:v(s).channel,"onUpdate:modelValue":a[2]||(a[2]=e=>v(s).channel=e),class:"!w-[22rem]"},null,8,["modelValue"])])),_:1})):_("",!0)],64))])),_:1},8,["rules","model","class","style"])])}}}),[["__scopeId","data-v-83ef19c6"]]);export{K as default};
