import{r as a,u as t,l as e,H as s,af as r,p as o,G as i,ah as n,J as l,a6 as m,M as c}from"./utils-lib.js?v=1734676359";import{checkModuleServerConnection as p,checkServerConnection as _,syncDataToServer as u,syncModuleDataToServer as d,setDbTypes as v,getMysqlCloudServer as y,getModulesCloudServer as b,getSoftStatus as f,backDatabase as g,backModuleDatabase as E}from"./database.js?v=1734676359";import{s as h,g as D,i as T,r as w,az as O}from"./base-lib.js?v=1734676359";import{a as j,j as A,c as P}from"./column.js?v=1734676359";import{h as L,c as R}from"./validator.js?v=1734676359";const S=D("DATABASE-STORE1",{state:()=>({tabActive:T((()=>a.currentRoute.value.name)),isRefreshTable:!1,isLoading:!1,isHaveServer:!0,isSearchClick:!1,safetyStatus:!1,envStatus:{setup:!1,status:!1,version:""},softData:{}}),getters:{},actions:{refreshTableList(a=!0){this.isRefreshTable=!0,this.isLoading=a},resetRefresh(){this.isRefreshTable=!1,this.isLoading=!1},async getGlobalConfig(){const{getGlobalInfo:a}=t();await a()}},persist:[{storage:localStorage,paths:["tabActive"]}]}),q=()=>{const a=S();return{refs:h(a),...a}},{refs:{tabActive:I,envStatus:x,isRefreshTable:V}}=q(),k=w([]),C=async a=>{try{o(a)&&(a=0);return await i({request:"mysql"!==I.value?p({data:JSON.stringify({sid:a})},I.value):_({sid:a}),data:{status:Boolean,msg:String,db_status:Boolean,err_msg:String}})}catch(t){return n(t,"useCheckServerConnection"),{status:!1,err_msg:"error",msg:"检查出错啦！"}}},F=async a=>{try{const{data:t}=await f({name:a});return x.value=t,t||{setup:!1,version:"",status:!1}}catch(t){return n(t,"useCheckSoftStatus"),{setup:!1,version:"",status:!1}}},M=T((()=>({mysql:["支持MySQL5.5、MariaDB10.1及以上版本","注意3：通过宝塔安装的数据库root默认不支持远程权限"],redis:["支持redis-4.0+版本","注意3：通过宝塔安装的redis默认不支持远程权限"],sqlserver:["","注意3：通过宝塔安装的sqlserver默认不支持远程权限"],mongodb:["支持Mongodb-4.0及以上版本","注意3：通过宝塔安装的Mongodb默认不支持远程权限"],pgsql:["支持Postgresql-9.6+版本","注意3：通过宝塔安装的Postgresql默认不支持远程权限"]}[I.value]||[]))),J=a=>[j(),{label:"数据库名",prop:"name",width:160,sortable:!0},{label:"用户名",prop:"username",minWidth:100,sortable:!0},A({event:a})],N=(a,t)=>{let e="本地数据库";return{label:"数据库位置",minWidth:90,render:s=>(null==a||a.forEach((a=>{a.id===s.sid&&(e="mysql"===t?a.db_host:a.ps,"127.0.0.1"===a.db_host&&(e="本地数据库"))})),O("span",e))}},B=()=>{e({title:"远程数据库",area:86,component:()=>s((()=>import("./index164.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},G=a=>{e({title:"数据库工具箱-【".concat(a.name,"】"),area:86,compData:a,component:()=>s((()=>import("./index165.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},H=a=>{e({title:"设置数据库【".concat(a.name,"】密码"),area:53,showFooter:!0,compData:a,component:()=>s((()=>import("./index166.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},z=a=>e({area:60,compData:a,component:()=>s((()=>import("./index167.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)}),W=async(a,t)=>{if("import"===t)return await e({title:"导入本地备份",area:84,compData:a,component:()=>s((()=>import("./import-back.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)});e({title:"数据库【".concat(a.name,"】备份"),area:92,compData:{row:a,type:t},component:()=>s((()=>import("./index168.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},Q=(a="",t)=>{e({title:"修改root密码",area:40,compData:{rootPwd:a,refresh:t},showFooter:!0,component:()=>s((()=>import("./index169.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},K=a=>{let t=[];t=l(a)?a.map((a=>a.id)):[a.id],e({title:"删除数据库",area:76,showFooter:!0,compData:{ids:t,isMult:l(a)},confirmBtnType:"danger",component:()=>s((()=>import("./index170.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},U=(a,t)=>{e({title:"上传文件到",area:80,compData:{refreshEvent:a,path:m(t)?t:""},component:()=>s((()=>import("./index171.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},X=(a,t)=>{e({title:"批量".concat(t.title,"结果"),area:42,component:()=>s((()=>import("./index102.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{resultData:a,resultTitle:t.title||"操作"}})},Y=(a,t="single",r)=>{m(t)||(t="single"),e({title:"设置数据库权限",area:42,component:()=>s((()=>import("./index172.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),compData:{type:t,rowData:a,batchConfirm:r},showFooter:!0})},Z=async a=>{try{let t=[],e=0;a&&(t=[a.id],e=1);return"mysql"===I.value?await u({ids:JSON.stringify(t)},e):await d({data:JSON.stringify({type:e,ids:JSON.stringify(t)})},I.value)}catch(t){n(t,"syncDatabaseEvent")}},$=async a=>{const t=c.load("正在备份，请稍后...");try{return"mysql"===I.value?await g(a):await E({data:JSON.stringify(a)},I.value)}catch(e){n(e,"backDatabaseEvent")}finally{t.close()}},aa=async(a,t,e,s)=>{const{refreshTableList:r}=q(),{label:o,value:i}=s,n=async(a,t)=>{const e=new Map([["sync",Z],["back",$]]).get(i);if(e)return await e(a)};await a({title:"批量".concat(o),content:"批量".concat(o,"已选数据库，是否继续操作！"),column:[{prop:"name",label:"数据库名"},P()],onConfirm:async()=>(await t(n),r(),!1)})},ta=(a,t,r)=>{const o={mysql:()=>s((()=>import("./index173.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),redis:()=>s((()=>import("./index121.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),sqlserver:()=>s((()=>import("./index174.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),mongodb:()=>s((()=>import("./index175.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),pgsql:()=>s((()=>import("./index176.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)};e({title:"添加"+I.value+"数据库",area:"redis"===I.value?44:56,compData:{refresh:()=>a(),sid:t,keyId:r},showFooter:!0,component:o[I.value]})},ea=a=>[{label:"同步数据库",value:"sync",event:aa},{label:"备份数据库",value:"back",event:aa},{label:"删除数据库",value:"delete",event:(a,t,e)=>K(e.value)}],sa={alioss:"阿里云OSS",ftp:"FTP",sftp:"SFTP",msonedrive:"微软OneDrive",qiniu:"七牛云",txcos:"腾讯COS",upyun:"又拍云",jdcloud:"京东云",aws_s3:"亚马逊存储","Google Cloud":"谷歌云","Google Drive":"谷歌网盘",bos:"百度云",obs:"华为云"},ra=async a=>{if(!a)return;const{data:t}=await r({sName:a});L({name:t.name,type:"i",pluginInfo:t})},oa=()=>{e({title:"PHPMyAdmin",area:80,component:()=>s((()=>import("./index152.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},ia=async(a,t,e,s)=>{await R({name:"数据库分类",options:e.value,selectList:a.value,request:async(e,s)=>{const r=a.value.map((a=>a.name)).join(",");await i({loading:"正在批量设置FTP分类，请稍后...",request:v({id:e.id,database_names:r,db_type:I.value}),message:!0,success:a=>{}}),t(),V.value=!0,s()}})},na=async()=>await i({loading:"正在获取数据中，请稍后...",request:"mysql"===I.value?y():b({data:JSON.stringify({type:I.value})},I.value),data:Array});export{S as A,ta as a,B as b,oa as c,Y as d,ea as e,Q as f,q as g,J as h,N as i,G as j,H as k,K as l,k as m,W as n,X as o,C as p,Z as q,na as r,ia as s,ra as t,F as u,$ as v,M as w,z as x,U as y,sa as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
