import{G as e,o as a,j as t,c as l,k as s,h as r,b as o,a5 as n,X as i}from"./utils-lib.js?v=1734676359";import{c as p,r as u,o as m,aB as d,B as _,k as c,l as v,e as j,x as y,q as g,p as f,y as x,C as b,J as w,M as h,R as C,ag as S,ah as z,A as V,w as k,W as M}from"./base-lib.js?v=1734676359";import{g as J}from"./index55.js?v=1734676359";import{u as L,S as T}from"./useStore7.js?v=1734676359";import{_ as U,a as q,b as H}from"./traditional-project.vue_vue_type_script_setup_true_lang.js?v=1734676359";import{_ as N}from"./index.vue_vue_type_style_index_0_lang2.js?v=1734676359";import{_ as O}from"./index.vue_vue_type_script_setup_true_lang14.js?v=1734676359";import{_ as I}from"./index.vue_vue_type_script_setup_true_lang12.js?v=1734676359";import{_ as A}from"./index.vue_vue_type_script_setup_true_lang15.js?v=1734676359";import{_ as B}from"./index.vue_vue_type_script_setup_true_lang16.js?v=1734676359";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang17.js?v=1734676359";import{_ as F}from"./index.vue_vue_type_script_setup_true_lang18.js?v=1734676359";import G from"./index408.js?v=1734676359";import{_ as R}from"./index.vue_vue_type_script_setup_true_lang19.js?v=1734676359";import{_ as W}from"./index90.js?v=1734676359";import{u as X}from"./column.js?v=1734676359";import{getNodeModules as E,installPackages as K,installModule as P,upgradeModule as Q,uninstallModule as Y}from"./site.js?v=1734676359";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang20.js?v=1734676359";import{_ as $}from"./index.vue_vue_type_script_setup_true_lang21.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index116.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";import"./useController3.js?v=1734676359";import"./index124.js?v=1734676359";import"./index107.js?v=1734676359";import"./index.vue_vue_type_script_setup_true_lang13.js?v=1734676359";import"./index88.js?v=1734676359";import"./index185.js?v=1734676359";import"./ace.js?v=1734676359";import"./index353.js?v=1734676359";import"./form-item.js?v=1734676359";import"./useStore11.js?v=1734676359";import"./useController8.js?v=1734676359";import"./useController9.js?v=1734676359";import"./useController10.js?v=1734676359";import"./useController7.js?v=1734676359";import"./useStore9.js?v=1734676359";import"./useMethod5.js?v=1734676359";import"./useStore10.js?v=1734676359";import"./useController11.js?v=1734676359";import"./index101.js?v=1734676359";import"./useController12.js?v=1734676359";import"./useController4.js?v=1734676359";import"./useStore8.js?v=1734676359";import"./index276.js?v=1734676359";import"./index277.js?v=1734676359";import"./useStore6.js?v=1734676359";const ee={class:"flex items-center"},ae={class:"flex items-center justify-center text-[12px]"},te={class:"bg-[#333] p-[12px] h-[36rem] text-white overflow-auto"},le=["innerHTML"],se=p({__name:"index",props:{compData:{default:{}}},setup(i,{expose:p}){const{siteInfo:k}=L(),M=o(),J=u(!1),T=u([]),U=u(!1),q=u({mod_name:"",type:"yarn"}),H=u(),N=u("正在请求安装..."),O=async()=>{await e({loading:U,request:E({data:JSON.stringify({project_name:k.value.name,project_cwd:k.value.project_cwd})}),data:[Array,T]})},I=async(t,l)=>{var s,r,o;const{name:n}=k.value,{mod_name:i,type:p}=q.value;if(""===i&&"install"===l)return void M.error("请输入模块名称");"install"!==l&&await a({width:38,title:"".concat("update"===l?"更新":"卸载","模块【").concat(null==t?void 0:t.name,"】"),content:"".concat("update"===l?"更新":"卸载","模块后，可能影响项目正常运行，请谨慎操作，是否继续操作？"),type:"calc"});const u={install:{data:JSON.stringify({project_name:n,mod_name:i,pkg_manager:p})},update:{data:JSON.stringify({project_name:n,mod_name:null==t?void 0:t.name,type:p})},uninstall:{data:JSON.stringify({project_name:n,mod_name:null==t?void 0:t.name})}},m=new Map([["install",P],["update",Q],["uninstall",Y]]).get(l),d=u[l],_=await e({loading:"正在操作,请稍后...",request:m(d)});(null==(s=null==_?void 0:_.data)?void 0:s.status)?(q.value.mod_name="",O(),M.success(null==(r=null==_?void 0:_.data)?void 0:r.data)):M.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:null==(o=null==_?void 0:_.data)?void 0:o.error_msg,type:"error",duration:0,showClose:!0})};let A=null;const B=(e,a)=>{const t=a.data;N.value+="\n"+t,t.includes("Done")&&(null==A||A.close())},D=async()=>{try{N.value="";const e=K({data:JSON.stringify({project_name:k.value.name})});A=n({route:"/sock_shell",onMessage:B}),null==A||A.send({"x-http-token":window.vite_public_request_token}),null==A||A.send("tail -f /www/server/panel/logs/npm-exec.log"),J.value=!0,H.value=await e;let{data:a}=await e;a.status||(M.request({status:a.status,msg:a.data||a.msg}),null==A||A.close()),M.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:H.value.data.data,type:H.value.status?"success":"error"})}catch(e){}},F=C([{label:"模块名称",prop:"name"},{label:"版本",prop:"version"},{label:"协议",prop:"license"},{label:"描述",prop:"description"},X([{onClick:e=>{I(e,"update")},title:"更新"},{onClick:e=>{I(e,"uninstall")},title:"卸载"}])]);return m(O),p({init:O}),d((()=>{null==A||A.close()})),(e,a)=>{const o=S,n=z,i=t,p=V,u=l,m=s,d=r,C=W,k=_("bt-loading"),M=_("scroll-bottom");return c(),v("div",null,[j(C,null,{"header-left":y((()=>[g("div",ee,[j(n,{modelValue:f(q).type,"onUpdate:modelValue":a[0]||(a[0]=e=>f(q).type=e),class:"!w-[10rem]"},{default:y((()=>[j(o,{label:"yarn",value:"yarn"}),j(o,{label:"pnpm",value:"pnpm"}),j(o,{label:"npm",value:"npm"})])),_:1},8,["modelValue"]),j(i,{class:"ml-4px !w-[24rem]",modelValue:f(q).mod_name,"onUpdate:modelValue":a[1]||(a[1]=e=>f(q).mod_name=e),placeholder:"模块名称"},null,8,["modelValue"]),j(p,{type:"primary",class:"ml-1.4rem",onClick:a[2]||(a[2]=e=>I(null,"install"))},{default:y((()=>a[4]||(a[4]=[x("安装模块")]))),_:1})])])),"header-right":y((()=>[j(p,{type:"primary",onClick:D},{default:y((()=>a[5]||(a[5]=[x("一键安装项目模块")]))),_:1})])),content:y((()=>[b((c(),w(m,{"max-height":"620",column:f(F),data:f(T)},{empty:y((()=>[g("div",ae,[a[7]||(a[7]=x(" 未安装模块,点击 ")),j(u,{onClick:D},{default:y((()=>a[6]||(a[6]=[x("一键安装项目模块")]))),_:1})])])),_:1},8,["column","data"])),[[k,f(U)]])])),popup:y((()=>[j(d,{title:"正在安装模块,请稍后...",modelValue:f(J),"onUpdate:modelValue":a[3]||(a[3]=e=>h(J)?J.value=e:null),area:[50,36]},{default:y((()=>[b((c(),v("div",te,[g("pre",{class:"whitespace-pre-line",innerHTML:f(N)},null,8,le)])),[[M]])])),_:1},8,["modelValue"])])),_:1})])}}}),re=p({__name:"index",setup(e){const{siteInfo:a,settingTabActive:t,isJump:l}=L(),{resetTab:s}=T(),r=u(t.value||"project"),o=u(a.value),n=[{label:"项目配置",name:"project",lazy:!0,render:()=>{const e={node:U,pm2:q,general:H};return e[o.value.project_config.project_type]||e.node}},{label:"域名管理",name:"domain",lazy:!0,render:N},{label:"外网映射",name:"mapping",lazy:!0,render:O},{label:"流量限制",name:"limit",lazy:!0,render:I},{label:"伪静态",name:"pseudo",lazy:!0,render:A},{label:"配置文件",name:"configFile",lazy:!0,render:B},{label:"SSL",name:"ssl",lazy:!0,render:D},{label:"重定向",name:"redirect",render:F},{label:"负载状态",name:"load",lazy:!0,render:G},{label:"服务状态",name:"state",lazy:!0,render:R},{label:"模块管理",name:"modules",lazy:!0,render:se},{label:"项目日志",name:"projectLogs",lazy:!0,render:Z},{label:"网站日志",name:"siteLogs",lazy:!0,render:$}],{BtTabs:p}=i({type:"left-bg-card",value:r,options:n});k((()=>l.value),(e=>{e&&(r.value=t.value,s())}));const d=u({});return M("nodeData",d),m((async()=>{if("general"===o.value.project_config.project_type){const e=n.findIndex((e=>"modules"===e.name));n.splice(e,1)}if("pm2"===o.value.project_config.project_type){const e=n.findIndex((e=>"load"===e.name));n.splice(e,1)}d.value=await J()})),(e,a)=>(c(),w(f(p),{type:"left-bg-card",modelValue:f(r),"onUpdate:modelValue":a[0]||(a[0]=e=>h(r)?r.value=e:null),options:n},null,8,["modelValue"]))}});export{re as default};
