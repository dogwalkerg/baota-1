import{_ as a}from"./index90.js?v=1734676359";import{u as e,R as t,o as s,G as l,M as o,k as n,h as i,e as c}from"./utils-lib.js?v=1734676359";import{_ as r}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1734676359";import{_ as d}from"./index97.js?v=1734676359";import{c as u,r as p,h as m,e as _,az as g,aN as f,y as v,o as b,B as y,k as x,l as h,x as w,C as j,p as k,M as z,q as M,I as C,aX as D,v as q,F as O,z as H,A as N}from"./base-lib.js?v=1734676359";import{u as R}from"./column.js?v=1734676359";import{a6 as T,a7 as U,a8 as V}from"./config.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";const I={class:"p-[2rem]"},J={class:"p-[2rem]"},L={class:"item"},S={key:0,class:"border border-[#ececec] rounded-[0.4rem] max-h-[20rem] overflow-y-auto"},A={class:"w-[50%]"},B={class:"w-[50%] truncate"},F={key:1,class:"box"},G={class:"item"},X=["innerHTML"],E=c(u({__name:"record",props:{compData:{default:()=>{}}},setup(c){const u=c,{push:E}=e(),K=p({}),P=p(!1),Q=p([]),W=p(!1),Y=p([]),Z=m({page:1,size:10,total:0}),$=async a=>{try{await s({title:"清空记录【".concat(u.compData.title,"】"),content:"您真的要清空【".concat(u.compData.title,"】的所有告警记录吗？")}),await l({loading:"正在清空记录，请稍后...",request:T({task_id:u.compData.id,record_ids:JSON.stringify([a.id])}),message:!0}),aa()}catch(e){}},aa=async()=>{try{await l({loading:W,request:V({task_id:u.compData.id,page:Z.page,size:Z.size}),success:({data:a})=>{Y.value=a.data.list,Z.total=a.data.count}})}catch(a){}},ea=[{label:"发送时间",render:a=>_("span",null,[t(a.create_time)])},{label:"发送状态",render:a=>{let e=a.result.stop_msg;if(a.do_send){const t=Object.values(a.result.send_data).reduce(((a,e)=>("number"==typeof e&&1===e?a.success++:"string"==typeof e&&a.fail++,a)),{success:0,fail:0});e="发送成功"+t.success+"次，发送失败"+t.fail+"次"}return g(f,{popperClass:"softTooltip",effect:"light",enterable:!1,placement:"top-end",content:e},(()=>g("span",{class:a.do_send?"text-primary":"text-danger"},a.do_send?"已发送":"未发送")))}},{label:"告警详情",render:a=>_("span",{class:"bt-link",onClick:()=>(a=>{K.value=a;let e=o.load("正在获取告警详情，请稍后...");try{const e=new Map([["wx_account","微信公众号"],["feishu","飞书"],["mail","邮箱"],["sms","短信通知"],["dingding","钉钉"],["weixin","企业微信"],["webhook","自定义消息通道"]]),t=Object.entries(a.result.send_data).map((a=>{const t=a.at(0),s=E.value.config.find((a=>a.id===t));return{result:1===a.at(1),resultMsg:1===a.at(1)?"发送成功":a.at(1),accounts:{title:e.get(s.sender_type)||"",account:s.data.title||""}}}));Q.value=t,P.value=!0}catch(t){}finally{e.close()}})(a)},[v("点击查看")])},R([{onClick:async a=>{try{await s({title:"删除记录",content:"您真的要删除这条告警记录吗？"}),await l({loading:"正在删除记录，请稍后...",request:U({task_id:u.compData.id,record_ids:JSON.stringify([a.id])}),message:!0}),aa()}catch(e){}},title:"删除"}])];return b((()=>aa())),(e,t)=>{const s=N,l=n,o=d,c=r,u=i,p=a,m=y("bt-loading");return x(),h("div",I,[_(p,null,{"header-left":w((()=>[_(s,{onClick:$},{default:w((()=>t[3]||(t[3]=[v("清空记录")]))),_:1})])),content:w((()=>[j(_(l,{ref:"alarmRecordRef",column:ea,data:k(Y),description:"记录为空","max-height":"42rem"},null,8,["data"]),[[m,k(W)],[m,"正在获取告警记录，请稍候...","title"]])])),"footer-right":w((()=>[_(o,{total:k(Z).total,page:k(Z).page,"onUpdate:page":t[0]||(t[0]=a=>k(Z).page=a),row:k(Z).size,"onUpdate:row":t[1]||(t[1]=a=>k(Z).size=a),onChange:aa},null,8,["total","page","row"])])),popup:w((()=>[_(u,{modelValue:k(P),"onUpdate:modelValue":t[2]||(t[2]=a=>z(P)?P.value=a:null),area:48,title:"告警详情"},{default:w((()=>[M("div",J,[M("div",L,[t[5]||(t[5]=M("div",{class:"title"},"发送情况",-1)),k(Q).length>0?(x(),h("div",S,[t[4]||(t[4]=M("div",{class:"table-box"},[M("span",{class:"w-[50%]"},"发送账号"),M("span",{class:"w-[50%]"},"发送结果")],-1)),(x(!0),h(C,null,D(k(Q),((a,e)=>(x(),h("div",{class:"table-box",key:e},[M("span",A,q("".concat(a.accounts.account,"(").concat(a.accounts.title,")")),1),M("span",B,[_(c,{class:O(a.result?"text-primary":"text-danger"),text:a.resultMsg},null,8,["class","text"])])])))),128))])):H("",!0),0==k(Q).length?(x(),h("div",F,q(k(K).result.stop_msg),1)):H("",!0)]),M("div",G,[t[6]||(t[6]=M("div",{class:"title"},"告警信息",-1)),M("div",{class:"box",innerHTML:k(K).send_data.msg_list.join("<br>")},null,8,X)])])])),_:1},8,["modelValue"])])),_:1})])}}}),[["__scopeId","data-v-ea336051"]]);export{E as default};
