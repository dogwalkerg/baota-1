import{_ as e}from"./index100.js?v=1734676359";import{_ as t}from"./index90.js?v=1734676359";import{_ as a}from"./index97.js?v=1734676359";import{l as s,H as r,G as o,S as i,o as n,a9 as l,R as c,u,F as d,k as p,V as m}from"./utils-lib.js?v=1734676359";import{B as g}from"./index107.js?v=1734676359";import{_}from"./index91.js?v=1734676359";import{g as y,s as h,r as w,h as b,R as v,i as f,az as x,c as C,o as k,a1 as D,B as E,k as T,l as S,p as j,J as O,x as R,q,e as A,y as H,C as L,A as N}from"./base-lib.js?v=1734676359";import{q as V,t as I,u as M,v as P,w as F,x as B,y as U,z as $,A as J,B as z,C as G,D as W,E as K,F as Q,G as X,H as Y,I as Z,p as ee}from"./useMethod2.js?v=1734676359";import{a as te,b as ae,u as se,c as re}from"./column.js?v=1734676359";import{c as oe}from"./validator.js?v=1734676359";import{C as ie}from"./useStore2.js?v=1734676359";const ne=y("CRONTAB-SCHEDULE-STORE",(()=>{const e=ie(),{logCompData:t}=h(e),a=w(null),u=w([]),d=w(!1),p=w(0),m=b({p:1,rows:20,search:"",order_param:"",type_id:"all"}),g=w({}),_=w([]),y=w([]),C=async()=>{const e={...m,type_id:"all"===m.type_id?"":m.type_id};await o({loading:d,request:I(e),data:{data:[Array,u],page:i(p)}})},k=async({trigger_id:e,name:t})=>{await n({title:"执行脚本",icon:"warning-filled",content:"立即执行【".concat(t,"】中的脚本任务，执行过程可能等待时间较长，请耐心等待。是否继续？")});const{data:a}=await o({loading:"正在执行脚本，请稍后...",request:M({trigger_id:e})}),s="string"==typeof a.msg?a.msg:a.msg.join("\n");P({msg:s})},D=e=>{g.value=e,s({title:"查看事件",area:66,component:()=>r((()=>import("./index109.js?v=1734676359").then((e=>e.i))),__vite__mapDeps([]),import.meta.url)})},E=e=>{t.value={request:F,data:{trigger_id:e.trigger_id}},s({title:"执行日志",area:86,component:()=>r((()=>import("./index110.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},T=async({trigger_id:e})=>{await n({title:"删除任务",icon:"warning-filled",content:"删除后不再执行任务规则,是否继续操作？"}),await o({loading:"正在删除任务，请稍后...",request:B({trigger_id:e}),message:!0,success:C})},S=async e=>{xe(),g.value=e,await(async()=>_.value=await Y())(),s({title:e?"编辑任务":"添加任务",area:65,component:()=>r((()=>import("./index111.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),showFooter:!0})},j=async({trigger_id:e,status:t},a)=>{const s=0===t?"停用":"启用";await n({title:"".concat(1===t?"停用":"启用","任务"),icon:"warning-filled",content:"该任务已".concat(s,"，是否要").concat(1===t?"停用":"启用","这个任务？")}),await o({loading:"正在修改任务状态，请稍后...",request:Z({trigger_id:e,status:null!=a?a:Number(!t)}),message:!0,success:C})},O=async()=>(await o({loading:"正在获取分类，请稍后...",request:U(),data:{msg:Array},success:e=>{y.value=e.msg.map((e=>({label:e.name,value:e.id}))),y.value.unshift({label:"默认分类",value:"0"}),y.value.unshift({label:"全部分类",value:"all"})}}),Promise.resolve(y.value||[]));let R=v([]);const q={getClassList:O,addClass:$,editClass:J,deleteClass:z},A=async(e,t,a,s)=>{const{label:r,value:o}=s,i=async(e,t)=>{const{trigger_id:a}=e;switch(o){case"start":case"stop":const e="start"===o?1:0;return await Z({trigger_id:a,status:e});case"delete":return await B({trigger_id:a})}};await e({title:"批量".concat(r),content:"即将批量".concat(r,"，是否继续操作！"),column:[{label:"任务名",prop:"name"},re()],onConfirm:async()=>(await t(i),C(),!1)})},H=[{label:"开启任务",value:"start",event:A},{label:"停止任务",value:"stop",event:A},{label:"设置分类",value:"setClass",event:async(e,t,a,s,r)=>await oe({name:"设置任务编排分类",options:y.value.filter((e=>"0"!==e.value)),selectList:a.value,request:async(e,t)=>{const s=JSON.stringify(a.value.map((e=>e.trigger_id)));await o({loading:"正在批量设置分类，请稍后...",request:G({id:e.id,trigger_ids:s}),message:!0}),r(),t(),C()}})},{label:"删除任务",value:"delete",event:A}],L=w(!1),N=w([]),ee=async()=>{await o({loading:L,request:W(),data:[Array,N]}),ne()},ne=()=>{const e=document.querySelector(".groupSortTable .el-table__body-wrapper tbody");l.create(e,{animation:500,onEnd:async e=>{const t=N.value.splice(e.oldIndex,1)[0];N.value.splice(e.newIndex,0,t);const a=N.value.map((e=>e.trigger_id));await o({loading:"正在保存排序，请稍后...",request:K({order_list:JSON.stringify(a)}),message:!0}),ee(),C()}})};let le=v([]);const ce=b({name:"",on:"script",script_id:"",ps:"",args:"",script_body:"",crontab_expression:"",exec_count:1,start_time:V()}),ue=b({type:"day",week:1,where1:"1",hour:1,minute:30}),de=w(),pe=w(),me=w(),ge=b({is_args:"",args_holder:"",args_title:""}),_e={name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],args:[{required:!0,message:"请输入参数",trigger:"blur"}],script_id:[{validator:(e,t,a)=>{"script"===ce.on&&""===t?a(new Error("请选择脚本")):a()},trigger:["change"]}],exec_count:[{validator:(e,t,a)=>{!/^[0-9]\d*$/.test(t)||t<0?a(new Error("请输入大于等于0的整数")):a()},trigger:["change"]}],crontab_expression:[{validator:(e,t,a)=>{"custom"===ue.type&&""===t?a(new Error("请输入crontab表达式")):a()},trigger:["change"]}]},ye=f((()=>"custom"===ue.type?[{content:"设置了开始时间后，任务将在该时间点之后才开始执行"},{content:"执行次数为0表示不限次数，每次修改执行次数后，计数将重新开始。"},{content:"只支持标准的crontab表达式，不支持设置年份字段"}]:[{content:"设置了开始时间后，任务将在该时间点之后才开始执行"},{content:"执行次数为0表示不限次数，每次修改执行次数后，计数将重新开始。"}])),he=w(),we=w(0);let be=v([{type:"day",text:"每天",showDay:!1,showHour:!0,showMinute:!0},{type:"day-n",text:"N天",showDay:!0,showHour:!0,showMinute:!0},{type:"hour",text:"每小时",showDay:!1,showHour:!1,showMinute:!0},{type:"hour-n",text:"N小时",showDay:!1,showHour:!0,showMinute:!0},{type:"minute-n",text:"N分钟",showDay:!1,showHour:!1,showMinute:!0},{type:"week",text:"每周",showDay:!1,showHour:!0,showMinute:!0},{type:"month",text:"每月",showDay:!0,showHour:!0,showMinute:!0},{type:"custom",text:"自定义",showDay:!1,showHour:!1,showMinute:!1}]);const ve=b({where1:[{validator:(e,t,a)=>{"day-n"!==ue.type&&"month"!==ue.type||(Number.parseInt(t)>31||Number.parseInt(t)<1||!Number.isInteger(parseFloat(t))?a(new Error("请输入1-31的整数")):""===t&&a(new Error("请输入天数")),a()),a()},trigger:["blur","change"]}],hour:[{validator:(e,t,a)=>{"minute-n"!==ue.type&&"hour"!==ue.type&&"second-n"!==ue.type||a(),t>23||t<0||!t?a(new Error("请输入0-23的整数")):"hour-n"===ue.type&&0===t&&a(new Error("小时不能为0")),a()},trigger:["blur","change"]}],minute:[{validator:(e,t,a)=>{t>59||t<0||!t?a(new Error("请输入0-59的整数")):"minute-n"===ue.type&&(t<1||!t)&&a(new Error("请输入1-59的整数")),a()},trigger:["blur","change"]}]}),fe=(e,t=!1)=>{ue.type=e,we.value=be.value.findIndex((t=>t.type===e)),"minute-n"===ue.type&&(ue.where1=ue.minute),"hour-n"===ue.type&&(ue.where1=ue.hour)},xe=()=>{g.value={},ue.type="day",ue.where1="1",ue.hour=1,ue.minute=30,Object.assign(ce,{name:"",on:"script",script_id:"",ps:"",args:"",script_body:"",crontab_expression:"",exec_count:1,start_time:V()}),Object.assign(ge,{is_args:"",args_holder:"",args_title:""})};return{taskScheduleRef:a,tableColumns:R,tableData:u,tableLoad:d,total:p,tableParam:m,scriptData:_,classOption:y,productData:{title:"任务编排-功能介绍",ps:"脚本库含有：服务管理、进程监控、告警通知、负载监控、网站监控等常用脚本任务，可以实现自动化的脚本定时执行、服务器状态监控和任务追踪功能。",source:22,desc:["脚本定时执行","监控服务器状态","任务追踪"],tabImgs:[{title:"概览",imgSrc:"https://www.bt.cn/Public/new/plugin/introduce/crontab/crontab_trigger.png"}]},TableBatchOptions:H,sortChange:({column:e,prop:t,order:a})=>{m.order_param=a?t+("ascending"===a?" asc":" desc"):"",C()},taskSortEvent:()=>{s({title:"任务排序",area:42,component:()=>r((()=>import("./index108.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})},getClassOption:q,getTaskList:C,getTriggerTypes:O,executionEvent:k,openAddTaskView:S,openEventView:D,openLogEvent:E,deleteTaskEvent:T,$reset:()=>{u.value=[],m.p=1,m.search="",m.select="all",p.value=0,_.value=[],y.value=[],R.value=[]},init:()=>{C(),O(),R.value=[te(),{label:"任务名称",prop:"name",sortable:"custom"},ae({sortable:"custom",event:j,data:["停用","正常"],minWidth:50}),{label:"执行周期",render:e=>{let t=e.crontab_expression;if("custom"!==e.cycle_type){let a={day:"天，"+e.cycle_hour+"点"+e.cycle_minute+"分",week:"周"+e.cycle_where+"，"+e.cycle_hour+"点"+e.cycle_minute+"分",month:"月，"+e.cycle_where+"日，"+e.cycle_hour+"点"+e.cycle_minute+"分",hour:"小时，第"+e.cycle_minute+"分钟","minute-n":"隔"+e.cycle_minute+"分钟","hour-n":e.cycle_hour+"小时，第"+e.cycle_minute+"分钟","day-n":"隔"+e.cycle_where+"天，"+e.cycle_hour+"点"+e.cycle_minute+"分"};t=a[e.cycle_type]?["每"+a[e.cycle_type]+" 执行"]:""}return x("span",t)}},{label:"备注",prop:"ps"},{label:"创建时间",sortable:"custom",render:e=>c(e.create_time),prop:"create_time"},{label:"上次执行时间",prop:"last_exec_time",sortable:"custom",render:e=>e.last_exec_time?c(e.last_exec_time):""},se([{title:"执行",onClick:k},{title:"事件",onClick:D},{title:"编辑",onClick:S},{title:"日志",onClick:E},{title:"删除",onClick:T}])]},allTableData:N,allLoading:L,sortColumn:le,getSortTableData:ee,$reset_sort:()=>{N.value=[],L.value=!1,le.value=[]},initSort:()=>{ee(),le.value=[{label:"任务名称",prop:"name"},se([{render:()=>x("i",{class:"svgtofont-icon-drag cursor-move mover align-middle",props:{title:"拖拽排序"}})}],{fixed:!1})]},rowData:g,taskArrangementRef:me,scriptCascaderRef:pe,alertFormRef:de,rules:_e,helpList:ye,disabledDate:e=>e.getTime()<Date.now()-864e5,propsData:{label:"name",value:"script_id",children:"script_list"},taskForm:ce,timeForm:ue,argsForm:ge,changeScript:e=>{let t=pe.value.getCheckedNodes()[0].data;1===t.is_args?(ge.is_args=!0,ge.args_holder=t.args_ps,ge.args_title=t.args_title):ge.is_args=!1},changeScriptType:e=>{"0"===e&&(ce.script_body="",ge.is_args=!1),ce.script_id="",ce.args=""},$reset_add_task:xe,initAddTask:()=>{if(g.value){const{args_ps:e,args_title:t}=g.value.script_info,{name:a,ps:s,script_id:r,args:o,script_body:i,crontab_expression:n,start_time:l,exec_count:u,cycle_type:d,cycle_hour:p,cycle_minute:m,cycle_where:_}=g.value;let y=0==l?"":c(Number(l),"yyyy-MM-dd HH:mm:ss");Object.assign(ce,{name:a,ps:s,args:o,script_id:r,script_body:i,on:"0"===r||0===r||""==r?"0":"script",crontab_expression:n,start_time:y,exec_count:u||0}),Object.assign(ue,{type:d,hour:p,minute:m,week:"week"===d?Number(_):1,where1:_}),fe(d),g.value.args&&""===i?Object.assign(ge,{is_args:!0,args_holder:e,args_title:t}):ge.is_args=!1}},onConfirm:async e=>{try{await me.value.validate(),await de.value.formDataRef.validate();const t="script"===ce.on,{type:a,hour:s,minute:r,week:i,where1:n}=ue;let l={...ce,cycle_type:a,cycle_hour:s,cycle_minute:r,cycle_where:"week"===a?i:["day-n","month"].includes(a)?n:"",operator_where:[],start_time:ce.start_time?Date.parse(ce.start_time)/1e3:"",script_id:t?ce.script_id[1]:"",script_body:t?"":ce.script_body};delete l.on;const c=g.value;c&&(l.trigger_id=g.value.trigger_id,l.script_id=t?l.script_id||g.value.script_id:"");o({loading:"正在添加任务，请稍后...",request:(c?Q:X)({data:JSON.stringify(l)}),message:!0,success:t=>{t.status&&(e(),C())}})}catch(t){}},timeRule:ve,formDataRef:he,timeType:be,cycleTime:we,handleTypeChange:fe}})),le={class:"flex items-center"},ce={class:"flex items-center"},ue={class:"ml-1rem"},de=C({__name:"index",setup(s){const{payment:r,mainHeight:o}=u(),i=ne(),{tableColumns:n,taskScheduleRef:l,tableData:c,tableLoad:y,total:w,tableParam:b,classOption:v}=h(i),{TableBatchOptions:f,getClassOption:x,productData:C,sortChange:V,taskSortEvent:I,getTaskList:M,openAddTaskView:P,init:F,$reset:B}=i;return k(F),D(B),(s,i)=>{const u=N,h=_,k=g,D=d,F=p,B=m,U=a,$=t,J=e,z=E("bt-loading");return T(),S("div",null,["ltd"===j(r).authType?(T(),O($,{key:0},{"header-left":R((()=>[q("div",le,[A(u,{onClick:i[0]||(i[0]=e=>j(P)()),type:"primary"},{default:R((()=>i[6]||(i[6]=[H("创建任务")]))),_:1}),A(h,{direction:"vertical",class:"!mx-1.2rem"}),A(u,{type:"default",onClick:j(I)},{default:R((()=>i[7]||(i[7]=[H("任务排序")]))),_:1},8,["onClick"]),q("div",{class:"flex items-center ml-4px",onClick:i[1]||(i[1]=e=>j(ee)())},i[8]||(i[8]=[q("i",{class:"svgtofont-desired text-[1.6rem]"},null,-1),q("span",{class:"bt-link"},"需求反馈",-1)]))])])),"header-right":R((()=>[q("div",ce,[A(k,{name:"Crontab",class:"!w-[16rem]",modelValue:j(b).type_id,"onUpdate:modelValue":i[2]||(i[2]=e=>j(b).type_id=e),options:j(v),field:"name",config:j(x),onChange:j(M),ignore:["0"]},null,8,["modelValue","options","config","onChange"]),q("div",ue,[A(D,{modelValue:j(b).search,"onUpdate:modelValue":i[3]||(i[3]=e=>j(b).search=e),onSearch:j(M),class:"!w-[32rem]",placeholder:"请输入任务名称"},null,8,["modelValue","onSearch"])])])])),content:R((()=>[L(A(F,{ref_key:"taskScheduleRef",ref:l,"max-height":j(o)-220,onSortChange:j(V),column:j(n),data:j(c)},null,8,["max-height","onSortChange","column","data"]),[[z,j(y)],[z,"正在加载中，请稍后...","title"]])])),"footer-left":R((()=>[A(B,{"table-ref":j(l),options:j(f)},null,8,["table-ref","options"])])),"footer-right":R((()=>[A(U,{total:j(w),page:j(b).p,"onUpdate:page":i[4]||(i[4]=e=>j(b).p=e),row:j(b).rows,"onUpdate:row":i[5]||(i[5]=e=>j(b).rows=e),onChange:j(M)},null,8,["total","page","row","onChange"])])),_:1})):(T(),O(J,{key:1,data:j(C),class:"px-[20%] my-[8rem]"},null,8,["data"]))])}}}),pe=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"}));export{ne as C,pe as i};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
