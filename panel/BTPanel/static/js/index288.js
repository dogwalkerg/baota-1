import{G as a,h as e,b as l}from"./utils-lib.js?v=1734676359";import{c as s,r as t,o,k as i,l as u,q as n,y as r,e as m,x as d,I as p,aX as c,p as f,J as v,M as x,v as y,ag as _,ah as b,aY as w,A as j}from"./base-lib.js?v=1734676359";import{B as V}from"./index185.js?v=1734676359";import{c as g}from"./useController3.js?v=1734676359";import{S as h}from"./useStore7.js?v=1734676359";import{getRewriteLists as k,setRewriteLists as C}from"./site.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./ace.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const D={class:"p-2rem"},S={class:"flex items-center"},U={class:"relative h-full"},J={class:"p-20px"},q={class:"overflow-auto h-[12rem] border border-[#efefef] p-12px"},H={class:"absolute bottom-0 w-full bg-[#f6f8f8] flex items-center justify-end p-12px"},N=s({__name:"index",props:{compData:{default:()=>{}}},emits:["close"],setup(s,{expose:N,emit:O}){const{getFileEvent:P}=h(),A=l(),B=s,E=O,F=t(""),G=t(!1),I=t([]),M=t([]),X=t(),Y=t(),z=async a=>{await L(a),Y.value=""},K=async a=>{await L(a),X.value=""},L=async a=>{try{const{data:e}=await P({path:a});F.value=e.data}catch(e){}},Q=async()=>{const e={sites:JSON.stringify(B.compData.map((a=>{const e=I.value.find((e=>e.id===a.id));return{id:a.id,name:a.name,file:e.file}}))),rewrite_data:F.value};a({loading:"正在部署，请稍后...",request:C(e),success:a=>{g({resultData:a.data,title:"批量部署伪静态"}),G.value=!1,E("close")}})};return N({onConfirm:()=>{X.value||Y.value?G.value=!0:A.error("请选择一种伪静态规则")}}),o((async()=>{await(async()=>{try{const a=await k({site_ids:JSON.stringify(B.compData.map((a=>a.id))),site_type:"PHP"});I.value=a.data.site_rewrites,M.value=a.data.template_rewrites}catch(a){}})()})),(a,l)=>{const s=_,t=b,o=w,g=V,h=j,k=e;return i(),u("div",D,[n("div",S,[l[5]||(l[5]=r(" 站点已有伪静态规则： ")),m(t,{class:"mx-12px !w-16rem",modelValue:f(X),"onUpdate:modelValue":l[0]||(l[0]=a=>x(X)?X.value=a:null),onChange:z},{default:d((()=>[(i(!0),u(p,null,c(f(I),(a=>(i(),v(s,{key:a.id,label:a.name+"站点的伪静态配置",value:a.file},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),l[6]||(l[6]=r(" 模板伪静态规则： ")),m(t,{class:"mx-12px !w-16rem",modelValue:f(Y),"onUpdate:modelValue":l[1]||(l[1]=a=>x(Y)?Y.value=a:null),onChange:K},{default:d((()=>[(i(!0),u(p,null,c(f(M),(a=>(i(),v(s,{key:a.id,label:a.name+"模板的伪静态配置",value:a.file},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])]),m(o),m(g,{modelValue:f(F),"onUpdate:modelValue":l[2]||(l[2]=a=>x(F)?F.value=a:null),class:"!h-[42rem]"},null,8,["modelValue"]),m(k,{title:"部署当前伪静态",modelValue:f(G),"onUpdate:modelValue":l[4]||(l[4]=a=>x(G)?G.value=a:null),area:[52,28]},{default:d((()=>[n("div",U,[n("div",J,[l[7]||(l[7]=n("span",{class:"!mb-4px inline-block"},"如下是需要批量部署证书的站点：",-1)),n("div",q,[(i(!0),u(p,null,c(a.compData,((a,e)=>(i(),u("div",{key:e,class:"p-4px w-full"},y(a.name),1)))),128))]),l[8]||(l[8]=n("div",{class:"text-danger mt-4px"},"注意：批量设置站点伪静态后，原有站点伪静态配置将被覆盖。",-1))]),n("div",H,[m(h,{type:"warning",onClick:l[3]||(l[3]=a=>G.value=!1)},{default:d((()=>l[9]||(l[9]=[r("取消")]))),_:1}),m(h,{type:"primary",onClick:Q},{default:d((()=>[r("部署("+y(a.compData.length)+"项)",1)])),_:1})])])])),_:1},8,["modelValue"])])}}});export{N as default};
