import{dm as s,R as a,ah as t,d as e,c as r,a5 as o,e as c}from"./utils-lib.js?v=1734676359";import{c as l,r as i,h as n,i as d,o as u,B as p,C as g,p as f,k as m,l as v,q as y,F as _,J as w,I as k,e as h,y as b,v as S,z as x,x as E,aX as T,b7 as C,A as j}from"./base-lib.js?v=1734676359";import{T as O}from"./firewall.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";const J={id:"safeDetectList"},A={class:"progress-header"},D={class:"progress-header-cot"},I={key:0,class:"relative"},M={class:"absolute top-[1.6rem] left-[2.6rem] flex flex-col"},N={class:"progress-header-cot"},H={class:"scanning-progress-title"},q={class:"color-org"},z={class:"color-red"},B={class:"scanning-progress-cont"},F={class:"progress-header-cot"},L={class:"progress-cont-list"},P=["onClick"],R={class:"progress_type"},X={class:"progress_status"},G={key:0,class:"text-danger"},K={key:1,class:"text-warning"},Q={key:1},U={key:2,class:"text-[#666]"},V={key:0},W={class:"progress_fold"},Y={class:"progress_item_body"},Z={class:"info_cont"},$={class:"info_cont_desc"},ss=c(l({__name:"index",setup(c){const l=i(!1),ss=[{color:"#888",text:"未安装"},{color:"#666",text:"良好"},{color:"#e6a23c",text:"警告"},{color:"red",text:"危险"}],as={system_account:"系统账户",sshd_service:"SSHD远程服务",file_mode:"重要文件权限及属性",software:"重点软件检测",website_permissions:"网站权限检测",other:"其他项目检测",backdoor:"后门检测",proc:"恶意进程",history:"历史命令",log:"日志排查",rootkit:"rootkit检测"},ts={scanStatus:!1,isEnd:!1,error:0,warn:0,time:0,progress:0,progressColor:"#20a53a",progressConfig:{system_account:[],sshd_service:[],file_mode:[],software:[],website_permissions:[],other:[],backdoor:[],proc:[],history:[],log:[],rootkit:[]},statusTotal:{},allArr:[],result:{},progressStatus:{},active:{system_account:!1,sshd_service:!1,file_mode:!1,software:!1,website_permissions:!1,other:!1,backdoor:!1,proc:!1,history:!1,log:!1,rootkit:!1}},es=i({}),rs=n({...ts}),os=s=>s+" 分";let cs=null;const ls=d((()=>rs.scanStatus&&!rs.isEnd?"正在扫描":es.value.status?"上次检测时间 "+("刚刚"===s(es.value.msg.time)?"一分钟内":s(es.value.msg.time)):"当前未进行安全检测")),is=i(""),ns=i(""),ds=d((()=>rs.scanStatus&&!rs.isEnd?"正在扫描-".concat(is.value):rs.isEnd?"检测时间："+a(rs.time/1e3,"yyyy-MM-dd"):es.value.status?"若长时间未检测，服务器可能存在安全风险，建议立即检测":"当前安全风险未知，请立即检测")),us=(s,a)=>{if(a.data){const s=JSON.parse(a.data.replace(/'/g,'"'));s.hasOwnProperty("callback")?(null==cs||cs.close(),rs.scanStatus=!1,rs.isEnd=!0,rs.time=(new Date).getTime()):(is.value=s.name,ns.value=s.topic,rs.progress=parseInt(s.progress),rs.progressConfig[s.topic].push(s),rs.statusTotal[s.topic]=ps(rs.progressConfig[s.topic]),rs.allArr.push(s),3===s.status?rs.error++:2===s.status&&rs.warn++,1!==s.status&&(rs.progressColor="#fc6d26"))}},ps=s=>{const a={};return s.forEach((s=>{a[s.status]?a[s.status]++:a[s.status]=1})),a},gs=()=>{if(rs.scanStatus&&!rs.isEnd||rs.isEnd,rs.scanStatus&&!rs.isEnd)return null==cs||cs.close(),void fs();rs.isEnd&&fs(),rs.scanStatus=!0,cs=o({route:"/ws_project",onMessage:us}),null==cs||cs.send({mod_name:"safe_detect",def_name:"get_safe_scan",ws_callback:""})},fs=()=>{Object.assign(rs,JSON.parse(JSON.stringify(ts)))};return u((()=>{(async()=>{try{const s=await O();es.value=s.data}catch(s){t(s)}})()})),(s,a)=>{var t,o;const c=e,i=C,n=j,d=r,u=p("bt-loading");return g((m(),v("div",J,[y("div",A,[y("div",D,[y("div",{class:_("progresscirclebar "+(f(es).status?"security ":"")+"text-["+(100===(null==(t=f(es).msg)?void 0:t.security_count)?" #20a53a ":" #fc6d26 ")+"]")},[f(es).status?(m(),v(k,{key:1},[f(rs).scanStatus&&!f(rs).isEnd?(m(),v("div",I,[h(i,{class:"animate-spin",type:"circle",percentage:70,"show-text":!1,"stroke-width":4,"define-back-color":"#fff",color:f(rs).warn||f(rs).error?"#fc6d26":"#20a53a",width:100},null,8,["color"]),y("div",M,[h(c,{class:"w-[full] px-[.4rem]",src:"/firewall/icon-safe-detect".concat(f(rs).warn||f(rs).error?"-org":"",".svg")},null,8,["src"]),a[0]||(a[0]=y("span",{class:"text-[1.2rem] font-bold py-[.4rem] leading-none"}," 安全检测 ",-1))])])):(m(),w(i,{key:1,type:"circle",percentage:null==(o=f(es).msg)?void 0:o.security_count,format:os,color:f(rs).warn||f(rs).error?"#fc6d26":"#20a53a",width:100},null,8,["percentage","color"]))],64)):(m(),w(c,{key:0,class:"w-[10rem]",src:"/firewall/icon-safe-detect.svg"}))],2)]),y("div",N,[y("div",H,[f(rs).isEnd?(m(),v(k,{key:1},[a[5]||(a[5]=b(" 检测已完成 ")),f(rs).error>0||f(rs).warn>0?(m(),v(k,{key:0},[a[4]||(a[4]=b(" ，一共发现 ")),f(rs).warn>0?(m(),v(k,{key:0},[y("span",q,S(f(rs).warn),1),a[1]||(a[1]=b(" 项风险项 "))],64)):x("",!0),f(rs).error>0?(m(),v(k,{key:1},[a[2]||(a[2]=b(" （包含 ")),y("span",z,S(f(rs).error),1),a[3]||(a[3]=b(" 项危险项，请立即处理） "))],64)):x("",!0)],64)):x("",!0)],64)):(m(),v(k,{key:0},[b(S(f(ls)),1)],64))]),f(rs).scanStatus?(m(),w(i,{key:0,percentage:f(rs).progress,color:f(rs).warn||f(rs).error?"#fc6d26":"#20a53a","stroke-width":10},null,8,["percentage","color"])):x("",!0),y("div",B,S(f(ds)),1)]),y("div",F,[h(n,{type:f(rs).scanStatus&&!f(rs).isEnd?"warning":"primary",onClick:gs,plain:!(!f(rs).scanStatus||f(rs).isEnd)},{default:E((()=>[b(S(f(rs).scanStatus&&!f(rs).isEnd?"取消扫描":f(rs).isEnd?"重新检测":"立即检测"),1)])),_:1},8,["type","plain"]),h(d,{class:"!absolute -bottom-[2.5rem] right-[1.4rem]",href:"https://www.bt.cn/bbs/thread-126643-1-1.html"},{default:E((()=>a[6]||(a[6]=[b(" 需求反馈>> ")]))),_:1})])]),y("div",L,[(m(),v(k,null,T(as,((s,a)=>y("div",{key:a,class:_([a+"_item "+(f(rs).active[a]?"active":""),"progress_item"])},[y("div",{class:"progress_item_header",onClick:s=>(s=>{rs.active[s]=!rs.active[s]})(a)},[y("div",R,[h(c,{class:"title-icon",src:"/firewall/icon-"+a+".svg"},null,8,["src"]),y("span",null,S(s),1)]),y("div",X,[f(rs).statusTotal[a]?(m(),v(k,{key:0},[f(rs).statusTotal[a][3]||f(rs).statusTotal[a][2]?(m(),v(k,{key:0},[f(rs).statusTotal[a][3]?(m(),v("span",G," 发现"+S(f(rs).statusTotal[a][3])+"项危险 ",1)):x("",!0),f(rs).statusTotal[a][2]?(m(),v("span",K,S((f(rs).statusTotal[a][3]?"":"发现")+f(rs).statusTotal[a][2])+"项警告 ",1)):x("",!0)],64)):f(rs).scanStatus&&f(ns)==a?(m(),v("span",Q," 正在扫描... ")):(m(),v("span",U,"无风险项"))],64)):(m(),v(k,{key:1},[f(rs).scanStatus&&!f(rs).statusTotal[a]?(m(),v("span",V," 等待扫描 ")):x("",!0)],64))]),y("div",W,[h(c,{src:"/firewall/arrow-down.svg"})])],8,P),y("div",Y,[f(rs).progressConfig[a]&&f(rs).progressConfig[a].length?(m(!0),v(k,{key:0},T(f(rs).progressConfig[a],((s,a)=>(m(),v("div",{key:a,class:_([s.info?"active":"","progress_item_info"])},[y("div",Z,[y("div",null,S(s.name.replace("分析网站","")),1),y("div",{class:_("text-["+ss[s.status<0?0:s.status].color+"]")},S(ss[s.status<0?0:s.status].text),3)]),y("div",$,S(s.info||""),1)],2)))),128)):x("",!0)])],2))),64))])])),[[u,f(l)]])}}}),[["__scopeId","data-v-73f8e457"]]);export{ss as default};
