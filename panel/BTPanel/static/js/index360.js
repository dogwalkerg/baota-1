import{G as e,o as a,M as l,a5 as s,j as t,k as n,h as o,af as d}from"./utils-lib.js?v=1734676359";import{c as u,r as i,h as r,o as c,a1 as m,B as p,k as _,l as v,p as b,J as f,z as x,q as h,y,e as w,x as g,I as j,aX as k,C as V,D as C,M as q,ag as U,ah as A,A as O}from"./base-lib.js?v=1734676359";import{_ as M}from"./index116.js?v=1734676359";import{getIndexList as z,delIndexList as D,getSphinxDatabase as J,getMysqlCloudServer as N}from"./database.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";import"./column.js?v=1734676359";import"./index.vue_vue_type_style_index_0_scoped_03ce946a_lang.js?v=1734676359";const S={class:"h-full"},B={class:"flex items-center flex-col w-full"},E={class:"border border-[#dcdfe6] p-20px flex items-center w-full"},G={class:"flex flex-col w-full"},H={class:"w-full flex items-center"},I={class:"flex items-center mt-12px justify-between"},T={class:"flex items-center w-full"},X={class:"flex justify-center items-center"},F={class:"svgtofont-el-loading animate-spin text-[1.4rem]"},K={class:"p-20px"},L=u({__name:"index",props:{compData:{default:()=>{}}},setup(u,{expose:L}){const P=i({}),Q=i([]),R=i([]),W=i(!1),Y=i(!1),Z=i(),$=i(),ee=i([{label:"数据列"}]),ae=i(!1),le=r({sid:0,model_index:"project",mod_name:"sphinx_search",def_name:"sphinx_search",ws_callback:"1",p:1,db_name:"",tb_name:"",search:""}),se=[{label:"数据库名称",prop:"db_name"},{label:"表名称",prop:"tb_name"},{label:"端口号",prop:"search_port"},{label:"索引时间",prop:"create_index"},{label:"索引大小",prop:"size"},{label:"操作",render:function(e){return w("span",{onClick:()=>oe(e),class:"bt-link"},[y("删除")])}}],te=i([]),ne=async a=>{Y.value=!0;try{await e({loading:"正在获取索引记录, 请稍后...",request:z({sid:le.sid}),data:{data:[Array,te]}})}catch(l){}},oe=async({db_name:l,tb_name:s})=>{try{await a({title:"删除索引记录",content:"删除索引记录后，该索引记录将永久消失，是否继续操作？",icon:"warning-filled"}),await e({loading:"正在删除索引记录, 请稍后...",request:D({sid:le.sid,db_name:l,tb_name:s}),message:!0,success:z})}catch(t){}},de=e=>{const a=Z.value.find((a=>a.name===e)).table_list;$.value=a,le.tb_name=a.length?a[0].value:""},ue=async()=>{var a,l,s,t;try{await e({loading:"正在获取服务器数据，请稍后...",request:J({sid:le.sid}),data:{data:[Array,Z]}}),le.db_name=null==(a=Z.value[0])?void 0:a.name,$.value=null==(l=Z.value[0])?void 0:l.table_list,le.tb_name=null==(t=null==(s=Z.value[0])?void 0:s.table_list[0])?void 0:t.value}catch(n){}},ie=async()=>{if(!le.db_name||!le.tb_name)return l.error("请选择数据库和表");ae.value=!0,W.value=!1,ce(),R.value=[],null==re||re.send(le)};let re=null;const ce=()=>{re=s({route:"/ws_model",onMessage:me})},me=(e,a)=>{if("token error"===a.data)return l.error("token error"),null==re||re.close(),void(ae.value=!1);const s=JSON.parse(a.data);if(!1===s.status)return l.error(s.msg),ae.value=!1,void(null==re||re.close());if(1===s.type&&(ee.value=s.data.field_list.map((e=>({label:e,prop:e,showOverflowTooltip:!0})))),2===s.type){const e={},a={};ee.value.forEach((a=>e[a.prop]=""));for(let l=0;l<s.data.length;l++){const t=s.data[l];a[Object.keys(e)[l]]=t}R.value.push(a)}Object.keys(s).includes("result")&&(null==re||re.close(),ae.value=!1,l.success("搜索完成"))},pe=async()=>{await(async()=>{try{const e=await d({sName:"sphinx"});P.value=e.data}catch(e){}})(),P.value.setup&&(await ue(),(async()=>{var a;await e({loading:"正在获取服务器数据，请稍后...",request:N(),data:[Array,Q]}),le.sid=null==(a=Q.value[0])?void 0:a.id})())};return c(pe),m((()=>{null==re||re.close(),re=null})),L({init:pe}),(e,a)=>{const l=M,s=U,d=A,u=t,i=O,r=n,c=o,m=p("bt-loading");return _(),v("div",S,[b(P).setup?x("",!0):(_(),f(l,{key:0,options:{name:"sphinx",title:"Sphinx"}})),h("div",B,[h("div",E,[h("div",G,[h("div",H,[a[5]||(a[5]=y(" 服务器")),w(d,{onChange:ue,class:"!w-[14rem] mx-8px",modelValue:b(le).sid,"onUpdate:modelValue":a[0]||(a[0]=e=>b(le).sid=e)},{default:g((()=>[(_(!0),v(j,null,k(b(Q),((e,a)=>(_(),f(s,{key:a,value:e.id,label:e.db_host},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),a[6]||(a[6]=y(" 数据库 ")),w(d,{onChange:de,class:"!w-[14rem] mx-8px",modelValue:b(le).db_name,"onUpdate:modelValue":a[1]||(a[1]=e=>b(le).db_name=e)},{default:g((()=>[(_(!0),v(j,null,k(b(Z),((e,a)=>(_(),f(s,{key:a,value:e.name,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),a[7]||(a[7]=y(" 数据库表")),w(d,{class:"mx-8px !w-[14rem]",modelValue:b(le).tb_name,"onUpdate:modelValue":a[2]||(a[2]=e=>b(le).tb_name=e)},{default:g((()=>[(_(!0),v(j,null,k(b($),((e,a)=>(_(),f(s,{key:a,value:e.value,label:e.name},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])]),h("div",I,[h("div",T,[a[8]||(a[8]=h("span",{class:""},"搜索内容",-1)),w(u,{class:"ml-8px !w-[28rem]",placeholder:"请输入查询的语句或内容，该字段可为空",modelValue:b(le).search_content,"onUpdate:modelValue":a[3]||(a[3]=e=>b(le).search_content=e)},null,8,["modelValue"])]),h("div",X,[w(i,{type:"primary",onClick:ie,disabled:b(ae)},{default:g((()=>[a[9]||(a[9]=y(" 搜索 ")),V(h("i",F,null,512),[[C,b(ae)]])])),_:1},8,["disabled"]),w(i,{onClick:ne},{default:g((()=>a[10]||(a[10]=[y("索引记录")]))),_:1})])])])]),V(w(r,{"max-height":"420",class:"mt-16px",column:b(ee),data:b(R)},null,8,["column","data"]),[[m,b(ae)],[m,"正在搜索中，请稍后...","title"]]),w(c,{modelValue:b(Y),"onUpdate:modelValue":a[4]||(a[4]=e=>q(Y)?Y.value=e:null),title:"索引记录",area:60},{default:g((()=>[h("div",K,[w(r,{"max-height":"300",class:"w-full mt-24px",column:se,data:b(te)},null,8,["data"])])])),_:1},8,["modelValue"])])])}}});export{L as default};
