import{_ as a}from"./index90.js?v=1734676359";import{u as t,o as e,M as s,G as l,k as i,t as n}from"./utils-lib.js?v=1734676359";import{c as r,r as o,R as p,ax as d,h as u,o as c,B as m,k as y,l as v,e as f,p as g,x as b,C as x,z as h,q as j,aT as w,az as _}from"./base-lib.js?v=1734676359";import{deleteDatabase as q,checkDelData as S,checkModulesDelData as T,getMysqlCloudServer as k,getModulesCloudServer as J}from"./database.js?v=1734676359";import{g as M,o as N}from"./useMethod3.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";import"./validator.js?v=1734676359";const O={class:"p-[28px]"},A={key:0,class:"text-danger"},D={key:1,class:"text-danger mt-[4px]"},R=r({__name:"index",props:{compData:{default:()=>({ids:[],isMult:!1})}},setup(r,{expose:R}){const z=r,{refs:{tabActive:C},refreshTableList:H}=M(),{panel:B}=t(),{ids:E,isMult:F}=z.compData,G=o(!1),L=p([]),I=o(B.value.isDbRecycle),K=p([]),P=p(!1),Q=d("popupSetFooter"),U=u({title:"警告",titleType:"warning",description:"删除数据库后，数据库内的所有数据将被清空，且不可恢复。"}),V=async(a,t,e)=>{const{id:i,name:n}=K.value[t],r="mysql"===C.value?null:C.value,o=await l({request:q({id:i,name:n},r)});a.push({id:i,name:n,status:o.status}),t===K.value.length-1&&(H(),e?N(a,{title:"删除数据库"}):s.request(o)),t<K.value.length-1&&V(a,t+1,e)},W=[{label:"数据库名称",prop:"name"},{label:"数据库大小",prop:"total",render:a=>_("span",n(a.total,!0,2))},{label:"数据库位置",render:a=>{var t;let e="本地数据库";return null==(t=L.value)||t.forEach((t=>{t.id===a.sid&&(e="mysql"===C.value?t.db_host:t.ps,"127.0.0.1"===t.db_host&&(e="本地数据库"))})),_("span",e)}},{width:160,label:"创建时间",prop:"addtime"},{width:100,label:"删除结果",render:a=>{let t=0===a.sid;return t&&I.value?_("span","移至回收站"):_("span",{class:"text-danger"},"彻底删除")}}];return c((()=>{(async()=>{let a={data:JSON.stringify({type:C.value})};await l({request:"mysql"===C.value?k():J(a,C.value),data:[Array,L]})})(),(async()=>{Q(!1);const{data:a}=await l({loading:P,request:"mysql"===C.value?S({ids:JSON.stringify(E)}):T({data:JSON.stringify({ids:JSON.stringify(E)})},C.value),data:{data:[Array,K]}});G.value=null==a?void 0:a.some((a=>a.sid)),G.value&&(U.titleType="error",U.description="当前列表存在彻底删除后无法恢复的数据库，请仔细查看列表，以防误删，是否继续操作？"),Q(!0)})()})),R({onConfirm:async a=>{await e({type:"input",title:"二次验证信息-删除数据库",content:'移至回收站的数据库如需彻底删除请前往数据库回收站，<span class="text-danger">远程数据库将直接彻底删除</span>，是否继续操作？',icon:"warning-filled",isHtml:!0,input:{content:"删除数据库"}});const t=s.load("正在删除...");await V([],0,F),t.close(),a()}}),(t,e)=>{const s=w,l=i,n=a,r=m("bt-loading");return y(),v("div",O,[f(s,{title:"警告",type:g(U).titleType,"show-icon":"",closable:!1,description:g(U).description},null,8,["type","description"]),f(n,null,{content:b((()=>[x(f(l,{ref:"deleteRef",data:g(K),column:g(W),"max-height":300},null,8,["data","column"]),[[r,g(P)],[r,"正在检查删除数据，请稍候...","title"]])])),_:1}),g(G)?(y(),v("p",A,"注意：远程数据库暂不支持数据库回收站，选中的数据库将彻底删除")):h("",!0),e[0]||(e[0]=j("p",{class:"text-danger mt-4px"},"请仔细阅读以上要删除信息，防止数据库被误删",-1)),g(I)||g(G)?h("",!0):(y(),v("p",D,"当前数据库回收站尚未开启,请谨慎操作!"))])}}});export{R as default};
