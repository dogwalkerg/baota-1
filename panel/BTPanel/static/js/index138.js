import{u as a,aA as e,aM as t,cw as s,a5 as l,c as n,a6 as o,a1 as r,H as i,o as c,cx as u,b as p,e as m,bJ as d,G as v,cy as f,a7 as x,_ as g,d as h,cz as y,l as k,cA as w,X as b,bb as _}from"./utils-lib.js?v=1734676359";import{c as A,r as T,ax as j,o as I,B as L,C as B,p as C,k as E,l as S,q as R,e as z,x as O,y as Z,z as q,I as V,aX as M,n as X,au as D,aY as F,v as G,F as J,J as P,ar as Q,i as K,w as H,W as U}from"./base-lib.js?v=1734676359";import{_ as Y}from"./index91.js?v=1734676359";import{w as N}from"./validator.js?v=1734676359";import{_ as W}from"./index90.js?v=1734676359";import{B as $}from"./index87.js?v=1734676359";import{_ as aa}from"./index101.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";const ea={class:"w-full h-full flex flex-col justify-center content-center"},ta={key:0,class:"h-full"},sa={class:"flex align-middle justify-center h-full"},la={key:1,class:"taskList pr-[10px] mb-[10px]"},na={key:0,class:"taskTips flex justify-between"},oa={class:"taskItemHeader"},ra={class:"taskItemName"},ia=["onClick"],ca={key:0,id:"taskRealTimeLogs",class:"taskRealTimeLog"},ua=m(A({__name:"task-list",setup(m,{expose:d}){const{panel:v}=a(),f=p(),x=T(!0),g=T(!0),h=T([]),y=T(""),k=T(!1),w=T(j("msgBoxSockShell",null)),b=[];let _=null;const A=async()=>{try{x.value=!0;const{data:a}=await e();if(t(a)&&void 0!==a.task){const{task:e,msg:t}=a;if(v.value.msgBoxTaskCount=e.length,e.length>0){g.value=!0,h.value=e;const{type:a,status:l}=e[0];"execshell"===a?"-1"===l?(P(),y.value="",y.value=t,X((()=>s("#taskRealTimeLogs"))),k.value=!0):(setTimeout((()=>{A()}),2e3),k.value=!0):k.value=!1}}else v.value.msgBoxTaskCount=0,g.value=!1}catch(a){}finally{x.value=!1}},P=async()=>{w.value||(w.value=l({route:"/sock_shell",onMessage:async(a,e)=>{const{data:t}=e;if(t.indexOf("|-Successify --- 命令已执行! ---")>-1)await A(),await Q(),setTimeout((async()=>{var a;await A(),k.value||(null==(a=w.value)||a.close(),w.value=null,y.value="")}),2e3);else if(o(t)){if(b.push(t),(null==b?void 0:b.length)>50&&b.shift(),r(_))return;_=setTimeout((()=>{y.value=b.join(""),_=null}),500)}}}),w.value.send("tail -n 100 -f /tmp/panelExec.log"))},Q=async()=>{const{useSoftStore:a}=await i((()=>import("./validator.js?v=1734676359").then((a=>a.aG))),__vite__mapDeps([]),import.meta.url),{refreshRouteData:e}=a();e("1")};return d({init:A}),I(A),(a,e)=>{const t=D,s=n,l=F,o=Y,r=L("scroll-bottom"),i=L("bt-loading");return B((E(),S("div",ea,[C(g)?(E(),S("div",la,[C(h).length>0?(E(),S("div",na,[e[3]||(e[3]=R("span",null," 提示：若任务长时间未执行，请尝试点击【重启面板】来重置任务队列 ",-1)),z(s,{onClick:C(N)},{default:O((()=>e[2]||(e[2]=[Z("重启面板")]))),_:1},8,["onClick"])])):q("",!0),z(l,{class:"!my-1rem"}),(E(!0),S(V,null,M(C(h),((a,e)=>(E(),S("div",{key:e,class:"taskItem"},["execshell"===a.type?(E(),S(V,{key:0},[R("div",oa,[R("span",ra,G(a.name),1),R("span",null,[R("span",{class:J({leaveOut:"-1"===a.status})},G("0"===a.status?"等待":"正在安装"),3),z(o),R("span",{class:"bt-link",onClick:e=>(async a=>{var e;let t=null;try{await c({icon:"warning-filled",title:"删除任务",content:"删除当前选中任务，删除后将取消任务执行，是否继续操作？"}),t=f.load("正在删除任务，请稍后...");const s=await u({id:a});f.request(s),s.status&&A(),null==(e=w.value)||e.close()}catch(s){}finally{t.close()}})(a.id)}," 删除 ",8,ia)])]),"-1"===a.status&&"execshell"===a.type?B((E(),S("pre",ca,[Z(G(C(y)),1)])),[[r]]):q("",!0)],64)):q("",!0)])))),128))])):(E(),S("div",ta,[R("div",sa,[z(t,{class:"flex"},{image:O((()=>e[0]||(e[0]=[R("i",{class:"!text-[#999] svgtofont-empty !text-7rem"},null,-1)]))),description:O((()=>e[1]||(e[1]=[R("span",{class:"text-[16px] text-medium"},"当前没有任务执行",-1)]))),_:1})])]))])),[[i,C(x)]])}}}),[["__scopeId","data-v-afa3d1ed"]]),pa={class:"mt-8px leading-8 text-[1.2rem] list-disc ml-20px"},ma={id:"wechat-customer",class:"wechat-customer"},da={class:"customer-title"},va={class:"flex border-solid border-b-1 border-[#20a53a] text-[#20a53a] justify-center items-center"},fa={class:"qrcode-wechat w-[128px] h-[128px] mt-[8px] mb-[4px]"},xa={id:"wechatCustomerQrcode"},ga=m(A({__name:"completed-list",setup(a,{expose:e}){const t=T([{label:"名称",prop:"name",showOverflowTooltip:!0,render:a=>z("div",null,[z("span",{class:"mr-2 font-bold !text-[12px] ".concat(a.install_status?"text-primary svgtofont-el-check":"text-danger svgtofont-el-close")},null),a.name])},{label:"创建时间",prop:"addtime",width:110,render:a=>z("span",null,[a.addtime.replace(/^\d{4}-/,"")])},{label:"任务耗时",width:80,render:a=>z("span",null,[y(a.end-a.start)])},{label:"安装详情",width:140,showOverflowTooltip:!0,render:a=>z("span",{class:a.install_status?"text-primary":"text-danger"},[a.msg||"安装成功"])},{label:"操作",align:"right",width:55,render:a=>null!==a.msg_info?z("span",{class:"text-primary cursor-pointer",onClick:()=>s(a)},[Z("详情")]):""}]),s=a=>k({title:"当前状态：".concat(a.msg_info.title),area:[72,50],compData:a.msg_info,component:()=>i((()=>import("./details.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)}),{BtTable:l,BtPage:o,refresh:r}=d({request:async a=>{try{const{data:e,page:t}=await v({request:f({table:"tasks",search:"1",limit:10,p:a.p}),data:{page:String,data:Array}});return{data:e,total:x(t),other:{}}}catch(e){return{data:[],total:0,other:{}}}},columns:t.value});return e({init:r}),(a,e)=>{const t=g,s=n,r=h,i=$,c=W;return E(),P(c,null,{content:O((()=>[z(C(l)),R("ul",pa,[R("li",null,[e[4]||(e[4]=Z(" 如安装或启动失败，请点击详情，截图相关错误信息 ")),z(i,{placement:"bottom-start",effect:"light","popper-class":"!p-0",trigger:"hover",width:"160px"},{reference:O((()=>e[3]||(e[3]=[R("span",{class:"inline-block bt-link"},"咨询客服",-1)]))),default:O((()=>[R("div",ma,[R("div",da,[z(s,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",class:"text-[16px] cursor-pointer flex flex-row items-center flex-nowrap"},{default:O((()=>[R("div",va,[e[0]||(e[0]=Z(" 点击咨询客服 ")),z(t,{icon:"arrow",size:16,color:"#20a53a",class:"ml-[5px]"})])])),_:1})]),R("div",fa,[R("div",xa,[z(r,{src:"/customer/customer-qrcode.png"})])]),e[1]||(e[1]=R("div",{class:"wechat-title flex"},[R("img",{class:"w-[14px] h-[14px]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),R("div",{class:"text-[14px] font-black"},"扫一扫")],-1)),e[2]||(e[2]=R("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[R("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])])),_:1}),e[5]||(e[5]=Z(" 求助 "))])])])),"footer-right":O((()=>[z(C(o),{"pager-count":5,layout:"prev, pager, next, total, jumper"})])),_:1})}}}),[["__scopeId","data-v-adf403a9"]]),ha=A({__name:"perform-log",setup(a,{expose:e}){const t=T(!1),s=T("获取中..."),l=async()=>{try{const a=await v({loading:t,request:w(),data:String});s.value=a.trim()||"暂无执行日志"}catch(a){}};return e({init:l}),I(l),(a,e)=>{const l=aa,n=L("bt-loading");return B((E(),P(l,{class:"h-50rem",content:C(s)},null,8,["content"])),[[n,C(t)]])}}});var ya=function(a){return a.taskList="taskList",a.completedList="completedList",a.performLog="performLog",a}(ya||{});const ka=A({__name:"index",setup(e,{expose:t}){const{panel:s}=a(),l=Q(s.value,"msgBoxTaskCount"),n=T(0),o=T(null),r=K((()=>"任务列表(".concat(l.value,")"))),i=K((()=>"消息列表(".concat(n.value,")")));H(l,((a,e)=>{e>a&&(n.value+=e-a)}));const{BtTabs:c}=b({type:"left-bg-card",options:[{label:()=>z(V,null,[r.value]),name:ya.taskList,lazy:!0,render:ua},{label:()=>z(V,null,[i.value]),name:"completedList",lazy:!0,render:ga},{label:"执行日志",name:"performLog",lazy:!0,render:ha}]});return I((async()=>{try{const{page:a}=await v({request:_({table:"tasks",search:"1",limit:11}),data:{page:String}});n.value=x(a)}catch(a){}})),U("msgBoxSockShell",o),t({onCancel:()=>{o.value&&(o.value.close(),o.value=null)}}),(a,e)=>(E(),P(C(c)))}});export{ka as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
