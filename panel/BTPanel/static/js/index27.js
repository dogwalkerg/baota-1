import{u as e,b2 as a,l as t,H as s,G as n,t as l,M as o,o as r,c as i,F as c,a8 as u,k as m,V as d,ai as p,e as _}from"./utils-lib.js?v=1734676359";import{_ as v}from"./index90.js?v=1734676359";import{_ as g}from"./index97.js?v=1734676359";import{_ as b}from"./index182.js?v=1734676359";import{g as f,z as h,A as k,B as y,x as w,C as x,y as E,D as j}from"./useStore3.js?v=1734676359";import{c as C,r as D,h as T,R as N,w as S,o as q,n as R,a1 as I,B as L,k as M,l as O,e as A,x as V,q as P,p as B,y as J,C as U}from"./base-lib.js?v=1734676359";import{a as H,N as F,b as z,c as G,d as K,r as W,C as Q,t as X,o as Y}from"./useMethods.js?v=1734676359";import{u as Z}from"./use-socket-request.js?v=1734676359";import"./__commonjsHelpers__.js?v=1734676359";import"./column.js?v=1734676359";import"./index91.js?v=1734676359";const $={class:"relative container-table-tab p-[1.6rem]"},ee={class:"flex items-center"},ae=_(C({__name:"index",setup(_,{expose:C}){const{refs:{refreshWs:ae,isRefreshTableList:te,customLimit:se,cpuAndMemData:ne},resetRefresh:le}=f(),{mainHeight:oe}=e(),re=D(null),ie=T({loading:!1,total:0,p:1,limit:Number(localStorage.getItem("dockercontainerlimit"))||20,usedList:[],search:""}),ce=D([]),ue=N([]),me=D([]),de=D("all"),pe=[{label:"启动",value:"start",event:z},{label:"重启",value:"restart",event:z},{label:"停止",value:"stop",event:z},{label:"强制停止",value:"kill",event:z},{label:"暂停",value:"pause",event:z},{label:"恢复",value:"unpause",event:z},{label:"删除",value:"delete",event:z}],_e=[{active:!0,content:"创建容器",event:()=>G()},{content:"日志管理",event:()=>Te()},{content:"清理容器",event:()=>Se()},{content:"安全检测",event:async()=>{t({title:"安全检测",area:70,component:()=>s((()=>import("./images-safe-scan-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})}},{content:"容器分组 ",event:()=>{t({title:"容器分组",area:60,component:()=>s((()=>import("./index180.js?v=1734676359")),__vite__mapDeps([]),import.meta.url)})}}],ve=()=>{se.value.container=!0,localStorage.setItem("dockercontainerlimit",String(ie.limit)),De(!1)},ge=async e=>{n({loading:"正在获取容器目录，请稍候...",request:x({data:JSON.stringify({id:e.id})}),success:e=>{p("Path",e.data.path),window.location.href=window.location.origin+"/files"},error:e=>{o.error((null==e?void 0:e.msg)||"获取容器目录失败")}})},be=async()=>{if(ie.p=1,""===ie.search)return ie.total=ce.value.length,void De(!1);const e=ie.search.toLowerCase(),a=["name","id","image"],t=ce.value.filter((t=>a.some((a=>{var s;return null==(s=t[a])?void 0:s.toLowerCase().includes(e)}))));ie.total=t.length,ue.value=K({limit:ie.limit,list:t,p:ie.p})||[]},fe=D(H({reNameEvent:e=>W(e),realMonitorEvent:e=>Q(e),terminalEvent:X,dirEvent:ge,logDataEvent:e=>Te(e),deleteDataEvent:async e=>{try{await r({title:"删除容器【".concat(e.name,"】"),content:"删除容器【".concat(e.name,"】,是否继续操作？")}),n({loading:"正在删除容器，请稍候...",request:E({data:JSON.stringify({id:e.id})}),message:!0,success:De})}catch(a){}},conDetailEvent:Y,setStatusEvent:async(e,a)=>{n({loading:"正在设置容器状态，请稍候...",request:w({data:JSON.stringify({id:e.id,status:a})}),message:!0,success:De})},openContainerBackups:e=>Ne(e),openProxyDetails:e=>Y(e,"proxy"),changeTaskTopEvent:async(e,a)=>{n({loading:"正在设置容器置顶，请稍候...",request:j({type:"top"==a?"add":"del",container_name:e.name}),message:!0,success:()=>{e.is_top="top"==a?1:0,je()}})},moreEvent:(e,a)=>{switch(e){case"terminal":X(a);break;case"reName":W(a);break;case"realMonitor":Q(a);break;case"proxyDetails":Y(a,"proxy");break;case"dir":ge(a);break;case"log":Te(a)}},setStatusTitle:async e=>{var a;if("all"===e)return de.value=e,await De();ue.value=(null==(a=me.value[e])?void 0:a.map((e=>{const a=ce.value.find((a=>a.id===e.id));return{...e,backup_count:(null==a?void 0:a.backup_count)||0,remark:(null==a?void 0:a.remark)||""}})))||[]},statusFilterKey:de}));let he=null;const ke=async e=>{try{const a=e;a.data.container_stats_data&&xe(a.data),a.end&&(null==he||he.socketRequest({params:{model_index:"btdocker",mod_name:"container",def_name:"get_all_stats",ws_callback:"get_all_stats"},onMessage:ke}))}catch(a){}},ye=async()=>{null==he||he.socketDestroy(),he=Z("/ws_model");null==he||he.socketRequest({params:{model_index:"btdocker",mod_name:"container",def_name:"get_all_stats",ws_callback:"get_all_stats"},onMessage:ke})};S((()=>ae.value),(e=>{e&&(ae.value=!1,ye())}));const we=e=>e.id,xe=e=>{if(!e.container_stats_data)return;const a=e.container_stats_data;ue.value.forEach((e=>{if("running"===e.status){const t=a.find((a=>a.id==e.id));t&&(ne.value[e.id]={cpu_usage:t.cpu_usage||0,mem_percent:t.mem_percent||0})}}))},Ee=()=>{null==he||he.socketDestroy(),he=null},je=()=>{ce.value=ce.value.sort(((e,a)=>1==e.is_top&&1!=a.is_top?-1:1!=e.is_top&&1==a.is_top?1:e.created_time>a.created_time?-1:1)),ue.value=K({limit:ie.limit,list:ce.value,p:ie.p})||[]};let Ce=!0;const De=async e=>{!1!==e?(Ce&&(ie.loading=!0),n({request:h(),data:{container_list:Array,grouped_by_status:Object,mem_total:Number,online_cpus:Number},success:e=>{Ce=!1;const a=e.container_list;e.container_list.forEach((e=>{ne.value[e.id]={cpu_usage:0,mem_percent:0}})),ce.value=a,ie.total=a.length,ue.value=K({...ie,list:a})||[],ie.loading=!1,me.value=e,ie.maxCPU=e.online_cpus,ie.maxMem=Number(l(Number(e.mem_total),!1,0,"MB")),n({request:k(),data:Array,success:e=>{ce.value.forEach(((a,t)=>{const s=e.find((e=>e.id===a.id));s&&(a.backup_count=s.backup_count,a.remark=s.remark)})),ye()}})}})):ue.value=K({...ie,list:ce.value})||[]},Te=(e={})=>{if(!ce.value.length)return o.error("容器列表为空");t({component:()=>s((()=>import("./index181.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"容器日志",area:88,compData:{row:e,list:ce.value}})},Ne=e=>t({component:()=>s((()=>import("./container-backups-dialog.js?v=1734676359")),__vite__mapDeps([]),import.meta.url),title:"备份容器 - ["+e.name+"]",area:79,compData:{row:e}}),Se=async()=>{await r({content:"将删除所有已停止、未使用的容器,是否继续？",title:"清理容器",width:"42rem",type:"check",check:{content:'删除<span class="text-danger">所有</span>容器，包含正在运行的容器',onConfirm:async e=>{ie.loading=!0,n({request:y({type:e?1:0}),message:!0,success:De,error:()=>{ie.loading=!1}})}}})};return S((()=>te.value),(e=>{e&&(le(),De())})),q((async()=>{fe.value=a(JSON.parse(localStorage.getItem("dockerContainerTableColumn")||"[]")||[],fe.value),De(),R((()=>{se.value.container||setTimeout((()=>{oe.value>900?ie.limit=20:ie.limit=10}),0)}))})),C({init:De,destroy:Ee}),I((()=>Ee())),(e,a)=>{const t=b,s=i,n=c,l=u,o=m,r=d,p=g,_=v,f=L("bt-loading");return M(),O("div",$,[A(_,null,{"header-left":V((()=>[P("div",ee,[A(t,{options:_e}),A(s,{class:"ml-[1.6rem]",onClick:B(F)},{default:V((()=>a[3]||(a[3]=[J("需求反馈")]))),_:1},8,["onClick"]),A(s,{class:"ml-[1.6rem]",href:"https://www.bt.cn/bbs/thread-140412-1-1.html"},{default:V((()=>a[4]||(a[4]=[J(">>使用帮助")]))),_:1})])])),"header-right":V((()=>[A(n,{class:"!w-[26rem] mr-1rem",modelValue:B(ie).search,"onUpdate:modelValue":a[0]||(a[0]=e=>B(ie).search=e),onSearch:be,onClear:be,placeholder:"请输入容器名、ID、容器镜像"},null,8,["modelValue"]),A(l,{name:"dockerContainerTableColumn",column:B(fe),tableRef:B(re)},null,8,["column","tableRef"])])),content:V((()=>[U(A(o,{ref_key:"containerTable",ref:re,key:"containerTable",column:B(fe),data:B(ue),"row-key":we,description:"容器列表为空","max-height":B(oe)-230},null,8,["column","data","max-height"]),[[f,B(ie).loading],[f,"正在加载容器列表，请稍后...","title"]])])),"footer-left":V((()=>[A(r,{"table-ref":B(re),options:pe},null,8,["table-ref"])])),"footer-right":V((()=>[A(p,{page:B(ie).p,"onUpdate:page":a[1]||(a[1]=e=>B(ie).p=e),row:B(ie).limit,"onUpdate:row":a[2]||(a[2]=e=>B(ie).limit=e),total:B(ie).total,onChange:ve},null,8,["page","row","total"])])),_:1})])}}}),[["__scopeId","data-v-809d6721"]]);export{ae as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
